!function e(t,n,i){function r(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return r(n?n:e)},u,u.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t,n){"use strict";function i(){if(c.length)throw c.shift()}function r(e){var t;t=a.length?a.pop():new o,t.task=e,s(t)}function o(){this.task=null}var s=e("./raw"),a=[],c=[],l=s.makeRequestCallFromTimer(i);t.exports=r,o.prototype.call=function(){try{this.task.call()}catch(e){r.onerror?r.onerror(e):(c.push(e),l())}finally{this.task=null,a[a.length]=this}}},{"./raw":2}],2:[function(e,t,n){(function(e){"use strict";function n(e){a.length||(s(),c=!0),a[a.length]=e}function i(){for(;l<a.length;){var e=l;if(l+=1,a[e].call(),l>u){for(var t=0,n=a.length-l;t<n;t++)a[t]=a[t+l];a.length-=l,l=0}}a.length=0,l=0,c=!1}function r(e){var t=1,n=new h(e),i=document.createTextNode("");return n.observe(i,{characterData:!0}),function(){t=-t,i.data=t}}function o(e){return function(){function t(){clearTimeout(n),clearInterval(i),e()}var n=setTimeout(t,0),i=setInterval(t,50)}}t.exports=n;var s,a=[],c=!1,l=0,u=1024,d="undefined"!=typeof e?e:self,h=d.MutationObserver||d.WebKitMutationObserver;s="function"==typeof h?r(i):o(i),n.requestFlush=s,n.makeRequestCallFromTimer=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,t,n){"use strict";function i(e,t,n){var i,r=e instanceof Error?e:new Error(e);if("object"==typeof t?n=t:null!=t&&(r.code=t),n)for(i in n)r[i]=n[i];return r}t.exports=i},{}],4:[function(e,t,n){"use strict";var i=e("./util/constants"),r=e("./mixins/logging"),o={VERSION:i.VERSION,Client:e("./protocol/client"),Scheduler:e("./protocol/scheduler")};r.wrapper=o,t.exports=o},{"./mixins/logging":6,"./protocol/client":10,"./protocol/scheduler":16,"./util/constants":28}],5:[function(e,t,n){(function(n){"use strict";var i=e("../util/promise");t.exports={then:function(e,t){var n=this;return this._promise||(this._promise=new i(function(e,t){n._resolve=e,n._reject=t})),0===arguments.length?this._promise:this._promise.then(e,t)},callback:function(e,t){return this.then(function(n){e.call(t,n)})},errback:function(e,t){return this.then(null,function(n){e.call(t,n)})},timeout:function(e,t){this.then();var i=this;this._timer=n.setTimeout(function(){i._reject(t)},1e3*e)},setDeferredStatus:function(e,t){this._timer&&n.clearTimeout(this._timer),this.then(),"succeeded"===e?this._resolve(t):"failed"===e?this._reject(t):delete this._promise}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util/promise":33}],6:[function(e,t,n){"use strict";var i=e("../util/to_json"),r={LOG_LEVELS:{fatal:4,error:3,warn:2,info:1,debug:0},writeLog:function(e,t){var n=r.logger||(r.wrapper||r).logger;if(n){var o=Array.prototype.slice.apply(e),s="[Faye",a=this.className,c=o.shift().replace(/\?/g,function(){try{return i(o.shift())}catch(e){return"[Object]"}});a&&(s+="."+a),s+="] ","function"==typeof n[t]?n[t](s+c):"function"==typeof n&&n(s+c)}}};for(var o in r.LOG_LEVELS)(function(e){r[e]=function(){this.writeLog(arguments,e)}})(o);t.exports=r},{"../util/to_json":35}],7:[function(e,t,n){"use strict";var i=e("../util/extend"),r=e("../util/event_emitter"),o={countListeners:function(e){return this.listeners(e).length},bind:function(e,t,n){var i=Array.prototype.slice,r=function(){t.apply(n,i.call(arguments))};return this._listeners=this._listeners||[],this._listeners.push([e,t,n,r]),this.on(e,r)},unbind:function(e,t,n){this._listeners=this._listeners||[];for(var i,r=this._listeners.length;r--;)i=this._listeners[r],i[0]===e&&(!t||i[1]===t&&i[2]===n)&&(this._listeners.splice(r,1),this.removeListener(e,i[3]))}};i(o,r.prototype),o.trigger=o.emit,t.exports=o},{"../util/event_emitter":31,"../util/extend":32}],8:[function(e,t,n){(function(e){"use strict";t.exports={addTimeout:function(t,n,i,r){if(this._timeouts=this._timeouts||{},!this._timeouts.hasOwnProperty(t)){var o=this;this._timeouts[t]=e.setTimeout(function(){delete o._timeouts[t],i.call(r)},1e3*n)}},removeTimeout:function(t){this._timeouts=this._timeouts||{};var n=this._timeouts[t];n&&(e.clearTimeout(n),delete this._timeouts[t])},removeAllTimeouts:function(){this._timeouts=this._timeouts||{};for(var e in this._timeouts)this.removeTimeout(e)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(e,t,n){"use strict";var i=e("../util/class"),r=e("../util/extend"),o=e("../mixins/publisher"),s=e("./grammar"),a=i({initialize:function(e){this.id=this.name=e},push:function(e){this.trigger("message",e)},isUnused:function(){return 0===this.countListeners("message")}});r(a.prototype,o),r(a,{HANDSHAKE:"/meta/handshake",CONNECT:"/meta/connect",SUBSCRIBE:"/meta/subscribe",UNSUBSCRIBE:"/meta/unsubscribe",DISCONNECT:"/meta/disconnect",META:"meta",SERVICE:"service",expand:function(e){var t=this.parse(e),n=["/**",e],i=t.slice();i[i.length-1]="*",n.push(this.unparse(i));for(var r=1,o=t.length;r<o;r++)i=t.slice(0,r),i.push("**"),n.push(this.unparse(i));return n},isValid:function(e){return s.CHANNEL_NAME.test(e)||s.CHANNEL_PATTERN.test(e)},parse:function(e){return this.isValid(e)?e.split("/").slice(1):null},unparse:function(e){return"/"+e.join("/")},isMeta:function(e){var t=this.parse(e);return t?t[0]===this.META:null},isService:function(e){var t=this.parse(e);return t?t[0]===this.SERVICE:null},isSubscribable:function(e){return this.isValid(e)?!this.isMeta(e)&&!this.isService(e):null},Set:i({initialize:function(){this._channels={}},getKeys:function(){var e=[];for(var t in this._channels)e.push(t);return e},remove:function(e){delete this._channels[e]},hasSubscription:function(e){return this._channels.hasOwnProperty(e)},subscribe:function(e,t){for(var n,i=0,r=e.length;i<r;i++){n=e[i];var o=this._channels[n]=this._channels[n]||new a(n);o.bind("message",t)}},unsubscribe:function(e,t){var n=this._channels[e];return!!n&&(n.unbind("message",t),!!n.isUnused()&&(this.remove(e),!0))},distributeMessage:function(e){for(var t=a.expand(e.channel),n=0,i=t.length;n<i;n++){var r=this._channels[t[n]];r&&r.trigger("message",e)}}})}),t.exports=a},{"../mixins/publisher":7,"../util/class":27,"../util/extend":32,"./grammar":14}],10:[function(e,t,n){(function(n){"use strict";var i=e("asap"),r=e("../util/class"),o=(e("../util/promise"),e("../util/uri")),s=e("../util/array"),a=e("../util/browser"),c=e("../util/constants"),l=e("../util/extend"),u=e("../util/validate_options"),d=e("../mixins/deferrable"),h=e("../mixins/logging"),f=e("../mixins/publisher"),p=e("./channel"),m=e("./dispatcher"),g=e("./error"),v=e("./extensible"),_=e("./publication"),w=e("./subscription"),b=r({className:"Client",UNCONNECTED:1,CONNECTING:2,CONNECTED:3,DISCONNECTED:4,HANDSHAKE:"handshake",RETRY:"retry",NONE:"none",CONNECTION_TIMEOUT:60,DEFAULT_ENDPOINT:"/bayeux",INTERVAL:0,initialize:function(e,t){this.info("New client created for ?",e),t=t||{},u(t,["interval","timeout","endpoints","proxy","retry","scheduler","websocketExtensions","tls","ca"]),this._channels=new p.Set,this._dispatcher=m.create(this,e||this.DEFAULT_ENDPOINT,t),this._messageId=0,this._state=this.UNCONNECTED,this._responseCallbacks={},this._advice={reconnect:this.RETRY,interval:1e3*(t.interval||this.INTERVAL),timeout:1e3*(t.timeout||this.CONNECTION_TIMEOUT)},this._dispatcher.timeout=this._advice.timeout/1e3,this._dispatcher.bind("message",this._receiveMessage,this),a.Event&&void 0!==n.onbeforeunload&&a.Event.on(n,"beforeunload",function(){s.indexOf(this._dispatcher._disabled,"autodisconnect")<0&&this.disconnect()},this)},addWebsocketExtension:function(e){return this._dispatcher.addWebsocketExtension(e)},disable:function(e){return this._dispatcher.disable(e)},setHeader:function(e,t){return this._dispatcher.setHeader(e,t)},handshake:function(e,t){if(this._advice.reconnect!==this.NONE&&this._state===this.UNCONNECTED){this._state=this.CONNECTING;var r=this;this.info("Initiating handshake with ?",o.stringify(this._dispatcher.endpoint)),this._dispatcher.selectTransport(c.MANDATORY_CONNECTION_TYPES),this._sendMessage({channel:p.HANDSHAKE,version:c.BAYEUX_VERSION,supportedConnectionTypes:this._dispatcher.getConnectionTypes()},{},function(o){o.successful?(this._state=this.CONNECTED,this._dispatcher.clientId=o.clientId,this._dispatcher.selectTransport(o.supportedConnectionTypes),this.info("Handshake successful: ?",this._dispatcher.clientId),this.subscribe(this._channels.getKeys(),!0),e&&i(function(){e.call(t)})):(this.info("Handshake unsuccessful"),n.setTimeout(function(){r.handshake(e,t)},1e3*this._dispatcher.retry),this._state=this.UNCONNECTED)},this)}},connect:function(e,t){if(this._advice.reconnect!==this.NONE&&this._state!==this.DISCONNECTED){if(this._state===this.UNCONNECTED)return this.handshake(function(){this.connect(e,t)},this);this.callback(e,t),this._state===this.CONNECTED&&(this.info("Calling deferred actions for ?",this._dispatcher.clientId),this.setDeferredStatus("succeeded"),this.setDeferredStatus("unknown"),this._connectRequest||(this._connectRequest=!0,this.info("Initiating connection for ?",this._dispatcher.clientId),this._sendMessage({channel:p.CONNECT,clientId:this._dispatcher.clientId,connectionType:this._dispatcher.connectionType},{},this._cycleConnection,this)))}},disconnect:function(){if(this._state===this.CONNECTED){this._state=this.DISCONNECTED,this.info("Disconnecting ?",this._dispatcher.clientId);var e=new _;return this._sendMessage({channel:p.DISCONNECT,clientId:this._dispatcher.clientId},{},function(t){t.successful?(this._dispatcher.close(),e.setDeferredStatus("succeeded")):e.setDeferredStatus("failed",g.parse(t.error))},this),this.info("Clearing channel listeners for ?",this._dispatcher.clientId),this._channels=new p.Set,e}},subscribe:function(e,t,n){if(e instanceof Array)return s.map(e,function(e){return this.subscribe(e,t,n)},this);var i=new w(this,e,t,n),r=t===!0,o=this._channels.hasSubscription(e);return o&&!r?(this._channels.subscribe([e],i),i.setDeferredStatus("succeeded"),i):(this.connect(function(){this.info("Client ? attempting to subscribe to ?",this._dispatcher.clientId,e),r||this._channels.subscribe([e],i),this._sendMessage({channel:p.SUBSCRIBE,clientId:this._dispatcher.clientId,subscription:e},{},function(t){if(!t.successful)return i.setDeferredStatus("failed",g.parse(t.error)),this._channels.unsubscribe(e,i);var n=[].concat(t.subscription);this.info("Subscription acknowledged for ? to ?",this._dispatcher.clientId,n),i.setDeferredStatus("succeeded")},this)},this),i)},unsubscribe:function(e,t){if(e instanceof Array)return s.map(e,function(e){return this.unsubscribe(e,t)},this);var n=this._channels.unsubscribe(e,t);n&&this.connect(function(){this.info("Client ? attempting to unsubscribe from ?",this._dispatcher.clientId,e),this._sendMessage({channel:p.UNSUBSCRIBE,clientId:this._dispatcher.clientId,subscription:e},{},function(e){if(e.successful){var t=[].concat(e.subscription);this.info("Unsubscription acknowledged for ? from ?",this._dispatcher.clientId,t)}},this)},this)},publish:function(e,t,n){u(n||{},["attempts","deadline"]);var i=new _;return this.connect(function(){this.info("Client ? queueing published message to ?: ?",this._dispatcher.clientId,e,t),this._sendMessage({channel:e,data:t,clientId:this._dispatcher.clientId},n,function(e){e.successful?i.setDeferredStatus("succeeded"):i.setDeferredStatus("failed",g.parse(e.error))},this)},this),i},_sendMessage:function(e,t,n,i){e.id=this._generateMessageId();var r=this._advice.timeout?1.2*this._advice.timeout/1e3:1.2*this._dispatcher.retry;this.pipeThroughExtensions("outgoing",e,null,function(e){e&&(n&&(this._responseCallbacks[e.id]=[n,i]),this._dispatcher.sendMessage(e,r,t||{}))},this)},_generateMessageId:function(){return this._messageId+=1,this._messageId>=Math.pow(2,32)&&(this._messageId=0),this._messageId.toString(36)},_receiveMessage:function(e){var t,n=e.id;void 0!==e.successful&&(t=this._responseCallbacks[n],delete this._responseCallbacks[n]),this.pipeThroughExtensions("incoming",e,null,function(e){e&&(e.advice&&this._handleAdvice(e.advice),this._deliverMessage(e),t&&t[0].call(t[1],e))},this)},_handleAdvice:function(e){l(this._advice,e),this._dispatcher.timeout=this._advice.timeout/1e3,this._advice.reconnect===this.HANDSHAKE&&this._state!==this.DISCONNECTED&&(this._state=this.UNCONNECTED,this._dispatcher.clientId=null,this._cycleConnection())},_deliverMessage:function(e){e.channel&&void 0!==e.data&&(this.info("Client ? calling listeners for ? with ?",this._dispatcher.clientId,e.channel,e.data),this._channels.distributeMessage(e))},_cycleConnection:function(){this._connectRequest&&(this._connectRequest=null,this.info("Closed connection for ?",this._dispatcher.clientId));var e=this;n.setTimeout(function(){e.connect()},this._advice.interval)}});l(b.prototype,d),l(b.prototype,f),l(b.prototype,h),l(b.prototype,v),t.exports=b}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../mixins/deferrable":5,"../mixins/logging":6,"../mixins/publisher":7,"../util/array":25,"../util/browser":26,"../util/class":27,"../util/constants":28,"../util/extend":32,"../util/promise":33,"../util/uri":36,"../util/validate_options":37,"./channel":9,"./dispatcher":11,"./error":12,"./extensible":13,"./publication":15,"./subscription":17,asap:1}],11:[function(e,t,n){(function(n){"use strict";var i=e("../util/class"),r=e("../util/uri"),o=e("../util/cookies"),s=e("../util/extend"),a=e("../mixins/logging"),c=e("../mixins/publisher"),l=e("../transport"),u=e("./scheduler"),d=i({className:"Dispatcher",MAX_REQUEST_SIZE:2048,DEFAULT_RETRY:5,UP:1,DOWN:2,initialize:function(e,t,n){this._client=e,this.endpoint=r.parse(t),this._alternates=n.endpoints||{},this.cookies=o.CookieJar&&new o.CookieJar,this._disabled=[],this._envelopes={},this.headers={},this.retry=n.retry||this.DEFAULT_RETRY,this._scheduler=n.scheduler||u,this._state=0,this.transports={},this.wsExtensions=[],this.proxy=n.proxy||{},"string"==typeof this._proxy&&(this._proxy={origin:this._proxy});var i=n.websocketExtensions;if(i){i=[].concat(i);for(var s=0,a=i.length;s<a;s++)this.addWebsocketExtension(i[s])}this.tls=n.tls||{},this.tls.ca=this.tls.ca||n.ca;for(var c in this._alternates)this._alternates[c]=r.parse(this._alternates[c]);this.maxRequestSize=this.MAX_REQUEST_SIZE},endpointFor:function(e){return this._alternates[e]||this.endpoint},addWebsocketExtension:function(e){this.wsExtensions.push(e)},disable:function(e){this._disabled.push(e)},setHeader:function(e,t){this.headers[e]=t},close:function(){var e=this._transport;delete this._transport,e&&e.close()},getConnectionTypes:function(){return l.getConnectionTypes()},selectTransport:function(e){l.get(this,e,this._disabled,function(e){this.debug("Selected ? transport for ?",e.connectionType,r.stringify(e.endpoint)),e!==this._transport&&(this._transport&&this._transport.close(),this._transport=e,this.connectionType=e.connectionType)},this)},sendMessage:function(e,t,n){n=n||{};var i,r=e.id,o=n.attempts,s=n.deadline&&(new Date).getTime()+1e3*n.deadline,a=this._envelopes[r];a||(i=new this._scheduler(e,{timeout:t,interval:this.retry,attempts:o,deadline:s}),a=this._envelopes[r]={message:e,scheduler:i}),this._sendEnvelope(a)},_sendEnvelope:function(e){if(this._transport&&!e.request&&!e.timer){var t=e.message,i=e.scheduler,r=this;if(!i.isDeliverable())return i.abort(),void delete this._envelopes[t.id];e.timer=n.setTimeout(function(){r.handleError(t)},1e3*i.getTimeout()),i.send(),e.request=this._transport.sendMessage(t)}},handleResponse:function(e){var t=this._envelopes[e.id];void 0!==e.successful&&t&&(t.scheduler.succeed(),delete this._envelopes[e.id],n.clearTimeout(t.timer)),this.trigger("message",e),this._state!==this.UP&&(this._state=this.UP,this._client.trigger("transport:up"))},handleError:function(e,t){var i=this._envelopes[e.id],r=i&&i.request,o=this;if(r){r.then(function(e){e&&e.abort&&e.abort()});var s=i.scheduler;s.fail(),n.clearTimeout(i.timer),i.request=i.timer=null,t?this._sendEnvelope(i):i.timer=n.setTimeout(function(){i.timer=null,o._sendEnvelope(i)},1e3*s.getInterval()),this._state!==this.DOWN&&(this._state=this.DOWN,this._client.trigger("transport:down"))}}});d.create=function(e,t,n){return new d(e,t,n)},s(d.prototype,c),s(d.prototype,a),t.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../mixins/logging":6,"../mixins/publisher":7,"../transport":18,"../util/class":27,"../util/cookies":29,"../util/extend":32,"../util/uri":36,"./scheduler":16}],12:[function(e,t,n){"use strict";var i=e("../util/class"),r=e("./grammar"),o=i({initialize:function(e,t,n){this.code=e,this.params=Array.prototype.slice.call(t),this.message=n},toString:function(){return this.code+":"+this.params.join(",")+":"+this.message}});o.parse=function(e){if(e=e||"",!r.ERROR.test(e))return new o(null,[],e);var t=e.split(":"),n=parseInt(t[0]),i=t[1].split(","),e=t[2];return new o(n,i,e)};var s={versionMismatch:[300,"Version mismatch"],conntypeMismatch:[301,"Connection types not supported"],extMismatch:[302,"Extension mismatch"],badRequest:[400,"Bad request"],clientUnknown:[401,"Unknown client"],parameterMissing:[402,"Missing required parameter"],channelForbidden:[403,"Forbidden channel"],channelUnknown:[404,"Unknown channel"],channelInvalid:[405,"Invalid channel"],extUnknown:[406,"Unknown extension"],publishFailed:[407,"Failed to publish"],serverError:[500,"Internal server error"]};for(var a in s)(function(e){o[e]=function(){return new o(s[e][0],arguments,s[e][1]).toString()}})(a);t.exports=o},{"../util/class":27,"./grammar":14}],13:[function(e,t,n){"use strict";var i=e("../util/extend"),r=e("../mixins/logging"),o={addExtension:function(e){this._extensions=this._extensions||[],this._extensions.push(e),e.added&&e.added(this)},removeExtension:function(e){if(this._extensions)for(var t=this._extensions.length;t--;)this._extensions[t]===e&&(this._extensions.splice(t,1),e.removed&&e.removed(this))},pipeThroughExtensions:function(e,t,n,i,r){if(this.debug("Passing through ? extensions: ?",e,t),!this._extensions)return i.call(r,t);var o=this._extensions.slice(),s=function(t){if(!t)return i.call(r,t);var a=o.shift();if(!a)return i.call(r,t);var c=a[e];return c?void(c.length>=3?a[e](t,n,s):a[e](t,s)):s(t)};s(t)}};i(o,r),t.exports=o},{"../mixins/logging":6,"../util/extend":32}],14:[function(e,t,n){"use strict";t.exports={CHANNEL_NAME:/^\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*$/,CHANNEL_PATTERN:/^(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*\/\*{1,2}$/,ERROR:/^([0-9][0-9][0-9]:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*(,(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)*:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*|[0-9][0-9][0-9]::(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)$/,VERSION:/^([0-9])+(\.(([a-z]|[A-Z])|[0-9])(((([a-z]|[A-Z])|[0-9])|\-|\_))*)*$/}},{}],15:[function(e,t,n){"use strict";var i=e("../util/class"),r=e("../mixins/deferrable");t.exports=i(r)},{"../mixins/deferrable":5,"../util/class":27}],16:[function(e,t,n){"use strict";var i=e("../util/extend"),r=function(e,t){this.message=e,this.options=t,this.attempts=0};i(r.prototype,{getTimeout:function(){return this.options.timeout},getInterval:function(){return this.options.interval},isDeliverable:function(){var e=this.options.attempts,t=this.attempts,n=this.options.deadline,i=(new Date).getTime();return!(void 0!==e&&t>=e)&&!(void 0!==n&&i>n)},send:function(){this.attempts+=1},succeed:function(){},fail:function(){},abort:function(){}}),t.exports=r},{"../util/extend":32}],17:[function(e,t,n){"use strict";var i=e("../util/class"),r=e("../util/extend"),o=e("../mixins/deferrable"),s=i({initialize:function(e,t,n,i){this._client=e,this._channels=t,this._callback=n,this._context=i,this._cancelled=!1},withChannel:function(e,t){return this._withChannel=[e,t],this},apply:function(e,t){var n=t[0];this._callback&&this._callback.call(this._context,n.data),this._withChannel&&this._withChannel[0].call(this._withChannel[1],n.channel,n.data)},cancel:function(){this._cancelled||(this._client.unsubscribe(this._channels,this),this._cancelled=!0)},unsubscribe:function(){this.cancel()}});r(s.prototype,o),t.exports=s},{"../mixins/deferrable":5,"../util/class":27,"../util/extend":32}],18:[function(e,t,n){"use strict";var i=e("./transport");i.register("websocket",e("./web_socket")),i.register("eventsource",e("./event_source")),i.register("long-polling",e("./xhr")),i.register("cross-origin-long-polling",e("./cors")),i.register("callback-polling",e("./jsonp")),t.exports=i},{"./cors":19,"./event_source":20,"./jsonp":21,"./transport":22,"./web_socket":23,"./xhr":24}],19:[function(e,t,n){(function(n){"use strict";var i=e("../util/class"),r=e("../util/set"),o=e("../util/uri"),s=e("../util/extend"),a=e("../util/to_json"),c=e("./transport"),l=s(i(c,{encode:function(e){return"message="+encodeURIComponent(a(e))},request:function(e){var t,i=n.XDomainRequest?XDomainRequest:XMLHttpRequest,r=new i,s=++l._id,a=this._dispatcher.headers,c=this;if(r.open("POST",o.stringify(this.endpoint),!0),r.setRequestHeader){r.setRequestHeader("Pragma","no-cache");for(t in a)a.hasOwnProperty(t)&&r.setRequestHeader(t,a[t])}var u=function(){return!!r&&(l._pending.remove(s),r.onload=r.onerror=r.ontimeout=r.onprogress=null,void(r=null))};return r.onload=function(){var t;try{t=JSON.parse(r.responseText)}catch(e){}u(),t?c._receive(t):c._handleError(e)},r.onerror=r.ontimeout=function(){u(),c._handleError(e)},r.onprogress=function(){},i===n.XDomainRequest&&l._pending.add({id:s,xhr:r}),r.send(this.encode(e)),r}}),{_id:0,_pending:new r,isUsable:function(e,t,i,r){if(o.isSameOrigin(t))return i.call(r,!1);if(n.XDomainRequest)return i.call(r,t.protocol===location.protocol);if(n.XMLHttpRequest){var s=new XMLHttpRequest;return i.call(r,void 0!==s.withCredentials)}return i.call(r,!1)}});t.exports=l}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util/class":27,"../util/extend":32,"../util/set":34,"../util/to_json":35,"../util/uri":36,"./transport":22}],20:[function(e,t,n){(function(n){"use strict";var i=e("../util/class"),r=e("../util/uri"),o=e("../util/copy_object"),s=e("../util/extend"),a=e("../mixins/deferrable"),c=e("./transport"),l=e("./xhr"),u=s(i(c,{initialize:function(e,t){if(c.prototype.initialize.call(this,e,t),!n.EventSource)return this.setDeferredStatus("failed");this._xhr=new l(e,t),t=o(t),t.pathname+="/"+e.clientId;var i=new n.EventSource(r.stringify(t)),s=this;i.onopen=function(){s._everConnected=!0,s.setDeferredStatus("succeeded")},i.onerror=function(){s._everConnected?s._handleError([]):(s.setDeferredStatus("failed"),i.close())},i.onmessage=function(e){var t;try{t=JSON.parse(e.data)}catch(e){}t?s._receive(t):s._handleError([])},this._socket=i},close:function(){this._socket&&(this._socket.onopen=this._socket.onerror=this._socket.onmessage=null,this._socket.close(),delete this._socket)},isUsable:function(e,t){this.callback(function(){e.call(t,!0)}),this.errback(function(){e.call(t,!1)})},encode:function(e){return this._xhr.encode(e)},request:function(e){return this._xhr.request(e)}}),{isUsable:function(e,t,n,i){var r=e.clientId;return r?void l.isUsable(e,t,function(r){return r?void this.create(e,t).isUsable(n,i):n.call(i,!1)},this):n.call(i,!1)},create:function(e,t){var n=e.transports.eventsource=e.transports.eventsource||{},i=e.clientId,s=o(t);return s.pathname+="/"+(i||""),s=r.stringify(s),n[s]=n[s]||new this(e,t),n[s]}});s(u.prototype,a),t.exports=u}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../mixins/deferrable":5,"../util/class":27,"../util/copy_object":30,"../util/extend":32,"../util/uri":36,"./transport":22,"./xhr":24}],21:[function(e,t,n){(function(n){"use strict";var i=e("../util/class"),r=e("../util/uri"),o=e("../util/copy_object"),s=e("../util/extend"),a=e("../util/to_json"),c=e("./transport"),l=s(i(c,{encode:function(e){var t=o(this.endpoint);return t.query.message=a(e),t.query.jsonp="__jsonp"+l._cbCount+"__",r.stringify(t)},request:function(e){var t=document.getElementsByTagName("head")[0],i=document.createElement("script"),s=l.getCallbackName(),c=o(this.endpoint),u=this;c.query.message=a(e),c.query.jsonp=s;var d=function(){if(!n[s])return!1;n[s]=void 0;try{delete n[s]}catch(e){}i.parentNode.removeChild(i)};return n[s]=function(e){d(),u._receive(e)},i.type="text/javascript",i.src=r.stringify(c),t.appendChild(i),i.onerror=function(){d(),u._handleError(e)},{abort:d}}}),{_cbCount:0,getCallbackName:function(){return this._cbCount+=1,"__jsonp"+this._cbCount+"__"},isUsable:function(e,t,n,i){n.call(i,!0)}});t.exports=l}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util/class":27,"../util/copy_object":30,"../util/extend":32,"../util/to_json":35,"../util/uri":36,"./transport":22}],22:[function(e,t,n){(function(n){"use strict";var i=e("../util/class"),r=e("../util/cookies").Cookie,o=e("../util/promise"),s=e("../util/uri"),a=e("../util/array"),c=e("../util/extend"),l=e("../mixins/logging"),u=e("../mixins/timeouts"),d=e("../protocol/channel"),h=c(i({className:"Transport",DEFAULT_PORTS:{"http:":80,"https:":443,"ws:":80,"wss:":443},MAX_DELAY:0,batching:!0,initialize:function(e,t){this._dispatcher=e,this.endpoint=t,this._outbox=[],this._proxy=c({},this._dispatcher.proxy),this._proxy.origin||(this._proxy.origin=this._findProxy())},close:function(){},encode:function(e){return""},sendMessage:function(e){return this.debug("Client ? sending message to ?: ?",this._dispatcher.clientId,s.stringify(this.endpoint),e),this.batching?(this._outbox.push(e),this._flushLargeBatch(),e.channel===d.HANDSHAKE?this._publish(.01):(e.channel===d.CONNECT&&(this._connectMessage=e),this._publish(this.MAX_DELAY))):o.resolve(this.request([e]))},_makePromise:function(){var e=this;this._requestPromise=this._requestPromise||new o(function(t){e._resolvePromise=t})},_publish:function(e){return this._makePromise(),this.addTimeout("publish",e,function(){this._flush(),delete this._requestPromise},this),this._requestPromise},_flush:function(){this.removeTimeout("publish"),this._outbox.length>1&&this._connectMessage&&(this._connectMessage.advice={timeout:0}),this._resolvePromise(this.request(this._outbox)),this._connectMessage=null,this._outbox=[]},_flushLargeBatch:function(){var e=this.encode(this._outbox);if(!(e.length<this._dispatcher.maxRequestSize)){var t=this._outbox.pop();this._makePromise(),this._flush(),t&&this._outbox.push(t)}},_receive:function(e){if(e){e=[].concat(e),this.debug("Client ? received from ? via ?: ?",this._dispatcher.clientId,s.stringify(this.endpoint),this.connectionType,e);for(var t=0,n=e.length;t<n;t++)this._dispatcher.handleResponse(e[t])}},_handleError:function(e,t){e=[].concat(e),this.debug("Client ? failed to send to ? via ?: ?",this._dispatcher.clientId,s.stringify(this.endpoint),this.connectionType,e);for(var n=0,i=e.length;n<i;n++)this._dispatcher.handleError(e[n])},_getCookies:function(){var e=this._dispatcher.cookies,t=s.stringify(this.endpoint);return e?a.map(e.getCookiesSync(t),function(e){return e.cookieString()}).join("; "):""},_storeCookies:function(e){var t,n=this._dispatcher.cookies,i=s.stringify(this.endpoint);if(e&&n){e=[].concat(e);for(var o=0,a=e.length;o<a;o++)t=r.parse(e[o]),n.setCookieSync(t,i)}},_findProxy:function(){if("undefined"!=typeof n){var e=this.endpoint.protocol;if(e){var t,i,r=e.replace(/:$/,"").toLowerCase()+"_proxy",o=r.toUpperCase(),s=n.env;return"http_proxy"===r&&s.REQUEST_METHOD?(t=Object.keys(s).filter(function(e){return/^http_proxy$/i.test(e)}),1===t.length?t[0]===r&&void 0===s[o]&&(i=s[r]):t.length>1&&(i=s[r]),i=i||s["CGI_"+o]):(i=s[r]||s[o],i&&!s[r]&&console.warn("The environment variable "+o+" is discouraged. Use "+r+".")),i}}}}),{get:function(e,t,n,i,r){var o=e.endpoint;a.asyncEach(this._transports,function(o,s){var c=o[0],l=o[1],u=e.endpointFor(c);return a.indexOf(n,c)>=0?s():a.indexOf(t,c)<0?(l.isUsable(e,u,function(){}),s()):void l.isUsable(e,u,function(t){if(!t)return s();var n=l.hasOwnProperty("create")?l.create(e,u):new l(e,u);i.call(r,n)})},function(){throw new Error("Could not find a usable connection type for "+s.stringify(o))})},register:function(e,t){this._transports.push([e,t]),t.prototype.connectionType=e},getConnectionTypes:function(){return a.map(this._transports,function(e){return e[0]})},_transports:[]});c(h.prototype,l),c(h.prototype,u),t.exports=h}).call(this,e("_process"))},{"../mixins/logging":6,"../mixins/timeouts":8,"../protocol/channel":9,"../util/array":25,"../util/class":27,"../util/cookies":29,"../util/extend":32,"../util/promise":33,"../util/uri":36,_process:39}],23:[function(e,t,n){(function(n){"use strict";var i=e("../util/class"),r=e("../util/promise"),o=e("../util/set"),s=e("../util/uri"),a=e("../util/browser"),c=e("../util/copy_object"),l=e("../util/extend"),u=e("../util/to_json"),d=e("../util/websocket"),h=e("../mixins/deferrable"),f=e("./transport"),p=l(i(f,{UNCONNECTED:1,CONNECTING:2,CONNECTED:3,batching:!1,isUsable:function(e,t){this.callback(function(){e.call(t,!0)}),this.errback(function(){e.call(t,!1)}),this.connect()},request:function(e){this._pending=this._pending||new o;for(var t=0,n=e.length;t<n;t++)this._pending.add(e[t]);var i=this,s=new r(function(t,n){i.callback(function(n){n&&1===n.readyState&&(n.send(u(e)),t(n))}),i.connect()});return{abort:function(){s.then(function(e){e.close()})}}},connect:function(){if(!p._unloaded&&(this._state=this._state||this.UNCONNECTED,this._state===this.UNCONNECTED)){this._state=this.CONNECTING;var e=this._createSocket();if(!e)return this.setDeferredStatus("failed");var t=this;e.onopen=function(){e.headers&&t._storeCookies(e.headers["set-cookie"]),t._socket=e,t._state=t.CONNECTED,t._everConnected=!0,t._ping(),t.setDeferredStatus("succeeded",e)};var n=!1;e.onclose=e.onerror=function(){if(!n){n=!0;var i=t._state===t.CONNECTED;e.onopen=e.onclose=e.onerror=e.onmessage=null,delete t._socket,t._state=t.UNCONNECTED,t.removeTimeout("ping");var r=t._pending?t._pending.toArray():[];delete t._pending,i||t._everConnected?(t.setDeferredStatus("unknown"),t._handleError(r,i)):t.setDeferredStatus("failed")}},e.onmessage=function(e){var n;try{n=JSON.parse(e.data)}catch(e){}if(n){n=[].concat(n);for(var i=0,r=n.length;i<r;i++)void 0!==n[i].successful&&t._pending.remove(n[i]);t._receive(n)}}}},close:function(){this._socket&&this._socket.close()},_createSocket:function(){var e=p.getSocketUrl(this.endpoint),t=this._dispatcher.headers,n=this._dispatcher.wsExtensions,i=this._getCookies(),r=this._dispatcher.tls,o={extensions:n,headers:t,proxy:this._proxy,tls:r};return""!==i&&(o.headers.Cookie=i),d.create(e,[],o)},_ping:function(){this._socket&&1===this._socket.readyState&&(this._socket.send("[]"),this.addTimeout("ping",this._dispatcher.timeout/2,this._ping,this))}}),{PROTOCOLS:{"http:":"ws:","https:":"wss:"},create:function(e,t){var n=e.transports.websocket=e.transports.websocket||{};return n[t.href]=n[t.href]||new this(e,t),n[t.href]},getSocketUrl:function(e){return e=c(e),e.protocol=this.PROTOCOLS[e.protocol],s.stringify(e)},isUsable:function(e,t,n,i){this.create(e,t).isUsable(n,i)}});l(p.prototype,h),a.Event&&void 0!==n.onbeforeunload&&a.Event.on(n,"beforeunload",function(){p._unloaded=!0}),t.exports=p}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});
},{"../mixins/deferrable":5,"../util/browser":26,"../util/class":27,"../util/copy_object":30,"../util/extend":32,"../util/promise":33,"../util/set":34,"../util/to_json":35,"../util/uri":36,"../util/websocket":38,"./transport":22}],24:[function(e,t,n){(function(n){"use strict";var i=e("../util/class"),r=e("../util/uri"),o=e("../util/browser"),s=e("../util/extend"),a=e("../util/to_json"),c=e("./transport"),l=s(i(c,{encode:function(e){return a(e)},request:function(e){var t,i=this.endpoint.href,r=this;if(n.XMLHttpRequest)t=new XMLHttpRequest;else{if(!n.ActiveXObject)return this._handleError(e);t=new ActiveXObject("Microsoft.XMLHTTP")}t.open("POST",i,!0),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Pragma","no-cache"),t.setRequestHeader("X-Requested-With","XMLHttpRequest");var s=this._dispatcher.headers;for(var a in s)s.hasOwnProperty(a)&&t.setRequestHeader(a,s[a]);var c=function(){t.abort()};return void 0!==n.onbeforeunload&&o.Event.on(n,"beforeunload",c),t.onreadystatechange=function(){if(t&&4===t.readyState){var i=null,s=t.status,a=t.responseText,l=s>=200&&s<300||304===s||1223===s;if(void 0!==n.onbeforeunload&&o.Event.detach(n,"beforeunload",c),t.onreadystatechange=function(){},t=null,!l)return r._handleError(e);try{i=JSON.parse(a)}catch(e){}i?r._receive(i):r._handleError(e)}},t.send(this.encode(e)),t}}),{isUsable:function(e,t,n,i){var o="ReactNative"===navigator.product||r.isSameOrigin(t);n.call(i,o)}});t.exports=l}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util/browser":26,"../util/class":27,"../util/extend":32,"../util/to_json":35,"../util/uri":36,"./transport":22}],25:[function(e,t,n){"use strict";t.exports={commonElement:function(e,t){for(var n=0,i=e.length;n<i;n++)if(this.indexOf(t,e[n])!==-1)return e[n];return null},indexOf:function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1},map:function(e,t,n){if(e.map)return e.map(t,n);var i=[];if(e instanceof Array)for(var r=0,o=e.length;r<o;r++)i.push(t.call(n||null,e[r],r));else for(var s in e)e.hasOwnProperty(s)&&i.push(t.call(n||null,s,e[s]));return i},filter:function(e,t,n){if(e.filter)return e.filter(t,n);for(var i=[],r=0,o=e.length;r<o;r++)t.call(n||null,e[r],r)&&i.push(e[r]);return i},asyncEach:function(e,t,n,i){var r=e.length,o=-1,s=0,a=!1,c=function(){return s-=1,o+=1,o===r?n&&n.call(i):void t(e[o],u)},l=function(){if(!a){for(a=!0;s>0;)c();a=!1}},u=function(){s+=1,l()};u()}}},{}],26:[function(e,t,n){(function(e){"use strict";var n={_registry:[],on:function(e,t,n,i){var r=function(){n.call(i)};e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent("on"+t,r),this._registry.push({_element:e,_type:t,_callback:n,_context:i,_handler:r})},detach:function(e,t,n,i){for(var r,o=this._registry.length;o--;)r=this._registry[o],e&&e!==r._element||t&&t!==r._type||n&&n!==r._callback||i&&i!==r._context||(r._element.removeEventListener?r._element.removeEventListener(r._type,r._handler,!1):r._element.detachEvent("on"+r._type,r._handler),this._registry.splice(o,1),r=null)}};void 0!==e.onunload&&n.on(e,"unload",n.detach,n),t.exports={Event:n}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],27:[function(e,t,n){"use strict";var i=e("./extend");t.exports=function(e,t){"function"!=typeof e&&(t=e,e=Object);var n=function(){return this.initialize?this.initialize.apply(this,arguments)||this:this},r=function(){};return r.prototype=e.prototype,n.prototype=new r,i(n.prototype,t),n}},{"./extend":32}],28:[function(e,t,n){t.exports={VERSION:"1.2.3",BAYEUX_VERSION:"1.0",ID_LENGTH:160,JSONP_CALLBACK:"jsonpcallback",CONNECTION_TYPES:["long-polling","cross-origin-long-polling","callback-polling","websocket","eventsource","in-process"],MANDATORY_CONNECTION_TYPES:["long-polling","callback-polling","in-process"]}},{}],29:[function(e,t,n){"use strict";t.exports={}},{}],30:[function(e,t,n){"use strict";var i=function(e){var t,n,r;if(e instanceof Array){for(t=[],n=e.length;n--;)t[n]=i(e[n]);return t}if("object"==typeof e){t=null===e?null:{};for(r in e)t[r]=i(e[r]);return t}return e};t.exports=i},{}],31:[function(e,t,n){function i(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(t===e[n])return n;return-1}function r(){}var o="function"==typeof Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.exports=r,r.prototype.emit=function(e){if("error"===e&&(!this._events||!this._events.error||o(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var t=this._events[e];if(!t)return!1;if("function"==typeof t){switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:var n=Array.prototype.slice.call(arguments,1);t.apply(this,n)}return!0}if(o(t)){for(var n=Array.prototype.slice.call(arguments,1),i=t.slice(),r=0,s=i.length;r<s;r++)i[r].apply(this,n);return!0}return!1},r.prototype.addListener=function(e,t){if("function"!=typeof t)throw new Error("addListener only takes instances of Function");return this._events||(this._events={}),this.emit("newListener",e,t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){var n=this;return n.on(e,function i(){n.removeListener(e,i),t.apply(this,arguments)}),this},r.prototype.removeListener=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[e])return this;var n=this._events[e];if(o(n)){var r=i(n,t);if(r<0)return this;n.splice(r,1),0==n.length&&delete this._events[e]}else this._events[e]===t&&delete this._events[e];return this},r.prototype.removeAllListeners=function(e){return 0===arguments.length?(this._events={},this):(e&&this._events&&this._events[e]&&(this._events[e]=null),this)},r.prototype.listeners=function(e){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),o(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]}},{}],32:[function(e,t,n){"use strict";t.exports=function(e,t,n){if(!t)return e;for(var i in t)t.hasOwnProperty(i)&&(e.hasOwnProperty(i)&&n===!1||e[i]!==t[i]&&(e[i]=t[i]));return e}},{}],33:[function(e,t,n){"use strict";var i=e("asap"),r=0,o=1,s=2,a=function(e){return e},c=function(e){throw e},l=function(e){if(this._state=r,this._onFulfilled=[],this._onRejected=[],"function"==typeof e){var t=this;e(function(e){p(t,e)},function(e){g(t,e)})}};l.prototype.then=function(e,t){var n=new l;return u(this,e,n),d(this,t,n),n},l.prototype.catch=function(e){return this.then(null,e)};var u=function(e,t,n){"function"!=typeof t&&(t=a);var i=function(e){h(t,e,n)};e._state===r?e._onFulfilled.push(i):e._state===o&&i(e._value)},d=function(e,t,n){"function"!=typeof t&&(t=c);var i=function(e){h(t,e,n)};e._state===r?e._onRejected.push(i):e._state===s&&i(e._reason)},h=function(e,t,n){i(function(){f(e,t,n)})},f=function(e,t,n){var i;try{i=e(t)}catch(e){return g(n,e)}i===n?g(n,new TypeError("Recursive promise chain detected")):p(n,i)},p=function(e,t){var n,i,r=!1;try{if(n=typeof t,i=null!==t&&("function"===n||"object"===n)&&t.then,"function"!=typeof i)return m(e,t);i.call(t,function(t){r^(r=!0)&&p(e,t)},function(t){r^(r=!0)&&g(e,t)})}catch(t){if(!(r^(r=!0)))return;g(e,t)}},m=function(e,t){if(e._state===r){e._state=o,e._value=t,e._onRejected=[];for(var n,i=e._onFulfilled;n=i.shift();)n(t)}},g=function(e,t){if(e._state===r){e._state=s,e._reason=t,e._onFulfilled=[];for(var n,i=e._onRejected;n=i.shift();)n(t)}};l.resolve=function(e){return new l(function(t,n){t(e)})},l.reject=function(e){return new l(function(t,n){n(e)})},l.all=function(e){return new l(function(t,n){var i,r=[],o=e.length;if(0===o)return t(r);for(i=0;i<o;i++)(function(e,i){l.resolve(e).then(function(e){r[i]=e,0===--o&&t(r)},n)})(e[i],i)})},l.race=function(e){return new l(function(t,n){for(var i=0,r=e.length;i<r;i++)l.resolve(e[i]).then(t,n)})},l.deferred=l.pending=function(){var e={};return e.promise=new l(function(t,n){e.resolve=t,e.reject=n}),e},t.exports=l},{asap:1}],34:[function(e,t,n){"use strict";var i=e("./class");t.exports=i({initialize:function(){this._index={}},add:function(e){var t=void 0!==e.id?e.id:e;return!this._index.hasOwnProperty(t)&&(this._index[t]=e,!0)},forEach:function(e,t){for(var n in this._index)this._index.hasOwnProperty(n)&&e.call(t,this._index[n])},isEmpty:function(){for(var e in this._index)if(this._index.hasOwnProperty(e))return!1;return!0},member:function(e){for(var t in this._index)if(this._index[t]===e)return!0;return!1},remove:function(e){var t=void 0!==e.id?e.id:e,n=this._index[t];return delete this._index[t],n},toArray:function(){var e=[];return this.forEach(function(t){e.push(t)}),e}})},{"./class":27}],35:[function(e,t,n){"use strict";t.exports=function(e){return JSON.stringify(e,function(e,t){return this[e]instanceof Array?this[e]:t})}},{}],36:[function(e,t,n){"use strict";t.exports={isURI:function(e){return e&&e.protocol&&e.host&&e.path},isSameOrigin:function(e){return e.protocol===location.protocol&&e.hostname===location.hostname&&e.port===location.port},parse:function(e){if("string"!=typeof e)return e;var t,n,i,r,o,s,a={},c=function(t,n){e=e.replace(n,function(e){return a[t]=e,""}),a[t]=a[t]||""};for(c("protocol",/^[a-z]+\:/i),c("host",/^\/\/[^\/\?#]+/),/^\//.test(e)||a.host||(e=location.pathname.replace(/[^\/]*$/,"")+e),c("pathname",/^[^\?#]*/),c("search",/^\?[^#]*/),c("hash",/^#.*/),a.protocol=a.protocol||location.protocol,a.host?(a.host=a.host.substr(2),t=a.host.split(":"),a.hostname=t[0],a.port=t[1]||""):(a.host=location.host,a.hostname=location.hostname,a.port=location.port),a.pathname=a.pathname||"/",a.path=a.pathname+a.search,n=a.search.replace(/^\?/,""),i=n?n.split("&"):[],s={},r=0,o=i.length;r<o;r++)t=i[r].split("="),s[decodeURIComponent(t[0]||"")]=decodeURIComponent(t[1]||"");return a.query=s,a.href=this.stringify(a),a},stringify:function(e){var t=e.protocol+"//"+e.hostname;return e.port&&(t+=":"+e.port),t+=e.pathname+this.queryString(e.query)+(e.hash||"")},queryString:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return 0===t.length?"":"?"+t.join("&")}}},{}],37:[function(e,t,n){"use strict";var i=e("./array");t.exports=function(e,t){for(var n in e)if(i.indexOf(t,n)<0)throw new Error("Unrecognized option: "+n)}},{"./array":25}],38:[function(e,t,n){(function(e){"use strict";var n=e.MozWebSocket||e.WebSocket;t.exports={create:function(e,t,i){return"function"!=typeof n?null:new n(e)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],39:[function(e,t,n){function i(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(e){if(d===setTimeout)return setTimeout(e,0);if((d===i||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(t){try{return d.call(null,e,0)}catch(t){return d.call(this,e,0)}}}function s(e){if(h===clearTimeout)return clearTimeout(e);if((h===r||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{return h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}function a(){g&&p&&(g=!1,p.length?m=p.concat(m):v=-1,m.length&&c())}function c(){if(!g){var e=o(a);g=!0;for(var t=m.length;t;){for(p=m,m=[];++v<t;)p&&p[v].run();v=-1,t=m.length}p=null,g=!1,s(e)}}function l(e,t){this.fun=e,this.array=t}function u(){}var d,h,f=t.exports={};!function(){try{d="function"==typeof setTimeout?setTimeout:i}catch(e){d=i}try{h="function"==typeof clearTimeout?clearTimeout:r}catch(e){h=r}}();var p,m=[],g=!1,v=-1;f.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];m.push(new l(e,t)),1!==m.length||g||o(c)},l.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=u,f.addListener=u,f.once=u,f.off=u,f.removeListener=u,f.removeAllListeners=u,f.emit=u,f.binding=function(e){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(e){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],40:[function(e,t,n){"use strict";function i(e){return e&&"EPROMISERETRY"===e.code&&a.call(e,"retried")}function r(e,t){var n,r;return"object"==typeof e&&"function"==typeof t&&(n=t,t=e,e=n),r=s.operation(t),new Promise(function(t,n){r.attempt(function(s){Promise.resolve().then(function(){return e(function(e){throw i(e)&&(e=e.retried),o("Retrying","EPROMISERETRY",{retried:e})},s)}).then(t,function(e){i(e)&&(e=e.retried,r.retry(e||new Error))||n(e)})})})}var o=e("err-code"),s=e("retry"),a=Object.prototype.hasOwnProperty;t.exports=r},{"err-code":3,retry:41}],41:[function(e,t,n){t.exports=e("./lib/retry")},{"./lib/retry":42}],42:[function(e,t,n){var i=e("./retry_operation");n.operation=function(e){var t=n.timeouts(e);return new i(t,{forever:e&&e.forever,unref:e&&e.unref})},n.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var n in e)t[n]=e[n];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],r=0;r<t.retries;r++)i.push(this.createTimeout(r,t));return e&&e.forever&&!i.length&&i.push(this.createTimeout(r,t)),i.sort(function(e,t){return e-t}),i},n.createTimeout=function(e,t){var n=t.randomize?Math.random()+1:1,i=Math.round(n*t.minTimeout*Math.pow(t.factor,e));return i=Math.min(i,t.maxTimeout)},n.wrap=function(e,t,i){if(t instanceof Array&&(i=t,t=null),!i){i=[];for(var r in e)"function"==typeof e[r]&&i.push(r)}for(var o=0;o<i.length;o++){var s=i[o],a=e[s];e[s]=function(){var i=n.operation(t),r=Array.prototype.slice.call(arguments),o=r.pop();r.push(function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),o.apply(this,arguments))}),i.attempt(function(){a.apply(e,r)})},e[s].options=t}}},{"./retry_operation":43}],43:[function(e,t,n){function i(e,t){"boolean"==typeof t&&(t={forever:t}),this._timeouts=e,this._options=t||{},this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}t.exports=i,i.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},i.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;this._errors.push(e);var t=this._timeouts.shift();if(void 0===t){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),t=this._timeouts.shift()}var n=this,i=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),this._options.unref&&n._timeout.unref()),n._fn(n._attempts)},t);return this._options.unref&&i.unref(),!0},i.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._fn(this._attempts)},i.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},i.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},i.prototype.start=i.prototype.try,i.prototype.errors=function(){return this._errors},i.prototype.attempts=function(){return this._attempts},i.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,n=0,i=0;i<this._errors.length;i++){var r=this._errors[i],o=r.message,s=(e[o]||0)+1;e[o]=s,s>=n&&(t=r,n=s)}return t}},{}],44:[function(e,t,n){(function(){function e(e){function t(t,n,i,r,o,s){for(;o>=0&&o<s;o+=e){var a=r?r[o]:o;i=n(i,t[a],a,t)}return i}return function(n,i,r,o){i=y(i,o,4);var s=!E(n)&&b.keys(n),a=(s||n).length,c=e>0?0:a-1;return arguments.length<3&&(r=n[s?s[c]:c],c+=e),t(n,i,r,s,c,a)}}function i(e){return function(t,n,i){n=k(n,i);for(var r=T(t),o=e>0?0:r-1;o>=0&&o<r;o+=e)if(n(t[o],o,t))return o;return-1}}function r(e,t,n){return function(i,r,o){var s=0,a=T(i);if("number"==typeof o)e>0?s=o>=0?o:Math.max(o+a,s):a=o>=0?Math.min(o+1,a):o+a+1;else if(n&&o&&a)return o=n(i,r),i[o]===r?o:-1;if(r!==r)return o=t(h.call(i,s,a),b.isNaN),o>=0?o+s:-1;for(o=e>0?s:a-1;o>=0&&o<a;o+=e)if(i[o]===r)return o;return-1}}function o(e,t){var n=Y.length,i=e.constructor,r=b.isFunction(i)&&i.prototype||l,o="constructor";for(b.has(e,o)&&!b.contains(t,o)&&t.push(o);n--;)o=Y[n],o in e&&e[o]!==r[o]&&!b.contains(t,o)&&t.push(o)}var s=this,a=s._,c=Array.prototype,l=Object.prototype,u=Function.prototype,d=c.push,h=c.slice,f=l.toString,p=l.hasOwnProperty,m=Array.isArray,g=Object.keys,v=u.bind,_=Object.create,w=function(){},b=function(e){return e instanceof b?e:this instanceof b?void(this._wrapped=e):new b(e)};"undefined"!=typeof n?("undefined"!=typeof t&&t.exports&&(n=t.exports=b),n._=b):s._=b,b.VERSION="1.8.3";var y=function(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,r){return e.call(t,n,i,r)};case 4:return function(n,i,r,o){return e.call(t,n,i,r,o)}}return function(){return e.apply(t,arguments)}},k=function(e,t,n){return null==e?b.identity:b.isFunction(e)?y(e,t,n):b.isObject(e)?b.matcher(e):b.property(e)};b.iteratee=function(e,t){return k(e,t,1/0)};var x=function(e,t){return function(n){var i=arguments.length;if(i<2||null==n)return n;for(var r=1;r<i;r++)for(var o=arguments[r],s=e(o),a=s.length,c=0;c<a;c++){var l=s[c];t&&void 0!==n[l]||(n[l]=o[l])}return n}},C=function(e){if(!b.isObject(e))return{};if(_)return _(e);w.prototype=e;var t=new w;return w.prototype=null,t},A=function(e){return function(t){return null==t?void 0:t[e]}},$=Math.pow(2,53)-1,T=A("length"),E=function(e){var t=T(e);return"number"==typeof t&&t>=0&&t<=$};b.each=b.forEach=function(e,t,n){t=y(t,n);var i,r;if(E(e))for(i=0,r=e.length;i<r;i++)t(e[i],i,e);else{var o=b.keys(e);for(i=0,r=o.length;i<r;i++)t(e[o[i]],o[i],e)}return e},b.map=b.collect=function(e,t,n){t=k(t,n);for(var i=!E(e)&&b.keys(e),r=(i||e).length,o=Array(r),s=0;s<r;s++){var a=i?i[s]:s;o[s]=t(e[a],a,e)}return o},b.reduce=b.foldl=b.inject=e(1),b.reduceRight=b.foldr=e(-1),b.find=b.detect=function(e,t,n){var i;if(i=E(e)?b.findIndex(e,t,n):b.findKey(e,t,n),void 0!==i&&i!==-1)return e[i]},b.filter=b.select=function(e,t,n){var i=[];return t=k(t,n),b.each(e,function(e,n,r){t(e,n,r)&&i.push(e)}),i},b.reject=function(e,t,n){return b.filter(e,b.negate(k(t)),n)},b.every=b.all=function(e,t,n){t=k(t,n);for(var i=!E(e)&&b.keys(e),r=(i||e).length,o=0;o<r;o++){var s=i?i[o]:o;if(!t(e[s],s,e))return!1}return!0},b.some=b.any=function(e,t,n){t=k(t,n);for(var i=!E(e)&&b.keys(e),r=(i||e).length,o=0;o<r;o++){var s=i?i[o]:o;if(t(e[s],s,e))return!0}return!1},b.contains=b.includes=b.include=function(e,t,n,i){return E(e)||(e=b.values(e)),("number"!=typeof n||i)&&(n=0),b.indexOf(e,t,n)>=0},b.invoke=function(e,t){var n=h.call(arguments,2),i=b.isFunction(t);return b.map(e,function(e){var r=i?t:e[t];return null==r?r:r.apply(e,n)})},b.pluck=function(e,t){return b.map(e,b.property(t))},b.where=function(e,t){return b.filter(e,b.matcher(t))},b.findWhere=function(e,t){return b.find(e,b.matcher(t))},b.max=function(e,t,n){var i,r,o=-(1/0),s=-(1/0);if(null==t&&null!=e){e=E(e)?e:b.values(e);for(var a=0,c=e.length;a<c;a++)i=e[a],i>o&&(o=i)}else t=k(t,n),b.each(e,function(e,n,i){r=t(e,n,i),(r>s||r===-(1/0)&&o===-(1/0))&&(o=e,s=r)});return o},b.min=function(e,t,n){var i,r,o=1/0,s=1/0;if(null==t&&null!=e){e=E(e)?e:b.values(e);for(var a=0,c=e.length;a<c;a++)i=e[a],i<o&&(o=i)}else t=k(t,n),b.each(e,function(e,n,i){r=t(e,n,i),(r<s||r===1/0&&o===1/0)&&(o=e,s=r)});return o},b.shuffle=function(e){for(var t,n=E(e)?e:b.values(e),i=n.length,r=Array(i),o=0;o<i;o++)t=b.random(0,o),t!==o&&(r[o]=r[t]),r[t]=n[o];return r},b.sample=function(e,t,n){return null==t||n?(E(e)||(e=b.values(e)),e[b.random(e.length-1)]):b.shuffle(e).slice(0,Math.max(0,t))},b.sortBy=function(e,t,n){return t=k(t,n),b.pluck(b.map(e,function(e,n,i){return{value:e,index:n,criteria:t(e,n,i)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(n<i||void 0===i)return-1}return e.index-t.index}),"value")};var j=function(e){return function(t,n,i){var r={};return n=k(n,i),b.each(t,function(i,o){var s=n(i,o,t);e(r,i,s)}),r}};b.groupBy=j(function(e,t,n){b.has(e,n)?e[n].push(t):e[n]=[t]}),b.indexBy=j(function(e,t,n){e[n]=t}),b.countBy=j(function(e,t,n){b.has(e,n)?e[n]++:e[n]=1}),b.toArray=function(e){return e?b.isArray(e)?h.call(e):E(e)?b.map(e,b.identity):b.values(e):[]},b.size=function(e){return null==e?0:E(e)?e.length:b.keys(e).length},b.partition=function(e,t,n){t=k(t,n);var i=[],r=[];return b.each(e,function(e,n,o){(t(e,n,o)?i:r).push(e)}),[i,r]},b.first=b.head=b.take=function(e,t,n){if(null!=e)return null==t||n?e[0]:b.initial(e,e.length-t)},b.initial=function(e,t,n){return h.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},b.last=function(e,t,n){if(null!=e)return null==t||n?e[e.length-1]:b.rest(e,Math.max(0,e.length-t))},b.rest=b.tail=b.drop=function(e,t,n){return h.call(e,null==t||n?1:t)},b.compact=function(e){return b.filter(e,b.identity)};var S=function(e,t,n,i){for(var r=[],o=0,s=i||0,a=T(e);s<a;s++){var c=e[s];if(E(c)&&(b.isArray(c)||b.isArguments(c))){t||(c=S(c,t,n));var l=0,u=c.length;for(r.length+=u;l<u;)r[o++]=c[l++]}else n||(r[o++]=c)}return r};b.flatten=function(e,t){return S(e,t,!1)},b.without=function(e){return b.difference(e,h.call(arguments,1))},b.uniq=b.unique=function(e,t,n,i){b.isBoolean(t)||(i=n,n=t,t=!1),null!=n&&(n=k(n,i));for(var r=[],o=[],s=0,a=T(e);s<a;s++){var c=e[s],l=n?n(c,s,e):c;t?(s&&o===l||r.push(c),o=l):n?b.contains(o,l)||(o.push(l),r.push(c)):b.contains(r,c)||r.push(c)}return r},b.union=function(){return b.uniq(S(arguments,!0,!0))},b.intersection=function(e){for(var t=[],n=arguments.length,i=0,r=T(e);i<r;i++){var o=e[i];if(!b.contains(t,o)){for(var s=1;s<n&&b.contains(arguments[s],o);s++);s===n&&t.push(o)}}return t},b.difference=function(e){var t=S(arguments,!0,!0,1);return b.filter(e,function(e){return!b.contains(t,e)})},b.zip=function(){return b.unzip(arguments)},b.unzip=function(e){for(var t=e&&b.max(e,T).length||0,n=Array(t),i=0;i<t;i++)n[i]=b.pluck(e,i);return n},b.object=function(e,t){for(var n={},i=0,r=T(e);i<r;i++)t?n[e[i]]=t[i]:n[e[i][0]]=e[i][1];return n},b.findIndex=i(1),b.findLastIndex=i(-1),b.sortedIndex=function(e,t,n,i){n=k(n,i,1);for(var r=n(t),o=0,s=T(e);o<s;){var a=Math.floor((o+s)/2);n(e[a])<r?o=a+1:s=a}return o},b.indexOf=r(1,b.findIndex,b.sortedIndex),b.lastIndexOf=r(-1,b.findLastIndex),b.range=function(e,t,n){null==t&&(t=e||0,e=0),n=n||1;for(var i=Math.max(Math.ceil((t-e)/n),0),r=Array(i),o=0;o<i;o++,e+=n)r[o]=e;return r};var X=function(e,t,n,i,r){if(!(i instanceof t))return e.apply(n,r);var o=C(e.prototype),s=e.apply(o,r);return b.isObject(s)?s:o};b.bind=function(e,t){if(v&&e.bind===v)return v.apply(e,h.call(arguments,1));if(!b.isFunction(e))throw new TypeError("Bind must be called on a function");var n=h.call(arguments,2),i=function(){return X(e,i,t,this,n.concat(h.call(arguments)))};return i},b.partial=function(e){var t=h.call(arguments,1),n=function(){for(var i=0,r=t.length,o=Array(r),s=0;s<r;s++)o[s]=t[s]===b?arguments[i++]:t[s];for(;i<arguments.length;)o.push(arguments[i++]);return X(e,n,this,this,o)};return n},b.bindAll=function(e){var t,n,i=arguments.length;if(i<=1)throw new Error("bindAll must be passed function names");for(t=1;t<i;t++)n=arguments[t],e[n]=b.bind(e[n],e);return e},b.memoize=function(e,t){var n=function(i){var r=n.cache,o=""+(t?t.apply(this,arguments):i);return b.has(r,o)||(r[o]=e.apply(this,arguments)),r[o]};return n.cache={},n},b.delay=function(e,t){var n=h.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},b.defer=b.partial(b.delay,b,1),b.throttle=function(e,t,n){var i,r,o,s=null,a=0;n||(n={});var c=function(){a=n.leading===!1?0:b.now(),s=null,o=e.apply(i,r),s||(i=r=null)};return function(){var l=b.now();a||n.leading!==!1||(a=l);var u=t-(l-a);return i=this,r=arguments,u<=0||u>t?(s&&(clearTimeout(s),s=null),a=l,o=e.apply(i,r),s||(i=r=null)):s||n.trailing===!1||(s=setTimeout(c,u)),o}},b.debounce=function(e,t,n){var i,r,o,s,a,c=function(){var l=b.now()-s;l<t&&l>=0?i=setTimeout(c,t-l):(i=null,n||(a=e.apply(o,r),i||(o=r=null)))};return function(){o=this,r=arguments,s=b.now();var l=n&&!i;return i||(i=setTimeout(c,t)),l&&(a=e.apply(o,r),o=r=null),a}},b.wrap=function(e,t){return b.partial(t,e)},b.negate=function(e){return function(){return!e.apply(this,arguments)}},b.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,i=e[t].apply(this,arguments);n--;)i=e[n].call(this,i);return i}},b.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},b.before=function(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}},b.once=b.partial(b.before,2);var I=!{toString:null}.propertyIsEnumerable("toString"),Y=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];b.keys=function(e){if(!b.isObject(e))return[];if(g)return g(e);var t=[];for(var n in e)b.has(e,n)&&t.push(n);return I&&o(e,t),t},b.allKeys=function(e){if(!b.isObject(e))return[];var t=[];for(var n in e)t.push(n);return I&&o(e,t),t},b.values=function(e){for(var t=b.keys(e),n=t.length,i=Array(n),r=0;r<n;r++)i[r]=e[t[r]];return i},b.mapObject=function(e,t,n){t=k(t,n);for(var i,r=b.keys(e),o=r.length,s={},a=0;a<o;a++)i=r[a],s[i]=t(e[i],i,e);return s},b.pairs=function(e){for(var t=b.keys(e),n=t.length,i=Array(n),r=0;r<n;r++)i[r]=[t[r],e[t[r]]];return i},b.invert=function(e){for(var t={},n=b.keys(e),i=0,r=n.length;i<r;i++)t[e[n[i]]]=n[i];return t},b.functions=b.methods=function(e){var t=[];for(var n in e)b.isFunction(e[n])&&t.push(n);return t.sort()},b.extend=x(b.allKeys),b.extendOwn=b.assign=x(b.keys),b.findKey=function(e,t,n){t=k(t,n);for(var i,r=b.keys(e),o=0,s=r.length;o<s;o++)if(i=r[o],t(e[i],i,e))return i},b.pick=function(e,t,n){var i,r,o={},s=e;if(null==s)return o;b.isFunction(t)?(r=b.allKeys(s),i=y(t,n)):(r=S(arguments,!1,!1,1),i=function(e,t,n){return t in n},s=Object(s));for(var a=0,c=r.length;a<c;a++){var l=r[a],u=s[l];i(u,l,s)&&(o[l]=u)}return o},b.omit=function(e,t,n){if(b.isFunction(t))t=b.negate(t);else{var i=b.map(S(arguments,!1,!1,1),String);t=function(e,t){return!b.contains(i,t)}}return b.pick(e,t,n)},b.defaults=x(b.allKeys,!0),b.create=function(e,t){var n=C(e);return t&&b.extendOwn(n,t),n},b.clone=function(e){return b.isObject(e)?b.isArray(e)?e.slice():b.extend({},e):e},b.tap=function(e,t){return t(e),e},b.isMatch=function(e,t){var n=b.keys(t),i=n.length;if(null==e)return!i;for(var r=Object(e),o=0;o<i;o++){var s=n[o];if(t[s]!==r[s]||!(s in r))return!1}return!0};var P=function(e,t,n,i){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof b&&(e=e._wrapped),t instanceof b&&(t=t._wrapped);var r=f.call(e);if(r!==f.call(t))return!1;switch(r){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var o="[object Array]"===r;if(!o){if("object"!=typeof e||"object"!=typeof t)return!1;var s=e.constructor,a=t.constructor;if(s!==a&&!(b.isFunction(s)&&s instanceof s&&b.isFunction(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],i=i||[];for(var c=n.length;c--;)if(n[c]===e)return i[c]===t;if(n.push(e),i.push(t),o){if(c=e.length,c!==t.length)return!1;for(;c--;)if(!P(e[c],t[c],n,i))return!1}else{var l,u=b.keys(e);if(c=u.length,b.keys(t).length!==c)return!1;for(;c--;)if(l=u[c],!b.has(t,l)||!P(e[l],t[l],n,i))return!1}return n.pop(),i.pop(),!0};b.isEqual=function(e,t){return P(e,t)},b.isEmpty=function(e){return null==e||(E(e)&&(b.isArray(e)||b.isString(e)||b.isArguments(e))?0===e.length:0===b.keys(e).length)},b.isElement=function(e){return!(!e||1!==e.nodeType)},b.isArray=m||function(e){return"[object Array]"===f.call(e)},b.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},b.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){b["is"+e]=function(t){return f.call(t)==="[object "+e+"]"}}),b.isArguments(arguments)||(b.isArguments=function(e){return b.has(e,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(b.isFunction=function(e){return"function"==typeof e||!1}),b.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},b.isNaN=function(e){return b.isNumber(e)&&e!==+e},b.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===f.call(e)},b.isNull=function(e){return null===e},b.isUndefined=function(e){return void 0===e},b.has=function(e,t){return null!=e&&p.call(e,t)},b.noConflict=function(){return s._=a,this},b.identity=function(e){return e},b.constant=function(e){return function(){return e}},b.noop=function(){},b.property=A,b.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},b.matcher=b.matches=function(e){return e=b.extendOwn({},e),function(t){return b.isMatch(t,e)}},b.times=function(e,t,n){var i=Array(Math.max(0,e));t=y(t,n,1);for(var r=0;r<e;r++)i[r]=t(r);return i},b.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},b.now=Date.now||function(){return(new Date).getTime()};var R={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},N=b.invert(R),O=function(e){var t=function(t){return e[t]},n="(?:"+b.keys(e).join("|")+")",i=RegExp(n),r=RegExp(n,"g");return function(e){return e=null==e?"":""+e,i.test(e)?e.replace(r,t):e}};b.escape=O(R),b.unescape=O(N),b.result=function(e,t,n){var i=null==e?void 0:e[t];return void 0===i&&(i=n),b.isFunction(i)?i.call(e):i};var D=0;b.uniqueId=function(e){var t=++D+"";return e?e+t:t},b.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var F=/(.)^/,M={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\u2028|\u2029/g,U=function(e){return"\\"+M[e]};b.template=function(e,t,n){!t&&n&&(t=n),t=b.defaults({},t,b.templateSettings);var i=RegExp([(t.escape||F).source,(t.interpolate||F).source,(t.evaluate||F).source].join("|")+"|$","g"),r=0,o="__p+='";e.replace(i,function(t,n,i,s,a){return o+=e.slice(r,a).replace(L,U),r=a+t.length,n?o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?o+="'+\n((__t=("+i+"))==null?'':__t)+\n'":s&&(o+="';\n"+s+"\n__p+='"),t}),o+="';\n",t.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var s=new Function(t.variable||"obj","_",o)}catch(e){throw e.source=o,e}var a=function(e){return s.call(this,e,b)},c=t.variable||"obj";return a.source="function("+c+"){\n"+o+"}",a},b.chain=function(e){var t=b(e);return t._chain=!0,t};var z=function(e,t){return e._chain?b(t).chain():t};b.mixin=function(e){b.each(b.functions(e),function(t){var n=b[t]=e[t];b.prototype[t]=function(){var e=[this._wrapped];return d.apply(e,arguments),z(this,n.apply(b,e))}})},b.mixin(b),b.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=c[e];b.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],z(this,n)}}),b.each(["concat","join","slice"],function(e){
var t=c[e];b.prototype[e]=function(){return z(this,t.apply(this._wrapped,arguments))}}),b.prototype.value=function(){return this._wrapped},b.prototype.valueOf=b.prototype.toJSON=b.prototype.value,b.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return b})}).call(this)},{}],45:[function(e,t,n){function i(e,t,n,i,r,o,s,a,c,l,u,d,h,f,p,m,g,v){function w(){function e(){var e=m.notifySharedAccessWiley();i.$watch("sharing",function(t){t||m.hide(e)}),$(s).on("access-check",function(){s.hasFullAccess()&&i.$emit("close-checkout")})}function t(){var e=null;a.onExternalCheck(function(){s.hasAccess()||(e=m.notifySharedPaywallWiley())}),$(s).on("access-check",function(){e&&s.hasFullAccess()&&m.hide(e)})}function n(){s.isShared()?e():i.sharingToken&&t()}function r(){if(s.isShared()){var e=p.notifySharedAccess();$(s).on("access-check",function(){s.isShared()||p.hide(e)})}}function o(){"wiley"==s.get().publisher?n():"ieee"!=s.get().publisher&&r()}$(a).on("rental-expiry",p.notifyRentalExpiry),$(a).on("external-access-timeout",function(){s.isShared()&&!a.externalCheckAvailable()||p.notifyAuthFailed()}),$(s).on("access-forbidden",p.notifyAccessForbidden),s.onData(function(){a.externalCheckAvailable()?a.onExternalCheck(o):s.onAccess(o)}),Promise.all([b(),y()]).then(p.notifyReadPersonal)}function b(){return new Promise(function(e){a.onExternalCheck(function(){!s.hasAccess()&&e()})})}function y(){return new Promise(function(e){s.onInit(function(){c.item.get().then(function(t){t.item.pdf_hash&&e()},_.noop)})})}function k(e){return!!e.viewer_pdf&&((!e.doi||!v(e.doi))&&(!n.cochrane&&!n.lang))}e.trackPdfToolbar=!0,e.download=function(e){return f.download(e)},e.print=function(e){return f.print(e)},$(window).on("keydown",function(e){(e.metaKey||e.ctrlKey)&&(70==e.keyCode?l.loadAll():80==e.keyCode&&(e.preventDefault(),f.print()))}),$(d).on("update",function(){h.available().then(p.notifyUpdateAvailable)}),$(d).on("toast",function(e,t){p.notifyMessage(t)}),s.onInit(function(e){k(e)?l.setLocalData(e).catch(function(e){e&&403==e.status&&t.go("error.404",null,{location:!1})}):(l.setPreviewData(e).catch(function(e){if(!e||"load_html_fail"!=e.error)throw e;$.get(o.ip_api,function(t){(trackJs||window).console.log("load html fail location:",t),g(e,{country:t.country})}).always(function(){setTimeout(function(){s.onData(function(e){r.redirectOrPost(e.meta.pdf_url)})},300)})}),s.onAccessCheck(function(e){s.hasAccess()&&l.setFullData(e)}),s.onAccess(function(){$(s).on("resources-expired",function(){$(l).one("loading-start",a.performAccessChecks)})}))}),$(l).on("page-changed",function(e,t){u.scroll(t)}),w()}i.$inject=["$scope","$state","$stateParams","$rootScope","util","endpoint","article","access","sync","viewer","tracker","command","update","articleExport","toast","infoBar","trackError","pdfjsBlacklist"],angular.module("reader").controller("ArticleCtrl",i)},{}],46:[function(e,t,n){function i(e,t,n,i,r,o,s,a,c,l,u){function d(){"wiley"==o.get().publisher&&t(function(){e.publisherPageLabel="Go to HTML"})}function h(){o.get().doi&&(e.defaultAction={handler:e.openRelated,tooltip:"Related Articles",icon:"layers"})}e.user=s,e.article=o,e.tracker=c,e.altmetric=void 0,e.publisherPageLabel=void 0,e.notes=l.listArr(),u.then(function(t){e.altmetric=t},_.noop),e.toggleAnnots=function(){r.$emit("toggle-annotations")},o.onInit(function(e){d(),h()}),$(l).on("changed",function(){t(function(){e.notes=l.listArr()})}),e.toolsEnabled=function(){return"ieee"!=o.get().publisher&&(o.get().doi||e.notesEnabled())},e.notesEnabled=function(){return s.signedIn()&&o.hasAccess()&&!o.get().sync_item_sponsored},e.gotoPublisher=function(){window.open(o.get().meta.url,"_blank"),c.linkout("publisher")},e.openAltmetric=function(){window.open(e.altmetric.detailsUrl,"_blank"),c.altmetric()},e.export=function(e){i.show(i.alert({targetEvent:e,clickOutsideToClose:!0,templateUrl:"dialogs/export.html",controller:"ExportCtrl"})),c.exportOptions()},e.share=function(e){var t=angular.merge(r.$new(!0),{type:"dialog"}),n="dialogs/share.html",s="ShareCtrl";"wiley"==o.get().publisher&&(n="dialogs/share_wiley.html",s="ShareWileyCtrl"),i.show(i.alert({scope:t,targetEvent:e,clickOutsideToClose:!0,templateUrl:n,controller:s})),c.sidepanel("share")}}i.$inject=["$scope","$timeout","$http","$mdDialog","$rootScope","article","user","endpoint","tracker","annotationsModel","altmetricInit"],angular.module("reader").controller("ArticleToolsCtrl",i)},{}],47:[function(e,t,n){function i(e,t,n,i,r,o){i.onInit(function(i){$("body").addClass("publisher-"+(i.original_publisher||i.publisher)),r.setPreviewData(i).catch(function(){t.go("error.404",null,{location:!1})}),n(function(){e.articleUrl=[o.dx_doi,i.doi].join("/")})})}i.$inject=["$scope","$state","$timeout","article","viewer","endpoint"],angular.module("reader").controller("DiscoverCtrl",i)},{}],48:[function(e,t,n){function i(e,t,n,i,r){function o(){return t.is("error.404")?"Possible Broken Link (404)":"Possible Server Error (500)"}function s(){return sprintf("I cannot load the following webpage: %s",location.href)}function a(e,t){return sprintf("mailto:support@readcube.com?subject=%s&body=%s",encodeURIComponent(e),encodeURIComponent(t))}e.showCode=!1,e.showMessage=!1,e.supportHref=a(o(),s()),e.edgeSupportHref=["http://support.readcube.com/knowledgebase/articles","815760-i-can-t-open-pdfs-from-the-web-library-app-in-edge"].join("/"),i.visible().then(function(){r.start(),n(function(){e.showCode=!0},600),n(function(){e.showMessage=!0},1200)})}i.$inject=["$scope","$state","$timeout","visibility","errorAnimation"],angular.module("reader").controller("ErrorCtrl",i)},{}],49:[function(e,t,n){function i(e,t,n){function i(t){e.index!=t&&(e.index=t,e.busy=!0)}e.busy=!0,e.detailsOpen=!0,e.figures=n.get().figures||[],e.showNav=e.figures.length>1,e.toggleDetails=function(){e.detailsOpen=!e.detailsOpen},e.figure=function(){return e.figures[e.index]},e.next=function(){i((e.index+1)%e.figures.length)},e.prev=function(){i((e.index+e.figures.length-1)%e.figures.length)},$(window).on("keydown.figure-viewer",function(n){if(!n.metaKey&&!n.ctrlKey)switch(n.keyCode){case 37:case 38:t(e.prev);break;case 39:case 40:t(e.next)}}),e.$on("$destroy",function(){$(window).off("keydown.figure-viewer")})}i.$inject=["$scope","$timeout","article"],angular.module("reader").controller("FigureViewerCtrl",i)},{}],50:[function(e,t,n){function i(e,t,n,i,r,o,s,a,c,l,u,d,h,f,p){function m(){return h.saveCloud(),c.item.add().then(d.showSyncedAd).catch(_.noop)}function g(){return c.item.remove().catch(_.noop)}function v(){$(c.item).on("busy",function(){n(function(){e.syncing=!0})}),$(c.item).on("done",function(){n(function(){e.syncing=!1})}),c.item.onAdd(function(){n(function(){e.inLibrary=!0})}),c.item.onRemove(function(){n(function(){e.inLibrary=!1})}),l.onInit(function(t){"wiley"==t.publisher&&n(function(){e.publisherLinkout=function(){l.get().meta.url&&(window.open(l.get().meta.url,"_blank"),h.linkout("publisher"))}})})}e.user=s,e.article=l,e.syncing=!1,e.inLibrary=!1,e.downloading=!1,e.showClose=o.show_close,e.close=function(){window.parent.postMessage({type:"close"},"*")},e.downloadPdf=function(t){e.downloading=!0,f.download(t).finally(function(){n(function(){e.downloading=!1})}),h.menuBar("download_pdf")},e.getAccess=function(){t.$emit("toggle-checkout")},e.toggleInLibrary=function(t){e.syncing||(e.inLibrary?g():(s.signedIn()?m():p.showRegister({targetEvent:t,params:{tracking_action:"add_to_library",tracking_origin:h.trackingOrigin()},onAuth:function(){u.onLoginCheck(m)},registerAd:"ads/add_to_library.html"}),h.menuBar("add_to_library")))},e.openMoreMenu=function(e,t){e(t)},e.onAppMenuClick=function(t){t.stopPropagation(),s.signedIn()?e.toggleAppNav():p.showRegister({targetEvent:t,params:{tracking_action:"toolbar_signup",tracking_origin:h.trackingOrigin(),promocode:"WRSUM162"},registerAd:"ads/my_library_register.html",successAd:"ads/my_library_success.html"})},t.toggleAppNav=function(){i("appnav").toggle(),i("appnav").isOpen()&&(t.$emit("appnav-open"),h.sidepanel("library"))},t.closeAppNav=function(){i("appnav").close(),t.$emit("appnav-close")},v()}i.$inject=["$scope","$rootScope","$timeout","$mdSidenav","$sce","$stateParams","user","endpoint","sync","article","access","toast","tracker","articleExport","userModal"],angular.module("reader").controller("MenuBarCtrl",i)},{}],51:[function(e,t,n){function i(e,t,n,i,r,o,s,a,c,l,u,d,h,f,p,m,g,v,w,b,y,k){function x(){"wiley"==s.get().publisher?s.isShared()?g.notifySharedAccessWiley():!s.hasAccess()&&T()&&g.notifySharedPaywallWiley():s.isShared()&&g.notifySharedAccess()}function C(){return v.saveCloud(),d.item.add().then(g.showSyncedAd).catch(_.noop)}function A(){return d.item.remove().catch(_.noop)}function T(){return!_.isEmpty(a.pickDefined(t,y.SHARING_TOKENS))}function E(){return new Promise(function(e){p.onExternalCheck(function(){!s.hasAccess()&&e()})})}function j(){return new Promise(function(e){s.onInit(function(){d.item.get().then(function(t){t.item.pdf_hash&&e()},_.noop)})})}e.user=l,e.article=s,e.syncing=!1,e.inLibrary=!1,e.altmetric=void 0,e.numPages=void 0,e.notes=m.listArr(),r.mobileFeedback=!!k.local.get("mobile-feedback"),e.contactSupport=function(){window.open("https://support.readcube.com")},e.leaveFeedback=function(){i("leave-feedback").open()},e.accountPage=function(){window.open(c.web+"/account","_blank")},e.share=function(){var e="wiley"==s.get().publisher?"share-wiley":"share";i(e).open().then(function(){return r.$emit(e+"-open")}),v.sidepanel("share")},e.sharingEnabled=function(){return s.get().access_share_enabled},e.notesEnabled=function(){return e.notes.length&&l.signedIn()&&s.hasAccess()&&!s.get().sync_item_sponsored},e.openAnnots=function(){i("annotations").open()},e.openAltmetric=function(){window.open(e.altmetric.detailsUrl,"_blank"),v.altmetric()},e.closeSidenav=function(e){i(e).close()},e.openRelated=function(){i("related").open(),v.related(),v.sidepanel("related"),s.getRelated().then(function(t){n(function(){e.related=t||[]})})},e.openReferences=function(){i("references").open(),v.sidepanel("references")},e.openMetrics=function(){l.signedIn()?(i("cited-by").open(),r.$emit("cited-by-open"),v.sidepanel("cited_by")):g.promptRegister(function(){i("cited-by").open(),r.$emit("cited-by-open"),v.sidepanel("cited_by")})},e.openRCR=function(){i("rcr").open(),v.sidepanel("rcr")},e.openSupplements=function(){i("supplements").open(),v.sidepanel("supplements")},e.openFigures=function(){i("figures").open(),v.sidepanel("figures")},e.signIn=function(e){u.showRegister({params:{tracking_action:"toolbar_signup",tracking_origin:v.trackingOrigin()},targetEvent:e})},e.signOut=function(){w.clear(),l.signOut(function(){c.parent?window.parent.postMessage({type:"sign_out",url:c.parent},"*"):location.reload()})},e.gotoPublisher=function(){v.linkout("publisher"),s.isShared()&&/springer|nature/.test(s.get().publisher)?y.getProxiedArticle(s.get().doi).then(function(e){return a.redirectOrPost(e.url)}).catch(function(){return a.redirectOrPost(s.get().meta.url)}):n(function(){return a.redirectOrPost(s.get().meta.url)},300)},e.toggleInLibrary=function(t){e.syncing||(e.inLibrary?A():(l.signedIn()?C():u.showRegister({title:"Add To Library",params:{tracking_action:"add_to_library",tracking_origin:v.trackingOrigin()},onAuth:function(){p.onLoginCheck(C)},registerAd:"ads/add_to_library.html",targetEvent:t}),v.menuBar("add_to_library")))},t.feed_token&&$("body").addClass("article-feed"),b.then(function(t){n(function(){return e.altmetric=t})},_.noop),s.onInit(function(t){n(function(){return e.numPages=t.total_pages})}),$(h).on("update",function(){f.available().then(g.notifyUpdateAvailable)}),$(h).on("toast",function(e,t){g.notifyMessage(t)}),$(m).on("changed",function(){n(function(){return e.notes=m.listArr()})}),$(p).on("rental-expiry",g.notifyRentalExpiry),$(p).on("external-access-timeout",function(){s.isShared()&&!p.externalCheckAvailable()||g.notifyAuthFailed()}),$(s).on("access-forbidden",g.notifyAccessForbidden),Promise.all([E(),j()]).then(g.notifyReadPersonal),d.item.onAdd(function(){n(function(){e.inLibrary=!0})}),d.item.onRemove(function(){n(function(){e.inLibrary=!1})}),$(d.item).on("busy",function(){n(function(){e.syncing=!0})}),$(d.item).on("done",function(){n(function(){e.syncing=!1})}),s.onInit(function(t){$("body").addClass("initialized"),t.publisher&&s.isBrandable()&&$("body").addClass("publisher-"+t.publisher),"wiley"==s.get().publisher&&n(function(){return e.publisherPageLabel="Go to HTML"})}),s.onData(function(t){$("body").addClass("metadata"),e.$emit("start-read-mode"),n(function(){e.metadata=t.meta,e.supplements=t.supplements,e.references=t.references,e.figures=t.figures})}),s.onData(function(){p.externalCheckAvailable()?p.onExternalCheck(x):s.onAccess(x)}),s.onAccessCheck(function(e){e.pdf_url&&$("body").addClass("can-save"),e.print_url&&$("body").addClass("can-print")})}i.$inject=["$scope","$stateParams","$timeout","$mdSidenav","$rootScope","$http","article","util","endpoint","user","userSidenav","sync","command","update","access","annotationsModel","toast","tracker","trackId","altmetricInit","accessToken","storage"],angular.module("reader").controller("MobileReaderCtrl",i)},{}],52:[function(e,t,n){function i(e,t,n,i,r,o,s,a,c,l,u){t.pageIndex=1,t.numPages=1,t.downloading=!1,t.authorizing=!1,t.unauthorized=!1,$(a).on("auth-begin",function(){n(function(){return t.authorizing=!0})}),$(a).on("auth-end",function(){n(function(){return t.authorizing=!1})}),s.onData(function(){a.onExternalCheck(function(){s.hasAccess()||n(function(){return t.unauthorized=!0})})}),t.getAccess=function(){r.redirectOrPost([o.web+"/checkout/new?","doi="+encodeURIComponent(s.get().doi)+"&","redirect="+encodeURIComponent(location.href)+"&","embed=1&mobile=1"].join(""))},t.download=function(e){t.downloading=!0,u.download(e).catch(function(e){"preview"==e&&t.getAccess()}).finally(function(){n(function(){return t.downloading=!1})}),c.menuBar("download_pdf")},t.menu=function(){i("mobile_menu").toggle()},t.prevPage=function(){l.curIndex--},t.nextPage=function(){l.curIndex++},l.onInit(function(){n(function(){t.viewer=l,t.numPages=l.numPages})}),$(l).on("page-changed",function(e,i){n(function(){return t.pageIndex=i})}),$(l).on("slide",function(e,i){n(function(){i=Math.round(i),i!=t.pageIndex&&(t.pageIndex=i)})})}i.$inject=["$rootScope","$scope","$timeout","$mdSidenav","util","endpoint","article","access","tracker","mobileViewer","articleExport"],angular.module("reader").controller("MobileToolbarCtrl",i)},{}],53:[function(e,t,n){function i(e,t,n,i){function r(){return parseInt(n.session.get(s()))||10}function o(e){n.session.set(s(),Math.min(e,60))}function s(){return["processing-refresh",CryptoJS.MD5(location.href).toString()].join(":")}e.refresh=r();var a=t(function(){--e.refresh>0||(t.cancel(a),o(2*r()),i.reload())},1e3)}i.$inject=["$scope","$interval","storage","util"],angular.module("reader").controller("ProcessingCtrl",i)},{}],54:[function(e,t,n){function i(e,t,n,i,r,o,s,a,c,l,u,d,h,f){function p(){return!_.isEmpty(s.pickDefined(t,f.SHARING_TOKENS))}e.env=a,e.article=l,e.metadata=void 0,e.related=void 0,e.references=void 0,e.supplements=void 0,e.figures=void 0,e.goNext=void 0,e.goPrev=void 0,n.sharingToken=p(),e.openRelated=function(){r("related").open(),d.related(),d.sidepanel("related"),l.getRelated().then(function(t){o(function(){e.related=t||[]})})},e.openReferences=function(){r("references").open(),d.sidepanel("references")},e.openMetrics=function(){u.signedIn()?(r("cited-by").open(),n.$emit("cited-by-open"),d.sidepanel("cited_by")):h.promptRegister(function(){r("cited-by").open(),n.$emit("cited-by-open"),d.sidepanel("cited_by")})},e.openRCR=function(){r("rcr").open(),d.sidepanel("rcr")},e.openSupplements=function(){r("supplements").open(),d.sidepanel("supplements")},e.openFigures=function(){r("figures").open(),d.sidepanel("figures")},t.feed_token&&$("body").addClass("article-feed"),$(c).on("bg-click",function(){t.lightbox&&window.parent.postMessage({type:"close"},"*")}),l.onInit(function(t){$("body").addClass("initialized"),t.publisher&&l.isBrandable()&&$("body").addClass("publisher-"+t.publisher),o(function(){t.sync_next_item_id&&(e.goNext=function(){s.redirectOrPost(i.href("sponsored",{resource_id:[t.sync_collection_id,t.sync_next_item_id].join(":")},{absolute:!0}))}),t.sync_prev_item_id&&(e.goPrev=function(){s.redirectOrPost(i.href("sponsored",{resource_id:[t.sync_collection_id,t.sync_prev_item_id].join(":")},{absolute:!0}))})})}),l.onData(function(t){$("body").addClass("metadata"),e.$emit("start-read-mode"),o(function(){e.metadata=t.meta,e.supplements=t.supplements,e.references=t.references,e.figures=t.figures})}),l.onAccessCheck(function(e){e.pdf_url&&$("body").addClass("can-save"),e.print_url&&$("body").addClass("can-print")}),$(l).on("access-check",function(){o(function(){return n.sharing=l.isShared()})})}i.$inject=["$scope","$stateParams","$rootScope","$state","$mdSidenav","$timeout","util","environment","viewer","article","user","tracker","toast","accessToken"],angular.module("reader").controller("ReaderCtrl",i)},{}],55:[function(e,t,n){function i(e,t,n,i,r){e.types=n.types.split(","),i.onInit(function(e){e.viewer_pdf?r.setLocalData(e):r.setPreviewData(e).catch(function(e){if(!e||"load_html_fail"!=e.error)throw e;t.go("error.404",null,{location:!1})})}),i.onAccess(function(e){e.viewer_pdf||r.setFullData(e)})}i.$inject=["$scope","$state","$stateParams","article","viewer"],angular.module("reader").controller("ResolveCtrl",i)},{}],56:[function(e,t,n){function i(e,t,n,i,r,o,s,a,c){e.article=o,e.details=void 0,e.toolbarLinks=void 0,e.notes=a.listArr(),e.toggleAnnots=function(){r.$emit("toggle-annotations")},e.toggleInfo=function(){r.$emit("toggle-info")},o.onInit(function(t){$("body").addClass("initialized"),t.publisher&&o.isBrandable()&&$("body").addClass("publisher-"+t.publisher),t.description&&t.description.length&&$("body").addClass("info-open"),(t.download_url||t.url)&&$("body").addClass("can-save"),t.viewer_pdf?s.setLocalData(t):(s.setPreviewData(t).catch(function(e){if(!e||"load_html_fail"!=e.error)throw e;c(e)}),s.setFullData(t),$(o).on("resources-expired",function(){$(s).one("loading-start",function(){o.updateSupplement().then(s.setFullData)})})),n(function(){e.$emit("start-read-mode"),e.caption=t.caption||["Supplement",parseInt(t.index)+1].join(" "),e.type=t.type.toUpperCase().slice(0,4).replace(/\W/,""),e.details=t.description&&t.description.length,e.toolbarLinks={save:{target:t.download_url?void 0:"_blank",href:t.download_url||t.url}}})}),$(a).on("changed",function(){n(function(){e.notes=a.listArr()})})}i.$inject=["$scope","$state","$timeout","$stateParams","$rootScope","article","viewer","annotationsModel","trackError"],angular.module("reader").controller("SupplementCtrl",i)},{}],57:[function(e,t,n){function i(e,t,n,i,r,o){function s(t){e.trackPdfToolbar&&o.pdfToolbar(t)}e.printing=!1,e.downloading=!1,e.disabled={fullscreen_exit:!0},r.onInit(function(t){"ieee"==t.publisher&&(e.disabled.save=!0,e.disabled.print=!0)}),t.$watch("sharing",function(){"wiley"==r.get().publisher&&(e.disabled.save=t.sharing,e.disabled.print=t.sharing)}),e.toolbar={zoom_in:function(){i.scaleBy(1.25),s("zoom_in")},zoom_out:function(){i.scaleBy(.8),s("zoom_out")},rotate_right:function(){i.rotatePageBy(90),s("rotate")},fullscreen:function(){i.fitWidth(),s("fit_width"),e.disabled.fullscreen=!0,e.disabled.fullscreen_exit=!1},fullscreen_exit:function(){i.fitPage(),i.gotoPage(i.getPage()),s("fit_page"),e.disabled.fullscreen=!1,e.disabled.fullscreen_exit=!0},keyboard_arrow_down:function(){i.gotoPage(i.getPage()+1),s("page_down")},keyboard_arrow_up:function(){i.gotoPage(i.getPage()-1),s("page_up")},save:function(t){e.download&&!e.downloading&&(e.downloading=!0,e.download(t).finally(function(){n(function(){e.downloading=!1})}),s("save"))},print:function(t){e.print&&!e.printing&&(e.printing=!0,e.print(t).finally(function(){n(function(){e.printing=!1})}),s("print"))}}}i.$inject=["$scope","$rootScope","$timeout","viewer","article","tracker"],angular.module("reader").controller("ViewerToolbarCtrl",i)},{}],58:[function(e,t,n){function i(e,t,n,i,r,o){e.gotoPublisher=void 0,e.titleAction=o,e.msgAction={download:"saving",print:"printing"}[o],e.close=function(){n.hide()},i.onData(function(){t(function(){e.articleUrl=i.get().meta.url})}),i.onData(function(n){("taylorfrancis"!=n.publisher||n.meta.url)&&t(function(){e.gotoPublisher=function(){window.open(i.get().meta.url,"_blank"),r.linkout("publisher")}})})}i.$inject=["$scope","$timeout","$mdDialog","article","tracker","action"],angular.module("reader").controller("ComplimentaryCtrl",i)},{}],59:[function(e,t,n){function i(e,t,n,i,r){function o(e){return"bibtex"==e?"bib":"ris"}var s={type:"text/plain;charset=UTF-8"};e.format="ris",e.export=function(e){var a=n.get().meta,c=new Blob([r[o(e)](a,!0)],s);saveAs(c,encodeURIComponent(r.getKey(a)+"."+o(e))),i.exportCitation(e),t.hide()}}i.$inject=["$scope","$mdDialog","article","tracker","exporter"],angular.module("reader").controller("ExportCtrl",i)},{}],60:[function(e,t,n){function i(e,t,n,i,r,o,s){e.endpoint=t,e.savePaper=!0,e.openLibrary=function(){!r.item.id()&&e.savePaper&&n.onLoginCheck(function(){i.saveCloud(),r.item.add().then(o.showSyncedAd).catch(_.noop)}),s.hide()}}i.$inject=["$scope","endpoint","access","tracker","sync","toast","userModal"],angular.module("reader").controller("MyLibrarySuccessCtrl",i)},{}],61:[function(e,t,n){function i(e,t,n,i){e.synced=!1,e.endpoint=n,e.printPdf=function(){i.pdf().then(function(){t.hide()})},e.cloudPrint=function(){i.cloud().then(function(){t.hide()})},e.sendToMobile=function(){i.mobile().then(function(){e.synced=!0})}}i.$inject=["$scope","$mdDialog","endpoint","articlePrint"],angular.module("reader").controller("PrintCtrl",i)},{}],62:[function(e,t,n){function i(e,t,n,i){function r(){t.busy=!0,i.generate(t.includeAnnotations).then(function(e){n(function(){t.shareLink=e.url})}).finally(function(){n(function(){t.busy=!1})})}t.busy=!0,t.includeAnnotations=!1,t.shareLink="Generating Link...",t.$watch("includeAnnotations",function(e,t){e!=t&&r()}),t.select=function(e){e.preventDefault(),e.target.select()},"dialog"==t.type?r():e.$on("share-open",_.once(r))}i.$inject=["$rootScope","$scope","$timeout","share"],angular.module("reader").controller("ShareCtrl",i)},{}],63:[function(e,t,n){function i(e,t,n){function i(){e.busy=!0,e.shareLink="Generating Link...",n.generate().then(function(n){t(function(){e.shareLink=r=n.url})}).finally(function(){t(function(){e.busy=!1})})}var r=null;e.busy=!1,e.shareLink="",e.acceptTerms=!1,e.select=function(e){e.preventDefault(),e.target.select()},e.$watch("acceptTerms",function(t){t?r?e.shareLink=r:i():e.shareLink=""})}i.$inject=["$scope","$timeout","share"],angular.module("reader").controller("ShareWileyCtrl",i)},{}],64:[function(e,t,n){function i(e,t,n,i){e.titleAction=i,e.msgAction={download:"Saving",print:"Printing"}[i],e.close=function(){t.hide()},n.get().purchased_at&&(e.purchaseDate=new Date(1e3*n.get().purchased_at),e.purchaseType={1:"48-hour Rental",2:"Cloud Access"}[n.get().purchase_tier])}i.$inject=["$scope","$mdDialog","article","action"],angular.module("reader").controller("UnavailableCtrl",i)},{}],65:[function(e,t,n){function i(e,t,n,i,r){e.score=void 0,e.disabled=function(){return isNaN(e.score)},e.submit=function(){r(),n("leave-feedback").close(),i.local.set("mobile-feedback",!0),t.mobileFeedback=!!i.local.get("mobile-feedback"),mixpanel.track("NPS - Mobile Web Reader",{Score:e.score})}}i.$inject=["$scope","$rootScope","$mdSidenav","storage","initMixpanel"],angular.module("reader").controller("LeaveFeedbackCtrl",i)},{}],66:[function(e,t,n){function i(e,t,n,i,r,o,s,a,c){function l(e){return i.merge(i.pickDefined(n,a),{index:e.index,st:i.readcube("st")})}function u(e){var n=t.href("supplement",l(e),{absolute:!0});window.open(n,"_blank")}e.viewSupplement=function(e,t){if("video"==t.type){e.preventDefault();var n=$(e.target.closest(".supplement.video"));n.find(".thumb").hasClass("load-failed")?window.open(t.source_url,"_blank"):s(t),o.video()}else c?o.supplement():(t.stylesheet||t.viewer_pdf)&&(e.preventDefault(),o.supplement(),u(t))}}i.$inject=["$scope","$state","$stateParams","util","article","tracker","videoPlayer","SUPPL_PARAMS","MOBILE"],angular.module("reader").controller("SupplementsCtrl",i)},{}],67:[function(e,t,n){function i(e,t,n){e.close=function(){n.hide()},e.reload=function(){t.reload()}}i.$inject=["$scope","util","toast"],angular.module("reader").controller("AccessFrobiddenCtrl",i)},{}],68:[function(e,t,n){function i(e,t,n,i,r,o,s){function a(){return o.saveCloud(),r.item.add().then(n.showSyncedAd).catch(_.noop)}e.close=function(){n.hide()},e.addToLibrary=function(e){n.hide(t),i.signedIn()?a():s.showRegister({params:{tracking_action:"annotations_notification",tracking_origin:o.trackingOrigin()},onAuth:a,registerAd:"ads/add_to_library.html",targetEvent:e})}}i.$inject=["$scope","toastId","toast","user","sync","tracker","userModal"],angular.module("reader").controller("AnnotsNotSyncedCtrl",i)},{}],69:[function(e,t,n){function i(e,t,n,i,r){e.articleUrl=void 0,e.close=function(){i.hide()},n.onData(function(i){t(function(){e.articleUrl=n.get().meta.url})}),n.onAccessCheck(function(){n.hasFullAccess()&&i.hide(r)})}i.$inject=["$scope","$timeout","article","toast","toastId"],angular.module("reader").controller("AuthFailCtrl",i)},{}],70:[function(e,t,n){function i(e,t,n,i,r,o,s,a,c){var l=c?a:s;e.close=function(){n.hide()},e.register=function(){l.showRegister({params:{tracking_action:"metrics_register_prompt",tracking_origin:r.trackingOrigin()},onAuth:o})},e.login=function(){l.showLogin({params:{tracking_action:"metrics_login_prompt",tracking_origin:r.trackingOrigin()},onAuth:o})},i.onSignIn(function(){n.hide(t)})}i.$inject=["$scope","toastId","toast","user","tracker","onAuth","userModal","userSidenav","MOBILE"],angular.module("reader").controller("PromptRegisterCtrl",i)},{}],71:[function(e,t,n){function i(e,t,n,i,r,o){t.close=function(){r.hide()},t.openPersonal=function(){o.item.get().then(function(t){i.redirectOrPost(e.href("library",{resource_id:[t.item.collection_id,t.item.id].join(":")},{absolute:!0}))},_.noop)}}i.$inject=["$state","$scope","$timeout","util","toast","sync"],angular.module("reader").controller("ReadPersonalCtrl",i)},{}],72:[function(e,t,n){function i(e,t,n,i,r){function o(){a()>=0?e.expiresIn=a():n.cancel(o.promise)}function s(){return 1e3*r.get().expires_at}function a(){return s()-Date.now()}e.expiresIn=void 0,e.expiredOn=void 0,e.close=function(){i.hide()},e.$on("$destroy",function(){n.cancel(o.promise)}),a()>=0?(o(),o.promise=n(o,1e3)):e.expiredOn=s()}i.$inject=["$scope","$timeout","$interval","toast","article"],angular.module("reader").controller("RentalExpiryCtrl",i)},{}],73:[function(e,t,n){function i(e,t,n,i,r,o){switch(e.gotoPublisher=void 0,e.publisherName="Publisher",e.initiative="sharing initiative",n.get().publisher){case"nature":case"springer":e.publisherName="Springer Nature",e.initiative="SharedIt",e.whatsThisLink="http://www.springernature.com/content-sharing";break;case"taylorfrancis":e.publisherName="Taylor & Francis",e.whatsThisLink="https://www.routledge.com/resources/authors/promoting";break;case"ieee":e.publisherName="IEEE"}"author_token"==n.get().access_method?e.message=sprintf("Online access to this article has been shared by the author(s) via %s %s.",e.publisherName,e.initiative):e.message=sprintf("Online access to this article has been provided by %s %s.",e.publisherName,e.initiative),e.close=function(){r.hide()},n.onData(function(r){("taylorfrancis"!=r.publisher||r.meta.url)&&t(function(){e.gotoPublisher=function(){window.open(n.get().meta.url,"_blank"),i.linkout("publisher")}})})}i.$inject=["$scope","$timeout","article","tracker","toast","toastId"],angular.module("reader").controller("SharedAccessCtrl",i)},{}],74:[function(e,t,n){function i(e,t,n,i,r,o,s){e.type=s,e.learnMoreLink="http://www.wiley.com/WileyCDA/Section/id-829333.html",e.message={access:"Limited access to this article is provided by the Wiley Content Sharing initiative.",paywall:"The Wiley Content Sharing link that you used to access this page is no longer valid."}[s],e.getAccess=function(){t.redirectOrPost([i.web+"/checkout/new?","doi="+encodeURIComponent(n.get().doi)+"&","redirect="+encodeURIComponent(location.href)+"&","embed=1&mobile=1"].join(""))},e.close=function(){r.hide()}}i.$inject=["$scope","util","article","endpoint","toast","toastId","type"],angular.module("reader").controller("SharedAccessWileyCtrl",i)},{}],75:[function(e,t,n){function i(e,t,n){e.endpoint=t,e.close=function(){n.hide()}}i.$inject=["$scope","endpoint","toast"],angular.module("reader").controller("SyncedAdCtrl",i)},{}],76:[function(e,t,n){function i(e,t,n){e.close=function(){n.hide()},e.reload=function(){t.reload()}}i.$inject=["$scope","util","toast"],angular.module("reader").controller("UpdateAvailableCtrl",i)},{}],77:[function(e,t,n){function i(){return D.get().publisher}function r(){return"subscription"!=D.get().access_method}function o(){return!/^taylorfrancis|ieee$/.test(i())}function s(e){return R(i())?e.replace(parseUri(e).host,R(i())):e}function a(){var e=N.jsonp_access[i()];return e?s(e):null}function c(){return"//www.nature.com/articles/doi:"+D.get().doi+".epdf"}function l(){return"nature"!=i()?null:Y.addParams(s(c()),{doi:D.get().doi,pdf_url:D.get().meta.pdf_url,parent_url:location.href})}function u(){$(O.all).on("jsonp_access_result",function(e,t){y(t.result)}).on("cors_access_check_fail",function(e,t){}).on("pdf_size",function(e,t){Y.log("pdf size:",t.size),m(),g(t.size)}).on("pdf_size_fail",function(e,t){Y.log("get pdf size failed with status:",t.status),m(),j().then(function(){/5\d{2}/.test(t.status)||E()})})}function d(){if(!r())return!1;if(!o())return!1;if(parseUri(location.href).queryKey.no_publisher_access)return void I.fetch().finally(function(){I.signedIn()?C(function(){return E(!0)}):E(!0)});var e=parseUri(location.href).queryKey.standalone_access;a()?v():!e&&N.parent?f():p()}function h(){if(U={},z=!1,B=!1,H=!1,D.isPersonal()||D.isFeed())j();else try{$(M).trigger("auth-begin"),D.onData(function(){d(),k()}),I.onSignIn(x)}catch(e){throw $(M).trigger("auth-end"),e}}function f(){parseUri(location.href).queryKey.access_api?w():_()}function p(){l()&&(m(),$("<iframe></iframe>").attr("src",l()).addClass("access").appendTo(document.body))}function m(){$("iframe.access").remove()}function g(e){U.size=parseInt(e)||1337,j().then(E)}function v(){N.parent?w():b()}function _(){window.parent.postMessage({type:"get_pdf_size",pdf_url:D.get().meta.pdf_url},N.parent)}function w(){window.parent.postMessage({type:"jsonp_access_check"},N.parent)}function b(){var e=Y.timer.tic(),t=D.get(),n={resource:t.meta.original_doi};t.options&&t.options.cochrane&&(n.pdfType=t.options.cochrane),$.ajax({url:a(),dataType:"jsonp",data:n,success:function(t){Y.log("jsonp access response:",Y.timer.toc(e)+"ms",t),y(t)}})}function y(e){U.publisher_access_response=Y.merge(e,{publisher:i()}),j().then(E)}function k(){var e=!1;$(D).on("access-forbidden",function(){return e=!0}),setTimeout(function(){B||j()},5e3),setTimeout(function(){H||e||D.hasFullAccess()||$(M).trigger("external-access-timeout")},12e3)}function x(){j().then(function(){z=!0,$(M).trigger("login-access-check")})}function C(e){z?e():$(M).one("login-access-check",e)}function A(e){H?e():$(M).one("external-access-check",e)}function T(){D.onAccess(function(e){if(e.expires_at){var t=1e3*e.expires_at,n=t-Date.now();n>=0&&P.add(function(){Y.reload()},Date.now()+n),$(M).trigger("rental-expiry",[t])}})}function E(){H=!0,$(M).trigger("external-access-check")}function j(){return B=!0,$(M).trigger("auth-begin"),D.checkAccessWith(U).then(function(e){return $(M).trigger("auth-end"),e},function(e){return $(M).trigger("auth-end"),e})}function S(){A(function(){F(D.hasAccess()?"access:fulltext":"access:preview");
})}function X(){L||(D.onInit(function(e){S(),u(),h(),T()}),L=!0)}var I=e("./user"),Y=e("./utils/util"),P=e("./utils/alarm_clock"),R=e("./proxy_host"),N=e("./endpoint"),O=e("./receiver"),D=e("./article"),F=e("./tracking/notify_parent"),M={},L=!1,U={},z=!1,B=!1,H=!1;M.init=X,M.checkAccess=j,M.onLoginCheck=C,M.onExternalCheck=A,M.externalCheckAvailable=o,M.performAccessChecks=h,t.exports=M},{"./article":88,"./endpoint":97,"./proxy_host":115,"./receiver":116,"./tracking/notify_parent":125,"./user":132,"./utils/alarm_clock":134,"./utils/util":147}],78:[function(e,t,n){function i(){for(var e=parseUri(location.href),t=0;t<l.length;t++){var n=l[t],i=e.queryKey[n];if(i)return{key:n,val:decodeURIComponent(i)}}return null}function r(e){var t=i(),n={doi:e,source:"mobile_reader",referrer_url:decodeURIComponent(location.href),referrer:o.referrerHost(),tracking_id:a.get()};return n[t.key]=t.val,new Promise(function(e,t){$.get(s.services+"/reader/generate_proxy_url?"+$.param(n)).done(function(n){return n.url?e(n):t(n)}).fail(t)})}var o=e("./utils/util"),s=e("./endpoint"),a=e("./tracking/track_id"),c=["shared_access_token","referrer_access_token","author_access_token"],l=["feed_token"].concat(c);t.exports={get:i,getProxiedArticle:r,SHARING_TOKENS:c,ACCESS_TOKENS:l}},{"./endpoint":97,"./tracking/track_id":129,"./utils/util":147}],79:[function(e,t,n){function i(e,t){var n="html5"==t.renderer,i="swf"==t.renderer,s=!n&&!i,c=null,l={container:e.getElem(),insertWhitespace:!n};return t.text?(t.preceeding_text||(t.preceeding_text=""),s&&!_.isEmpty(t.rects)&&(l.boundingRects=a.getTransformedRects(e,t.rects)),c||(c=o.deserialize({prefix:t.preceeding_text,text:t.text},l)),!c&&i&&(c=o.deserialize({prefix:t.preceeding_text.slice(0,-1),text:t.text.slice(0,-1)},l)),!c&&i&&(c=o.deserialize({prefix:t.preceeding_text,text:t.text},r.merge(l,{matchMisconverted:!0}))),!c&&s&&(c=o.deserialize({prefix:"",text:t.text},l)),c):null}var r=e("../utils/util"),o=e("../utils/range_serializer"),s=e("./annotation_toolbar"),a=e("./annotation_helper"),c=function(e,t,n){t=r.merge({id:r.guid(),created:r.dateISO(),renderer:"html5",type:"highlight",has_note:!1,color_id:1},t),n=n||i(e,t),this.klass="annotation",this.id=r.guid(),this.page=e,this.data=t,this.range=n,this._initData(),this._initRects(),this._initElems(),this._addDrawable(),this._addEventable(),this._initToolbar()};c.prototype={_initData:function(){!this.data.text&&this.range&&(this.data=r.merge(this.data,a.rangeToTextData(this.range,this.page))),!this.data.rects&&this.range&&(this.data=r.merge(this.data,a.rangeToRectData(this.range,this.page)))},_initRects:function(){this.data.rects?this.rects=a.fromSyncCoords(this.page,this.data.rects):this.range&&(this.rects=a.getNormalizedRects(this.page,this.range))},_initElems:function(){var e=[],t=this.page.getZoom();_.each(this.rects,function(n){e.push(r.divFromRect(n.scale(t,t)))}),this._elems=$(e)},_addDrawable:function(){var e=[this.klass+"-elem-draw",this.getColor(),this.id].join(" "),t=a.addToDocumentFragment(this._elems,e);this._drawableElems=$(t).children(),this.page.getDrawable().append(t)},_addEventable:function(){var e=[this.klass,this.id].join(" "),t=a.addToDocumentFragment(this._elems,e);this._eventableElems=$(t).children(),this.page.getEventable().append(t)},_initToolbar:function(){var e=this;this.toolbar=new s(this),$(this.toolbar).on("add-note",function(){e._setNote(""),e.openToolbar()}).on("set-note",function(){e._setNote(e.toolbar.getNote())}).on("delete",function(){e.toolbar.close(),$(e).trigger("delete")})},_removeEventable:function(){this._eventableElems.remove(),this._eventableElems=null},_removeDrawable:function(){this._drawableElems.remove(),this._drawableElems=null},_destroyToolbar:function(){$(this.toolbar).off("add-note set-note delete"),this.toolbar.destroy(),this.toolbar=null},_setNote:function(e){this.hasNote()&&this.getNote()==e||(this.data.has_note=!0,this.data.note=e,$(this).trigger("change"))},setData:function(e){this.data=r.clone(e)},openToolbar:function(){this.toolbar.open()},hasNote:function(){return this.data.has_note},getElems:function(){return this._eventableElems},getNote:function(){return this.data.note},getColor:function(){var e=parseInt(this.data.color_id);return!e||e<1||e>4?"color-1":"color-"+e},getId:function(){return this.id},getDataId:function(){return this.data.id},getKlass:function(){return this.klass},destroy:function(){this._destroyToolbar(),this._removeEventable(),this._removeDrawable(),this.range=null,this.klass=null,this.data=null,this.page=null},serialize:function(){return r.clone(this.data)}},t.exports=c},{"../utils/range_serializer":141,"../utils/util":147,"./annotation_helper":80,"./annotation_toolbar":81}],80:[function(e,t,n){function i(e,t){return e?f.hasTransparentText(f.getElems(e)):t.hasTransparentText()}function r(e,t){var n=document.createDocumentFragment();return e.each(function(){var e=this.cloneNode();e.className=t,n.appendChild(e)}),n}function o(e,t){return Math.abs(e.top+e.height-(t.top+t.height))<1}function s(e,t){var n=[];return _.each(e,function(e){var i=n[n.length-1];i&&t(e,i)?i.boundingRect(e):n.push(e)}),n}function a(e,t){var n=[],i=e.getNormRect(),r=1/e.getScale();return f.getElems(t).each(function(){var e=this.getBoundingClientRect();if(e.width>0&&e.height>0){var t=new p(e.left,e.top,e.width,e.height);t.translate(-i.left,-i.top),t.scale(r,r),n.push(t)}}),s(n,o)}function c(e,t){var n=e.getNormRect(),i=e.getScale();return $.map(t,function(e){var t=new p(e[0],n.height-e[1]-e[3],e[2],e[3]);return t.scale(i,i),t.translate(n.left,n.top),t})}function l(e,t){var n=e.getNormRect();return $.map(t,function(e){return[[m.round10(e.left,-1),m.round10(n.height-e.top-e.height,-1),m.round10(e.width,-1),m.round10(e.height,-1)]]})}function u(e,t){var n=e.getNormRect();return $.map(t,function(e){return new p(e[0],n.height-e[1]-e[3],e[2],e[3])})}function d(e,t){var n=g.serialize(e,t.getElem(),128);return{preceeding_text:n.prefix,text:n.text}}function h(e,t){return{rects:l(t,a(t,e))}}var f=e("../utils/util"),p=e("../utils/rect"),m=e("../utils/number"),g=e("../utils/range_serializer");t.exports={isTextTransparent:i,addToDocumentFragment:r,getNormalizedRects:a,getTransformedRects:c,fromSyncCoords:u,rangeToTextData:d,rangeToRectData:h}},{"../utils/number":140,"../utils/range_serializer":141,"../utils/rect":142,"../utils/util":147}],81:[function(e,t,n){var i=e("./base_toolbar"),r=function(e){this.annot=e,this._init("annotations-base-toolbar","annotation")};r.prototype=$.extend(new i,{_initEvents:function(){this._deleted=!1,this._elem.find(".add-note").click($.proxy(this._onAddNote,this)),this._elem.find(".delete").click($.proxy(this._onDelete,this)),this._textarea().on("keydown",function(e){e.stopPropagation()}),this._textarea().on("keyup",_.debounce($.proxy(this._onSetNote,this),5e3)),this._textarea().on("blur",$.proxy(this._onSetNote,this)),$(this.annot).on("click",$.proxy(this.open,this))},_textarea:function(){return this._elem.find("textarea")},_onAddNote:function(){this._elem.toggleClass("note",!0),$(this).trigger("add-note")},_onDelete:function(){this._deleted=!0,$(this).trigger("delete")},_onSetNote:function(){this._deleted||$(this).trigger("set-note")},getNote:function(){return this._textarea().val()},updateNote:function(){this._textarea().is(":focus")||(this._elem.toggleClass("note",this.annot.hasNote()),this.getNote()!=this.annot.getNote()&&this._textarea().val(this.annot.getNote()||""))},open:function(){this.updateNote(),i.prototype.open.call(this,this.annot.getElems().first(),this.annot.getColor()),this._textarea().is(":visible")&&!this.getNote()&&this._textarea().focus()},destroy:function(){i.prototype.destroy.apply(this),this.selection=null,this.annot=null}}),t.exports=r},{"./base_toolbar":84}],82:[function(e,t,n){function i(e,t){T[e.getId()]=e,y.add(e),$(e).on("change",function(){k.updateItem(e.serialize())}).on("delete",function(){k.removeItem(e.getDataId()),r(e)}),t&&e.openToolbar()}function r(e){$(e).off("change delete"),y.remove(e),delete E[e.getDataId()],delete T[e.getId()],e.destroy()}function o(e){var t=e.page_start+1,n=C.getPageObj(t),r=new x(n,e,null);r&&(delete E[e.id],i(r))}function s(e){var t=e.page_start+1;j[t]=!1,E[e.id]=e,C.onInit(function(){a(t,C.getPageObj(t))})}function a(e,t){if(!j[e]&&t.hasText()){g.timer.tic();for(var n in E){var i=E[n];i&&i.page_start+1==e&&o(i)}j[e]=!0}}function c(e){return _.find(T,function(t){return t.getDataId()==e})}function l(){v.hasAccess()&&w.item.get().then(function(e){e.item.pdf_hash||w.item.add().catch(_.noop)},_.noop)}function u(e,t,n){var r=C.getPageObj(t),o=new x(r,g.merge(n,{sha256:v.get().hash,page_start:t-1,page_end:t-1}),e);i(o,n.has_note),k.addItem(o.serialize())}function d(e,t,n){u(e,t,{color_id:n}),b.highlight()}function h(e,t,n){u(e,t,{has_note:!0,note:n}),b.note()}function f(e){var t=c(e);t&&(k.removeItem(e),r(t))}function p(){S||v.get().sync_item_shared||(E=k.list(),$(C).on("page-loaded",function(e,t){a(t,C.getPageObj(t))}),C.onInit(function(){C.eachPage(a)}),$(k).on("add.external",function(e,t){s(t)}),$(k).on("update.external",function(e,t,n){var i=c(t.id);i&&i.setData(n)}),$(k).on("remove.external",function(e,t){var n=c(t.id);n&&r(n)}),$(k).on(["add.internal","update.internal","remove.internal"].join(" "),l),S=!0)}var m=e("../utils/mobile_detect").any,g=e("../utils/util"),v=e("../article"),w=e("../sync/sync"),b=e("../tracking/tracker"),y=e("../input_handler"),k=e("./annotations_model"),x=e("./annotation"),C=e(m?"../viewer/mobile_viewer":"../viewer/viewer"),A={},T={},E={},j={},S=!1;A.init=p,A.addHighlight=d,A.addNote=h,A.remove=f,t.exports=A},{"../article":88,"../input_handler":113,"../sync/sync":122,"../tracking/tracker":130,"../utils/mobile_detect":139,"../utils/util":147,"../viewer/mobile_viewer":152,"../viewer/viewer":156,"./annotation":79,"./annotations_model":83}],83:[function(e,t,n){function i(e){return e?".internal":".external"}function r(e){$(R).trigger("not-synced",[e])}function o(e,t){$(R).trigger("add"+i(t),[e]).trigger("changed")}function s(e,t,n){$(R).trigger("update"+i(n),[e,t]).trigger("changed")}function a(e,t){$(R).trigger("remove"+i(t),[e]).trigger("changed")}function c(e,t){e.text&&(N[e.id]=e,o(e,t))}function l(e,t,n){N[e.id]&&(_.isEqual(e,t)||(delete N[e.id],N[t.id]=t,s(e,t,n)))}function u(e,t){var n=N[e];n&&(delete N[e],a(n,t))}function d(e){return _.pick(e,["preceeding_text","text","color_id","has_note","note","page_start","page_end"])}function h(e){return CryptoJS.MD5(JSON.stringify(d(e))).toString()}function f(e,t){var n={},i={};return _.each(e,function(e){n[h(e)]=e}),_.each(t,function(e){i[h(e)]=e}),E.arrayToHash(_.filter(E.objDiff(n,i),function(e){return!_.isEmpty(d(e))}))}function p(e,t){_.each(e,function(e){e.sha256=t})}function m(){X.onData(function(){var e=X.get().shared_annotations_url;e&&I.read(e).then(function(e){p(e.user_data.annotations,X.get().hash);var t=f(N,e.user_data.annotations);_.isEmpty(t)||(Y.item.id()?$(R).trigger("merge-shared-prompt",function(){T(t)}):T(t))})})}function g(e){return e=e||{},Y.annots.list().then(function(t){e=f(t.annotations,e);var n=E.arrayToHash(t.annotations);_.each(N,function(t,i){n[i]||e[i]||u(i)}),_.each(n,function(t,n){N[n]?(delete e[n],l(N[n],t)):c(t)}),_.each(e,function(e){Y.annots.add(e).then(function(t){l(e,t.annotation)},r)})},_.noop)}function v(){var e=X.get().sync_collection_id||j.get().id;return sprintf("/%s/collections/%s/items/%s",S.get(),e,Y.item.id())}function w(){var e=null,t=_.once(m);Y.item.get().finally(function(){Y.item.id()||t(),Y.item.onAdd(function(){g(_.clone(N)).then(t),e=P.subscribe(v(),function(){g()})}),Y.item.onRemove(function(){e&&e.cancel()})})}function b(){return E.clone(N)}function y(){return E.hashToArray(N)}function k(e){return c(e,!0),Y.annots.add(e).then(function(t){l(e,t.annotation)},r)}function x(e){var t=E.objDiff(N[e.id],e);return _.isEmpty(t)?Promise.resolve({status:"ok"}):(l(N[e.id],e,!0),Y.annots.update(e.id,t).then(function(t){l(e,t.annotation)},function(t){404==t.status?u(e.id):r(t)}))}function C(e){return u(e,!0),Y.annots.remove(e).catch(_.noop)}function A(){return I.writableUrl().then(function(e){return new Promise(function(t){I.write(e.url,{user_data:{modified:E.dateISO(),annotations:_.toArray(N)}}).then(function(){t(e.id)},_.noop)})})}function T(e){_.each(e,function(e){c(e),Y.annots.add(e).then(function(t){l(e,t.annotation)},_.noop)})}var E=e("../utils/util"),j=e("../user"),S=e("../environment"),X=e("../article"),I=e("../s3_storage"),Y=e("../sync/sync"),P=e("../sync/faye_client"),R={},N={};X.onInit(w),R.list=b,R.listArr=y,R.addItem=k,R.updateItem=x,R.removeItem=C,R.writeShared=A,t.exports=R},{"../article":88,"../environment":98,"../s3_storage":118,"../sync/faye_client":120,"../sync/sync":122,"../user":132,"../utils/util":147}],84:[function(e,t,n){var i=e("../elements/popover"),r=function(){};r.prototype={_init:function(e,t){this._elem=$("#"+e).clone(),this._elem.removeAttr("id").addClass(t),this._initEvents()},_initEvents:function(){},_open:function(e,t){this._anchor=e,i.open({placement:"up",content:this._elem,anchor:this._anchor,klass:t})},open:function(e,t){this._open(e||this._anchor,t)},close:function(){i.close(this._anchor)},isOpen:function(){return i.isOpen(this._anchor)},destroy:function(){this.close(),this._elem.remove(),this._elem=null,this._anchor=null}},t.exports=r},{"../elements/popover":96}],85:[function(e,t,n){var i=e("./base_toolbar"),r=function(e){this.selection=e,this._init("resolve-toolbar","resolve")};r.prototype=$.extend(new i,{_initEvents:function(){var e=this;this._elem.find(".row").click(function(){e.close(),$(e).trigger("marked",[{type:$(this).attr("type").toLowerCase(),text:e.selection.getRangeAndClear().text().replace(/(?:\r?\n|\r)+/g," ")}])}),$(this.selection).on("set-selection",function(){e.open(e.selection.getElems().first())}).on("clear-selection",$.proxy(this.close,this))},destroy:function(){i.prototype.destroy.apply(this),this.selection=null}}),t.exports=r},{"./base_toolbar":84}],86:[function(e,t,n){function i(e,t){function n(){var e=f.commonAncestorContainer;return e.nodeType==Node.TEXT_NODE&&(e=e.parentNode.parentNode),$(e).find("."+h)}function i(e){try{e.removeAllRanges()}catch(e){}}function s(){o.remove(u),n().removeClass(h),i(rangy.getSelection()),$(u).trigger("clear-selection")}function a(){var e=rangy.getSelection(),n=e.getAllRanges()[0];return t(n)?(d=r.guid(),f=n,p.applyToRange(f),e.setSingleRange(f),o.add(u),$(u).trigger("set-selection"),!0):(i(e),!1)}function c(){var t=rangy.getSelection();return!t.isCollapsed&&(!!$.contains(e[0],t.anchorNode)&&!!$.contains(e[0],t.focusNode))}function l(){$(document).on("mousedown.selection",function(t){1==t.which&&(c()&&s(),e.one("mouseup.selection",function(t){if(1==t.which)return c()&&a()?(e.one("click.selection",!1),!1):void 0}))})}e=e||$(document.body),t=t||function(){return!0};var u={},d=null,h="current-selection",f=rangy.createRange(),p=rangy.createClassApplier(h);return l(),u.clear=function(){return s()},u.getRange=function(){return f.cloneRange()},u.getRangeAndClear=function(){var e=f.cloneRange();return s(),e},u.getElems=function(){return n()},u.getKlass=function(){return h},u.getId=function(){return d},u}var r=e("../utils/util"),o=e("../input_handler");t.exports=i},{"../input_handler":113,"../utils/util":147}],87:[function(e,t,n){var i=e("./base_toolbar"),r=function(e){this.selection=e,this._init("annotations-base-toolbar","selection")};r.prototype=$.extend(new i,{_initEvents:function(){var e=this;this._elem.find(".add-note").click(function(){$(e).trigger("add-note")}),this._elem.find(".annot-colors .sample").click(function(t){$(e).trigger("highlight",[$(this).data("colorid")])}),$(this.selection).on("set-selection",function(){e.selection.getRange().text()&&e.open(e.selection.getElems().first())}).on("clear-selection",$.proxy(this.close,this))},destroy:function(){i.prototype.destroy.apply(this),this.selection=null}}),t.exports=r},{"./base_toolbar":84}],88:[function(e,t,n){function i(){var e=new Date,t=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate());return t+47*ue.hrs+_.random(ue.hrs-1)}function r(){return ne.clone(pe)}function o(){return ge}function s(){return!!he.sync_item_id}function a(){return he.sync_item_sponsored}function c(){return!s()||a()}function l(){return!_.isEmpty(ne.pickDefined(me,ae.SHARING_TOKENS))}function u(){return/(?:sharing|referrer|author)_token/.test(he.access_method)}function d(){return l()&&ae.get().key.replace("_access_token","")}function h(){return l()&&ae.get().val}function f(){return!!me.feed_token}function p(){return ne.merge(pe,me,_.pick(he,"doi"),{st:ne.readcube("st")})}function m(){return ne.addParams(ie.services+"/reader/basic_data",p())}function g(){return ne.addParams(ie.services+"/reader/article_data",ne.merge(he.options,p()))}function v(e){return ne.addParams(ie.services+"/articles/metrics",ne.merge({doi:he.doi,scroll:1,size:30},e))}function w(){return ie.services+"/reader/pages"}function b(){return ne.addParams(ie.services+"/reader/related",p())}function y(e){return fe=ne.merge(fe,he.options,e,p()),ne.referrerHost()&&(fe.referrer=ne.referrerHost()),fe}function k(e,t){return function(n){n.error?t(n):e(n)}}function x(e){return function(t){403==t.status&&$(de).trigger("access-forbidden"),e(t.responseJSON||t.responseText||"unknown error")}}function C(e){return e.error||e.stylesheet||e.png}function A(){return new Promise(function(e,t){var n=ne.clone(ce);C(n)?k(e,t)(n):$.ajax(ne.merge(be,{url:m(),dataType:"json",success:k(e,t),error:function(e){return t(e.responseJSON||e.responseText||"unknown error")}}))})}function T(){return new Promise(function(e,t){$.ajax(ne.merge(be,{url:g(),dataType:"json",success:e,error:x(t)}))})}function E(e){return new Promise(function(t,n){$.ajax(ne.merge(be,{url:v(e),dataType:"json",success:t,error:x(n)}))})}function j(e,t){return new Promise(function(n,i){$.ajax(ne.merge(be,{url:e,type:"POST",contentType:"application/json; charset=UTF-8",dataType:"json",data:JSON.stringify(y(t)),success:n,error:x(i)}))})}function S(){return new Promise(function(e){S.data?e(S.data):$.ajax(ne.merge(be,{url:b(),dataType:"json",success:function(t){e(S.data=t)}}))})}function X(){return _.has(he,"access")}function I(e){return U()?Promise.resolve(he):j(w(),e)}function Y(e){return e=e.toLowerCase(),e.indexOf("video")!=-1?"video":0==e.indexOf("vnd.")?e.indexOf("word")!=-1?"doc":e.indexOf("excel")!=-1||e.indexOf("sheet")!=-1?"xls":e.indexOf("powerpoint")!=-1||e.indexOf("presentation")!=-1?"ppt":"type":e}function P(e,t){return e.index=t,e.caption=e.caption||"Supplement "+(t+1),e.type=Y(e.type),e}function R(e){return"wiley"==he.publisher?e.badge=e.label||e.ordinal:e.badge=e.ordinal||e.label,e}function N(e){function t(){return(he.options||{}).cochrane}if("wiley"==me.publisher&&!t()){var n=he.doi.replace("#","%23"),i="https://onlinelibrary.wiley.com";if(ie.parent){var r=parseUri(ie.parent);i=r.protocol+"://"+r.host}e.meta.url=i+"/doi/full/"+n,e.meta.pdf_url=i+"/doi/pdf/"+n}return e.meta.url?"ieee"!=he.publisher&&(e.meta.url=K(e.meta.url),e.meta.pdf_url=K(e.meta.pdf_url)):e.meta.url=ie.dx_doi+"/"+he.doi,e}function O(e){return e=ne.merge(we,e),e.references=_(e.references).map(R),e.supplements=_(e.supplements).map(P),he.cover&&e.citations.unshift([]),ie.parent&&me.publisher&&(e.meta.publisher=me.publisher),"wiley"!=he.publisher&&parseFloat(e.meta.rcr)||delete e.meta.rcr,N(e)}function D(){oe.remove(_e),_e=oe.add(function(){$(de).trigger("resources-expired")},i())}function F(e){return he=ne.merge(ce,he,e),ie.parent&&me.publisher&&(he.publisher=me.publisher),he.print_url=he.print_url||he.viewer_pdf,he.stylesheet_linked=!!ce.stylesheet,he.yield_thumb=function(t){return"https://images.readcube-cdn.com/prerendered/"+e.hash+"/"+ ++t+".jpg"},D(),$(de).trigger("initialized",[z()]),he}function M(e){return he=ne.merge(he,O(e)),$(de).trigger("data",[z()]),he}function L(e){return he=ne.merge(he,e),he.share_type=d(),he.share_token=h(),$(de).trigger("access-check",[z()]),B()&&(D(),$(de).trigger("access",[z()])),he}function U(){return B()&&he.pdf_url}function z(){return ne.clone(he)}function B(){return he.access}function H(e){return I(e).then(L)}function q(e){return j(ie.services+"/reader/generate_shared_access",e)}function W(e){he.meta?e(z()):$(de).one("data",function(t,n){e(n)})}function V(e){B()?e(z()):$(de).one("access",function(t,n){e(n)})}function J(e){X()&&e(z()),$(de).on("access-check",function(t,n){e(n)})}function Q(e){X()?e(z()):$(de).one("access-check",function(t,n){e(n)})}function K(e){return e&&re(he.publisher)?e.replace(parseUri(e).host,re(he.publisher)):e}function G(e){_.isEmpty(he)?$(de).one("initialized",function(t,n){e(n)}):e(z())}function Z(e){return ve?ve:(ge="supplement",ve=se.init(e),ve.then(F),ve)}function ee(){return se.update().then(F)}function te(e,t){return ve?ve:(pe=e||{},me=t||{},le&&(me.mobile=1),ve=A(),ve.then(F).then(function(e){e.meta?M(e):T().then(M)}),ve)}var ne=e("./utils/util"),ie=e("./endpoint"),re=e("./proxy_host"),oe=e("./utils/alarm_clock"),se=e("./supplement"),ae=(e("./environment"),e("./access_token")),ce=window.readcube||{},le=e("./utils/mobile_detect").any,ue={sec:1e3,min:6e4,hrs:36e5},de={},he={},fe={},pe={},me={},ge="article",ve=null,_e=null,we={meta:{},figures:[],citations:[],references:[],supplements:[]},be={crossDomain:!0,xhrFields:{withCredentials:!0}};de.init=te,de.initSupplement=Z,de.updateSupplement=ee,de.onInit=G,de.get=z,de.getIds=r,de.getType=o,de.hasAccess=B,de.hasFullAccess=U,de.checkAccessWith=H,de.generateSharedAccess=q,de.getMetrics=E,de.onData=W,de.onAccess=V,de.onAccessCheck=J,de.onceAccessChecked=Q,de.getRelated=S,de.isPersonal=s,de.isSponsored=a,de.isBrandable=c,de.isShared=u,de.isFeed=f,window.article=de,t.exports=de},{"./access_token":78,"./endpoint":97,"./environment":98,"./proxy_host":115,"./supplement":119,"./utils/alarm_clock":134,"./utils/mobile_detect":139,"./utils/util":147}],89:[function(e,t,n){function i(){return l.getPageObj(1)}function r(){var e=i();if(e){var t=e.getWidth()*e.getScale(),n=e.getMargin()*e.getScale(),r=t/d.data("original-width"),o=d.data("original-height")*r,s=d.data("bg-original-width"),a=d.data("bg-original-height")*r;d.css({width:t,height:o,margin:n+"px auto","background-size":s+"px "+a+"px"}),d.find("img").each(function(){var e=$(this),n=e.data("original-height")*r,i=e.data("original-width")*r,s=1;i>o&&(s=o/i),n*s>t&&(s=t/n),e.css("height",i*s)})}}function o(e){d=e,d.data("original-width",d.width()),d.data("original-height",d.height());var t=parseUri(location.href).queryKey;t.banner?(d.addClass("flat"),s({background:"data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",center:decodeURIComponent(t.banner)})):c.onData(function(e){c.isPersonal()&&!c.get().sync_item_sponsored||s(e.banner)})}function s(e){e&&(e.url&&d.click(function(){window.open(e.url,"_blank")}),a(e.background,function(t){function n(e){$(e).attr("role","presentation").appendTo(d)}d.css("background-image",'url("'+e.background+'")').show(),d.data("bg-original-width",$(t).data("original-width")),d.data("bg-original-height",$(t).data("original-height")),r(),a(e.left,function(e){e.className="left",n(e),r()}),a(e.center,function(e){e.className="center",n(e),r()}),a(e.right,function(e){e.className="right",n(e),r()})}),$(l).on("scale",r),l.onInit(r))}function a(e,t){if(e){var n=new Image;n.onload=function(){$(n).data("original-width",n.width),$(n).data("original-height",n.height),t(n)},n.src=e}}var c=e("./article"),l=e("./viewer/viewer"),u={},d=null;u.init=o,t.exports=u},{"./article":88,"./viewer/viewer":156}],90:[function(e,t,n){function i(e,t){var n=[];e.indexOf("'",1)!=-1&&(e=e.replace(/\'$/,""),n.push(e)),e.indexOf("",1)!=-1&&(e=e.replace(/\/,""),n.push(e)),n.push(e.replace(" "," "));for(var i=1;i<e.length-2;i++)n.push(e.substring(0,i)+e.substring(i,e.length).replace(/(.{1})/,"$1-"));return n.push(".",".",""),t.match(/^\s*\d{1}\s*$/)||n.push(""),n}function r(e){for(var t=[],n=1;n<e.length-2;n++)t.push(e.substring(0,n)+e.substring(n,e.length).replace(/(.{1})/,"$1-"));return t}var o=e("../utils/util"),s=e("../utils/range_serializer"),a=function(e,t,n){this.klass="enhanced-"+t.type,this.id=o.guid(),this.page=e,this.data=t,this.range=n,this.elems=null,this.klassApp=null,this.idApp=null,this._init()};a.prototype={_init:function(){this.klassApp=rangy.createClassApplier(this.klass),this.idApp=rangy.createClassApplier(this.id),this.klassApp.applyToRange(this.range),this.idApp.applyToRange(this.range),this.elems=o.getElems(this.range,this.id),this.elems.closest("div.t").addClass("citation-container")},getElems:function(){return this.elems},getId:function(){return this.id},getKlass:function(){return this.klass},getType:function(){return this.data.type},getData:function(){return o.clone(this.data)},getRange:function(){return this.range.cloneRange()},getPage:function(){return this.page},destroy:function(){this.klassApp.undoToRange(this.range),this.idApp.undoToRange(this.range),this.klassApp=null,this.idApp=null,this.range=null,this.elems=null,this.data=null}},a.deserialize=function(e,t,n,c){var l=null,u={container:e.getElem(),matchFilter:n,matchWeirdCitations:!0,matchTranslits:"author"==t.type,matchCase:"author"==t.type};if(!l&&t.text.match(/^\d{4}$/)&&(l=s.deserialize({prefix:t.prefix.split(/\(|\[|;/g).pop().trim(),text:t.text},o.merge(u,{matchTranslits:!1},c))),l||(l=s.deserialize({prefix:t.prefix.split(/\s+|\n/).pop(),text:t.text},o.merge(u,c))),!l&&t.text.match(/\d+\s+-\s+\d+/)&&(l=s.deserialize({prefix:t.prefix,text:t.text.replace(/\s+-\s+/g," - - ")},o.merge(u,c))),l||(l=s.deserialize({prefix:t.prefix.replace(/(;)/g," $1 "),text:t.text.replace(/(\d+|[a-zA-Z\.]+|,|;)/g," $1 ")},o.merge(u,c))),l||(l=s.deserialize(t,o.merge(u,{matchBrokenTxt:!0},c))),l||(l=s.deserialize(t,o.merge(u,{insertWhitespace:!0},c))),l||"author"!=t.type||(l=s.deserialize(t,o.merge(u,{removeDiacritics:!0},c))),l||"author"!=t.type||(l=s.deserialize(t,o.merge(u,{removeDiacritics:!0,matchCase:!1},c))),l||(l=s.deserialize(t,o.merge(u,{matchTranslits:!1,matchMisconverted:!0},c))),l||(l=s.deserialize(t,o.merge(u,{matchTranslits:!1,matchBrokenSpaces:!0},c))),l||(l=s.deserialize(t,o.merge(u,{matchTranslits:!1,matchBrokenDigits:!0},c))),!l&&t.prefix.length)for(var d=i(t.prefix,t.text),h=0;h<d.length&&!(l=s.deserialize({prefix:d[h],text:t.text},o.merge(u,c)));h++);if(!l&&!t.text.match(/^\s*\d{1}\s*$/))for(var d=r(t.text),h=0;h<d.length&&!(l=s.deserialize({prefix:t.prefix,text:d[h]},o.merge(u,c)));h++);return l?new a(e,t,l):(u.container.children().length&&o.log("* missed citation: ["+t.prefix+"]["+t.text+"]"),null)},t.exports=a},{"../utils/range_serializer":141,"../utils/util":147}],91:[function(e,t,n){function i(e){if("reference"!=e.getType())return!1;var t=e.getData().text;return t=t.replace(/[\s\[\]\(\)]/g,""),t=t.replace(/[-]/g,","),/^(\d{1,3},)*\d{1,3}$/.test(t)}function r(e){return i(e)?"enhanced-rectangle-draw":"enhanced-underline-draw"}function o(e){e.getElem().addClass("animate-enhanced show-enhanced")}function s(e){e.getElem().removeClass("show-enhanced"),setTimeout(function(){e.getElem().removeClass("animate-enhanced")},1e3)}function a(){var e=h.getPageObj(h.getPage());return!(!e||!e.hasText())&&(o(e),setTimeout(function(){s(e)},1e3),!0)}function c(e){m[e.getId()]=e;var t=r(e),n=e.getElems().filter(function(){return!!this.textContent});d.hasTransparentText(n)&&(t+=" transparent"),n.addClass(t),"author"==e.getType()?n.filter(function(){return f.detectGlyph(this.textContent.trim())}).addClass("diacritic"):n.length>1&&n.each(function(e){0==e?$(this).addClass("leftmost"):e==n.length-1?$(this).addClass("rightmost"):$(this).addClass("middle")}),n.on({"mouseenter.citation-drawer":function(){n.addClass("hover")},"mouseleave.citation-drawer":function(){n.removeClass("hover")},"open.popover.citation-drawer":function(){n.addClass("active")},"close.popover.citation-drawer":function(){n.removeClass("active")}})}function l(e){var t=r(e),n=e.getElems();n.off(["mouseenter.citation-drawer","mouseleave.citation-drawer","open.popover.citation-drawer","close.popover.citation-drawer"].join(" ")),n.removeClass(t+" transparent diacritic leftmost middle rightmost"),delete m[e.getId()]}function u(){_.each(_.keys(m),function(e){l(m[e])})}var d=e("../utils/util"),h=e("../viewer/viewer"),f=e("../utils/diacritics"),p={},m={};p.add=c,p.remove=l,p.showAll=o,p.hideAll=s,p.animateAll=a,p.removeAll=u,t.exports=p},{"../utils/diacritics":137,"../utils/util":147,"../viewer/viewer":156}],92:[function(e,t,n){var i={"10.1007/s40891-017-0122-6":{matchBrokenDigits:!1}};t.exports=function(e){return i[e]||{}}},{}],93:[function(e,t,n){function i(e){var t=e.getId();x[t]=e,_.add(e),w.add(e),$(k).trigger("add",[e])}function r(e){return[e.startNode.textContent,e.startNodeIndex.toString(),e.endNode.textContent,e.endNodeIndex.toString()].join("-")}function o(e){return[e.startContainer.textContent,e.startOffset.toString(),e.endContainer.textContent,e.endOffset.toString()].join("-")}function s(e,t){var n=t.getRange(),i=[e,o(n)].join(":");C[i]||(C[i]=[]),C[i].push(n)}function a(e){var t=rangy.createRange();return t.setStart(e.startNode,e.startNodeIndex),t.setEnd(e.endNode,e.endNodeIndex),t}function c(e,t){return!!t.startContainer.isEqualNode(e.startNode)&&(!!t.endContainer.isEqualNode(e.endNode)&&t.equals(a(e)))}function l(e){return function(t){var n=[e,r(t)].join(":");if(!C[n])return!0;for(var i=0;i<C[n].length;i++)if(c(t,C[n][i]))return!1;return!0}}function u(e){var t=[];return"nature"==X&&t.push({provider:"Nature Research Journals",url:"https://www.nature.com/search?"+$.param({author_match:"all",author:e.standard_name})}),t.concat([{provider:"PubMed",url:"http://www.ncbi.nlm.nih.gov/pubmed/?"+$.param({term:e.standard_name+"[Author]"})},{provider:"Google Scholar",url:"http://scholar.google.com/scholar?"+$.param({as_q:"",as_sauthors:e.text})}])}function d(e,t){var n=j[e-1][t],r=v.getPageObj(e);"author"==n.type&&(n=g.merge(n,{search:u(n)})),"figure"==n.type?n.figures=$.map(n.ids,function(e){return E[e-1]}):n.references=$.map(n.ids,function(e){return S[e-1]});var o=y.deserialize(r,n,l(e),A);o&&(s(e,o),i(o))}function h(e,t){if(!T[e]&&t.hasText()&&j[e-1]){for(var n=g.timer.tic(),i=0;i<j[e-1].length;i++)d(e,i);g.log("citations("+e+") duration: "+g.timer.toc(n)+"ms"),T[e]=!0}}function f(e){E=e.figures,j=e.citations,S=e.references,X=e.publisher,A=b(e.doi),v.onInit(function(){v.eachPage(h)}),$(v).on("page-loaded.citations-model",function(e,t){h(t,v.getPageObj(t))})}function p(e){for(var t in x)if(!1===e(x[t]))break}function m(){return g.clone(x)}var g=e("../utils/util"),v=(e("../article"),e("../viewer/viewer")),_=e("../input_handler"),w=e("./citation_drawer"),b=e("./citation_rules"),y=e("./citation"),k={},x={},C={},A={},T={},E=null,j=null,S=null,X=null;k.init=f,k.forEach=p,k.getAll=m,t.exports=k},{"../article":88,"../input_handler":113,"../utils/util":147,"../viewer/viewer":156,"./citation":90,"./citation_drawer":91,"./citation_rules":92}],94:[function(e,t,n){var i=e("./environment"),r=e("./sync/faye_client"),o={};r.subscribe(sprintf("/%s/web_reader",i.get()),function(e){if(e&&e.command){var t=e.command.split(":");$(o).trigger(t[0],[t.pop()])}}),t.exports=o},{"./environment":98,"./sync/faye_client":120}],95:[function(e,t,n){function i(){return d.readcube("mobile_browser_supported")}function r(){return"WebkitAppearance"in document.documentElement.style}function o(){return"safari"==h.name&&"win"==h.os}function s(){return"safari"==h.name&&h.versionNumber<6}function a(){return"chrome"==h.name&&h.versionNumber<29}function c(){return"firefox"==h.name&&h.versionNumber<17}function l(){if(f.any&&!i())return d.log("browser is mobile"),{result:!1,message:"mobile_browser"};if(d.readcube("browser_bot"))return{result:!0,message:"bot"};for(var e=0;e<m.length;e++){var t=m[e];if("string"!=typeof t){for(var n=!1,l=0;l<t.length;l++)if(Modernizr[t[l]]){n=!0;break}if(!n)return d.log("browser does not support "+t.join(" or ")),{result:!1,message:"old_browser"}}else if(!Modernizr[t])return d.log("browser does not support "+t),
{result:!1,message:"old_browser"}}return r()||p()?c()||a()||s()||o()?(d.log("browser is outdated"),{result:!1,message:"old_browser"}):{result:!0,message:"ok"}:(d.log("browser does not support subpixel font rendering"),{result:!1,message:"font_fail"})}function u(){return u.retval?u.retval:u.retval=l()}var d=e("./utils/util"),h=e("./utils/browser"),f=e("./utils/mobile_detect"),p=e("./utils/subpixelfont_test"),m=(e("./environment"),[["flexbox","flexboxlegacy"],"fontface","backgroundsize","borderradius","boxshadow","opacity","rgba","textshadow","cssgradients","csstransforms","csstransitions","hashchange","history","video","postmessage","svg"]);t.exports=u},{"./environment":98,"./utils/browser":135,"./utils/mobile_detect":139,"./utils/subpixelfont_test":144,"./utils/util":147}],96:[function(e,t,n){function i(e){return{width:e[0].offsetWidth,height:e[0].offsetHeight}}function r(e){if(document.body.contains(e[0]))return i(e);e=e.clone(),k.append(e).appendTo(document.body);var t=i(e);return e.remove(),k.detach(),t}function o(e){function t(){v.removeClass("up down left right"),v.css({top:"",left:""}),y.css({top:"",left:""})}function n(){t(),v.addClass("up"),X=r(b),v.css({top:Y.top-R-I.height-X.height-h.top,left:P.x-N-I.width/2});var e=u.getBoundingRect(y);return Math.max(0,S.top-(e.top-d.top))}function i(){t(),v.addClass("down"),X=r(b),v.css({top:Y.bottom-R+X.height+h.bottom,left:P.x-N-I.width/2});var e=u.getBoundingRect(y);return Math.max(0,e.bottom+d.bottom-S.bottom)}function o(){t(),v.addClass("left"),X=r(b),v.css({top:P.y-R-I.height/2,left:Y.left-N-I.width-X.width-h.left});var e=u.getBoundingRect(y);return Math.max(0,S.left-(e.left-d.left))}function a(){t(),v.addClass("right"),X=r(b),v.css({top:P.y-R-I.height/2,left:Y.right-N+X.width+h.right});var e=u.getBoundingRect(y);return Math.max(0,e.right+d.right-S.right)}function l(e){var t=[],r=[n,i],o="up"==e?0:1;(t[o]=r[o]())&&(t[1-o]=r[1-o]())&&(t[o]<=t[1-o]?r[o]():r[1-o]())}function k(e){var t=[],n=[o,a],i="left"==e?0:1;(t[i]=n[i]())&&(t[1-i]=n[1-i]())&&(t[i]<=t[1-i]?n[i]():n[1-i]())}function x(e){var t=e.left>0,n=e.right>0;return n&&t?e.left>=e.right?"right":"left":n?"left":t?"right":null}function C(e){var t=e.top>0,n=e.bottom>0;return n&&t?e.top>=e.bottom?"bottom":"top":n?"top":t?"bottom":null}function A(){var e=u.getBoundingRect(y),t={left:S.left-e.left+d.left,right:e.right-S.right+d.right},n=x(t);"left"==n&&y.css("left",Math.max(-(I.width/2)+X.width,-t.right)),"right"==n&&y.css("left",Math.min(I.width/2-X.width,t.left))}function T(){var e=u.getBoundingRect(y),t={top:S.top-e.top+d.top,bottom:e.bottom-S.bottom+d.bottom},n=C(t);"top"==n&&y.css("top",Math.max(-(I.height/2)+X.height,-t.bottom)),"bottom"==n&&y.css("top",Math.min(I.height/2-X.height,t.top))}function E(){switch(t(),j=g.offset(),S=u.getBoundingRect(g),I=r(m),Y=u.getBoundingRect(p),P={x:(Y.left+Y.right)/2,y:(Y.top+Y.bottom)/2},R=j.top-g.scrollTop(),N=j.left-g.scrollLeft(),e.placement){case"up":case"down":l(e.placement),A();break;case"left":case"right":k(e.placement),T()}}c()&&s(),p=e.anchor,m=e.content,g=u.scrollParent(p);var j=null,S=null,X=null,I=null,Y=null,P=null,R=null,N=null;y.removeClass(),y.addClass("container"),e.klass&&y.addClass(e.klass),y.children().detach(),y.append(m),v.appendTo(g),v.css({visibility:"hidden",display:"block"}),E(),w=function(){c()&&E()},$(window).on("resize.popover",_.throttle(w,50)),$(document).one("mouseup.popover touchstart.popover",function(e){$.contains(p[0],e.target)||s()}),v.css("visibility","visible"),p.trigger("open.popover"),$(f).trigger("open-popover")}function s(e){return!!c(e)&&($(window).off(".popover"),$(document).off(".popover"),v.css({visibility:"hidden",display:"none"}),p.trigger("close.popover"),$(f).trigger("close-popover"),m=null,p=null,g=null,!0)}function a(){w()}function c(e){return!!p&&(!e||e.is(p))}function l(e){s(e.anchor)||o(e)}var u=e("../utils/util"),d={top:42,right:20,bottom:0,left:20},h={top:7,right:2,bottom:2,left:2},f={},p=null,m=null,g=null,v=$(['<div class="popover">','<div class="container"></div>','<div class="arrow"></div>',"</div>"].join("")),w=function(){};v.on("mousedown mouseup click touchstart touchend",function(e){e.stopImmediatePropagation()});var b=v.find(".arrow"),y=v.find(".container"),k=$("<div></div>").css({position:"absolute",visibility:"hidden"});f.open=o,f.close=s,f.update=a,f.toggle=l,f.isOpen=c,t.exports=f},{"../utils/util":147}],97:[function(e,t,n){var i=e("./environment"),r=e("./utils/util"),o="https:"==document.location.protocol?"https:":"http:",s=parseUri(location.href).queryKey.parent_url;s&&(s=decodeURIComponent(s));var a="reader.readcube.com/v3",c=r.merge({parent:s,dx_doi:"https://doi.org",ip_api:"http://ip-api.com/json",altmetric:"https://api.altmetric.com",authors_springernature:"http://authors.springernature.com",chrome_extension:"https://chrome.google.com/webstore/detail/readcube-web-importer/mfacblegickmnfpaebakfnlbfhpoegin",mobile_apps:{ios:"https://itunes.apple.com/us/app/readcube/id864042981?ls=1&amp;mt=8",android:"https://play.google.com/store/apps/details?id=com.readcube.mobile"},scripts:{easeljs:"https://code.createjs.com/easeljs-0.8.1.min.js",tweenjs:"https://code.createjs.com/tweenjs-0.6.1.min.js",movieclip:"https://code.createjs.com/movieclip-0.8.1.min.js",cpgadget:"https://www.google.com/cloudprint/client/cpgadget.js",videojs:"https://vjs.zencdn.net/6.6.3/video.min.js",pdfjs:"https://"+a+"/scripts/pdfjs/pdf.5cebebff.js",pdfjs_worker:"https://"+a+"/scripts/pdfjs/pdf.worker.e600fef8.js"},stylesheets:{videojs:"https://vjs.zencdn.net/6.6.3/video-js.min.css"},jsonp_access:{kluwer:"http://journals.lww.com/readcubeaccess.rpdf/access",asha:"http://pubs.asha.org/services/ResourceAccessCheck.svc/CheckAccess"}},{production:{reader:o+"//www.readcube.com/articles",web:"https://www.readcube.com",app:"https://app.readcube.com",sync:"https://sync.readcube.com",analytics:"https://analytics.readcube.com",services:"https://services.readcube.com",push:"https://push.readcube.com/bayeux",version:"https://s3.amazonaws.com/"+a+"/version.6b9a4c83.json"},staging:{reader:o+"//staging.readcube.com/articles",web:"https://staging.readcube.com",app:"https://app-staging.readcube.com",sync:"https://sync-staging.readcube.com",analytics:"https://analytics-staging.readcube.com",services:"https://services-staging.readcube.com",push:"https://push-staging.readcube.com/bayeux",version:"https://s3.amazonaws.com/"+a+"/version.6b9a4c83.json"},development:{scripts:{pdfjs:o+"//local.readcube.com:5000/scripts/pdfjs/pdf.js",pdfjs_worker:o+"//local.readcube.com:5000/scripts/pdfjs/pdf.worker.js"},reader:o+"//local.readcube.com:3000/articles",web:o+"//local.readcube.com:3000",app:o+"//local.readcube.com:4000",sync:o+"//local.readcube.com:3003",analytics:o+"//local.readcube.com:3004",services:o+"//local.readcube.com:3001",push:o+"//local.readcube.com:8000/bayeux",version:"/version.6b9a4c83.json"}}[i.get()]);window.endpoint=c,t.exports=c},{"./environment":98,"./utils/util":147}],98:[function(e,t,n){function i(e){return e.toLowerCase()==c}function r(){return c}function o(){return i("development")}function s(){return i("staging")}function a(){return i("production")}var c="production",l={};l.is=i,l.get=r,l.staging=s,l.production=a,l.development=o,t.exports=l},{}],99:[function(e,t,n){function i(e){return _.map(e||[],a.authorName).join(" and ")}function r(e){if(e)return e.replace("-","--")}function o(e,t){var n={author:i(e.authors),year:e.year,title:e.title,journal:e.journal,publisher:a.publisherName(e.publisher),issn:e.issn,doi:e.doi,volume:e.volume,month:e.month,pages:r(e.pagination),number:e.issue};return a.articleUrl()&&(n.url=a.articleUrl()),t&&(n.abstract=e.abstract),n}function s(e,t){var n=a.LINE_END,i=["@article{"+a.getKey(e)];return _.each(o(e,t),function(e,t){(e||0===e)&&i.push(sprintf("  %s = {%s}",t,e))}),i.join(","+n)+n+"}"+n}var a=e("./helper");t.exports=s},{"./helper":101}],100:[function(e,t,n){var i=e("./helper"),r=e("./bibtex"),o=e("./ris");t.exports={getKey:i.getKey,bib:r,ris:o}},{"./bibtex":99,"./helper":101,"./ris":102}],101:[function(e,t,n){function i(e){return{nature:"Nature Publishing Group",wiley:"Wiley Online Library"}[e]}function r(e){var t=e.name||e,n=t.split(" ");return 1==n.length?n[0]:n.pop()+", "+n.join(" ")}function o(){return a.get().meta.url?sprintf("http:%s/%s",c.dx_doi,a.get().doi):null}function s(e){try{return[e.authors[0].name.split(/[\s]+/).pop(),e.year,e.title.split(/[,\.\s]+/)[0]].join("").toLowerCase()}catch(e){return a.get().doi.replace(/[\W]+/g,"")}}var a=e("../article"),c=e("../endpoint"),l=e("../utils/browser"),u="win"==l.platform?"\r\n":"\n";t.exports={LINE_END:u,publisherName:i,authorName:r,articleUrl:o,getKey:s}},{"../article":88,"../endpoint":97,"../utils/browser":135}],102:[function(e,t,n){function i(e,t){if(t||0===t)return sprintf("%s  - %s",e,t)}function r(e,t){if(e)return e.split("-")[t]}function o(e,t){var n=[i("TY","JOUR")];return n.push(i("T1",e.title)),_.each(e.authors,function(e){n.push(i("AU",s.authorName(e)))}),n.push(i("DO",e.doi)),n.push(i("JO",e.journal)),n.push(i("VL",e.volume)),n.push(i("IS",e.issue)),n.push(i("SP",r(e.pagination,0))),n.push(i("EP",r(e.pagination,1))),n.push(i("SN",e.issn)),s.articleUrl()&&n.push(i("UR",s.articleUrl())),n.push(i("Y1",e.year)),n.push(i("PB",s.publisherName(e.publisher))),t&&n.push(i("AB",e.abstract)),n.push("ER  - "+s.LINE_END),_.compact(n).join(s.LINE_END)}var s=e("./helper");t.exports=o},{"./helper":101}],103:[function(e,t,n){var i=e("../environment"),r="UA-19582843-2",o="4587af51bbb542afbbc9d93bf9567159",s="190e62ffe743e9fc44da8419f01ade8f",a="H9jSrH2fJST0D33BtNfyOA",c={production:"c940ea0703828ead4745629146c021da",staging:"bf6138a7d35159129ccf0117fef1ce95",development:"bf6138a7d35159129ccf0117fef1ce95"}[i.get()];t.exports={ga:r,trackjs:o,altmetric:s,uservoice:a,mixpanel:c}},{"../environment":98}],104:[function(e,t,n){var i=["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"].join(" ");t.exports={transition_end:i}},{}],105:[function(e,t,n){!function(e,t,n,i,r,o,s){e.GoogleAnalyticsObject=r,e[r]=e[r]||function(){(e[r].q=e[r].q||[]).push(arguments)},e[r].l=1*new Date,o=t.createElement(n),s=t.getElementsByTagName(n)[0],o.async=1,o.src=i,s.parentNode.insertBefore(o,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga")},{}],106:[function(e,t,n){var i=i||{};i.cmd=i.cmd||[],function(){var e=document.createElement("script");e.async=!0,e.type="text/javascript";var t="https:"==document.location.protocol;e.src=(t?"https:":"http:")+"//www.googletagservices.com/tag/js/gpt.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)}(),t.exports=i},{}],107:[function(e,t,n){function i(){if("undefined"==typeof ga)return e("./ga"),o.signedIn()?(ga("create",r.ga,{userId:o.get().id}),ga("set","dimension1",o.get().id)):(ga("create",r.ga,"auto"),ga("set","dimension1","Anonymous")),ga}var r=e("./api_keys"),o=e("../user");t.exports=i},{"../user":132,"./api_keys":103,"./ga":105}],108:[function(e,t,n){function i(){if("undefined"==typeof mixpanel)return e("./mixpanel"),mixpanel.init(r.mixpanel,{track_pageview:!1}),s.signedIn()?mixpanel.identify(s.get().id):mixpanel.identify(o.get()),mixpanel}var r=e("./api_keys"),o=e("../tracking/track_id"),s=e("../user");t.exports=i},{"../tracking/track_id":129,"../user":132,"./api_keys":103,"./mixpanel":110}],109:[function(e,t,n){function i(){return new Promise(function(e){function t(){PDFJS.workerSrc=o.scripts.pdfjs_worker,PDFJS.cMapUrl="https://cdn.jsdelivr.net/npm/pdfjs-dist@"+PDFJS.version+"/cmaps/",PDFJS.cMapPacked=!0,e(PDFJS)}window.PDFJS?t():r.loadScript(o.scripts.pdfjs,t)})}var r=e("../utils/util"),o=e("../endpoint");t.exports=i},{"../endpoint":97,"../utils/util":147}],110:[function(e,t,n){!function(e,t){if(!t.__SV){var n,i,r,o;window.mixpanel=t,t._i=[],t.init=function(e,n,i){function s(e,t){var n=t.split(".");2==n.length&&(e=e[n[0]],t=n[1]),e[t]=function(){e.push([t].concat(Array.prototype.slice.call(arguments,0)))}}var a=t;for("undefined"!=typeof i?a=t[i]=[]:i="mixpanel",a.people=a.people||[],a.toString=function(e){var t="mixpanel";return"mixpanel"!==i&&(t+="."+i),e||(t+=" (stub)"),t},a.people.toString=function(){return a.toString(1)+".people (stub)"},r="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" "),o=0;o<r.length;o++)s(a,r[o]);t._i.push([e,n,i])},t.__SV=1.2,n=e.createElement("script"),n.type="text/javascript",n.async=!0,n.src="undefined"!=typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js",i=e.getElementsByTagName("script")[0],i.parentNode.insertBefore(n,i)}}(document,window.mixpanel||[])},{}],111:[function(e,t,n){var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e("./trackjs_prelude"),function(e,t,n){"use awesome";if(e.trackJs)e.console&&e.console.warn&&e.console.warn("TrackJS global conflict");else{var r=function(e,t,n,i,r){this.util=e,this.onError=t,this.onFault=n,this.options=r,r.enabled&&this.initialize(i)};r.prototype={initialize:function(e){e.addEventListener&&(this.wrapAndCatch(e.Element.prototype,"addEventListener",1),this.wrapAndCatch(e.XMLHttpRequest.prototype,"addEventListener",1),this.wrapRemoveEventListener(e.Element.prototype),this.wrapRemoveEventListener(e.XMLHttpRequest.prototype)),this.wrapAndCatch(e,"setTimeout",0),this.wrapAndCatch(e,"setInterval",0)},wrapAndCatch:function(e,t,n){var i=this,r=e[t];i.util.hasFunction(r,"apply")&&(e[t]=function(){try{var s,a,c=Array.prototype.slice.call(arguments),l=c[n];if(i.options.bindStack)try{throw Error()}catch(e){a=e.stack,s=i.util.isoNow()}if("addEventListener"===t&&(this._trackJsEvt||(this._trackJsEvt=new o),this._trackJsEvt.getWrapped(c[0],l,c[2])))return;return l&&i.util.hasFunction(l,"apply")&&(c[n]=function(){try{return l.apply(this,arguments)}catch(e){throw i.onError("catch",e,{bindTime:s,bindStack:a}),i.util.wrapError(e)}},"addEventListener"===t&&this._trackJsEvt.add(c[0],l,c[2],c[n])),r.apply(this,c)}catch(n){e[t]=r,i.onFault(n)}})},wrapRemoveEventListener:function(e){if(e&&e.removeEventListener&&this.util.hasFunction(e.removeEventListener,"call")){var t=e.removeEventListener;e.removeEventListener=function(e,n,i){if(this._trackJsEvt){var r=this._trackJsEvt.getWrapped(e,n,i);return r&&this._trackJsEvt.remove(e,n,i),t.call(this,e,r,i)}return t.call(this,e,n,i)}}}};var o=function(){this.events=[]};o.prototype={add:function(e,t,n,i){-1>=this.indexOf(e,t,n)&&this.events.push([e,t,!!n,i])},remove:function(e,t,n){e=this.indexOf(e,t,!!n),0<=e&&this.events.splice(e,1)},getWrapped:function(e,t,i){return e=this.indexOf(e,t,!!i),0<=e?this.events[e][3]:n},indexOf:function(e,t,n){for(var i=0;i<this.events.length;i++)if(this.events[i][0]===e&&this.events[i][1]===t&&this.events[i][2]===!!n)return i;return-1}};var s=function(e,t){this.util=e,this.initCurrent(t)};s.prototype={current:{},initOnly:{application:"",enabled:!0,token:!0,callback:{enabled:!0},console:{enabled:!0},network:{enabled:!0},visitor:{enabled:!0},window:{enabled:!0}},defaults:{application:"",enabled:!0,onError:function(){return!0},serialize:function(e){return e===n?"undefined":null===e?"null":"number"==typeof e&&isNaN(e)?"NaN":""===e?"Empty String":0===e?"0":!1===e?"false":e&&e.toString?e.toString():"unknown"},sessionId:"",token:"",userId:"",version:"",callback:{enabled:!0,bindStack:!1},console:{enabled:!0,display:!0,error:!0,watch:["log","debug","info","warn","error"]},network:{enabled:!0,error:!0},visitor:{enabled:!0},window:{enabled:!0}},initCurrent:function(e){return this.validate(e,this.defaults,"config",{})?(this.current=this.util.extend(this.current,this.defaults,e),!0):(this.current=this.util.extend(this.current,this.defaults),!1)},setCurrent:function(e){return!!this.validate(e,this.defaults,"config",this.initOnly)&&(this.current=this.util.extend(this.current,e),!0)},validate:function(e,t,n,r){var o=!0;n=n||"",r=r||{};for(var s in e)if(e.hasOwnProperty(s))if(t.hasOwnProperty(s)){var a=i(t[s]);a!==i(e[s])?(console.warn(n+"."+s+": property must be type "+a+"."),o=!1):"[object Array]"!==Object.prototype.toString.call(e[s])||this.validateArray(e[s],t[s],n+"."+s)?"[object Object]"===Object.prototype.toString.call(e[s])?o=this.validate(e[s],t[s],n+"."+s,r[s]):r.hasOwnProperty(s)&&(console.warn(n+"."+s+": property cannot be set after load."),o=!1):o=!1}else console.warn(n+"."+s+": property not supported."),o=!1;return o},validateArray:function(e,t,n){var i=!0;n=n||"";for(var r=0;r<e.length;r++)this.util.contains(t,e[r])||(console.warn(n+"["+r+"]: invalid value: "+e[r]+"."),i=!1);return i}};var a=function(e,t,n,i,r,o,s){this.util=e,this.log=t,this.onError=n,this.onFault=i,this.serialize=r,s.enabled&&(o.console=this.wrapConsoleObject(o.console,s))};a.prototype={wrapConsoleObject:function(e,t){e=e||{};var n,i=e.log||function(){},r=this;for(n=0;n<t.watch.length;n++)!function(n){var o=e[n]||i;e[n]=function(){try{var e=Array.prototype.slice.call(arguments);if(r.log.add("c",{timestamp:r.util.isoNow(),severity:n,message:r.serialize(e)}),t.error&&"error"===n)try{throw Error(r.serialize(e))}catch(e){r.onError("console",e)}t.display&&(r.util.hasFunction(o,"apply")?o.apply(this,e):o(e[0],e[1],e[2]))}catch(e){r.onFault(e)}}}(t.watch[n]);return e},report:function(){return this.log.all("c")}};var c=function(e,t,n,i,r){this.config=e,this.util=t,this.log=n,this.window=i,this.document=r,this.correlationId=this.token=null,this.initialize()};c.prototype={initialize:function(){this.token=this.getCustomerToken(),this.correlationId=this.getCorrelationId()},getCustomerToken:function(){if(this.config.current.token)return this.config.current.token;var e=this.document.getElementsByTagName("script");return e[e.length-1].getAttribute("data-token")},getCorrelationId:function(){var e;try{e=this.document.cookie.replace(/(?:(?:^|.*;\s*)TrackJS\s*\=\s*([^;]*).*$)|^.*$/,"$1"),e||(e=this.util.uuid(),this.document.cookie="TrackJS="+e+"; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/")}catch(t){e=this.util.uuid()}return e},report:function(){return{application:this.config.current.application,correlationId:this.correlationId,sessionId:this.config.current.sessionId,token:this.token,userId:this.config.current.userId,version:this.config.current.version}}};var l=function(e){this.loadedOn=(new Date).getTime(),this.window=e};l.prototype={discoverDependencies:function(){var e,t={};this.window.jQuery&&this.window.jQuery.fn&&this.window.jQuery.fn.jquery&&(t.jQuery=this.window.jQuery.fn.jquery),this.window.jQuery&&this.window.jQuery.ui&&this.window.jQuery.ui.version&&(t.jQueryUI=this.window.jQuery.ui.version),this.window.angular&&this.window.angular.version&&this.window.angular.version.full&&(t.angular=this.window.angular.version.full);for(e in this.window)if("_trackJs"!==e&&"_trackJS"!==e&&"_trackjs"!==e&&"webkitStorageInfo"!==e&&"webkitIndexedDB"!==e&&"top"!==e&&"parent"!==e&&"frameElement"!==e)try{if(this.window[e]){var n=this.window[e].version||this.window[e].Version||this.window[e].VERSION;"string"==typeof n&&(t[e]=n)}}catch(e){}return t},report:function(){return{age:(new Date).getTime()-this.loadedOn,dependencies:this.discoverDependencies(),userAgent:this.window.navigator.userAgent,viewportHeight:this.window.document.documentElement.clientHeight,viewportWidth:this.window.document.documentElement.clientWidth}}};var u=function(e){this.util=e,this.appender=[],this.maxLength=30};u.prototype={all:function(e){var t,n,i=[];for(n=0;n<this.appender.length;n++)(t=this.appender[n])&&t.category===e&&i.push(t.value);return i},clear:function(){this.appender.length=0},truncate:function(){this.appender.length>this.maxLength&&(this.appender=this.appender.slice(Math.max(this.appender.length-this.maxLength,0)))},add:function(e,t){var n=this.util.uuid();return this.appender.push({key:n,category:e,value:t}),this.truncate(),n},get:function(e,t){var n,i;for(i=0;i<this.appender.length;i++)if(n=this.appender[i],n.category===e&&n.key===t)return n.value;return!1}};var d=function(e,t,n,i,r,o){this.util=e,this.log=t,this.onError=n,this.onFault=i,this.window=r,this.options=o,o.enabled&&this.initialize(r)};d.prototype={initialize:function(e){e.XMLHttpRequest&&this.util.hasFunction(e.XMLHttpRequest.prototype.open,"apply")&&this.watchNetworkObject(e.XMLHttpRequest),e.XDomainRequest&&this.util.hasFunction(e.XDomainRequest.prototype.open,"apply")&&this.watchNetworkObject(e.XDomainRequest)},watchNetworkObject:function(e){var t=this,n=e.prototype.open,i=e.prototype.send;return e.prototype.open=function(e,t){return 0>t.indexOf("localhost:0")&&(this._trackJs={method:e,url:t}),n.apply(this,arguments)},e.prototype.send=function(){try{if(!this._trackJs)return i.apply(this,arguments);this._trackJs.logId=t.log.add("n",{startedOn:t.util.isoNow(),method:this._trackJs.method,url:this._trackJs.url}),t.listenForNetworkComplete(this)}catch(e){t.onFault(e)}return i.apply(this,arguments)},e},listenForNetworkComplete:function(e){var t=this;t.window.ProgressEvent&&e.addEventListener&&e.addEventListener("readystatechange",function(){4===e.readyState&&t.finalizeNetworkEvent(e)},!0),e.addEventListener?e.addEventListener("load",function(){t.finalizeNetworkEvent(e),t.checkNetworkFault(e)},!0):setTimeout(function(){try{var n=e.onload;e.onload=function(){t.finalizeNetworkEvent(e),t.checkNetworkFault(e),"function"==typeof n&&t.util.hasFunction(n,"apply")&&n.apply(e,arguments)};var i=e.onerror;e.onerror=function(){t.finalizeNetworkEvent(e),t.checkNetworkFault(e),"function"==typeof oldOnError&&i.apply(e,arguments)}}catch(e){t.onFault(e)}},0)},finalizeNetworkEvent:function(e){if(e._trackJs){var t=this.log.get("n",e._trackJs.logId);t&&(t.completedOn=this.util.isoNow(),t.statusCode=1223==e.status?204:e.status,t.statusText=1223==e.status?"No Content":e.statusText)}},checkNetworkFault:function(e){if(this.options.error&&400<=e.status&&1223!=e.status){var t=e._trackJs||{};this.onError("ajax",e.status+" "+e.statusText+": "+t.method+" "+t.url)}},report:function(){return this.log.all("n")}};var h=function(t){this.util=t,this.disabled=!1,this.throttleStats={attemptCount:0,throttledCount:0,lastAttempt:(new Date).getTime()},e.JSON&&e.JSON.stringify||(this.disabled=!0)};h.prototype={errorEndpoint:function(t){var n="https://capture.trackjs.com/capture";return this.util.testCrossdomainXhr()||-1!==e.location.protocol.indexOf("https")||(n="http://capture.trackjs.com/capture"),n+"?token="+t},usageEndpoint:function(e){return this.appendObjectAsQuery(e,"https://usage.trackjs.com/usage.gif")},trackerFaultEndpoint:function(e){return this.appendObjectAsQuery(e,"https://usage.trackjs.com/fault.gif")},appendObjectAsQuery:function(e,t){t+="?";for(var n in e)e.hasOwnProperty(n)&&(t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n])+"&");return t},getCORSRequest:function(t,n){var i;return this.util.testCrossdomainXhr()?(i=new e.XMLHttpRequest,i.open(t,n),i.setRequestHeader("Content-Type","text/plain")):"undefined"!=typeof e.XDomainRequest?(i=new e.XDomainRequest,i.open(t,n)):i=null,i},sendTrackerFault:function(e){this.throttle(e)||((new Image).src=this.trackerFaultEndpoint(e))},sendUsage:function(e){(new Image).src=this.usageEndpoint(e)},sendError:function(t,i){var r=this;if(!this.disabled&&!this.throttle(t))try{var o=this.getCORSRequest("POST",this.errorEndpoint(i));o.onreadystatechange=function(){4===o.readyState&&200!==o.status&&(r.disabled=!0)},o._trackJs=n,o.send(e.JSON.stringify(t))}catch(e){throw this.disabled=!0,e}},throttle:function(e){var t=(new Date).getTime();if(this.throttleStats.attemptCount++,this.throttleStats.lastAttempt+1e3>=t){if(this.throttleStats.lastAttempt=t,10<this.throttleStats.attemptCount)return this.throttleStats.throttledCount++,!0}else e.throttled=this.throttleStats.throttledCount,this.throttleStats.attemptCount=0,this.throttleStats.lastAttempt=t,this.throttleStats.throttledCount=0;return!1}};var f=function(e){this.window=e};f.prototype={bind:function(e,t){return function(){return e.apply(t,Array.prototype.slice.call(arguments))}},contains:function(e,t){var n;for(n=0;n<e.length;n++)if(e[n]===t)return!0;return!1},defer:function(e,t){setTimeout(function(){e.apply(t)})},extend:function(e){for(var t,i=Array.prototype.slice.call(arguments,1),r=0;r<i.length;r++)for(t in i[r])null===i[r][t]||i[r][t]===n?e[t]=i[r][t]:"[object Object]"===Object.prototype.toString.call(i[r][t])?(e[t]=e[t]||{},this.extend(e[t],i[r][t])):e[t]=i[r][t];return e},hasFunction:function(e,t){try{return!!e[t]}catch(e){return!1}},isBrowserIE:function(){var e=this.window.navigator.userAgent,t=e.match(/Trident\/([\d.]+)/);return t&&"7.0"===t[1]?11:!!(e=e.match(/MSIE ([\d.]+)/))&&parseInt(e[1],10)},isBrowserSupported:function(){var e=this.isBrowserIE();return!e||8<=e},isoNow:function(){var e=new Date;return e.toISOString?e.toISOString():e.getUTCFullYear()+"-"+this.pad(e.getUTCMonth()+1)+"-"+this.pad(e.getUTCDate())+"T"+this.pad(e.getUTCHours())+":"+this.pad(e.getUTCMinutes())+":"+this.pad(e.getUTCSeconds())+"."+String((e.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"},pad:function(e){return e=String(e),1===e.length&&(e="0"+e),e},testCrossdomainXhr:function(){return"withCredentials"in new XMLHttpRequest},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},wrapError:function(e){if(e.innerError)return e;var t=Error("TrackJS Caught: "+(e.message||e));return t.description="TrackJS Caught: "+e.description,t.file=e.file,t.line=e.line||e.lineNumber,t.column=e.column||e.columnNumber,t.stack=e.stack,t.innerError=e,t}};var p=function(e,t,n,i,r,o){this.util=e,this.log=t,this.onError=n,this.onFault=i,this.options=o,this.document=r,o.enabled&&this.initialize(r)};p.prototype={initialize:function(e){var t=this.util.bind(this.onDocumentClicked,this),n=this.util.bind(this.onInputChanged,this);e.addEventListener?(e.addEventListener("click",t,!0),e.addEventListener("blur",n,!0)):e.attachEvent&&(e.attachEvent("onclick",t),e.attachEvent("onfocusout",n))},onDocumentClicked:function(e){try{var t=this.getElementFromEvent(e);t&&t.tagName&&(this.isDescribedElement(t,"a")||this.isDescribedElement(t,"button")||this.isDescribedElement(t,"input",["button","submit"])?this.writeVisitorEvent(t,"click"):this.isDescribedElement(t,"input",["checkbox","radio"])&&this.writeVisitorEvent(t,"input",t.value,t.checked))}catch(e){this.onFault(e)}},onInputChanged:function(e){try{var t=this.getElementFromEvent(e);t&&t.tagName&&(this.isDescribedElement(t,"textarea")?this.writeVisitorEvent(t,"input",t.value):this.isDescribedElement(t,"select")&&t.options&&t.options.length?this.onSelectInputChanged(t):this.isDescribedElement(t,"input")&&!this.isDescribedElement(t,"input",["button","submit","hidden","checkbox","radio"])&&this.writeVisitorEvent(t,"input",t.value))}catch(e){this.onFault(e)}},onSelectInputChanged:function(e){if(e.multiple)for(var t=0;t<e.options.length;t++)e.options[t].selected&&this.writeVisitorEvent(e,"input",e.options[t].value);else 0<=e.selectedIndex&&e.options[e.selectedIndex]&&this.writeVisitorEvent(e,"input",e.options[e.selectedIndex].value)},writeVisitorEvent:function(e,t,i,r){"password"===this.getElementType(e)&&(i=n),this.log.add("v",{timestamp:this.util.isoNow(),action:t,element:{tag:e.tagName.toLowerCase(),attributes:this.getElementAttributes(e),value:this.getMetaValue(i,r)}})},getElementFromEvent:function(e){return e.target||t.elementFromPoint(e.clientX,e.clientY)},isDescribedElement:function(e,t,n){if(e.tagName.toLowerCase()!==t.toLowerCase())return!1;if(!n)return!0;for(e=this.getElementType(e),t=0;t<n.length;t++)if(n[t]===e)return!0;return!1},getElementType:function(e){return(e.getAttribute("type")||"").toLowerCase()},getElementAttributes:function(e){for(var t={},n=0;n<e.attributes.length;n++)"value"!==e.attributes[n].name.toLowerCase()&&(t[e.attributes[n].name]=e.attributes[n].value);return t},getMetaValue:function(e,t){return e===n?n:{length:e.length,pattern:this.matchInputPattern(e),checked:t}},matchInputPattern:function(e){return""===e?"empty":/^[a-z0-9!#$%&'*+=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/.test(e)?"email":/^(0?[1-9]|[12][0-9]|3[01])[\/\-](0?[1-9]|1[012])[\/\-]\d{4}$/.test(e)||/^(\d{4}[\/\-](0?[1-9]|1[012])[\/\-]0?[1-9]|[12][0-9]|3[01])$/.test(e)?"date":/^(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:\(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*\)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})(?:\s*(?:#|x\.?|ext\.?|extension)\s*(\d+))?$/.test(e)?"usphone":/^\s*$/.test(e)?"whitespace":/^\d*$/.test(e)?"numeric":/^[a-zA-Z]*$/.test(e)?"alpha":/^[a-zA-Z0-9]*$/.test(e)?"alphanumeric":"characters"},report:function(){return this.log.all("v")}};var m=function(e,t,n,i,r){this.onError=e,this.onFault=t,this.serialize=n,r.enabled&&this.watchWindowErrors(i)};m.prototype={watchWindowErrors:function(e){var t=this;e.onerror=function(e,n,i,r,o){try{o=o||{},o.message=o.message||t.serialize(e),o.file=o.file||t.serialize(n),o.line=o.line||parseInt(i,10)||null,o.column=o.column||parseInt(r,10)||null,t.onError("window",o)}catch(e){t.onFault(e)}}}};var g=function(e,t,n,i,r,o,s,a,c,l,u,d,h,f,p,m){try{if(this.window=p,this.document=m,this.util=new u(this.window),this.onError=this.util.bind(this.onError,this),this.onFault=this.util.bind(this.onFault,this),this.serialize=this.util.bind(this.serialize,this),this.transmitter=new l(this.util),this.config=new i(this.util,e),this.log=new a(this.util),this.api=new t(this.config,this.util,this.onError,this.serialize),this.environment=new s(this.window),this.customer=new o(this.config,this.util,this.log,this.window,this.document),this.customer.token&&(this.apiConsoleWatcher=new r(this.util,this.log,this.onError,this.onFault,this.serialize,this.api,this.config.defaults.console),this.config.current.enabled&&(this.windowConsoleWatcher=new r(this.util,this.log,this.onError,this.onFault,this.serialize,this.window,this.config.current.console),this.util.isBrowserSupported()))){this.callbackWatcher=new n(this.util,this.onError,this.onFault,this.window,this.config.current.callback),this.visitorWatcher=new d(this.util,this.log,this.onError,this.onFault,this.document,this.config.current.visitor),this.networkWatcher=new c(this.util,this.log,this.onError,this.onFault,this.window,this.config.current.network),this.windowWatcher=new h(this.onError,this.onFault,this.serialize,this.window,this.config.current.window);var g=this;setTimeout(function(){g.transmitter.sendUsage({token:g.customer.token,correlationId:g.customer.correlationId,application:g.config.current.application,x:g.util.uuid()})},1e3)}}catch(e){this.onFault(e)}};g.prototype={reveal:function(){return this.customer.token?this.api:(this.window.console&&this.window.console.warn&&this.window.console.warn("TrackJS could not find a token"),n)},onError:function(){var t=!1;return function(n,i,r){if(this.util.isBrowserSupported()&&this.config.current.enabled)try{i=i||{},r=r||{bindStack:null,bindTime:null,force:!1};var o=i.message||this.serialize(i,r.force);if(o&&o.indexOf){if(-1!==o.indexOf("TrackJS Caught"))return;if(t&&-1!==o.indexOf("Script error"))return void(t=!1)}var s=this.util.extend({},{bindStack:r.bindStack,bindTime:r.bindTime,column:i.column||i.columnNumber,console:this.windowConsoleWatcher.report(),customer:this.customer.report(),entry:n,environment:this.environment.report(),file:i.file||i.fileName,line:i.line||i.lineNumber,message:o,network:this.networkWatcher.report(),url:(e.location||"").toString(),stack:i.stack,
timestamp:this.util.isoNow(),visitor:this.visitorWatcher.report(),version:"2.1.14"});if(!r.force)try{if(!this.config.current.onError(s,i))return}catch(e){s.console.push({timestamp:this.util.isoNow(),severity:"error",message:e.message});var a=this;setTimeout(function(){a.onError("catch",e,{force:!0})},0)}this.log.clear(),setTimeout(function(){t=!1}),t=!0,this.transmitter.sendError(s,this.customer.token)}catch(e){console.log(e),this.onFault(e)}}}(),onFault:function(e){var t=this.transmitter||new h;e=e||{},e={token:this.customer.token,file:e.file||e.fileName,msg:e.message||"unknown",stack:(e.stack||"unknown").substr(0,500),url:this.window.location,v:"2.1.14",x:this.util.uuid()},t.sendTrackerFault(e)},serialize:function(e,t){if(this.config.current.serialize&&!t)try{return this.config.current.serialize(e)}catch(e){this.onError("catch",e,{force:!0})}return this.config.defaults.serialize(e)}},r=new g(e._trackJs||e._trackJS||e._trackjs||{},function(e,t,n,i){return{attempt:function(e,i){try{var r=Array.prototype.slice.call(arguments,2);return e.apply(i||this,r)}catch(e){throw n("catch",e),t.wrapError(e)}},configure:function(t){return e.setCurrent(t)},track:function(e){if(e=e||{},!e.stack)try{throw Error(i(e))}catch(t){e=t}n("direct",e)},watch:function(e,i){return function(){try{var r=Array.prototype.slice.call(arguments,0);return e.apply(i||this,r)}catch(e){throw n("catch",e),t.wrapError(e)}}},watchAll:function(e){var i,r=Array.prototype.slice.call(arguments,1);for(i in e)"function"==typeof e[i]&&(t.contains(r,i)||function(){var r=e[i];e[i]=function(){try{var e=Array.prototype.slice.call(arguments,0);return r.apply(this,e)}catch(e){throw n("catch",e),t.wrapError(e)}}}());return e},version:"2.1.14"}},r,s,a,c,l,u,d,h,f,p,m,o,e,t),e.trackJs=r.reveal()}}(window,document)},{"./trackjs_prelude":112}],112:[function(e,t,n){function i(e){try{return"string"==typeof e?e:JSON.stringify(e)}catch(e){}}function r(e){for(var t=[],n=0;n<e.length;n++)t.push(i(e[n]));return t.join(" ")}function o(){return{production:"readcube-reader",staging:"readcube-reader-staging"}[s.get()]||""}var s=e("../environment"),a=e("./api_keys");window._trackJs={enabled:!!o(),application:o(),token:a.trackjs,serialize:function(e){return Array.isArray(e)?r(e):i(e)},onError:function(e){return!/401 Unauthorized: GET/.test(e.message)&&(!/^Script error(\.)?$/.test(e.message)&&(!/\/\/api\.altmetric\.com\/v1\/doi/.test(e.message)&&(!/file:\/\/(\/)?/.test(e.url)&&!/404 Not Found: GET https:\/\/sync\.readcube\.com/.test(e.message))))}}},{"../environment":98,"./api_keys":103}],113:[function(e,t,n){function i(e){var t=e.attr("class");return t?(t=$.grep(t.split(" "),function(e){return!!g[e]}).sort(function(e,t){return g[e]-g[t]}),t[0]):null}function r(e,t){t.getElems().on(e+"."+t.getId(),function(t){var n=$(t.target),r=i(n);if(r){var o=n.data(r+v).split(" ").pop();return $(m[o]).trigger(jQuery.Event(e,{originalEvent:t})),!1}})}function o(e,t){t.getElems().off(e+"."+t.getId())}function s(e){for(var t=0;t<p.length;t++)r(p[t],e)}function a(e){for(var t=0;t<p.length;t++)o(p[t],e)}function c(e){var t=e.getId(),n=e.getKlass()+v;e.getElems().each(function(){var e=$(this),i=e.data(n),r=i?[i,t].join(" "):t;e.data(n,r)})}function l(e){var t=e.getId(),n=e.getKlass()+v;e.getElems().each(function(){var e=$(this),i=e.data(n);if(i){var r=$.grep(i.split(" "),function(e){return e!=t});e.data(n,r.join(" "))}})}function u(e){m[e.getId()]=e,c(e),s(e)}function d(e){a(e),l(e),delete m[e.getId()]}function h(){_.each(_.keys(m),function(e){d(m[e])})}var f={},p=["mouseenter","mouseleave","click"],m={},g={termite:100,annotation:200,"current-selection":300,"enhanced-reference":400,"enhanced-author":500,"enhanced-figure":600},v="-input-id";f.add=u,f.remove=d,f.removeAll=h,t.exports=f},{}],114:[function(e,t,n){function i(e){return void 0!==r.find(s,function(t){return t.test(e)})}var r=e("underscore"),o=e("./utils/util"),s=r.map([],function(e){return new RegExp("^"+o.regexEscape(e))});t.exports=i},{"./utils/util":147,underscore:44}],115:[function(e,t,n){function i(e){return _.findKey(u,function(t){return t.test(e)})}function r(e,t){var n=JSON.parse(c.session.get(l)||"{}");n[e]=t,c.session.set(l,JSON.stringify(n))}function o(e){var t=JSON.parse(c.session.get(l));return t&&t[e]}function s(e){return e==i(a.referrerHost())&&r(e,a.referrerHost()),o(e)}var a=e("./utils/util"),c=e("./utils/storage"),l="readcube-proxy-referrer",u={nature:/nature\.com/,palgrave:/palgraveconnect\.com/,wiley:/onlinelibrary\.wiley\.com/,karger:/karger\.(com|de)/};t.exports=s},{"./utils/storage":143,"./utils/util":147}],116:[function(e,t,n){function i(e){return!!/readcube\.com(:\d+)?$/.test(e||"")}function r(){$(window).on("message",function(e){for(;e.originalEvent;)e=e.originalEvent;e.data&&e.data.type&&(i(e.origin)&&$(o.readcube).trigger(e.data.type,[e.data]),$(o.all).trigger(e.data.type,[e.data]))}),window.popupMessage=function(e){$(o.all).trigger(e.type,[e])}}var o=(e("./utils/util"),{all:{},readcube:{}});r(),t.exports=o},{"./utils/util":147}],117:[function(e,t,n){function i(){/10\.5966\/sctm\./gi.test(u.get().doi)&&d.onInit(function(){d.eachPage(function(e,t){1==e&&t.onLoaded(function(){t.hasText()&&t.getElem().find(".pc .t.ff1").first().hide()})})})}function r(){/10\.1002\/(?:cctc|cbic|cmdc|cssc|cphc|cplu|celc|chem|adsc|asia|ange|anie|open|ajoc)\./gi.test(u.get().doi)&&d.onInit(function(){d.eachPage(function(e,t){t.onLoaded(function(){t.hasText()&&t.getElem().find('*:contains("ACHTUNGTRENNUNG")').contents().each(function(e,t){"ACHTUNGTRENNUNG"==t.textContent&&$(c.wrapTextNode(t)).hide()})})})})}function o(){"10.1577/T04-052.1"==u.get().doi&&d.onInit(function(){d.eachPage(function(e,t){t.onLoaded(function(){t.hasText()&&t.getElem().find('.t.ff1:contains("ARTMAN")').css("font-family","serif")})})})}function s(){"10.1002/adfm.201502338"==u.get().doi&&"chrome"==l.name&&d.onInit(function(){d.eachPage(function(e,t){10==e&&t.onLoaded(function(){t.getElem().find(".x84.y2ec").css("left",1282)})})})}function a(){u.onInit(function(){i(),r(),s(),o()})}var c=e("./utils/util"),l=e("./utils/browser"),u=e("./article"),d=e("./viewer/viewer");t.exports={init:a}},{"./article":88,"./utils/browser":135,"./utils/util":147,"./viewer/viewer":156}],118:[function(e,t,n){function i(e){return new Promise(function(t,n){$.ajax({url:e,dataType:"json",success:t,error:n})})}function r(e,t){return new Promise(function(n,i){$.ajax({url:e,type:"PUT",contentType:"application/json; charset=UTF-8",data:JSON.stringify(t),success:n,error:i})})}function o(){return new Promise(function(e,t){$.ajax({url:s.services+"/reader/annotations_bucket",success:e,error:t})})}var s=e("./endpoint"),a={};a.read=i,a.write=r,a.writableUrl=o,t.exports=a},{"./endpoint":97}],119:[function(e,t,n){function i(e){return c.addParams(l.services+"/reader/supplement",e)}function r(e){return new Promise(function(t,n){$.ajax(c.merge(f,{url:i(e),dataType:"json",success:function(e){!e.viewer_pdf&&e.url?n({error:"no_preview",url:e.url}):t(e)},error:function(e){n(e.responseJSON||e.responseText)}}))})}function o(){return c.clone(d)}function s(e){return h=e||{},r(h).then(function(e){return d=e})}function a(){return r(h).then(function(e){return d=e})}var c=e("./utils/util"),l=e("./endpoint"),u={},d={},h=null,f={crossDomain:!0,xhrFields:{withCredentials:!0}};u.init=s,u.update=a,u.get=o,window.supplement=u,t.exports=u},{"./endpoint":97,"./utils/util":147}],120:[function(e,t,n){function i(e){return e.data?e.data.sync_client_id:null}var r=e("faye"),o=(e("../utils/util"),e("../endpoint")),s=e("./primitives"),a=e("../tracking/track_error");o.push||a({error:"endpoint.push is undefined"});var c=new r.Client(o.push);c.addExtension({incoming:function(e,t){i(e)!=s.clientId&&t(e)},outgoing:function(e,t){t(e)}}),t.exports=c},{"../endpoint":97,"../tracking/track_error":128,"../utils/util":147,"./primitives":121,faye:4}],121:[function(e,t,n){function i(){return[k.sync,"items","add"].join("/")}function r(e){e=e||x.get().sync_item_id,e=e||encodeURIComponent(x.get().doi);var t=[k.sync];return x.get().sync_collection_id&&(t=t.concat(["collections",x.get().sync_collection_id])),t.concat(["items",e]).join("/")}function o(e){return[r(e),"view"].join("/")}function s(e,t){var n=[r(e),"annotations"].join("/");return t&&(n=[n,t].join("/")),n}function a(){return{"ext_ids[doi]":x.get().doi,article_access_token:x.get().access_token}}function c(e){return _.filter(e,function(e){return e.sha256==x.get().hash})}function l(e,t){return function(n){"ok"==n.status?e(n):t(n)}}function u(e,t){return function(n){404==n.status?e({status:"ok"}):t(n)}}function d(e){var t=r(e);return d[t]?d[t]:d[t]=new Promise(function(e,n){$.ajax(y.merge(E,{type:"GET",url:t,success:l(e,n),error:n,complete:function(){delete d[t]}}))})}function h(){return new Promise(function(e,t){$.ajax(y.merge(E,{type:"POST",url:i(),dataType:"json",data:a(),success:l(e,t),error:t}))})}function f(e,t){return new Promise(function(n,i){$.ajax(y.merge(E,{type:"PATCH",url:r(e),contentType:"application/json; charset=UTF-8",dataType:"json",data:JSON.stringify({item:t}),success:l(n,i),error:i}))})}function p(e){return new Promise(function(t,n){$.ajax(y.merge(E,{type:"DELETE",url:r(e),success:l(t,n),error:u(t,n)}))})}function m(e){return new Promise(function(e,t){$.ajax(y.merge(E,{type:"POST",url:o(),success:l(e,t),error:t}))})}function g(e){return new Promise(function(t,n){$.ajax(y.merge(E,{type:"GET",url:s(e),success:l(function(e){e.annotations=c(e.annotations),t(e)},n),error:n}))})}function v(e,t){return new Promise(function(n,i){$.ajax(y.merge(E,{type:"POST",url:s(e),contentType:"application/json; charset=UTF-8",dataType:"json",data:JSON.stringify({annotation:t}),success:l(n,i),error:i}))})}function w(e,t,n){return new Promise(function(i,r){$.ajax(y.merge(E,{type:"PATCH",url:s(e,t),contentType:"application/json; charset=UTF-8",dataType:"json",data:JSON.stringify({annotation:n}),success:l(i,r),error:r}))})}function b(e,t){return new Promise(function(n,i){$.ajax(y.merge(E,{type:"DELETE",url:s(e,t),success:l(n,i),error:u(n,i)}))})}var y=e("../utils/util"),k=e("../endpoint"),x=e("../article"),C={},A={},T=y.guid(),E={crossDomain:!0,xhrFields:{withCredentials:!0},headers:{"X-Readcube-Sync-Client":"Web Reader","X-Readcube-Sync-Client-Id":T}};C.get=d,C.add=h,C.update=f,C.remove=p,C.view=m,A.list=g,A.add=v,A.update=w,A.remove=b,t.exports={item:C,annots:A,clientId:T}},{"../article":88,"../endpoint":97,"../utils/util":147}],122:[function(e,t,n){function i(){return I}function r(){I=!0,$(Y.item).trigger("busy")}function o(){I=!1,$(Y.item).trigger("done")}function s(e){X=e.item,$(Y.item).trigger("added"),S(function(e){return E.item.view().catch(e)},{minTimeout:2e3})}function a(e){X=e.item,$(Y.item).trigger("changed")}function c(e){_.isEmpty(X)?s(e):_.isEqual(X,e.item)||a(e)}function l(){_.isEmpty(X)||(X={},$(Y.item).trigger("removed"))}function u(){return _.isEmpty(X)?null:X.id}function d(){return C.signedIn()?_.isEmpty(X)?E.item.get(u()):Promise.resolve({item:X}):Promise.reject({status:"signed_out"})}function h(){return i()?Promise.reject({status:"busy"}):(r(),E.item.add().then(function(e){c(e),o()},o))}function f(){return _.isEmpty(X)?Promise.resolve({status:"ok"}):i()?Promise.reject({status:"busy"}):(r(),E.item.remove(u()).then(function(){l(),o()},o))}function p(e){_.isEmpty(X)||e(X),$(Y.item).on("added",function(){e(X)})}function m(e){_.isEqual(X,{})&&e(),$(Y.item).on("removed",e)}function g(){return _.isEmpty(X)?Promise.reject({status:"item_not_synced"}):E.annots.list(u())}function v(e){return _.isEmpty(X)?Promise.reject({status:"item_not_synced"}):E.annots.add(u(),e)}function w(e,t){return _.isEmpty(X)?Promise.reject({status:"item_not_synced"}):E.annots.update(u(),e,t)}function b(e){return _.isEmpty(X)?Promise.reject({status:"item_not_synced"}):E.annots.remove(u(),e)}function y(e){C.signedIn()&&E.item.get(u()).then(c,function(e){404==e.status&&l()})}function k(){var e=A.get().sync_collection_id||C.get().id;return sprintf("/%s/collections/%s/items/*",T.get(),e)}function x(){A.onInit(function(e){e.discover||e.sync_item_sponsored||C.onSignIn(function(){j.subscribe(k(),y),E.item.get(u()).then(c).catch(_.noop)})})}var C=e("../user"),A=e("../article"),T=e("../environment"),E=e("./primitives"),j=e("./faye_client"),S=e("promise-retry"),X=null,I=!1,Y={item:{},annots:{}};x(),Y.item.id=u,Y.item.get=d,Y.item.add=h,Y.item.remove=f,Y.item.onAdd=p,Y.item.onRemove=m,Y.annots.list=g,Y.annots.add=v,Y.annots.update=w,Y.annots.remove=b,window.sync=Y,t.exports=Y},{"../article":88,"../environment":98,"../user":132,"./faye_client":120,"./primitives":121,"promise-retry":40}],123:[function(e,t,n){function i(e,t){var n=null,i={container:e.getElem()};return t.text?(t.preceeding_text||(t.preceeding_text=""),n||(n=o.deserialize({prefix:t.preceeding_text,text:t.text},i)),n||(n=o.deserialize({prefix:t.preceeding_text,text:t.text},r.merge(i,{matchMisconverted:!0}))),n):null}var r=e("../utils/util"),o=e("../utils/range_serializer"),s=e("../annotations/annotation_helper"),a=function(e,t,n){t=r.merge({id:r.guid(),color_id:1},t),n=n||i(e,t),this.klass="termite",this.id=r.guid(),this.page=e,this.data=t,this.range=n,this._initData(),this._initRects(),this._initElems(),this._addDrawable(),this._addEventable()};a.prototype={_initData:function(){!this.data.text&&this.range&&(this.data=r.merge(this.data,s.rangeToTextData(this.range,this.page))),!this.data.rects&&this.range&&(this.data=r.merge(this.data,s.rangeToRectData(this.range,this.page)))},_initRects:function(){this.data.rects?this.rects=s.fromSyncCoords(this.page,this.data.rects):this.range&&(this.rects=s.getNormalizedRects(this.page,this.range))},_initElems:function(){var e=[],t=this.page.getZoom();_.each(this.rects,function(n){e.push(r.divFromRect(n.scale(t,t)))}),this._elems=$(e)},_addDrawable:function(){var e=[this.klass+"-elem-draw",this.getColor(),this.id,"transparent"].join(" "),t=s.addToDocumentFragment(this._elems,e);this._drawableElems=$(t).children(),this.page.getDrawable().append(t)},_addEventable:function(){var e=[this.klass,this.id].join(" ");(this.data.meta||{})._ext_uri&&(e+=" linkout");var t=s.addToDocumentFragment(this._elems,e);this._eventableElems=$(t).children(),this.page.getEventable().append(t)},_removeEventable:function(){this._eventableElems.remove(),this._eventableElems=null},_removeDrawable:function(){this._drawableElems.remove(),this._drawableElems=null},getElems:function(){return this._eventableElems},getColor:function(){var e=parseInt(this.data.color_id);return!e||e<1||e>4?"color-1":"color-"+e},getId:function(){return this.id},getDataId:function(){return this.data.id},getKlass:function(){return this.klass},destroy:function(){this._removeEventable(),this._removeDrawable(),this.range=null,this.klass=null,this.data=null,this.page=null},serialize:function(){return r.clone(this.data)}},t.exports=a},{"../annotations/annotation_helper":80,"../utils/range_serializer":141,"../utils/util":147}],124:[function(e,t,n){function i(e){var t=e.getId();w[t]=e,g.add(e),$(_).trigger("add",[e]),$(e).on("click",function(){console.log("termite:",e.data),(e.data.meta||{})._ext_uri&&window.open(e.data.meta._ext_uri)})}function r(e,t){if(!b[e]&&y[e]&&t.hasText()){var n=u.timer.tic();y[e].forEach(function(e){return i(new v(t,e))}),u.log("termites("+e+") duration: "+u.timer.toc(n)+"ms"),b[e]=!0}}function o(e){var t=[];return e.forEach(function(e){t[e.page_start]||(t[e.page_start]=[]),t[e.page_start].push(e)}),t}function s(){return new Promise(function(e){p.onInit(function(){m.item.onAdd(function(t){$.ajax({xhrFields:{withCredentials:!0},url:f.sync+"/collections/"+t.collection_id+"/entities?id="+p.get().hash,success:function(t){"ok"==t.status&&e(o(t.entities))}})})})})}function a(){return!h.production()&&(s().then(function(e){y=e,d.onInit(function(){return d.eachPage(r)}),$(d).on("page-loaded.termites-model",function(e,t){r(t,d.getPageObj(t))})}),!0)}function c(e){for(var t in w)if(!1===e(w[t]))break}function l(){return u.clone(w)}var u=e("../utils/util"),d=e("../viewer/viewer"),h=e("../environment"),f=e("../endpoint"),p=e("../article"),m=e("../sync/sync"),g=e("../input_handler"),v=e("./termite"),_={},w={},b={},y=[];_.init=a,_.forEach=c,_.getAll=l,t.exports=_},{"../article":88,"../endpoint":97,"../environment":98,"../input_handler":113,"../sync/sync":122,"../utils/util":147,"../viewer/viewer":156,"./termite":123}],125:[function(e,t,n){function i(e,t){s.parent&&window.parent.postMessage(l.merge(t||{},{type:e,access:o(),user:r()}),s.parent)}function r(){return c.get()||{}}function o(){return _.pick(a.get(),["access_method","purchase_tier","share_token","share_type","referrer"])}var s=e("../endpoint"),a=e("../article"),c=e("../user"),l=e("../utils/util");t.exports=i},{"../article":88,"../endpoint":97,"../user":132,"../utils/util":147}],126:[function(e,t,n){function i(e){a(),c(),f(e)}function r(){var e=_.timer.toc(P)/1e3;N&&(e+=N,N=null),d({duration:Math.max(0,Math.min(Math.round(e),3600))})}function o(){clearTimeout(I),I=setTimeout(s,Y),P&&r(),P=_.timer.tic()}function s(){P&&r(),P=null}function a(){C={},sessionUpdateBatch={},E={},T=!1,clearInterval(j),j=setInterval(l,S),setTimeout(function(){clearInterval(j),j=setInterval(l,X)},6e4)}function c(){clearTimeout(I),P&&(_.timer.toc(P),P=null)}function l(){if(x){var e={};e=_.merge(e,A),T&&(e=_.merge(e,{counters:E})),$.isEmptyObject(e)||p(e),C=_.merge(C,A),A={},T=!1}}function u(e){_.log("received metrics event:",e),A=_.merge(A,_.objDiff(C,e))}function d(e){for(var t in e)E[t]=(E[t]||0)+e[t];T=!0}function h(){return article.isPersonal()?"web_library":v.any?"mobile_reader":"html5"}function f(e){N=Math.max(1,Math.round(_.timer.toc(R)/1e3));var t=parseUri(location.href).queryKey,n={session_id:k,doi:e.doi,publisher:e.meta.publisher,environment:h(),counters:{duration:N},shared:{view:!!t.shared_access_token,token:t.shared_access_token,annotations:!!e.shared_annotations_url},referred:{view:!!t.referrer_access_token,token:t.referrer_access_token},author_share:{view:!!t.author_access_token,token:t.author_access_token},feed:{view:!!t.feed_token,token:t.feed_token},referrer_url:t.tracking_referrer,article:{issn:e.meta.issn,eissn:e.meta.eissn,isbn:e.meta.isbn,eisbn:e.meta.eisbn,year:e.meta.year,references:e.references.length>0,inline_references:g(e),video_supplement:m(e),supplements:e.supplements.length>0,figures:e.figures.length>0},access:{proxy:b(article.get().publisher)}};e.sync_collection_id&&(n.collection_id=e.sync_collection_id,e.sync_item_sponsored?n.collection_type="sponsored":e.sync_item_shared?n.collection_type="shared":n.collection_type="personal"),t.customer_ids&&(n.publisher_data||(n.publisher_data={}),n.publisher_data.customer_ids=decodeURIComponent(t.customer_ids)),$.ajax({url:w.analytics+"/metrics/create_session_ex.json",type:"POST",contentType:"application/json; charset=UTF-8",dataType:"json",crossDomain:!0,xhrFields:{withCredentials:!0},data:JSON.stringify({data:n}),success:function(e){_.log("created metrics session:",n),x=e.result}})}function p(e){_.log("updated metrics:",e),$.ajax({url:w.analytics+"/metrics/update_session_ex.json",type:"POST",contentType:"application/json; charset=UTF-8",dataType:"json",crossDomain:!0,xhrFields:{withCredentials:!0},data:JSON.stringify({data:_.merge(e,{session_id:k,article_session_id:x})})})}function m(e){if(!e.supplements)return!1;var t=e.supplements.filter(function(e){return"video"==e.type}).length;return t>0}function g(e){if(!e.citations)return!1;var t=e.citations.reduce(function(e,t){return e+t.length},0);return t>0}var v=e("../utils/mobile_detect"),_=e("../utils/util"),w=e("../endpoint"),b=e("../proxy_host"),y=e("./track_id"),k=y.get(),x=null,C={},A={},T=!1,E={},j=null,S=1e4,X=3e4,I=null,Y=6e4,P=null,R=_.timer.tic(),N=null;t.exports={start:i,active:o,idle:s,sendEvent:u,addCounter:d}},{"../endpoint":97,"../proxy_host":115,"../utils/mobile_detect":139,"../utils/util":147,"./track_id":129}],127:[function(e,t,n){function i(){s.onInit(function(){c=!0,$(a).trigger("new")})}var r=e("../endpoint"),o=e("../receiver"),s=e("../article"),a={},c=!1;r.parent?$(o.all).on("new_session",i):i(),a.onceStarted=function(e){c?e():$(a).one("new",e)},a.onStart=function(e){c&&e(),$(a).on("new",e)},t.exports=a},{"../article":88,"../endpoint":97,"../receiver":116}],128:[function(e,t,n){var i=e("../utils/util");t.exports=function(e,t){t&&("string"==typeof e&&(e={error:e}),t=i.pickDefined(t,["doi","resource_id","country","st"]),e=$.extend({params:t},e)),trackJs&&trackJs.track(e)}},{"../utils/util":147}],129:[function(e,t,n){function i(){l=a.getItem(u),l||(l=s.guid(),a.setItem(u,l))}function r(){a.removeItem(u)}function o(){return l}var s=e("../utils/util"),a=e("../utils/cookies"),c={},l=null,u="readcube-track-id";i(),c.get=o,c.clear=r,t.exports=c},{"../utils/cookies":136,"../utils/util":147}],130:[function(e,t,n){function i(){F.get().doi&&"article"==F.getType()&&(ga("set","dimension3",F.get().doi),ga("set","dimension7","web_reader"),L.onStart(r),$(D).on("auth",function(e,t){c(t.user,t.auth)}),F.onAccessCheck(function(e){var t=F.hasAccess()?e.access_method:"denied";ga("send","event","article","access_method",t),U.sendEvent({access:{method:t},access_denied:!F.hasAccess()})}),F.onAccess(function(e){e.feed_id&&U.sendEvent({feed:{id:e.feed_id}})}),$(document).on("mousemove click scroll",_.throttle(o,3e3,{leading:!0})),$(window).on({focus:o,blur:s}))}function r(){var e=window.READER_VERSION;ga("send","event","webreader","version",e.version),ga("send","event","webreader","build",e.build),F.onData(function(){U.start(F.get()),ga("send","event","article","read","web"),ga("send","event","article","origin",O())})}function o(){U.active()}function s(){U.idle()}function a(){ga("send","event","article","altmetric"),U.sendEvent({altmetric:!0})}function c(e,t){var n={};n[t]=!0,U.sendEvent(n)}function l(){U.sendEvent({cite:!0})}function u(){U.sendEvent({discover:!0})}function d(){ga("send","event","article","checkout_opened")}function h(e){ga("send","event","article","save_pdf","web",e?1:0),e&&U.sendEvent({download:!0})}function f(){U.addCounter({highlight:1})}function p(e){var t={};t[e]=!0,U.sendEvent({inline:t})}function m(e){ga("send","event","article","linkout",e)}function g(e,t){B.push({source:t,doi:e}),U.sendEvent({referrals:B.slice()}),ga("send","event","referral",t,e.split("/")[0])}function v(){U.addCounter({note:1})}function w(e){var t={};t[e]=!0,U.sendEvent({print:t}),ga("send","event","article","print","web")}function b(e){U.sendEvent({purchased:!0,purchase_id:e.purchase.id})}function y(){U.sendEvent({related:!0})}function k(){U.sendEvent({save_cloud:!0})}function x(e){ga("send","event","article","scroll","page",e)}function C(e){var t={};t[e]=!0,U.sendEvent({sidepanel:t}),ga("send","event","article","sidepanel",e)}function A(e){ga("send","event","article","pdf_toolbar",e)}function T(e){ga("send","event","article","menu_bar",e)}function E(e){var t={};t[e]=!0,U.sendEvent({share:t})}function j(e){U.sendEvent({share:{token:e}})}function S(){U.sendEvent({supplement:!0}),ga("send","event","article","supplement","view")}function X(e){e?U.sendEvent({tooltips:{viewed:!0}}):U.sendEvent({tooltips:{skipped:!0}})}function I(){ga("send","event","article","video","view"),U.sendEvent({video_supplement:!0})}function Y(){ga("send","event","article","export_options","view")}function P(e){ga("send","event","article","export_citation","format",e)}function R(){ga("send","event","article","export_notes")}function N(){var e=F.get().access_method;return"sharing_token"==e?"web_reader_share":"referrer_token"==e?"web_reader_referral":"web_reader"}function O(){return M.parent?M.parent.match(/[\.\/]epdf/i)?"epdf_endpoint":"overlay":"readcube.com"}var D=e("../user"),F=e("../article"),M=e("../endpoint"),L=e("./session"),U=e("./readcube_analytics"),z={},B=[];window.ga||(window.ga=_.noop),F.onInit(i),z.menuBar=T,z.pdfToolbar=A,z.trackingOrigin=N,z.altmetric=a,z.auth=c,z.cite=l,z.discover=u,z.checkout=d,z.download=h,z.highlight=f,z.inline=p,z.linkout=m,z.referral=g,z.note=v,z.print=w,z.purchase=b,z.related=y,z.saveCloud=k,z.scroll=x,z.share=E,z.shareToken=j,z.supplement=S,z.sidepanel=C,z.tooltips=X,z.video=I,z.exportOptions=Y,z.exportCitation=P,z.exportNotes=R,t.exports=z},{"../article":88,"../endpoint":97,"../user":132,"./readcube_analytics":126,"./session":127}],131:[function(e,t,n){function i(){return new Promise(function(e,t){$.ajax({url:r.version,cache:o.development()}).done(function(t){var n=new Date(t.build),i=new Date(window.READER_VERSION.build);i<n&&e()})})}var r=e("./endpoint"),o=e("./environment"),s={};s.available=i,t.exports=s},{"./endpoint":97,"./environment":98}],132:[function(e,t,n){function i(){return window.readcube_user?Promise.resolve(window.readcube_user):Promise.reject({status:401})}function r(){return r.promise?r.promise:r.promise=i().then(s)}function o(){return h.clone(g)}function s(e,t){var n=g;return g=h.clone(e),"register"!=t&&(t="login"),!a(n)&&a(g)&&$(m).trigger("auth",[h.merge(o(),{auth:t})]),$(m).trigger("change",[o()]),o()}function a(e){return e&&e.id}function c(){return a(g)}function l(e){c()&&e(),$(m).on("auth",e)}function u(e){$.ajax({type:"DELETE",crossDomain:!0,xhrFields:{withCredentials:!0},url:f.web+"/session/delete.json",success:e})}function d(){$(p.readcube).on(["auth:success","checkout:auth"].join(" "),function(e,t){s(t.user,t.auth)}),r().catch(_.noop)}var h=e("./utils/util"),f=e("./endpoint"),p=e("./receiver"),m={},g={};d(),m.get=o,m.set=s,m.fetch=r,m.signOut=u,m.signedIn=c,m.onSignIn=l,t.exports=m},{"./endpoint":97,"./receiver":116,"./utils/util":147}],133:[function(e,t,n){function i(e){return _.compact([s,e]).join("-")}var r=e("./utils/storage"),o={},s=null;o.setPrefix=function(e){s||(s=e)},o.get=function(e,t){var n=r.local.get(i(e));return n?JSON.parse(n):t||null},o.set=function(e,t){r.local.set(i(e),JSON.stringify(t))},o.remove=function(e){r.local.remove(i(e))},o.clear=function(){r.local.clear()},t.exports=o},{"./utils/storage":143}],134:[function(e,t,n){function i(){setInterval(function(){c.forEach(function(e){Date.now()>=e.time_utc&&!s.docHidden()&&(e.time_utc=1/0,e.handler())})},1e3)}function r(e,t){if("function"==typeof e&&!(parseInt(t)<=Date.now()))return c.push({handler:e,time_utc:t})}function o(e){isNaN(e=parseInt(e))||e<1||e>c.length||(c[e-1].time_utc=1/0)}var s=e("./util"),a={},c=[];i(),a.add=r,a.remove=o,t.exports=a},{"./util":147}],135:[function(e,t,n){var i=[];jQBrowser.platform&&i.push(jQBrowser.platform+"-os"),jQBrowser.name&&(i.push(jQBrowser.name),parseInt(jQBrowser.versionNumber)&&i.push(jQBrowser.name+"-"+jQBrowser.versionNumber)),i.length&&$("html").addClass(i.join(" ")),t.exports=jQBrowser},{}],136:[function(e,t,n){var i={getItem:function(e){try{return e?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null}catch(e){return null}},setItem:function(e,t,n,i,r,o){try{if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var s="";if(n)switch(n.constructor){case Number:s=n===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+n;break;case String:s="; expires="+n;break;case Date:s="; expires="+n.toUTCString()}return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+s+(r?"; domain="+r:"")+(i?"; path="+i:"")+(o?"; secure":""),!0}catch(e){return!1}},removeItem:function(e,t,n){try{return!!this.hasItem(e)&&(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(n?"; domain="+n:"")+(t?"; path="+t:""),!0)}catch(e){return!1}},hasItem:function(e){try{return!!e&&new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)}catch(e){return!1}},keys:function(){try{for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),t=e.length,n=0;n<t;n++)e[n]=decodeURIComponent(e[n]);return e}catch(e){return[]}}};t.exports=i},{}],137:[function(e,t,n){function i(e){return/[^\u0000-\u007E]{1}/.test(e)}function r(e){return e.replace(/[^\u0000-\u007E]/g,function(e){return s[e]||e})}for(var o=[{base:"A",letters:"A"},{base:"AA",letters:""},{base:"AE",letters:""},{base:"AO",letters:""},{base:"AU",letters:""},{base:"AV",letters:""},{base:"AY",letters:""},{base:"B",letters:"B"},{base:"C",letters:"C"},{base:"D",letters:"D"},{base:"DZ",letters:""},{base:"Dz",letters:""},{base:"E",letters:"E"},{base:"F",letters:"F"},{base:"G",letters:"G"},{base:"H",letters:"H"},{base:"I",letters:"I"},{base:"J",letters:"J"},{base:"K",letters:"K"},{base:"L",letters:"L"},{base:"LJ",letters:""},{base:"Lj",letters:""},{base:"M",letters:"M"},{base:"N",letters:"N"},{base:"NJ",letters:""},{base:"Nj",letters:""},{base:"O",letters:"O"},{base:"OI",letters:""},{base:"OO",letters:""},{base:"OU",letters:""},{base:"OE",letters:""},{base:"oe",letters:""},{base:"P",letters:"P"},{base:"Q",letters:"Q"},{base:"R",letters:"R"},{base:"S",letters:"S"},{base:"T",letters:"T"},{base:"TZ",letters:""},{base:"U",letters:"U"},{base:"V",letters:"V"},{base:"VY",letters:""},{base:"W",letters:"W"},{base:"X",letters:"X"},{base:"Y",letters:"Y"},{base:"Z",letters:"Z"},{base:"a",letters:"a"},{base:"aa",letters:""},{base:"ae",letters:""},{base:"ao",letters:""},{base:"au",letters:""},{base:"av",letters:""},{base:"ay",letters:""},{base:"b",letters:"b"},{base:"c",letters:"c"},{base:"d",letters:"d"},{base:"dz",letters:""},{base:"e",letters:"e"},{base:"f",letters:"f"},{base:"g",letters:"g"},{base:"h",letters:"h"},{base:"hv",letters:""},{base:"i",letters:"i"},{base:"j",letters:"j"},{base:"k",letters:"k"},{base:"l",letters:"l"},{base:"lj",letters:""},{base:"m",letters:"m"},{base:"n",letters:"n"},{base:"nj",letters:""},{base:"o",letters:"o"},{base:"oi",letters:""},{base:"ou",letters:""},{base:"oo",letters:""},{base:"p",letters:"p"},{base:"q",letters:"q"},{base:"r",letters:"r"},{base:"s",letters:"s"},{base:"t",letters:"t"},{base:"tz",letters:""},{base:"u",letters:"u"},{base:"v",letters:"v"},{base:"vy",letters:""},{base:"w",letters:"w"},{base:"x",letters:"x"},{base:"y",letters:"y"},{base:"z",letters:"z"}],s={},a=0;a<o.length;a++)for(var c=o[a].letters.split(""),l=0;l<c.length;l++)s[c[l]]=o[a].base;t.exports={detectGlyph:i,remove:r}},{}],138:[function(e,t,n){function i(e,t,n,i){var a,c=[],l=[],u=o(t);if(!u)return l;if(e.global)for(;a=e.exec(u);)c.push(r(a,i));else a=u.match(e),a&&c.push(r(a,i));return c.length&&(l=s(t,c,n)),l}function r(e,t){if(t=t||0,!e[0])throw"findTxt cannot handle zero-length matches";var n=e.index;if(t>0){var i=e[t];if(!i)throw"Invalid capture group";n+=e[0].indexOf(i),e[0]=i}return[n,n+e[0].length,[e[0]]]}function o(e){if(3===e.nodeType)return e.data;var t="";if(e=e.firstChild)do t+=o(e);while(e=e.nextSibling);return t}function s(e,t,n){var i,r,o,s,a=e,c=0,l=[],u=[],d=t.shift();e:for(;;){if(3===a.nodeType&&(!r&&a.length+c>=d[1]?(r=a,s=d[1]-c):i&&u.push(a),!i&&a.length+c>d[0]&&(i=a,o=d[0]-c),c+=a.length),i&&r){var h={startNode:i,startNodeIndex:o,endNode:r,endNodeIndex:s,matchIndex:l.length+1};if(l.push(h),n&&!1===n(h))break;if(a=r,c-=r.length-s,i=null,r=null,u=[],d=t.shift(),!d)break}else if(a.firstChild||a.nextSibling){a=a.firstChild||a.nextSibling;continue;
}for(;;){if(a.nextSibling){a=a.nextSibling;break}if(a.parentNode===e)break e;a=a.parentNode}}if(!n)return l}t.exports=i},{}],139:[function(e,t,n){var i=navigator.userAgent||navigator.vendor||window.opera,r=function(){var e={OperaMini:function(){return/Opera Mini/i.test(i)},Android:function(){return/Android/i.test(i)},BlackBerry:function(){return/BlackBerry/i.test(i)},iOS:function(){return/iPhone|iPad|iPod/i.test(i)},Windows:function(){/IEMobile/i.test(i)}};for(var t in e)if(e[t]())return t;return null}(),o=function(){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(i)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(i.substr(0,4))||/micromessenger/i.test(i)}();t.exports={get phone(){return o},get platform(){return r},get any(){return!!r||o}}},{}],140:[function(e,t,n){function i(e,t){var n=e%t;return 0===n?e:Math.round(e-n+t)}function r(e){if(Math.floor(e)===e)return[e,1];var t=1/e,n=8;if(t>n)return[1,n];if(Math.floor(t)===t)return[1,t];for(var i=e>1?t:e,r=0,o=1,s=1,a=1;;){var c=r+s,l=o+a;if(l>n)break;i<=c/l?(s=c,a=l):(r=c,o=l)}return i-r/o<s/a-i?i===e?[r,o]:[o,r]:i===e?[s,a]:[a,s]}function o(e,t,n){return"undefined"==typeof n||0===+n?Math[e](t):(t=+t,n=+n,isNaN(t)||"number"!=typeof n||n%1!==0?NaN:(t=t.toString().split("e"),t=Math[e](+(t[0]+"e"+(t[1]?+t[1]-n:-n))),t=t.toString().split("e"),+(t[0]+"e"+(t[1]?+t[1]+n:n))))}var s={};s.roundToDivide=i,s.approximateFraction=r,s.round10=function(e,t){return o("round",e,t)},s.floor10=function(e,t){return o("floor",e,t)},s.ceil10=function(e,t){return o("ceil",e,t)},t.exports=s},{}],141:[function(e,t,n){function i(e,t,n){var i=e.cloneRange(),r=i.text(),o=r.length,s=o-n;if(s<0){if(i.moveStart("character",s),!$.contains(t[0],i.commonAncestorContainer))return arguments.callee(e,t,n>>1);r=i.text()}return{text:r.substr(-o),prefix:r.substring(0,r.length-o)}}function r(e){return function(t){var n=t.nodeType==Node.TEXT_NODE;n&&(t=c.wrapTextNode(t));var i=t.getBoundingClientRect();n&&(t=c.unwrapTextNode(t));for(var r=new l(i.left,i.top,i.width,i.height),o=0;o<e.length;o++)if(r.intersects(e[o]))return!0;return!1}}function o(e){var t=rangy.createRange();return t.setStart(e.startNode,e.startNodeIndex),t.setEnd(e.endNode,e.endNodeIndex),t}function s(e,t){if(!e.length)return null;if(!t||!t.length)return o(e[0]);for(var n=null,i=0,s=r(t),a=0;a<e.length;a++){var c=o(e[a]),l=c.getNodes([Node.TEXT_NODE,Node.ELEMENT_NODE],s);l.length>i&&(i=l.length,n=c)}return n}function a(e,t){t=$.extend({matchFilter:null,insertWhitespace:!1,removeDiacritics:!1,matchTranslits:!1,matchCase:!1,matchBrokenTxt:!1,matchWeirdCitations:!1,matchMisconverted:!1,matchBrokenSpaces:!1,matchBrokenDigits:!1,boundingRects:null},t);var n=e.text,i=e.prefix;t.insertWhitespace&&(n=n.replace(/\s+/g,"").split("").join(" "),i=i.replace(/\s+/g,"").split("").join(" "));var r=c.regexEscape(n),o=c.regexEscape(i);if(t.removeDiacritics&&(r=d.remove(r)),t.matchTranslits){r=r.replace(/\\?[-]/gi,"."),r=r.replace(/([szc]{1})/gi,"$1[`'\"~]? ");var a=r.replace(/([aeiou]{1})/gi,".");a.replace(/[^a-z]/gi,"").length>3&&(r=a)}if(t.matchBrokenTxt&&e.text.match(/[a-z]+/i)&&e.text.match(/\d{4}/)&&(r=r.replace(/([a-z0-9]{1})/gi,"(?:$1|[^\\x20-\\x7F]{1})")),t.matchWeirdCitations&&(r=r.replace(/(| )/gi,"."),o=o.replace(/(\d+)\\\)/,"$1 \\)")),t.matchMisconverted){var l=o.replace(/(ff|fi|fl|[^\x00-\x7F])/gi,"(?:$1|.\\s?.?)"),f=r.replace(/(ff|fi|fl|[^\x00-\x7F])/gi,"(?:$1|.\\s?.?)");l.replace(/\\s/gi,"").replace(/[^a-z]/gi,"").length&&(o=l),f.replace(/\\s/gi,"").replace(/[^a-z]/gi,"").length&&(r=f)}t.matchBrokenDigits&&(r=r.replace(/\d+/g,"(?:[^\\x00-\\x7F]|\\d)+"),o=o.replace(/\d+/g,"(?:[^\\x00-\\x7F]|\\d)+")),t.matchBrokenSpaces&&(r=r.replace(/\s+/g,"(?:[^\\x00-\\x7F]|\\s)+"),o=o.replace(/\s+/g,"(?:[^\\x00-\\x7F]|\\s)+")),r="("+r.replace(/\s+/g,"\\s*")+")",o=o.replace(/\s+/g,"\\s*");var p=(t.matchCase?"":"i")+"g",m=new RegExp(o+"\\s*"+r,p),g=[];try{g=u(m,t.container[0],null,1)}catch(e){return null}t.matchFilter&&(g=$.grep(g,t.matchFilter));var v=s(g,t.boundingRects);return v&&h.test(v.toString())?v:null}var c=e("./util"),l=e("./rect"),u=e("./findtxt"),d=e("./diacritics"),h=new RegExp;t.exports={serialize:i,deserialize:a}},{"./diacritics":137,"./findtxt":138,"./rect":142,"./util":147}],142:[function(e,t,n){function i(e,t,n,i){this.left=e,this.top=t,this.width=n,this.height=i}i.prototype.intersects=function(e){return this.left<=e.left+e.width&&e.left<=this.left+this.width&&this.top<=e.top+e.height&&e.top<=this.top+this.height},i.prototype.boundingRect=function(e){var t=Math.max(this.left+this.width,e.left+e.width),n=Math.max(this.top+this.height,e.top+e.height);this.left=Math.min(this.left,e.left),this.top=Math.min(this.top,e.top),this.width=t-this.left,this.height=n-this.top},i.prototype.translate=function(e,t){return this.left+=e,this.top+=t,this},i.prototype.scale=function(e,t){return this.left*=e,this.width*=e,this.top*=t,this.height*=t,this},i.prototype.clone=function(){return new i(this.left,this.top,this.width,this.height)},t.exports=i},{}],143:[function(e,t,n){function i(e){return window[e+"Storage"]}function r(e,t){try{return i(e).getItem(t)}catch(e){return null}}function o(e,t,n){try{return i(e).setItem(t,n)}catch(e){}}function s(e,t){try{return i(e).removeItem(t)}catch(e){}}function a(e){try{return i(e).clear()}catch(e){}}var c={},l={};o("local","availability-test",!0),o("session","availability-test",!0),c.get=_.partial(r,"local"),c.set=_.partial(o,"local"),c.remove=_.partial(s,"local"),c.clear=_.partial(a,"local"),c.available=!!r("local","availability-test"),l.get=_.partial(r,"session"),l.set=_.partial(o,"session"),l.remove=_.partial(s,"session"),l.clear=_.partial(a,"session"),l.available=!!r("session","availability-test"),t.exports={local:c,session:l}},{}],144:[function(e,t,n){function i(){var e=document.getElementsByTagName("body")[0],t=document.createElement("div");t.style.position="absolute",t.style.visibility="hidden",t.style.fontFamily='"Georgia"',t.innerHTML="PICS",e.appendChild(t);var n=10,i=4,r=.1;t.style.fontSize=n+"px";var o=t.offsetWidth;t.style.fontSize=n*i+"px";var s=t.offsetWidth;return e.removeChild(t),Math.abs(s/o-i)<r}t.exports=i},{}],145:[function(e,t,n){function i(e,t){if(!e.translate)return"";var n=e.translate.x.toFixed(a),i=e.translate.y.toFixed(a);return t?"translate3d("+n+"px, "+i+"px, 0)":"translate("+n+"px, "+i+"px)"}function r(e){return e.scale?"scale("+e.scale.toFixed(a)+")":""}function o(e,t){return[i(e,t),r(e)].join(" ")}function s(e){return e?e.x.toFixed(a)+"px "+e.y.toFixed(a)+"px 0":""}var a=5;t.exports={getCssTransformOrigin:s,getCssTransform:o}},{}],146:[function(e,t,n){function i(e,t){this._elem=e,this._opts=t,this._mc=null,this._startX=null,this._startY=null,this._panDirectioon=null,this._initScale=null,this._minScale=null,this._maxScale=null,this._transform=null,this._transformOrigin=null,this._ticking=null,this._scaling=null,this._translating=null,this._swiping=null,this._offsetWidth=null,this._offsetHeight=null,this._dbltapScale=null,this._init()}var r=e("./transform_helper"),o=4,s=8,a=12;i.prototype={_init:function(){this._dbltapScale=.5,this._offsetWidth=this._elem.offsetWidth,this._offsetHeight=this._elem.offsetHeight,this._initTransform(),this._mc=new Hammer.Manager(this._elem,{preventDefault:!0,recognizers:[[Hammer.Pan,{pointers:0}],[Hammer.Pinch,{},["pan"]],[Hammer.Tap,{event:"doubletap",posThreshold:20,threshold:10,taps:2},["pan"]]]}),this._mc.on("pinchstart",this._onPinchStart.bind(this)),this._mc.on("panstart panmove",this._onPan.bind(this)),this._mc.on("pinchstart pinchmove",this._onPinch.bind(this)),this._mc.on("doubletap",this._onDoubleTap.bind(this)),this._mc.on("hammer.input",this._onInput.bind(this)),this._finalizeElementTransform()},_initTransform:function(){this._startX=0,this._startY=0,this._initScale=this._opts.scale||1,this._minScale=this._initScale,this._maxScale=this._initScale*o,this._transformOrigin={x:0,y:0},this._transform={translate:{x:this._startX,y:this._startY},scale:this._initScale}},_onPan:function(e){this._translating=!0,this._setPanDirection(e);var t=this._panDirection==Hammer.DIRECTION_VERTICAL?0:e.deltaX,n=this._panDirection==Hammer.DIRECTION_HORIZONTAL?0:e.deltaY,i={x:this._startX+t,y:this._startY+n},r=this._setTransfromTranslate(i,this._panDirection==Hammer.DIRECTION_HORIZONTAL);(e.panOutX=i.x-r.x)&&(this._swiping=!0),this._requestElementTransform()},_onPinchStart:function(e){this._setTransformOrigin(e.center)},_onPinch:function(e){this._scaling=!0;var t=this._swiping?1:e.scale;this._setTransformScale(this._initScale*t),this._requestElementTransform()},_onDoubleTap:function(e){this._dbltapScale=1/this._dbltapScale,this._setTransformOrigin(e.center),this._setTransformScale(this._transform.scale*this._dbltapScale),this._finalizeElementTransform(!0)},_onInput:function(e){e.isFirst&&this._elem.classList.remove("animate"),e.isFinal&&(this._scaling||this._translating)&&(this._setTransformOrigin(),this._setElementTransform(),this._addTranslateInertia(e),this._finalizeElementTransform(!0),this._translating=null,this._scaling=null,this._swiping=null,this._panDirection=null)},_setPanDirection:function(e){this._scaling&&!this._swiping?this._panDirection=Hammer.DIRECTION_ALL:this._panDirection||(this._offsetHeight*this._transform.scale<=this._opts.viewport.height?this._panDirection=Hammer.DIRECTION_HORIZONTAL:Math.abs(e.deltaY)<s&&Math.abs(e.deltaX)>a?this._panDirection=Hammer.DIRECTION_HORIZONTAL:Math.abs(e.deltaX)<s&&Math.abs(e.deltaY)>a?this._panDirection=Hammer.DIRECTION_VERTICAL:Math.abs(e.deltaX)>=s&&Math.abs(e.deltaY)>=s&&(this._panDirection=Hammer.DIRECTION_ALL))},_finalizeElementTransform:function(e){this._setTransformOrigin(),this._setTransfromTranslate(this._transform.translate,!0),this._updateStartValues(),this._elem.classList.toggle("animate",!!e),this._setElementTransform()},_setTransformOrigin:function(e){var t=this._elem.getBoundingClientRect(),n=e?{x:(e.x-t.left)/this._transform.scale,y:(e.y-t.top)/this._transform.scale}:{x:0,y:0},i=(n.x-this._transformOrigin.x)*(this._transform.scale-1),r=(n.y-this._transformOrigin.y)*(this._transform.scale-1);this._transformOrigin=n,this._transform.translate.x+=i,this._transform.translate.y+=r,this._initScale=this._transform.scale,this._startX+=i,this._startY+=r},_setTransformScale:function(e){e=Math.min(e,this._maxScale),e=Math.max(e,this._minScale),this._transform.scale=e},_setTransfromTranslate:function(e,t){return t&&(e=this._clipTranslate(e)),this._transform.translate=e},_clipTranslate:function(e){e={x:e.x,y:e.y};var t=this._offsetWidth*this._transform.scale,n=this._offsetHeight*this._transform.scale,i=this._transformOrigin.x*(this._transform.scale-1),r=this._transformOrigin.y*(this._transform.scale-1),o=this._opts.viewport.width-t,s=this._opts.viewport.height-n;return t>this._opts.viewport.width?(e.x=Math.max(e.x,i+o),e.x=Math.min(e.x,i)):e.x=i+o/2,n>this._opts.viewport.height?(e.y=Math.max(e.y,r+s),e.y=Math.min(e.y,r)):e.y=r+s/2,e},_setElementTransform:function(){var e=this._scaling||this._translating;this._elem.style.transformOrigin=r.getCssTransformOrigin(this._transformOrigin),this._elem.style.transform=r.getCssTransform(this._transform,e)},_requestElementTransform:function(){var e=this;this._ticking||(this._ticking=!0,requestAnimationFrame(function(){e._setElementTransform(),e._ticking=!1}))},_updateStartValues:function(){this._startX=this._transform.translate.x,this._startY=this._transform.translate.y,this._initScale=this._transform.scale},_addTranslateInertia:function(e){if(!this._scaling){var t=100*e.velocityX,n=100*e.velocityY;Math.max(Math.abs(t),Math.abs(n))<10&&(t=n=0),this._panDirection==Hammer.DIRECTION_VERTICAL&&(t=0),this._anDirection==Hammer.DIRECTION_HORIZONTAL&&(n=0),this._transform.translate.x+=t,this._transform.translate.y+=n}},resize:function(e){var t=e.width/this._opts.viewport.width;this._opts.viewport=e,this._initScale*=t,this._minScale*=t,this._maxScale*=t,this._offsetWidth=this._elem.offsetWidth,this._offsetHeight=this._elem.offsetHeight,this._setTransformOrigin({x:this._opts.viewport.left,y:this._opts.viewport.top}),this._setTransformScale(this._transform.scale*t),this._finalizeElementTransform()},reset:function(e){this._opts.scale=e,this._initTransform(),this._finalizeElementTransform()},destroy:function(){this._mc.destroy(),this._mc=null,this._elem=null,this._opts=null,this._startX=null,this._startY=null,this._panDirectioon=null,this._initScale=null,this._minScale=null,this._maxScale=null,this._transform=null,this._transformOrigin=null,this._ticking=null,this._scaling=null,this._translating=null,this._swiping=null,this._offsetWidth=null,this._offsetHeight=null,this._dbltapScale=null},get hammer(){return this._mc}},t.exports=i},{"./transform_helper":145}],147:[function(e,t,n){function i(){return!F.production()||D.local.get("readcube-console-log")}function r(){try{Array.prototype.unshift.call(arguments,"[READCUBE]"),i()&&console.log.apply(console,arguments)}catch(e){}}function o(e){return $.extend(!0,{},e)}function s(){return Array.prototype.splice.call(arguments,0,0,!0,{}),$.extend.apply($,arguments)}function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})}function c(e){var t=[];for(var n in e)t.push(n+"="+encodeURIComponent(e[n]));return t.join("&")}function l(e,t){var n=e.split("#");return n[0]+=n[0].indexOf("?")==-1?"?":"&",n[0]+=c(t),n.join("#")}function u(e,t,n){$("<link>",{rel:"stylesheet",type:"text/css",href:e}).error(n||_.noop).load(t||_.noop).appendTo("head")}function d(e,t){var n=document.createElement("script");n.onload=t||_.noop,n.src=e,document.getElementsByTagName("head").item(0).appendChild(n)}function h(e){try{var t=e.scrollParent();return t.is(document)&&(t=$("body")),t}catch(e){return $("body")}}function f(e){var t=document.createElement("div");return t.setAttribute("style",["position:absolute","top:"+e.top+"px","left:"+e.left+"px","width:"+e.width+"px","height:"+e.height+"px"].join(";")),t}function p(e){for(var t={top:+(1/0),left:+(1/0),bottom:-(1/0),right:-(1/0)},n=0;n<e.length;n++){var i=e[n].getBoundingClientRect();t.top=Math.min(t.top,i.top),t.left=Math.min(t.left,i.left),t.bottom=Math.max(t.bottom,i.bottom),t.right=Math.max(t.right,i.right)}return t.width=t.right-t.left,t.height=t.bottom-t.top,t}function m(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null}function g(){var e=m();return!!e&&document[e]}function v(e){return"undefined"==typeof e?(new Date).toISOString():new Date(e).toISOString()}function w(e){var t={};if(!e)return t;for(var n=0;n<e.length;n++)t[e[n].id]=e[n];return t}function b(e){var t=[];if(!e)return t;for(var n in e)t.push(e[n]);return t}function y(e,t){return _.pick(_.pick(e,t||_.keys(e)),function(e){return"undefined"!=typeof e})}function k(e,t){var n={};for(var i in e)if(i in t)if(_.isObject(t[i])&&!_.isArray(t[i])){var r=k(e[i],t[i]);_.isEmpty(r)||(n[i]=r)}else _.isEqual(e[i],t[i])||(n[i]=t[i]);for(var i in t)i in e||(n[i]=t[i]);return n}function x(e){var t=document.createElement("span");return e.parentNode.insertBefore(t,e),t.appendChild(e),t}function C(e){var t=e.firstChild;return e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e),t}function A(e){return e.textContent&&/[^\s]/.test(e.textContent)}function T(e){var t=!1;return e.each(function(){if(A(this)&&P($(this).css("color")))return t=!0,!1}),t}function E(e,t){var n=e.commonAncestorContainer;return n.nodeType==Node.TEXT_NODE&&(n=n.parentNode.parentNode),t?$(n).find("."+t):(t=a(),rangy.createClassApplier(t).applyToRange(e),$(n).find("."+t).removeClass(t))}function j(){try{return window.self!==window.top}catch(e){return!0}}function S(e){j()?window.parent.postMessage({type:"redirect",url:e},"*"):location.href=e}function X(){j()?location.href=l(location.href,{autoboot:1}):location.reload()}function I(e,t){return(window.readcube||{})[e]||t}function Y(){var e="reader-referrer-"+CryptoJS.MD5(location.href).toString(),t=D.session.get(e);return t?t:(t=parseUri(location.href).queryKey.referrer_host,t=t||I("referrer"),t=t||parseUri(document.referrer).host,t&&D.session.set(e,t),t)}function P(e){return/transparent|rgba\(.+,\s?0\)/.test(e)}function R(){var e="(-webkit-min-device-pixel-ratio: 1.5), (min--moz-device-pixel-ratio: 1.5), (-o-min-device-pixel-ratio: 3/2), (min-resolution: 1.5dppx)";return window.devicePixelRatio>1||!(!window.matchMedia||!window.matchMedia(e).matches)}function N(e,t){return"PDF "+e.fingerprint+" ["+t.info.PDFFormatVersion+" "+(t.info.Producer||"-").trim()+" / "+(t.info.Creator||"-").trim()+"] (PDF.js: "+(PDFJS.version||"-")+(PDFJS.disableWebGL?"":" [WebGL]")+")"}function O(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var D=e("./storage"),F=e("../environment"),M=function(){var e={};return{tic:function(){var t=a();return e[t]=Date.now(),t},toc:function(t){var n=Date.now()-e[t];return delete e[t],n}}}();t.exports={log:r,guid:a,clone:o,merge:s,timer:M,loadCss:u,loadScript:d,addParams:l,scrollParent:h,divFromRect:f,getBoundingRect:p,wrapTextNode:x,unwrapTextNode:C,getElems:E,docHidden:g,arrayToHash:w,hashToArray:b,pickDefined:y,dateISO:v,objDiff:k,reload:X,redirectOrPost:S,referrerHost:Y,hasTransparentText:T,isRetina:R,pdfjsInfo:N,readcube:I,regexEscape:O}},{"../environment":98,"./storage":143}],148:[function(e,t,n){function i(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null}function r(){var e=i();return!!e&&document[e]}function o(e){var t=i();if(t){var n=t.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(n,e)}}function s(){return new Promise(function(e){e=_.once(e),r()?o(function(){r()||e()}):e()})}var a={};a.isHidden=r,a.onChange=o,a.visible=s,t.exports=a},{}],149:[function(e,t,n){var i=e("../utils/rect"),r=(e("../utils/util"),function(e){this._dimensions=e.dimensions,this._container=e.container,this._text=e.text,this._urls=e.urls,this._page=this._createPage(),this._scale=1,this._scalePage(),this._page.appendTo(this._container),this._drawable=$('<div class="drawable"></div>'),this._eventable=$('<div class="eventable"></div>')});r.prototype={_createPage:function(){var e=this;return $(['<div class="pf w0 h0">','<img class="cover page-bg" alt="" src="'+this._urls.url+'">',"</div>"].join("")).click(function(){window.open(e._urls.link)})},_scalePage:function(){this._page.css({width:this._dimensions.width*this._scale,height:this._dimensions.height*this._scale,margin:this._dimensions.margin*this._scale+"px auto"})},setUrls:function(e){},updateUrls:function(e){},hasAccess:function(){return!0},hasText:function(){return!1},fullyLoaded:function(){return!0},load:function(e){e()},scale:function(e){this._scale!=e&&(this._scale=e,this._scalePage())},rotateBy:function(e){var t=this;this._deg=(this._deg||0)+Math.floor(e),this._page.css({transition:"all .2s ease",transform:"rotate("+this._deg+"deg)"}),setTimeout(function(){t._page.css("transition","none")},200)},updateVisible:function(){var e=this._container[0].getBoundingClientRect(),t=this._page[0].getBoundingClientRect();this._visible=i.prototype.intersects.call(e,t),this._page.toggleClass("open",this._visible)},isVisible:function(){return this._visible},getElem:function(){return this._page},getWidth:function(){return this._dimensions.width},getHeight:function(){return this._dimensions.height},getMargin:function(){return this._dimensions.margin},getScale:function(){return this._scale},getZoom:function(){return this._dimensions.zoom},getNormRect:function(){var e=this._page[0].getBoundingClientRect();return new i(e.left,e.top,this._dimensions.width,this._dimensions.height)},getDrawable:function(){return this._drawable},getEventable:function(){return this._eventable},hasTransparentText:function(){return!1},onLoaded:function(e){e()},destroy:function(){this._page.remove()}},t.exports=r},{"../utils/rect":142,"../utils/util":147}],150:[function(e,t,n){function i(e){function t(e){1==++d&&$(l).trigger("loading-start")}function n(e,t){t&&!h[e]&&(++u,h[e]=!0,$(l).trigger("page-loaded",[e])),0==--d&&$(l).trigger("loading-stop")}function i(i,r,o){t(i),e[i].load(function(){n(i,!0),r&&r()},function(){n(i,!1),o&&o()})}function r(t,n){for(var r=0,o=!1,s=0;s<e.length;s++)i(s,function(){++r==e.length&&t&&t()},function(){o||(o=!0,n&&n())})}function o(){for(var t=0;t<e.length;t++)e[t].isVisible()&&i(t)}function s(t,n){f=!1,n=n||p;for(var r=Math.min(e.length,1+2*n),o=[t],s=0,a=1;o.length<r;a++){var c=t-a,l=t+a;c>=0&&o.push(c),l<e.length&&o.push(l)}!function(){if(!(f||s>=r)){var e=arguments.callee,t=o[s];i(t,function(){++s,e()})}}()}function a(){f=!0}function c(){return u}var l={},u=0,d=0,h={},f=!1,p=2;return l.loadAll=r,l.loadVisible=o,l.preloadPages=s,l.stopPreloading=a,l.getLoadedCnt=c,l}t.exports=i},{}],151:[function(e,t,n){function i(e){this._visible=!1,this._data=e,this._elem=this._createElem(),this._loader=this._createLoader(),this._img=this._elem.find("img.full").contextmenu(!1),this._tmb=this._elem.find("img.thumb").contextmenu(!1),this._tr=new o(this._elem[0],{viewport:this._data.container[0].getBoundingClientRect(),scale:this.getScale()}),this._init()}var r=(e("../utils/util"),e("../utils/rect")),o=e("../utils/transformable");i.prototype={_init:function(){var e=this;0==this._data.index?this._img.load(function(){e._tmb[0].src=e._data.thumb}):this._tmb[0].src=this._data.thumb},_createElem:function(){return $('<div class="page">\n        <img class="bg thumb">\n        <img class="bg full">\n        <div class="drawable"></div>\n        <div class="eventable"></div>\n      </div>').css({width:this._data.dimensions.width,height:this._data.dimensions.height}).appendTo(this._data.container)},_createLoader:function(){return $('<div class="loader">\n        <div class="loader-inner ball-pulse">\n          <div></div>\n          <div></div>\n          <div></div>\n        </div>\n      </div>').appendTo(this._data.container)},_show:function(){var e=this;this._data.full&&this._data.full!=this._img[0].src&&(this._img.load(function(){return e._loader.remove()}),this._loader[0].style.display="block",this._img[0].src=this._data.full),this._img[0].style.display="block"},_hide:function(){this._img[0].style.display="none"},setUrls:function(e){this._data.full=this._data.full||e.full,this._visible&&this._show()},reset:function(){this._tr.reset(this.getScale())},resize:function(){this._tr.resize(this._data.container[0].getBoundingClientRect())},updateVisible:function(e){(this._visible=e)?this._show():this._hide()},getElem:function(){return this._elem},getWidth:function(){return this._data.dimensions.width/this._data.dimensions.zoom},getHeight:function(){return this._data.dimensions.height/this._data.dimensions.zoom},getScale:function(){return this._data.container.width()/this._data.dimensions.width},getZoom:function(){return this._data.dimensions.zoom},getNormRect:function(){var e=this._elem[0].getBoundingClientRect();return new r(e.left,e.top,this.getWidth(),this.getHeight())},getDrawable:function(){return this._elem.find(".drawable")},getEventable:function(){return this._elem.find(".eventable")},hasText:function(){return!0},hasTransparentText:function(){return!0},get hammer(){return this._tr.hammer}},t.exports=i},{"../utils/rect":142,"../utils/transformable":146,"../utils/util":147}],152:[function(e,t,n){function i(){return/iOS/i.test(I.platform)?500:0}function r(e){z||(z=!0,requestAnimationFrame(function(){e(),z=!1}))}function o(e){H=e}function s(e,t){V[e]=t}function a(){var e=u();q.forEach(function(t,n){t.updateVisible(Math.abs(n-e)<2)})}function c(){var e={translate:{x:H,y:0}};B[0].style.transform=Y.getCssTransform(e,!0),ee()}function l(){W.forEach(function(e,t){e[0].style.transform=Y.getCssTransform({translate:{x:V[t],y:0}})})}function u(){return-H/A()}function d(e){L||(o(-e*A()),r(c),f("slide",e+1))}function h(e){return Math.min(q.length-1,Math.max(0,e))}function f(e,t){M&&(t?$(N).trigger(e,[t]):$(N).trigger(e))}function p(e){e.panOutX&&!L&&(o(-O*A()+e.panOutX),r(c))}function m(e){var t=0,n=u();if(n!=O&&Math.abs(e.velocityX)>Q)t=h(e.velocityX<0?O+1:O-1);else{var i=1/0;V.forEach(function(e,n){var r=Math.abs(-e-H);n==O&&(r+=.4*A()),r<i&&(t=n,i=r)}),t=Math.max(t,O-1),t=Math.min(t,O+1)}x(t)}function g(){q[O].hammer.off("pan",p),q[O].hammer.off("panend pancancel",m),q[O].hammer.on("pan",p),q[O].hammer.on("panend pancancel",m)}function v(){R=new Hammer.Manager(D[0]),R.add(new Hammer.Tap({event:"singletap"}));var e=R.get("singletap"),t=q[O].hammer.get("doubletap");e.requireFailure(t),g(),$(N).on("page-changed",function(){e.dropRequireFailure(t),t=q[O].hammer.get("doubletap"),e.requireFailure(t),g()})}function w(e){for(var t=$('<div class="page-container"></div>');e--;)W.push(t.clone().appendTo(B))}function b(){W.forEach(function(e,t){s(t,t*A())}),l()}function y(e){w(e.total_pages),b();for(var t=200/72,n=0;n<e.total_pages;n++){var i=e.sizes[n]||e.sizes[0];q.push(new P({index:n,full:e[F][n],thumb:e.yield_thumb(n),container:W[n],dimensions:{width:i[0],height:i[1],zoom:t}}))}x(0),v(),M=!0,f("initialized")}function k(e){q.forEach(function(t,n){t.setUrls({full:e[F][n]})}),a()}function x(e){if(!L){var t=q[O],n=q[O=h(e)];L=n!=t,U=!0,B.css("transition","transform "+K+"ms ease-out"),o(-e*A()),c(),setTimeout(function(){t&&L&&t.reset(),B.css("transition","none"),L=U=!1,f("page-changed",O+1)},K)}}function C(e){M?e():$(N).one("initialized",e)}function A(){return Z*J}function T(){var e=D.width();e!=Z&&(Z=e,o(-O*A()),c(),b(),q.forEach(function(e){return e.resize()}))}function E(e){D=$('<div class="viewer-inner"></div>').appendTo(e),B=$('<div class="sheet"></div>').appendTo(D),Z=D.width(),$(window).on("resize orientationchange",_.debounce(T,G))}function j(e){e=parseInt(e),isNaN(e)||(e=h(e),x(e))}function S(e){return q[e-1]}function X(e){for(var t=0;t<q.length;t++)if(!1===e(t+1,q[t]))return}var I=(e("../utils/util"),e("../utils/browser"),e("../utils/mobile_detect")),Y=e("../utils/transform_helper"),P=e("./mobile_page"),R=null,N=null,O=0,D=null,F="png",M=void 0,L=!1,U=!1,z=!1,B=null,H=0,q=[],W=[],V=[],J=1.02,Q=.4,K=350,G=i(),Z=screen.width,ee=_.debounce(a,100);N={init:E,onInit:C,setPreviewData:y,setFullData:k,getPageObj:S,eachPage:X,get initialized(){return M},get elem(){return D},get pages(){return q},get numPages(){return q.length},get curIndex(){return O+1},set curIndex(e){return j(e-1)},get slideIndex(){return u()+1},set slideIndex(e){return d(e-1)},get curPage(){return q[O]},get hammer(){return R}},window.viewer=N,t.exports=N},{"../utils/browser":135,"../utils/mobile_detect":139,"../utils/transform_helper":145,"../utils/util":147,"./mobile_page":151}],153:[function(e,t,n){var i=e("../utils/rect"),r=e("../utils/util"),o=e("../utils/browser"),s=e("promise-retry"),a={minTimeout:4e3,retries:2},c=function(e){this._dimensions=e.dimensions,this._container=e.container,this._text=e.text,this._urls=e.urls,this._init()};c.prototype={_init:function(){this._page=this._createPlaceholder(),this._bgLoaded=!1,this._catchevt=null,this._drawable=null,this._eventable=null,this._content=null,this._loading=!1,this._loaded=!1,this._jqxhr=null,this._scale=1,this._scalePage(),this._page.appendTo(this._container)},_createPlaceholder:function(){return $('<div class="pf w0 h0"></div>')},_setThumb:function(){var e=this;s(function(t){return new Promise(function(t,n){return e._urls.text?t():(e._page.find("img.bt").remove(),void $('<img class="bt" alt="" src="'+e._urls.thumb+'">').on("dragstart",!1).one("load",t).one("error",n).prependTo(e._page))}).catch(t)},a).catch(_.noop)},_setImageBg:function(){var e=this;s(function(t){return new Promise(function(t,n){e._content.find("img.page-bg").remove(),$('<img class="bf page-bg" alt="" src="'+e._urls.bg+'">').on("dragstart",!1).one("load",t).one("error",n).prependTo(e._content)}).then(function(){e._bgLoaded=!0}).catch(t)},a).catch(_.noop)},_setObjectBg:function(){var e=this;s(function(t,n){return new Promise(function(t,n){e._content.find("object.page-bg").remove();var i=$('<object class="bf page-bg" data="'+e._urls.bg+'"></object>').attr("type","image/svg+xml").on("dragstart",!1).prependTo(e._content);i[0].addEventListener("load",t),i[0].addEventListener("error",n)}).then(function(){e._bgLoaded=!0}).catch(t)},a).catch(_.noop)},_setBackground:function(){this._urls&&(this._page.find("img.bt").remove(),/chrome|safari/.test(o.name)?this._setObjectBg():this._setImageBg())},_scalePage:function(){if(this._page.css({width:this._dimensions.width*this._scale,height:this._dimensions.height*this._scale,margin:this._dimensions.margin*this._scale+"px auto"}),this._content){var e=this._scale/this._dimensions.zoom;this._content.css("transform","scale("+e.toFixed(5)+")")}},_createPage:function(e){this._content=$(e).find(".pc"),this._content.find("a").each(function(){var e=$(this),t=e.attr("href");/^http(s)?:\/\//.test(t)||e.attr("href","http://"+t.replace(/^\/+/,"")),e.text()||e.attr("aria-hidden","true"),e.attr("target","_blank")}),this._catchevt=$('<div class="bf"></div>'),this._drawable=$('<div class="drawable"></div>'),this._eventable=$('<div class="eventable"></div>'),this._content.prepend(this._drawable),this._content.prepend(this._catchevt),this._content.append(this._eventable),this._content.appendTo(this._page),this._scalePage(),this._setBackground()},_handleLoadSuccess:function(){this._jqxhr=null,this._loaded=!0,this._loading=!1,$(this).trigger("loaded")},_loadPage:function(){var e=this;this._text?(this._createPage(this._text),this._handleLoadSuccess()):this._urls.text?s(function(t){return new Promise(function(t,n){e._jqxhr=$.ajax({url:e._urls.text,dataType:"text",success:t,error:n})}).then(function(t){e._loading&&(e._createPage(t),e._handleLoadSuccess())}).catch(function(n){e._loading&&(/^4\d{2}$/.test(n.status)||t())})},a).catch(function(){e._loading=!1}):this._urls.thumb&&(this._setThumb(),this._handleLoadSuccess())},setUrls:function(e){!this._urls.text&&e.text&&(this._page.find("img").off("error"),this._jqxhr&&this._jqxhr.abort(),this._loading=!1,this._loaded=!1,this._jqxhr=null,
this._urls=e)},updateUrls:function(e){this._urls=e},hasAccess:function(){return!!this._urls.text},hasText:function(){return!!this._content},fullyLoaded:function(){return!this.hasAccess()||this._bgLoaded&&this.hasText()},load:function(e,t){this.onLoaded(e),this._loaded||this._loading||(this._loading=!0,this._loadPage())},scale:function(e){this._scale!=e&&(this._scale=e,this._scalePage())},rotateBy:function(e){var t=this;this._deg=(this._deg||0)+Math.floor(e),this._page.css({transition:"all .2s ease",transform:"rotate("+this._deg+"deg)"}),setTimeout(function(){t._page.css("transition","none")},200)},updateVisible:function(){var e=this._container[0].getBoundingClientRect(),t=this._page[0].getBoundingClientRect();this._visible=i.prototype.intersects.call(e,t),this._page.toggleClass("open",this._visible)},isVisible:function(){return this._visible},getElem:function(){return this._page},getWidth:function(){return this._dimensions.width},getHeight:function(){return this._dimensions.height},getMargin:function(){return this._dimensions.margin},getScale:function(){return this._scale},getZoom:function(){return this._dimensions.zoom},getNormRect:function(){var e=this._page[0].getBoundingClientRect();return new i(e.left,e.top,this._dimensions.width,this._dimensions.height)},getDrawable:function(){return this._drawable},getEventable:function(){return this._eventable},hasTransparentText:function(){return r.hasTransparentText(this._page.find(".t"))},onLoaded:function(e){e=e||function(){},this._loaded&&e(),$(this).on("loaded",e)},destroy:function(){this._page.remove()}},t.exports=c},{"../utils/browser":135,"../utils/rect":142,"../utils/util":147,"promise-retry":40}],154:[function(e,t,n){var i=e("../utils/util"),r=e("../utils/rect"),o=e("../utils/number"),s=e("./pdfjs_sls"),a=4,c=window.devicePixelRatio,l=function(e){var t=e.page.getViewport(1);this._index=e.index,this._dimensions={height:t.height,width:t.width,margin:e.margin},this._container=e.container,this._pgObj=e.page,this._init()};l.prototype={_init:function(){this._scale=1,this._dirty=!1,this._loaded=!1,this._loading=!1,this._page=$('<div class="pf pdfjs-page"></div>'),this._background=$("<div></div>").appendTo(this._page),this._drawable=$('<div class="drawable"></div>').appendTo(this._page),this._text=$('<div class="textLayer"></div>').appendTo(this._page),this._annots=$('<div class="annotationLayer"></div>').appendTo(this._page),this._eventable=$('<div class="eventable"></div>').appendTo(this._page),this._page.appendTo(this._container),this._scalePage(),this.updateVisible()},_rescaleBg:function(){var e=this._pgObj.getViewport(this._scale),t=parseFloat(this._background.attr("width"));this._background.css({transform:"scale("+e.width*c/t+")","transform-origin":"0 0"})},_renderCanvas:function(){var e=this,t=this._pgObj.getViewport(this._scale),n=document.createElement("canvas"),i=o.approximateFraction(c),r=o.approximateFraction(c);return n.width=o.roundToDivide(t.width*c,i[0]),n.height=o.roundToDivide(t.height*c,r[0]),$(n).hide().css({position:"absolute",width:o.roundToDivide(t.width,i[1]),height:o.roundToDivide(t.height,i[1])}).prependTo(this._page),this._pgObj.render({canvasContext:n.getContext("2d"),transform:[c,0,0,c,0,0],viewport:t}).then(function(){e._background.replaceWith(n),e._background=$(n).show()})},_renderText:function(){var e=this;if(this._text.attr("rendered"))return this._text.css("transform","scale("+this._scale/a+")"),Promise.resolve();var t=this,n=this._pgObj.getViewport(a);return this._text.css({width:n.width,height:n.height,transform:"scale("+this._scale/a+")","transform-origin":"0 0"}),this._pgObj.getTextContent({normalizeWhitespace:!0}).then(function(i){return e._text.attr("rendered",""),PDFJS.renderTextLayer({textContent:i,viewport:n,container:t._text[0]})})},_renderAnnots:function(){var e=this;return this._pgObj.getAnnotations({intent:"display"}).then(function(t){var n=e._pgObj.getViewport(a).clone({dontFlip:!0}),i={annotations:t,viewport:n,page:e._pgObj,linkService:s};e._annots.attr("rendered")?(e._annots.css("transform","scale("+e._scale/a+")"),i.div=e._annots[0],PDFJS.AnnotationLayer.update(i)):t.length&&(e._annots.css({transform:"scale("+e._scale/a+")","transform-origin":"0 0"}),e._page.append(e._annots),i.div=e._annots[0],PDFJS.AnnotationLayer.render(i),e._annots.attr("rendered","")),e._annots.find("a").attr("target","_blank")}),Promise.resolve()},_skipRender:function(){return!this._loaded||(!this._visible||(!this._dirty||void 0))},_render:function(e){if(!e&&this._skipRender())return Promise.resolve();this._dirty=!1;var t=this,n=i.timer.tic();return Promise.all([this._renderCanvas(),this._renderText(),this._renderAnnots()]).finally(function(){i.log(sprintf("render page (%s): %s ms",t._index,i.timer.toc(n)))})},_scalePage:function(){this._dirty=!0,this._page.css({width:this._dimensions.width*this._scale,height:this._dimensions.height*this._scale,margin:this._dimensions.margin*this._scale+"px auto"}),this._drawable.add(this._eventable).css({transform:"scale("+this._scale+")","transform-origin":"0 0"}),this._rescaleBg(),this._render()},hasAccess:function(){return!0},hasText:function(){return this._loaded},fullyLoaded:function(){return this._loaded},load:function(e,t){var n=this;this.onLoaded(e),this._loaded||this._loading||(this._loading=!0,this._render(!0).then(function(){n._loaded=!0,n._loading=!1,$(n).trigger("loaded")}))},scale:function(e){this._scale!=e&&(this._scale=e,this._scalePage())},rotateBy:function(e){var t=this;this._deg=(this._deg||0)+Math.floor(e),this._page.css({transition:"all .2s ease",transform:"rotate("+this._deg+"deg)"}),setTimeout(function(){t._page.css("transition","none")},200)},updateVisible:function(){var e=this._container[0].getBoundingClientRect(),t=this._page[0].getBoundingClientRect();this._visible=r.prototype.intersects.call(e,t),this._page.toggleClass("open",this._visible),this._render()},isVisible:function(){return this._visible},getElem:function(){return this._page},getWidth:function(){return this._dimensions.width},getHeight:function(){return this._dimensions.height},getMargin:function(){return this._dimensions.margin},getZoom:function(){return 1},getScale:function(){return this._scale},getNormRect:function(){var e=this._page[0].getBoundingClientRect();return new r(e.left,e.top,this._dimensions.width,this._dimensions.height)},getDrawable:function(){return this._drawable},getEventable:function(){return this._eventable},hasTransparentText:function(){return!0},onLoaded:function(e){this._loaded&&e(),$(this).on("loaded",e)},destroy:function(){this._page.remove()}},t.exports=l},{"../utils/number":140,"../utils/rect":142,"../utils/util":147,"./pdfjs_sls":155}],155:[function(e,t,n){t.exports={get page(){return 0},set page(e){},get rotation(){return 0},set rotation(e){},navigateTo:function(e){},getDestinationHash:function(e){return"#"},getAnchorUrl:function(e){return"#"},setHash:function(e){},executeNamedAction:function(e){},onFileAttachmentAnnotation:function(){},cachePageRef:function(e,t){}}},{}],156:[function(e,t,n){function i(e,t){ee&&(t?$(Q).trigger(e,[t]):$(Q).trigger(e))}function r(){G=q(K),$(G).on({"page-loaded.viewer":function(e,t){G.getLoadedCnt()>=K.length&&se.off("scroll.loader"),i("page-loaded",t+1)},"loading-start.viewer":function(){i("loading-start")},"loading-stop.viewer":function(){i("loading-stop")}})}function o(e){return Math.min(K.length-1e-9,Math.max(0,e))}function s(){var e=parseInt(se.css("padding-left")),t=parseInt(se.css("padding-right"));return se[0].getBoundingClientRect().width-e-t}function a(){return 0}function c(){return se.height()}function l(){return c()/(K[re].getHeight()+oe)/ie}function u(){var e,t=0,n=(se.scrollTop()-a())/ie;for(e=0;e<K.length&&(t+=K[e].getHeight()+oe,!(t>n));e++);var i=(t-n)/(K[e].getHeight()+oe);return e+(1-i)}function d(e){var t,n=e>0?Math.floor(e):Math.ceil(e),i=e-n,r=0;for(t=0;t<n;t++)r+=K[t].getHeight()+oe;return r+=i*(K[t].getHeight()+oe),Math.round(r*ie)+a()}function h(e,t){var n=d(e);t&&(n+=oe/2),se.scrollTop(n),m(),i("scroll")}function f(){return o(u()+l()/2)}function p(){var e=Math.floor(f());re!=e&&(re=e,i("page-changed",e+1)),i("scroll")}function m(){G.stopPreloading(),G.loadVisible()}function g(){G.preloadPages(Math.floor(f()))}function v(){se[0].style.display="block"}function w(){v(),K.forEach(function(e){e.updateVisible()})}function b(){y(),se.on("scroll.update",_.throttle(p,100)),se.on("scroll.render",_.debounce(w,100)),se.on("scroll.loader",_.debounce(m,200)),se.on("scroll.loader",_.debounce(g,1e3))}function y(){se.off("scroll.update"),se.off("scroll.render"),se.off("scroll.loader")}function k(e){return A(e/K[0].getWidth())}function x(e,t){e?(clearInterval(te),te=setInterval(t,500),t()):t()}function C(){clearInterval(te),te=null}function A(e){var t=u();e<=0&&(e=1),ie=e,K.forEach(function(t){t.scale(e)}),h(t),v(),i("scale")}function T(e,t){t=parseInt(t)||re,K[t].rotateBy(e),v(),i("rotate")}function E(e){A(ie*e)}function j(e){x(e,function(){A(s()/K[re].getWidth())})}function S(){var e=s()/K[re].getWidth();e<ie&&j()}function X(e){x(e,function(){var e=s()/K[re].getWidth(),t=c()/(K[re].getHeight()+oe);A(Math.min(e,t))})}function I(e){ee?e():$(Q).one("initialized",e)}function Y(e){return e.text&&e.text.length?new Promise(function(t,n){$.ajax({url:e.text[0],dataType:"text",success:t,error:function(e){(trackJs||window).console.log(sprintf("first page failed, status: %s, statusText: %s, readyState: %s",e.status,e.statusText,e.readyState)),n({error:"load_html_fail"})}})}):Promise.reject({error:"load_html_fail"})}function P(e){return e.stylesheet_linked?Promise.resolve():e.stylesheet?new Promise(function(t,n){B.loadCss(e.stylesheet,t,function(){n({error:"load_html_fail"})})}):Promise.reject({error:"load_html_fail"})}function R(){"fit-width"==ne?j():"fit-page"==ne?X():k(Math.min(ne,s())),se.scrollTop(0)}function N(){for(;K.length;)K.pop().destroy()}function O(e,t,n,i){var r=t.size||t.sizes[n],o={container:se,dimensions:{zoom:t.zoom,height:r[1],width:r[0],margin:oe},urls:{thumb:e.yield_thumb(n),text:e.text[n],bg:e.background[n]}};return i&&(o.text=i),new H(o)}function D(e,t){var n=t.size||t.sizes[0];return new V({urls:e,container:se,dimensions:{zoom:t.zoom,height:n[1],width:n[0],margin:oe}})}function F(e){return Promise.all([Y(e),P(e)]).then(function(t){var n=t[0],o=$(n).data("pages"),s=o.length;r(),N(),e.cover&&K.push(D(e.cover,o)),K.push(O(e,o,0,n));for(var a=1;a<s;a++)K.push(O(e,o,a));e.back&&K.push(D(e.back,o)),R(),b(),g(),w(),ee=!0,i("initialized")})}function M(e){return J().then(function(){return PDFJS.getDocument({url:e.viewer_pdf,withCredentials:!0}).then(function(e){e.getMetadata().then(function(t){B.log(B.pdfjsInfo(e,t))});for(var t=[],n=Promise.resolve(),o=1,s=e.numPages;o<=s;o++)n=n.then(e.getPage.bind(e,o)).then(function(e){t.push(e)});n.then(function(){r(),N(),t.forEach(function(e,t){K.push(new W({index:t+1,container:se,margin:oe,page:e}))}),R(),b(),g(),w(),ee=!0,i("initialized")})})})}function L(e){I(function(){K.slice(e.cover?1:0).forEach(function(t,n){t.updateUrls({thumb:e.yield_thumb(n),text:e.text[n],bg:e.background[n]})})})}function U(e){return U.called?void L(e):(U.called=!0,void I(function(){K.slice(e.cover?1:0).forEach(function(t,n){t.setUrls({thumb:e.yield_thumb(n),text:e.text[n],bg:e.background[n]})}),r(),b(),g(),w()}))}function z(e){se=e,Z=se.find("#journal-banner"),advert=se.find("#advert-leaderboard"),se.on("click",function(e){se.is(e.target)&&i("bg-click")}),r(),K=[new H({container:se,text:"<div></div>",dimensions:{width:ne,height:1200,margin:12,zoom:1}})],R()}var B=e("../utils/util"),H=e("./page"),q=e("./loader"),W=e("./pdfjs_page"),V=e("./cover_page"),J=e("../includes/load_pdfjs"),Q={},K=[],G=null,Z=null,ee=!1,te=null,ne=900,ie=1,re=0,oe=8,se=null;Q.init=z,Q.onInit=I,Q.setPreviewData=F,Q.setFullData=U,Q.setLocalData=M,Q.fitPage=function(e){if(ee)return X(e)},Q.shrinkToWidth=function(){if(ee)return S()},Q.fitWidth=function(e){if(ee)return j(e)},Q.getElem=function(){if(ee)return se},Q.getPage=function(){return ee?re+1:0},Q.getPageObj=function(e){if(ee)return K[e-1]},Q.eachPage=function(e){if(ee)for(var t=0;t<K.length;t++)if(!1===e(t+1,K[t]))return},Q.eachVisiblePage=function(e){if(ee)for(var t=0;t<K.length;t++)if(K[t].isVisible()&&!1===e(t+1,K[t]))return},Q.gotoPage=function(e){if(ee&&(e=parseFloat(e),!isNaN(e)))return h(o(e-1),!0)},Q.loadAll=function(e,t){ee&&G.loadAll(e,t)},Q.numPages=function(){return ee?K.length:0},Q.numVisiblePages=function(){return ee?l():0},Q.scaleBy=function(e){if(ee)return C(),E(e)},Q.scaleTo=function(e){if(ee)return C(),A(e)},Q.rotatePageBy=function(e,t){if(ee)return T(e,t)},window.viewer=Q,t.exports=Q},{"../includes/load_pdfjs":109,"../utils/util":147,"./cover_page":149,"./loader":150,"./page":153,"./pdfjs_page":154}],157:[function(e,t,n){function i(t,n,i,r,o){return{restrict:"A",link:function(s,a,c){function l(){a.find("iframe").length&&(a.data("iframe-width")||a.data("iframe-width",a.find("iframe").width()),a.toggleClass("hidden",a.width()<a.data("iframe-width")))}t.parent&&r.onInit(function(r){if("wiley"==r.publisher){var s=parseUri(t.parent).host;n.production()&&"qae.onlinelibrary.wiley.com"!=s||(googletag=e("../core/includes/gpt"),$(i.all).on("ad_data",function(e,t){var n=t.data;if(n){var i=["",n.network_id,n.subject_id,n.journal_id].join("/");googletag.cmd.push(function(){var e=googletag.sizeMapping().addSize([768,100],[728,90]).addSize([340,100],[300,50]).build();googletag.defineSlot(i,[[728,90],[300,50]],"advert-leaderboard").defineSizeMapping(e).setCollapseEmptyDiv(!0).addService(googletag.pubads()),_.each(n.targeting,function(e,t){googletag.pubads().setTargeting(t,e)}),googletag.pubads().enableSingleRequest(),googletag.enableServices(),googletag.display("advert-leaderboard"),$(o).on("scale",l),$(window).on("resize",_.debounce(l,100)),l()})}}),window.parent.postMessage({type:"get_ad_data"},"*"))}})}}}i.$inject=["endpoint","environment","receiver","article","viewer"],angular.module("reader").directive("advertLeaderboard",i)},{"../core/includes/gpt":106}],158:[function(e,t,n){function i(e,t,n,i,r,o,s,a,c,l,u){function d(e){return _.max(e,function(e){return e[1]})[1]}function h(e){var t=e.page_start+1,n=o.getPageObj(t);if(n){var i=n.getHeight(),r=(i-d(e.rects))/i;return t+r}return 0}function f(e){return new Date(e.created)}function p(e){return new Date(e.modified||e.created)}function m(){if(!r.get().doi)return"notes";var e=s.getKey(r.get().meta);return"supplement"==r.getType()&&(e+=sprintf("-supplement(%s)",r.get().index+1)),e+"-notes"}function g(){return $(document.body).hasClass("annotations-open")}function v(){g()||(a.sidepanel("notes"),$(document.body).addClass("annotations-open"),n.$emit("annotations-opened"))}function w(){g()&&($(document.body).removeClass("annotations-open"),n.$emit("annotations-closed"))}function b(){g()?w():v()}return n.$on("toggle-annotations",b),n.$on("open-annotations",v),n.$on("close-annotations",w),n.$on("checkout-opened",w),n.$on("info-opened",w),{restrict:"E",link:function(n,r){o.onInit(function(){n.annots=c.listArr(),n.predicates={position:function(e){return-h(e)},modified:p,created:f},n.directions={descending:!0,ascending:!1},n.sortPredicate="position",n.sortDirection="descending",n.annotationCreated=f,n.annotationModified=p,n.toggleAnnots=b,n.downloadAnnots=function(){var e={type:"text/csv;charset=UTF-8"},i=_.map(n.annots,function(e){return{Text:t("breaksToSpaces")(e.text),Note:t("breaksToSpaces")(e.note),Created:f(e).toLocaleString(),Modified:p(e).toLocaleString()}}),r=new Blob([Papa.unparse(i)],e);saveAs(r,m()+".csv"),a.exportNotes()},n.scrollTo=function(e){var t=h(e),n=o.numVisiblePages();o.gotoPage(t-.2*n),o.shrinkToWidth(),i.update()},n.delete=function(e,t){e.stopPropagation(),l.remove(t.id)},$(c).on("changed",function(){e(function(){n.annots=c.listArr()})}),r.on(u.transition_end,function(){g()&&o.shrinkToWidth(),i.update()})})}}}i.$inject=["$timeout","$filter","$rootScope","popover","article","viewer","exporter","tracker","annotationsModel","annotationsController","CONST"],angular.module("reader").directive("annotations",i)},{}],159:[function(e,t,n){function i(e,t,n,i,r,o,s){return{restrict:"E",link:function(a,c){function l(){e(function(){a.loaded=!0})}var u=null,d=c.find("iframe");a.accountPage=function(){window.open(n.web+"/account","_blank")},a.onLogOut=function(){s.clear(),i.signOut(function(){n.parent?window.parent.postMessage({type:"sign_out",url:n.parent},"*"):location.reload()})},a.loaded=!1,d.on("load",l),$(r.readcube).on("app:new",l).on("app:linkout",function(){o.linkout("library")}),t.$on("appnav-open",function(){$(document.body).addClass("appnav-open"),u||(u=sprintf("%s/#!/navigation",n.app),d[0].contentWindow.location.replace(u))}),t.$on("appnav-close",function(){$(document.body).removeClass("appnav-open")})}}}i.$inject=["$timeout","$rootScope","endpoint","user","receiver","tracker","trackId"],angular.module("reader").directive("appnav",i)},{}],160:[function(e,t,n){function i(){return{restrict:"E",controller:"ArticleCtrl",templateUrl:"article.html"}}angular.module("reader").directive("article",i)},{}],161:[function(e,t,n){function i(e,t,n,i,r,o,s,a,c,l,u,d,h,f,p,m,g){return{restrict:"A",link:function(v){function w(){s.fetch().then(function(){a.item.get().then(function(){a.annots.list().then(function(e){_.some(e.annotations,function(e){return 0==e.page_start})||y()},y)},y)},y)}function b(e){var t="annotation-intro-tip";return r.hasTransparentText(e)&&(t+=" transparent"),t}function y(){var t=g.create("annotations");if(!t)return!1;t.compile("intro_tips/annotations.html");var n=1/8,i=32,o=c.getPageObj(1);return o.onLoaded(function(){var s=o.getElem(),a=s.text().split(" "),c=Math.floor(a.length*n),l=Math.floor(a.length*n)+i;if(c>=0&&l<a.length){var u=p.deserialize({text:a.slice(c,l).join(" "),prefix:""},{container:s}),d=r.getElems(u),h=o.getScale(),f=o.getZoom(),g=o.getNormRect(),v=r.getBoundingRect(d),_=new m(v.left,v.top,v.width,v.height);_.translate(-g.left,-g.top),_.scale(f/h,f/h);var w=$(e.get("intro_tips/pulse.html"));w.css({top:_.top,left:_.left+_.width/2,"transform-origin":"0 0",transform:"scale("+f/h+")"}).appendTo(o.getEventable()),w.one("mouseenter",function(){w.addClass("stop"),d.addClass(b(d)),t.show(w,"up")}),$(t).on("close",function(){d.removeClass(b(d)),w.remove()})}}),!0}function k(e){var t=-1,n=e.commonAncestorContainer;return c.eachPage(function(e,i){if($.contains(i.getElem()[0],n))return t=e,!1}),t}function x(e){return k(e)!=-1}n.scibite&&d.init()||(f.init(),o.onInit(function(){o.get().sync_item_sponsored||"ieee"!=o.get().publisher&&c.onInit(function(){var e=l(c.getElem(),x);$(new u(e)).on("highlight",function(t,n){var i=e.getRangeAndClear();f.addHighlight(i,k(i),n)}).on("add-note",function(){var t=e.getRangeAndClear();f.addNote(t,k(t),"")}),"article"==o.getType()&&w()})}),$(h).on("merge-shared-prompt",function(e,n){t.show(t.alert({clickOutsideToClose:!0,templateUrl:"dialogs/import_annotations.html",controller:["$scope",function(e){e.close=function(e){t.hide(),e&&n()}}]}))}),$(h).on("not-synced",function(e,t){"item_not_synced"==t.status&&i.notifyAnnotsNotSynced()}))}}}i.$inject=["$templateCache","$mdDialog","$stateParams","toast","util","article","user","sync","viewer","Selection","SelectionToolbar","termiteModel","annotationsModel","annotationsController","rangeSerializer","Rect","introTip"],angular.module("reader").directive("articleAnnotations",i)},{}],162:[function(e,t,n){function i(e,t){var n=t.left+t.right>>1,i=t.top+t.bottom>>1,r=t.right-t.left>>1,o=t.bottom-t.top>>1,s=Math.max(Math.abs(e.x-n)-r,0),a=Math.max(Math.abs(e.y-i)-o,0);return s*s+a*a}function r(e,t,n,r,o,s,a,c,l,u,d,h,f){return{restrict:"A",link:function(p){function m(e){return angular.merge(r.$new(!0),e)}function g(e){var i=e.getData();switch(e.getType()){case"author":return i.affiliations&&(i.affiliations=_.uniq(i.affiliations)),t(n.get("citations/author.html"))(m(i));case"figure":return i.figures.length?t('\n              <div>\n                <div ng-repeat="figure in figures">\n                  <div figure="figure" index="ids[$index]-1"></div>\n                </div>\n              </div>\n            ')(m(i)):null;default:return t('<div references="references" tracking-source="inline_reference"></div>')(m(i))}}function v(e){return e.css({"max-height":.5*s.getElem().height()+"px"})}function w(e){var t=f.create("inline-citations");if(!t)return!1;t.compile("intro_tips/inline_citations.html");var i=e.getElems(),r=e.getPage(),s=r.getScale(),a=r.getZoom(),c=o.getBoundingRect(i),l=r.getNormRect(),d=new h(c.left,c.top,c.width,c.height);d.translate(-l.left,-l.top),d.scale(a/s,a/s);var p=$(n.get("intro_tips/pulse.html"));return p.css({top:d.top,left:d.left+d.width/2,"transform-origin":"0 0",transform:"scale("+a/s+")"}).appendTo(r.getEventable()),p.one("mouseenter",function(){p.addClass("stop"),u.showAll(r),t.show(p,"up")}),$(t).on("close",function(){u.hideAll(r),b(e),p.remove()}),!0}function b(t){function n(){return Math.min(i(x,o.getBoundingRect(p)),i(x,o.getBoundingRect(_)))}function r(){return{placement:"up",content:v(_),anchor:m}}function s(){e(function(){d.open(r()),c.inline(t.getType())})}if(y||"author"==t.getType()||(y=!0,!w(t))){var a=null,l=null,u=500,h=1e3,f=400,p=t.getElems(),m=p.first(),_=g(t);_&&$(t).on("click",function(){clearTimeout(l),s()}).on("mouseenter",function(){k||(a=setTimeout(function(){d.isOpen(m)||(clearTimeout(l),s(),l=setTimeout(function e(){d.isOpen(m)&&(n()>f?d.close(m):(clearTimeout(l),l=setTimeout(e,h)))},h),_.one("click",function(){clearTimeout(l)}))},u))}).on("mouseleave",function(){clearTimeout(a)})}}var y=!1;a.onData(function(e){l.init(e),l.forEach(b),$(l).on("add",function(e,t){b(t)}),s.onInit(function(){$(window).on("keydown.citation-drawer",function(e){e.metaKey||e.ctrlKey||82==e.keyCode&&u.animateAll()}),f.enabled("inline-citations")||$(document).one("mousemove.citation-drawer",function(){$(document).on("mousemove.citation-drawer",function(){u.animateAll()&&$(document).off("mousemove.citation-drawer")})})})});var k=!1,x={x:0,y:0};$(document).on("mousedown",function(){k=!0,$(document).one("mouseup",function(){k=!1})}),$(document).on("mousemove",function(e){x={x:e.pageX,y:e.pageY}})}}}r.$inject=["$timeout","$compile","$templateCache","$rootScope","util","viewer","article","tracker","citationsModel","citationDrawer","popover","Rect","introTip"],angular.module("reader").directive("articleCitations",r)},{}],163:[function(e,t,n){function i(e,t,n,i){return{restrict:"E",replace:!0,controller:"ArticleToolsCtrl",templateUrl:"article_tools.html",link:function(r,o,s){function a(){var e=i.create("article-tools");if(!e)return!1;o.addClass("intro-tip-active"),e.compile("intro_tips/article_tools.html");var n=$(t.get("intro_tips/pulse.html"));return n.css({bottom:34,left:0}),n.appendTo(o),o.one("mouseenter.intro-tips",function(){setTimeout(function(){n.addClass("stop"),n.css({left:15}),e.show(n,"left")},400)}),$(e).on("close",function(){o.removeClass("intro-tip-active"),o.off("mouseenter.intro-tips"),n.remove()}),!0}r.isOpen=!1,r.tooltipVisible=!1;var c=null;r.setOpen=function(t,n){e.cancel(c),c=e(function(){r.isOpen=t},n||0)};var l=null,u=r.$watch("isOpen",function(t){e.cancel(l),t?l=e(function(){r.tooltipVisible=r.isOpen},400):r.tooltipVisible&&(r.tooltipVisible=!1,u())});r.$on("$destroy",function(){e.cancel(l)}),n.onData(a)}}}i.$inject=["$timeout","$templateCache","article","introTip"],angular.module("reader").directive("articleTools",i)},{}],164:[function(e,t,n){function i(){return{restrict:"A",link:function(e,t,n){if(n.bgImage){var i=new Image;i.onload=function(){return t.css("background-image","url("+n.bgImage+")")},i.onerror=function(){return t.addClass("load-failed")},i.src=n.bgImage}}}}angular.module("reader").directive("bgImage",i)},{}],165:[function(e,t,n){function i(){return{restrict:"A",link:function(e,t,n){n&&n.cancelEvent&&t.on(n.cancelEvent,!1)}}}angular.module("reader").directive("cancelEvent",i)},{}],166:[function(e,t,n){function i(e,t,n,i,r,o,s,a,c,l,u,d){function h(){var e=i.merge({doi:o.get().doi,embed:1,html5:1,hide_formats:1,parent_url:location.href,tracking_origin:"web_reader",tracking_publisher:o.get().publisher},i.pickDefined(t,["no_additional_access","tracking_action","purchase_referrer","purchase_site_license","customer_ids"]));return i.referrerHost()&&(e.checkout_referrer=i.referrerHost()),n.sharing&&(e.show_tiers="3"),i.addParams(r.web+"/checkout/new",e)}return{restrict:"E",link:function(t,f){function p(){e(function(){t.loaded=!0})}function m(){return $(document.body).hasClass("checkout-open")}function g(){m()||(w||(w=h(),b[0].contentWindow.location.replace(w)),l.checkout(),$(document.body).addClass("checkout-open"),n.$emit("checkout-opened"))}function v(){m()&&($(document.body).removeClass("checkout-open"),n.$emit("checkout-closed"))}function _(){m()?v():g()}var w=null,b=f.find("iframe");f.on(d.transition_end,function(){m()&&c.shrinkToWidth(),u.update()}),t.loaded=!1,b.on("load",p),$(a.readcube).on("checkout:new",p).on("checkout:success",function(e,t){l.purchase(t),s.checkAccess()}),r.parent&&$(a.readcube).on(["auth:new","auth:success","checkout:new","checkout:login-screen","checkout:register-screen","checkout:auth","checkout:billing-screen","checkout:purchase-screen","checkout:success","checkout:failure"].join(" "),function(e,t){return window.parent.postMessage(t,r.parent)}),$(a.readcube).on("checkout:redirect",function(e,t){i.redirectOrPost(t.url)}),o.onData(function(){s.onExternalCheck(function(){o.hasAccess()||g()})}),$(o).on("access-check",function(){o.hasAccess()&&(n.sharing&&"wiley"==o.get().publisher||v())}),n.$on("toggle-checkout",_),n.$on("open-checkout",g),n.$on("close-checkout",v),n.$on("annotations-opened",v)}}}i.$inject=["$timeout","$stateParams","$rootScope","util","endpoint","article","access","receiver","viewer","tracker","popover","CONST"],angular.module("reader").directive("checkout",i)},{}],167:[function(e,t,n){function i(e,t,n){return{restrict:"E",link:function(i){function r(){n.getMetrics().then(function(t){e(function(){i.metrics=t,t.results&&t.results.length?i.scrollMetrics():i.metrics.finished=!0})},_.noop)}i.metrics=void 0,i.scrollMetrics=function(){if(i.metrics)return!i.metrics.finished&&void(i.metrics.busy||(i.metrics.busy=!0,n.getMetrics({scroll_id:i.metrics.scroll_id}).then(function(t){e(function(){t.results&&t.results.length?(i.metrics.results=i.metrics.results.concat(t.results),i.metrics.scroll_id=t.scroll_id):i.metrics.finished=!0})}).catch(function(){e(function(){i.metrics.finished=!0})}).finally(function(){e(function(){i.metrics.busy=!1})})))},t.$on("cited-by-open",_.once(r))}}}i.$inject=["$timeout","$rootScope","article"],angular.module("reader").directive("citedBy",i)},{}],168:[function(e,t,n){function i(){return{restrict:"A",link:function(e,t,n){new Clipboard(t[0])}}}angular.module("reader").directive("clipboard",i)},{}],169:[function(e,t,n){function i(e,t){return{restrict:"A",replace:!0,scope:{figure:"=",index:"="},templateUrl:"citations/figure.html",link:function(n,i,r){r.inlist||(i=i.find(".view-figure")),i.click(function(){t?window.open(n.figure.url,"_blank"):e(n.index)})}}}i.$inject=["figureViewer","MOBILE"],angular.module("reader").directive("figure",i)},{}],170:[function(e,t,n){function i(e,t){return{restrict:"A",link:function(n,i,r){if(t){var o=i.attr("md-component-id"),s=r.hammerSidenav,a=new Hammer.Manager(i[0],{recognizers:[[Hammer.Swipe,{direction:Hammer.DIRECTION_HORIZONTAL}]]});a.on("swipe"+s,function(){e(o).close()})}}}}i.$inject=["$mdSidenav","MOBILE"],angular.module("reader").directive("hammerSidenav",i)},{}],171:[function(e,t,n){function i(){return{restrict:"A",scope:{loadMore:"&",tresholdPercent:"="},link:function(e,t,n){function i(){var n=(t[0].scrollTop+t[0].offsetHeight)/t[0].scrollHeight*100;(n>r||n>=100)&&!1===e.loadMore()&&(t.off("scroll.infinite"),clearInterval(o))}var r=parseInt(n.tresholdPercent,10)||0;t.on("scroll.infinite",i);var o=setInterval(i,1e3);e.$on("$destroy",function(){clearInterval(o)})}}}angular.module("reader").directive("infiniteScroll",i)},{}],172:[function(e,t,n){function i(e,t){return{restrict:"E",link:function(n,i){function r(){e(function(){n.loaded=!0})}var o=i.find("iframe");n.loaded=!1,$(o).on("load",r),$(t.readcube).on("auth:new",r)}}}i.$inject=["$timeout","receiver"],angular.module("reader").directive("login",i)},{}],173:[function(e,t,n){function i(e,t,n,i,r,o,s,a,c,l){return{restrict:"E",replace:!0,controller:"MenuBarCtrl",templateUrl:"menu_bar.html",link:function(o,s){function l(){var r=c.create("my-library");if(!r)return!1;s.addClass("intro-tip-active"),r.compile("intro_tips/my_library.html",{signedIn:n.signedIn()});var o=$(e.get("intro_tips/pulse.html"));return o.css({bottom:-18,left:60}).appendTo(s),o.one("mouseenter",function(){o.addClass("stop"),o.css({bottom:-4}),r.show(o,"down")}),$(r).on("action",function(e,n){"sign_up"==n?i.showRegister({params:{tracking_action:"intro_tip_signup",tracking_origin:a.trackingOrigin(),promocode:"WRSUMTIP162"},registerAd:"ads/my_library_register.html",successAd:"ads/my_library_success.html"}):"view_library"==n&&window.open(t.app,"_blank")}),$(r).on("close",function(){s.removeClass("intro-tip-active"),o.remove()}),!0}n.fetch().finally(function(){r.onInit(l)})}}}i.$inject=["$templateCache","endpoint","user","userModal","article","access","sync","tracker","introTip","toast"],angular.module("reader").directive("menuBar",i)},{}],174:[function(e,t,n){function i(e,t,n,i,r,o,s){return{restrict:"A",link:function(s,a){function c(e){return angular.merge(i.$new(!0),e,{render_doi:e.doi&&!$('meta[name="citation_doi"]').length,canonical:e.doi&&sprintf("%s/%s",r.reader,e.doi),image:e.yield_thumb&&e.yield_thumb(0)})}o.onData(function(i){"article"==o.getType()&&i.meta&&n(function(){a.append(e(t.get("metadata.html"))(c(i)))})}),o.onInit(function(e){if("supplement"==o.getType()){var t=e.caption?["Supp:",e.caption].join(" "):["Supplement",parseInt(e.index)+1].join(" ");a.append(sprintf("<title>%s</title>",t))}})}}}i.$inject=["$compile","$templateCache","$timeout","$rootScope","endpoint","article","supplement"],angular.module("reader").directive("metadata",i)},{}],175:[function(e,t,n){function i(e){return{restrict:"A",replace:!0,scope:{metrics:"="},templateUrl:"citations/metrics.html",link:function(t,n,i){t.trackLinkout=function(t){e.linkout("cited_by"),t.doi&&i.trackingSource&&e.referral(t.doi,i.trackingSource)}}}}i.$inject=["tracker"],angular.module("reader").directive("metrics",i)},{}],176:[function(e,t,n){function i(e,t,n,i,r,o,s){function a(e){return _.max(e,function(e){return e[1]})[1]}function c(e){var t=e.page_start+1,n=i.getPageObj(t);if(n){var r=n.getHeight(),o=(r-a(e.rects))/r;return t+o}return 0}function l(e){return new Date(e.created)}function u(e){return new Date(e.modified||e.created)}return{restrict:"E",link:function(t,n){i.onInit(function(){t.annots=s.listArr(),t.predicates={position:function(e){return-c(e)},modified:u,created:l},t.directions={descending:!0,ascending:!1},t.sortPredicate="position",t.sortDirection="descending",t.annotationCreated=l,t.annotationModified=u,t.scrollTo=function(e){i.curIndex=e.page_start+1,t.closeSidenav("annotations"),t.closeSidenav("mobile_menu")},$(s).on("changed",function(){e(function(){t.annots=s.listArr()})})})}}}i.$inject=["$timeout","$filter","article","mobileViewer","exporter","tracker","annotationsModel"],angular.module("reader").directive("mobileAnnotations",i)},{}],177:[function(e,t,n){function i(e,t){return{restrict:"E",link:function(n,i){t.init(i),e.onInit(function(e){t.setPreviewData(e)}),e.onAccessCheck(function(n){e.hasAccess()&&t.setFullData(n)})}}}i.$inject=["article","mobileViewer"],angular.module("reader").directive("mobileArticle",i)},{}],178:[function(e,t,n){function i(e,t,n,i){return{restrict:"A",link:function(r){i.init(),$(n).on("merge-shared-prompt",function(t,n){e.show(e.alert({clickOutsideToClose:!0,templateUrl:"dialogs/import_annotations.html",controller:["$scope",function(t){t.close=function(t){e.hide(),
t&&n()}}]}))}),$(n).on("not-synced",function(e,n){"item_not_synced"==n.status&&t.notifyAnnotsNotSynced()})}}}i.$inject=["$mdDialog","toast","annotationsModel","annotationsController"],angular.module("reader").directive("mobileArticleAnnotations",i)},{}],179:[function(e,t,n){function i(e,t){return{restrict:"E",replace:!0,templateUrl:"toolbars/mobile_slider.html",link:function(e,n,i){function r(e){var t=g[0].getBoundingClientRect();return Math.max(0,Math.min(1,(e-t.left)/t.width))}function o(e){return u+e*(d-u)}function s(e){return(e-u)/(d-u)}function a(){f||(f=!0,requestAnimationFrame(function(){var e=100*s(h)+"%";v[0].style.left=e,_[0].style.width=e,f=!1}))}function c(e){p&&(t.slideIndex=o(r(e.srcEvent.pageX)),h=t.slideIndex,a())}function l(){p||(h=t.curIndex,a())}var u,d,h,f,p,m,g=n.find(".slider-track"),v=n.find(".slider-thumb"),_=n.find(".slider-fill");n.contextmenu(!1),t.onInit(function(){u=h=1,d=viewer.numPages});var w=new Hammer.Manager(n[0],{recognizers:[[Hammer.Pan,{pointers:1,threshold:0}]]});w.on("pan",c),$(t).on("page-changed",l),w.on("hammer.input",function(e){e.isFirst&&(p=!0,clearTimeout(m),c(e),n.addClass("active"),$("body").addClass("sliding")),e.isFinal&&(t.curIndex=Math.round(t.slideIndex),m=setTimeout(function(){return $("body").removeClass("sliding")},3e3),n.removeClass("active"),p=!1)})}}}i.$inject=["$timeout","mobileViewer"],angular.module("reader").directive("mobileSlider",i)},{}],180:[function(e,t,n){function i(){return{restrict:"E",replace:!0,controller:"MobileToolbarCtrl",templateUrl:"toolbars/mobile_toolbar.html"}}angular.module("reader").directive("mobileToolbar",i)},{}],181:[function(e,t,n){function i(e){return{restrict:"A",link:function(t,n,i){var r=e(i.onLoad);n.on("load",function(e){t.$apply(function(){r(t,{$event:e})})})}}}i.$inject=["$parse"],angular.module("reader").directive("onLoad",i)},{}],182:[function(e,t,n){function i(e,t){return{restrict:"E",replace:!0,templateUrl:"toolbars/page_info.html",link:function(n,i){function r(){s.val(e.getPage()||1)}function o(){var t=e.numPages()||"?";s.attr("data-num",t.toString().length),a.html(t)}var s=i.find(".idx"),a=i.find(".num");s.on("click",function(){s[0].select()}),s.on("blur",function(){var t=parseInt(s.val().replace(/[^0-9]/g,""));t=Math.min(Math.max(t||1,1),e.numPages()||1),e.gotoPage(t),s.val(t)}),s.on("keydown",function(e){13==e.keyCode&&s.blur(),[46,8,9,27,13].indexOf(e.keyCode)!=-1||(e.ctrlKey||e.metaKey)&&[65,67,88].indexOf(e.keyCode)!=-1||[35,36,37,38,39,40,45].indexOf(e.keyCode)!=-1||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()});var c=null,l=i.closest(".article-container");l.on("mousemove",function(e){var t=2*e.pageX<l.width(),n=l.height()-e.pageY<150,r=!$.contains(i[0],e.target);t&&n&&(clearTimeout(c),c=null,i.addClass("show")),c||!r||s.is(":focus")||(c=setTimeout(function(){i.removeClass("show")},2e3))}),r(),o(),i.addClass("loading"),e.onInit(function(){r(),o(),setTimeout(function(){setInterval(function(){var t=!0;e.eachVisiblePage(function(e,n){if(!n.fullyLoaded())return t=!1}),i.toggleClass("loading",!t)},1e3)},2e3),n.$on("$destroy",function(){clearInterval(loadingCheck)}),$(t).on("auth-begin",function(){i.addClass("authorizing")}),$(t).on("auth-end",function(){i.removeClass("authorizing")}),$(e).on("page-changed",r),$(e).on("scroll",_.throttle(function(){i.addClass("scrolling")},200)),$(e).on("scroll",_.debounce(function(){i.removeClass("scrolling")},1e3))})}}}i.$inject=["viewer","access"],angular.module("reader").directive("pageInfo",i)},{}],183:[function(e,t,n){function i(e,t,n,i){return{restrict:"A",link:function(r){function o(t){e.info("POST MESSAGE:",t),window.parent.postMessage(t,"*")}function s(e){var n=-1,i=e.commonAncestorContainer;return t.eachPage(function(e,t){if($.contains(t.getElem()[0],i))return n=e,!1}),n}function a(e){return s(e)!=-1}t.onInit(function(){var e=n(t.getElem(),a);$(new i(e)).on("marked",function(e,t){o({type:"marked",data:t})})})}}}i.$inject=["$log","viewer","Selection","ResolveToolbar"],angular.module("reader").directive("postSelection",i)},{}],184:[function(e,t,n){function i(e,t,n){return{restrict:"A",link:function(i,r,o){function s(){function e(e){return!!d.length&&(d.is(e.target)||$.contains(d[0],e.target))}function s(e){var t=!1;return h.add(r.find(".info-bar")).each(function(){if(t=t||$(this).is(e.target)||$.contains(this,e.target))return!1}),t}function a(e){if(!f.length)return!1;var t=f.width()-e.pageX<180,n=f.height()-e.pageY<240;return t&&n}function c(e){return e.pageY<60}function l(){$("body").on("mousemove",function(e){(c(e)||a(e))&&r.removeClass(o.readMode)}).on("mousemove",_.debounce(function(t){s(t)||e(t)||r.addClass(o.readMode)},2e3))}function u(){function e(){return setTimeout(function(){return r.addClass(o.readMode)},3e3)}var n=$(".mobile-toolbar .main-bar"),i=e();n.click(function(t){clearTimeout(i),r.removeClass(o.readMode),i=e()}),t.hammer.on("singletap",function(){clearTimeout(i),r.toggleClass(o.readMode),i=e()})}var d=(r.find(".viewer"),r.find(".article-tools")),h=r.find(".article-menu"),f=r.find(".article-container");i.$on("start-read-mode",function(){n?t.onInit(u):l()})}o.readMode&&e(s)}}}i.$inject=["$timeout","mobileViewer","MOBILE"],angular.module("reader").directive("readMode",i)},{}],185:[function(e,t,n){function i(e,t,n){return{restrict:"A",replace:!0,scope:{references:"="},templateUrl:"citations/references.html",link:function(i,r,o){i.hideBadges=void 0,i.trackLinkout=function(e){n.linkout("related"),e.doi&&o.trackingSource&&n.referral(e.doi,o.trackingSource)},t.onData(function(t){e(function(){i.hideBadges=t.meta.hide_reference_labels})})}}}i.$inject=["$timeout","article","tracker"],angular.module("reader").directive("references",i)},{}],186:[function(e,t,n){function i(e,t){var n=t("linkify"),i=t("refPublishInfo");return{restrict:"E",scope:{refs:"=",trackingSource:"@"},link:function(t,r){$((t.refs||[]).map(function(e,t){var r="article";e.badge&&(r+=" reference"),e.hideBadges&&(r+=" hide-badges");var o=['<div class="'+r+'">'];return e.badge&&o.push('<div title="'+e.badge+'" class="number">'+e.badge+"</div>"),e.title&&o.push('<h4 class="title">'+n(e.title)+"</h4>"),e.authors&&e.authors.length&&o.push('<div class="authors">'+e.authors.slice(0,10).join(", ")+"</div>"),o.push('<div class="links">'),e.find_article_url&&o.push('\n            <a\n              target="_blank"\n              ref-idx="'+t+'"\n              href="'+e.find_article_url+'">\n              Find Article\n            </a>\n          '),e.find_article_url&&e.article_url&&o.push("<span> | </span>"),e.article_url&&o.push('\n            <a\n              target="_blank"\n              ref-idx="'+t+'"\n              href="'+e.article_url+'">\n              Article\n            </a>\n          '),o.push("</div>"),o.push('<div class="published">'+i(e)+"</div>"),o.push("</div>"),o.join("")}).join("")).appendTo(r).on("click","a[ref-idx]",function(n){e.linkout("related");var i=$(n.target).attr("ref-idx"),r=t.refs[parseInt(i)];r&&r.doi&&t.trackingSource&&e.referral(r.doi,t.trackingSource)})}}}i.$inject=["tracker","$filter"],angular.module("reader").directive("referenceList",i)},{}],187:[function(e,t,n){function i(e){return{restrict:"A",link:function(t,n){function i(){e(function(){t.contracted=o()})}function r(){return parseInt(t.responsive)||960}function o(){return n.width()<r()}t.contracted=o(),$(window).on("resize",_.debounce(i,50)),t.$watch("responsive",i)}}}i.$inject=["$timeout"],angular.module("reader").directive("responsive",i)},{}],188:[function(e,t,n){function i(e,t,n,i,r,o){function s(){return $(document.body).hasClass("info-open")}function a(){s()||($(document.body).addClass("info-open"),e.$emit("info-opened"))}function c(){s()&&($(document.body).removeClass("info-open"),e.$emit("info-closed"))}function l(){s()?c():a()}return e.$on("toggle-info",l),e.$on("open-info",a),e.$on("close-info",c),e.$on("annotations-opened",c),{restrict:"E",link:function(e,a){e.supplement=void 0,n.onInit(function(){return t(function(){return e.supplement=n.get()})}),i.onInit(function(){a.on(o.transition_end,function(){s()&&i.shrinkToWidth(),r.update()})})}}}i.$inject=["$rootScope","$timeout","article","viewer","popover","CONST"],angular.module("reader").directive("supplementInfo",i)},{}],189:[function(e,t,n){function i(e){return{restrict:"A",link:function(t,n,i){var r=e(i.targetClick);"function"==typeof r&&n.click(function(e){n.is(e.target)&&t.$apply(function(){r(t,{$event:e})})})}}}i.$inject=["$parse"],angular.module("reader").directive("targetClick",i)},{}],190:[function(e,t,n){function i(e,t,n){return{restrict:"E",link:function(i,r,o){function s(){return e.isShared()&&!e.hasFullAccess()}function a(){$(document).on("contextmenu",".viewer",function(e){s()&&e.preventDefault()})}function c(){$(document).on("keydown",".viewer",function(e){s()&&(e.metaKey||e.ctrlKey)&&67==e.keyCode&&e.preventDefault()})}t.init(r),n.init(r.find("#journal-banner")),a(),c()}}}i.$inject=["article","viewer","banner"],angular.module("reader").directive("viewer",i)},{}],191:[function(e,t,n){function i(){return{restrict:"E",replace:!0,templateUrl:"toolbars/viewer_toolbar.html",controller:"ViewerToolbarCtrl",link:function(e,t){var n=t.closest(".article-container"),i=null;t.addClass("show"),n.on("mousemove",function(e){var r=2*e.pageX>n.width(),o=n.height()-e.pageY<150,s=!$.contains(t[0],e.target);r&&o&&(clearTimeout(i),i=null,t.addClass("show")),!i&&s&&(i=setTimeout(function(){t.removeClass("show")},2e3))})}}}angular.module("reader").directive("viewerToolbar",i)},{}],192:[function(e,t,n){function i(e,t,n,i){var r;e.properties={width:400,height:300,fps:48,color:"#FFFFFF",manifest:[]},(e.panelred=function(){this.initialize(),this.shape=new n.Shape,this.shape.graphics.f("#FF3E3C").s().p("AgJFMQgdgEgSgSIlollQgSgTADgVQADgWAXgNIFtjJQAYgNAaAFQAdAEASASIFoFlQASATgDAVQgEAXgWAMIlsDJQgSAJgUAAIgNgBg"),this.shape.setTransform(43.3,33.4),this.addChild(this.shape)}).prototype=r=new n.Container,r.nominalBounds=new n.Rectangle(0,0,86.6,66.8),(e.panelpurple=function(){this.initialize(),this.shape=new n.Shape,this.shape.graphics.f("#9823C6").s().p("AlWFXQgHgIANgXIDJlpQAMgXAZgaQAZgYAXgOIFrjIQAXgMAHAGQAHAHgMAXIjJFrQgMAXgaAaQgXAYgYAOIlsDIQgOAHgIAAQgFAAgDgCg"),this.shape.setTransform(34.6,34.6),this.addChild(this.shape)}).prototype=r=new n.Container,r.nominalBounds=new n.Rectangle(0,.1,69.2,69.1),(e.panelorange=function(){this.initialize(),this.shape=new n.Shape,this.shape.graphics.f("#FFC34E").s().p("AAwGhIllloQgSgSgEgdQgFgaANgYIDJltQAMgWAXgEQAVgDATASIFlFoQASASAEAdQAFAbgNAYIjJFsQgMAWgXAEIgGAAQgSAAgQgPg"),this.shape.setTransform(33.4,43.3),this.addChild(this.shape)}).prototype=r=new n.Container,r.nominalBounds=new n.Rectangle(0,0,66.8,86.6),(e.panelmagenta=function(){this.initialize(),this.shape=new n.Shape,this.shape.graphics.f("#FE0FA6").s().p("AlWFWQgGgHAMgXIDIlrQANgXAYgZQAagZAXgNIFrjIQAXgMAHAHQAHAHgMAXIjKFrQgNAXgYAYQgaAagWAMIlrDJQgOAIgIAAQgFAAgDgDg"),this.shape.setTransform(34.6,34.6),this.addChild(this.shape)}).prototype=r=new n.Container,r.nominalBounds=new n.Rectangle(0,.1,69.2,69.2),(e.panelgreen=function(){this.initialize(),this.shape=new n.Shape,this.shape.graphics.f("#98D843").s().p("AAwGhIllloQgSgSgEgdQgFgaANgYIDJltQANgXAWgDQAVgDATASIFlFoQASASAEAdQAFAcgNAXIjJFsQgMAXgXADIgGAAQgRAAgRgPg"),this.shape.setTransform(33.4,43.3),this.addChild(this.shape)}).prototype=r=new n.Container,r.nominalBounds=new n.Rectangle(0,0,66.8,86.6),(e.panelblue=function(){this.initialize(),this.shape=new n.Shape,this.shape.graphics.f("#26C4FF").s().p("AgIFNQgdgFgTgSIlnlmQgSgRACgXQADgWAXgNIFtjIQAXgNAcAFQAdAEARASIFoFlQATATgEAVQgDAXgXAMIlsDJQgSAJgWAAIgKAAg"),this.shape.setTransform(43.3,33.4),this.addChild(this.shape)}).prototype=r=new n.Container,r.nominalBounds=new n.Rectangle(0,.1,86.6,66.8),(e.CollapsedLogoErrorAnimation=function(t,i,r){null==r&&(r=!1),this.initialize(t,i,r,{}),this.frame_0=function(){if(window.devicePixelRatio>1){var e=canvas.width,t=canvas.height;canvas.width=e*window.devicePixelRatio,canvas.height=t*window.devicePixelRatio,canvas.style.width=e+"px",canvas.style.height=t+"px",stage.scaleX=stage.scaleY=window.devicePixelRatio}},this.frame_69=function(){try{stop()}catch(e){}},this.timeline.addTween(n.Tween.get(this).call(this.frame_0).wait(69).call(this.frame_69).wait(17)),this.FlashAICB_colour__Path__5=new e.panelpurple,this.FlashAICB_colour__Path__5.setTransform(142.6,86.4,1.5,1.5,0,0,0,34.6,34.6),this.FlashAICB_colour__Path__5.alpha=.898,this.FlashAICB_colour__Path__5.shadow=new n.Shadow("rgba(0,0,0,1)",0,0,0),this.timeline.addTween(n.Tween.get(this.FlashAICB_colour__Path__5).wait(18).to({scaleX:1.48,scaleY:1.48,skewX:2,skewY:1.3,x:142.3,y:91.6},0).wait(1).to({scaleX:1.45,scaleY:1.45,skewX:4,skewY:2.6,x:142.1,y:96.7},0).wait(1).to({scaleX:1.43,scaleY:1.43,skewX:5.9,skewY:3.8,x:141.9,y:101.5},0).wait(1).to({scaleX:1.41,scaleY:1.41,skewX:7.7,skewY:4.9,x:141.6,y:106.2},0).wait(1).to({scaleX:1.38,scaleY:1.38,skewX:9.4,skewY:6.1,x:141.5,y:110.8},0).wait(1).to({scaleX:1.36,scaleY:1.36,skewX:11.1,skewY:7.1,x:141.2,y:115.1},0).wait(1).to({scaleX:1.34,scaleY:1.34,skewX:12.7,skewY:8.2,x:141.1,y:119.3},0).wait(1).to({scaleX:1.32,scaleY:1.32,skewX:14.3,skewY:9.2,x:140.9,y:123.3},0).wait(1).to({scaleX:1.3,scaleY:1.3,skewX:15.8,skewY:10.2,x:140.7,y:127.2},0).wait(1).to({scaleX:1.29,scaleY:1.29,skewX:17.2,skewY:11.1,x:140.5,y:131},0).wait(1).to({scaleX:1.27,scaleY:1.27,skewX:18.6,skewY:12,x:140.3,y:134.6},0).wait(1).to({scaleX:1.25,scaleY:1.25,skewX:19.9,skewY:12.9,x:140.2,y:138.1},0).wait(1).to({scaleX:1.24,scaleY:1.24,skewX:21.2,skewY:13.7,x:140,y:141.4},0).wait(1).to({scaleX:1.22,scaleY:1.22,skewX:22.5,skewY:14.5,x:139.9,y:144.6},0).wait(1).to({scaleX:1.21,scaleY:1.21,skewX:23.7,skewY:15.3,x:139.7,y:147.8},0).wait(1).to({scaleX:1.19,scaleY:1.19,skewX:24.8,skewY:16,x:139.6,y:150.8},0).wait(1).to({scaleX:1.18,scaleY:1.18,skewX:26,skewY:16.7,x:139.4,y:153.7},0).wait(1).to({scaleX:1.16,scaleY:1.16,skewX:27,skewY:17.4,x:139.3,y:156.5},0).wait(1).to({scaleX:1.15,scaleY:1.15,skewX:28.1,skewY:18.1,x:139.2,y:159.3},0).wait(1).to({scaleX:1.14,scaleY:1.14,skewX:29.1,skewY:18.8,x:139.1,y:161.8},0).wait(1).to({scaleX:1.13,scaleY:1.13,skewX:30.1,skewY:19.4,x:138.9,y:164.4},0).wait(1).to({scaleX:1.11,scaleY:1.11,skewX:31,skewY:20,y:166.9},0).wait(1).to({scaleX:1.1,scaleY:1.1,skewX:32,skewY:20.6,x:138.7,y:169.3},0).wait(1).to({scaleX:1.09,scaleY:1.09,skewX:32.9,skewY:21.2,x:138.6,y:171.6},0).wait(1).to({scaleX:1.08,scaleY:1.08,skewX:33.7,skewY:21.7,x:138.5,y:173.9},0).wait(1).to({scaleX:1.07,scaleY:1.07,skewX:34.6,skewY:22.3,x:138.4,y:176.1},0).wait(1).to({scaleX:1.06,scaleY:1.06,skewX:35.4,skewY:22.8,x:138.3,y:178.3},0).wait(1).to({scaleX:1.05,scaleY:1.05,skewX:36.2,skewY:23.4,x:138.2,y:180.4},0).wait(1).to({scaleX:1.04,scaleY:1.04,skewX:37,skewY:23.9,x:138.1,y:182.5},0).wait(1).to({scaleX:1.03,scaleY:1.03,skewX:37.8,skewY:24.4,x:138,y:184.5},0).wait(1).to({scaleX:1.02,scaleY:1.02,skewX:38.6,skewY:24.9,x:137.9,y:186.5},0).wait(1).to({scaleX:1.01,scaleY:1.01,skewX:39.4,skewY:25.4,x:137.8,y:188.5},0).wait(1).to({scaleX:1,scaleY:1,skewX:40.2,skewY:25.9,x:137.7,y:190.5},0).wait(1).to({scaleX:.99,scaleY:.99,skewX:40.9,skewY:26.4,x:137.6,y:192.5},0).wait(1).to({scaleX:.98,scaleY:.98,skewX:41.7,skewY:26.9,x:137.5,y:194.5},0).wait(1).to({scaleX:.97,scaleY:.97,skewX:42.4,skewY:27.3,x:137.4,y:196.4},0).wait(1).to({scaleX:.96,scaleY:.96,skewX:43.2,skewY:27.8,x:137.3,y:198.4},0).wait(1).to({scaleX:.95,scaleY:.95,skewX:43.9,skewY:28.3,x:137.2,y:200.3},0).wait(1).to({scaleX:.94,scaleY:.94,skewX:44.7,skewY:28.8,y:202.3},0).wait(1).to({scaleX:.94,scaleY:.94,skewX:45.5,skewY:29.3,x:137.1,y:204.3},0).wait(1).to({scaleX:.93,scaleY:.93,skewX:46.2,skewY:29.8,x:137,y:206.3},0).wait(1).to({scaleX:.92,scaleY:.92,skewX:47,skewY:30.3,x:136.9,y:208.4},0).wait(1).to({scaleX:.91,scaleY:.91,skewX:47.8,skewY:30.8,x:136.8,y:210.5},0).wait(1).to({scaleX:.9,scaleY:.9,skewX:48.6,skewY:31.4,x:136.7,y:212.5},0).wait(1).to({scaleX:.89,scaleY:.89,skewX:49.5,skewY:31.9,x:136.6,y:214.7},0).wait(1).to({scaleX:.87,scaleY:.87,skewX:50.3,skewY:32.4,x:136.5,y:216.9},0).wait(1).to({scaleX:.86,scaleY:.86,skewX:51.2,skewY:33,x:136.3,y:219.2},0).wait(1).to({scaleX:.85,scaleY:.85,skewX:52.1,skewY:33.6,y:221.5},0).wait(1).to({scaleX:.84,scaleY:.84,skewX:53,skewY:34.2,x:136.2,y:223.9},0).wait(1).to({scaleX:.83,scaleY:.83,skewX:54,skewY:34.8,x:136,y:226.3},0).wait(1).to({scaleX:.82,scaleY:.82,skewX:54.9,skewY:35.4,x:135.9,y:228.9},0).wait(1).to({regX:35,regY:34.9,scaleX:.81,scaleY:.81,skewX:55.9,skewY:36.1,x:135.8,y:231.6},0).to({regY:35,scaleY:.8,skewY:33,x:135.7,y:229.7},3).to({regY:34.9,scaleY:.81,skewY:36.1,x:135.8,y:231.6},6).wait(8)),this.FlashAICB_colour__Path_=new e.panelgreen,this.FlashAICB_colour__Path_.setTransform(163.3,162.2,1.5,1.5,0,0,0,33.4,43.2),this.FlashAICB_colour__Path_.alpha=.898,this.FlashAICB_colour__Path_.shadow=new n.Shadow("rgba(0,0,0,1)",0,0,0),this.timeline.addTween(n.Tween.get(this.FlashAICB_colour__Path_).wait(24).to({regY:43.3,scaleX:1.51,scaleY:1.51,skewX:5,skewY:.7,x:161.8,y:168.1},0).wait(1).to({scaleX:1.52,scaleY:1.53,skewX:9.6,skewY:1.3,x:160.4,y:173.4},0).wait(1).to({scaleX:1.54,scaleY:1.54,skewX:13.8,skewY:1.9,x:159.1,y:178.4},0).wait(1).to({scaleX:1.55,scaleY:1.55,skewX:17.7,skewY:2.4,x:157.9,y:183},0).wait(1).to({scaleX:1.55,scaleY:1.56,skewX:21.4,skewY:2.9,x:156.9,y:187.3},0).wait(1).to({scaleX:1.56,scaleY:1.57,skewX:24.8,skewY:3.4,x:155.8,y:191.2},0).wait(1).to({scaleX:1.57,scaleY:1.57,skewX:27.9,skewY:3.8,x:154.9,y:194.8},0).wait(1).to({scaleX:1.58,scaleY:1.58,skewX:30.8,skewY:4.2,x:154,y:198.3},0).wait(1).to({scaleX:1.59,scaleY:1.59,skewX:33.6,skewY:4.6,x:153.2,y:201.5},0).wait(1).to({scaleX:1.59,scaleY:1.6,skewX:36.2,skewY:4.9,x:152.4,y:204.5},0).wait(1).to({scaleX:1.6,scaleY:1.6,skewX:38.6,skewY:5.2,x:151.7,y:207.4},0).wait(1).to({scaleX:1.6,scaleY:1.61,skewX:40.9,skewY:5.5,x:150.9,y:210},0).wait(1).to({scaleX:1.61,scaleY:1.61,skewX:43,skewY:5.8,x:150.4,y:212.5},0).wait(1).to({scaleX:1.62,scaleY:1.62,skewX:45.1,skewY:6.1,x:149.7,y:214.9},0).wait(1).to({scaleX:1.62,scaleY:1.62,skewX:47,skewY:6.4,x:149.1,y:217.1},0).wait(1).to({scaleX:1.62,scaleY:1.63,skewX:48.8,skewY:6.6,x:148.6,y:219.3},0).wait(1).to({scaleX:1.63,scaleY:1.63,skewX:50.6,skewY:6.9,x:148,y:221.3},0).wait(1).to({scaleX:1.63,scaleY:1.64,skewX:52.3,skewY:7.1,x:147.6,y:223.3},0).wait(1).to({scaleX:1.64,scaleY:1.64,skewX:54,skewY:7.3,x:147,y:225.3},0).wait(1).to({scaleX:1.64,scaleY:1.65,skewX:55.6,skewY:7.5,x:146.5,y:227.1},0).wait(1).to({scaleX:1.65,scaleY:1.65,skewX:57.1,skewY:7.8,x:146.1,y:228.9},0).wait(1).to({scaleX:1.65,scaleY:1.65,skewX:58.7,skewY:8,x:145.6,y:230.8},0).wait(1).to({scaleX:1.65,scaleY:1.66,skewX:60.2,skewY:8.2,x:145.2,y:232.5},0).wait(1).to({scaleX:1.66,scaleY:1.66,skewX:61.7,skewY:8.4,x:144.7,y:234.3},0).wait(1).to({scaleX:1.66,scaleY:1.67,skewX:63.3,skewY:8.6,x:144.2,y:236.1},0).wait(1).to({scaleX:1.67,scaleY:1.67,skewX:64.8,skewY:8.8,x:143.8,y:237.9},0).wait(1).to({scaleX:1.67,scaleY:1.68,skewX:66.4,skewY:9,x:143.3,y:239.7},0).wait(1).to({scaleX:1.67,scaleY:1.68,skewX:68,skewY:9.2,x:142.8,y:241.6},0).wait(1).to({scaleX:1.68,scaleY:1.68,skewX:69.6,skewY:9.5,x:142.3,y:243.5},0).wait(1).to({scaleX:1.68,scaleY:1.69,skewX:71.3,skewY:9.7,x:141.8,y:245.5},0).wait(1).to({scaleX:1.69,scaleY:1.69,skewX:73.1,skewY:9.9,x:141.3,y:247.6},0).wait(1).to({scaleX:1.69,scaleY:1.7,skewX:74.9,skewY:10.2,x:140.7,y:249.7},0).wait(1).to({scaleX:1.7,scaleY:1.7,skewX:76.8,skewY:10.4,x:140.2,y:251.9},0).wait(1).to({scaleX:1.7,scaleY:1.71,skewX:78.9,skewY:10.7,x:139.5,y:254.3},0).wait(1).to({regX:33.3,regY:43.1,scaleX:1.71,scaleY:1.71,skewX:81,skewY:11,x:138.9,y:256.8},0).to({regX:33.2,scaleX:1.71,skewX:83,x:138.7,y:254.3},7).to({regX:33.3,scaleX:1.71,skewX:81,x:138.9,y:256.8},9).wait(12)),this.FlashAICB_colour__Path__1=new e.panelmagenta,this.FlashAICB_colour__Path__1.setTransform(255.2,199.1,1.5,1.5,0,0,0,34.6,34.6),this.FlashAICB_colour__Path__1.alpha=.898,this.FlashAICB_colour__Path__1.shadow=new n.Shadow("rgba(0,0,0,1)",0,0,0),this.timeline.addTween(n.Tween.get(this.FlashAICB_colour__Path__1).wait(18).to({scaleX:1.5,scaleY:1.5,skewX:2.6,skewY:1.5,x:257.2,y:202.3},0).wait(1).to({scaleX:1.5,skewX:5,skewY:2.9,x:259.1,y:205.3},0).wait(1).to({scaleX:1.5,scaleY:1.5,skewX:7.2,skewY:4.3,x:260.9,y:208.1},0).wait(1).to({scaleX:1.5,scaleY:1.5,skewX:9.3,skewY:5.5,x:262.6,y:210.9},0).wait(1).to({skewX:11.3,skewY:6.7,x:264.2,y:213.4},0).wait(1).to({scaleX:1.51,scaleY:1.5,skewX:13.2,skewY:7.8,x:265.7,y:215.7},0).wait(1).to({scaleX:1.51,skewX:15,skewY:8.9,x:267.2,y:218},0).wait(1).to({scaleX:1.51,skewX:16.7,skewY:9.9,x:268.5,y:220.1},0).wait(1).to({scaleY:1.5,skewX:18.3,skewY:10.8,x:269.8,y:222.1},0).wait(1).to({scaleX:1.51,skewX:19.8,skewY:11.7,x:271,y:224.1},0).wait(1).to({scaleX:1.51,scaleY:1.49,skewX:21.3,skewY:12.6,x:272.1,y:225.9},0).wait(1).to({skewX:22.7,skewY:13.4,x:273.2,y:227.7},0).wait(1).to({scaleX:1.51,skewX:24,skewY:14.2,x:274.3,y:229.3},0).wait(1).to({scaleY:1.49,skewX:25.3,skewY:14.9,x:275.3,y:230.9},0).wait(1).to({scaleX:1.51,skewX:26.5,skewY:15.6,x:276.3,y:232.5},0).wait(1).to({skewX:27.7,skewY:16.3,x:277.2,y:233.9},0).wait(1).to({scaleX:1.51,skewX:28.8,skewY:17,x:278.1,y:235.4},0).wait(1).to({scaleY:1.49,skewX:29.9,skewY:17.6,x:278.9,y:236.7},0).wait(1).to({skewX:30.9,skewY:18.3,x:279.8,y:238.1},0).wait(1).to({scaleX:1.51,skewX:32,skewY:18.9,x:280.7,y:239.3},0).wait(1).to({scaleY:1.49,skewX:32.9,skewY:19.4,x:281.4,y:240.5},0).wait(1).to({scaleX:1.51,skewX:33.9,skewY:20,x:282.1,y:241.7},0).wait(1).to({skewX:34.8,skewY:20.6,x:282.9,y:243},0).wait(1).to({skewX:35.8,skewY:21.1,x:283.6,y:244.1},0).wait(1).to({scaleX:1.52,skewX:36.7,skewY:21.6,x:284.3,y:245.2},0).wait(1).to({scaleY:1.49,skewX:37.5,skewY:22.1,x:285.1,y:246.3},0).wait(1).to({skewX:38.4,skewY:22.7,x:285.7,y:247.4},0).wait(1).to({scaleX:1.52,skewX:39.3,skewY:23.2,x:286.4,y:248.5},0).wait(1).to({skewX:40.1,skewY:23.7,x:287.1,y:249.5},0).wait(1).to({scaleX:1.52,scaleY:1.49,skewX:41,skewY:24.2,x:287.8,y:250.6},0).wait(1).to({skewX:41.8,skewY:24.7,x:288.4,y:251.7},0).wait(1).to({skewX:42.6,skewY:25.2,x:289.1,y:252.7},0).wait(1).to({scaleX:1.52,skewX:43.5,skewY:25.7,x:289.8,y:253.8},0).wait(1).to({skewX:44.3,skewY:26.2,x:290.5,y:254.9},0).wait(1).to({scaleY:1.49,skewX:45.2,skewY:26.7,x:291.1,y:256},0).wait(1).to({scaleX:1.52,skewX:46.1,skewY:27.2,x:291.8,y:257.1},0).wait(1).to({skewX:46.9,skewY:27.7,x:292.6,y:258.1},0).wait(1).to({skewX:47.8,skewY:28.2,x:293.2,y:259.3},0).wait(1).to({scaleX:1.52,scaleY:1.49,skewX:48.8,skewY:28.8,x:294,y:260.5},0).wait(1).to({skewX:49.7,skewY:29.3,x:294.7,y:261.6},0).wait(1).to({skewX:50.7,skewY:29.9,x:295.5,y:262.8},0).wait(1).to({scaleX:1.52,skewX:51.6,skewY:30.5,x:296.3,y:264.1},0).wait(1).to({scaleY:1.49,skewX:52.7,skewY:31.1,x:297.1,y:265.4},0).wait(1).to({scaleX:1.52,skewX:53.7,skewY:31.7,x:297.9,y:266.7},0).wait(1).to({skewX:54.8,skewY:32.3,x:298.8,y:268.1},0).wait(1).to({regY:34.9,scaleX:1.52,skewX:55.9,skewY:33,x:299.7,y:269.6},0).to({scaleY:1.48,skewY:34,x:299.6,y:267.7},3).to({scaleY:1.49,skewY:33,x:299.7,y:269.6},7).wait(13)),this.FlashAICB_colour__Path__2=new e.panelblue,this.FlashAICB_colour__Path__2.setTransform(241,84.5,1.5,1.5,0,0,0,43.2,33.5),this.FlashAICB_colour__Path__2.alpha=.898,this.FlashAICB_colour__Path__2.shadow=new n.Shadow("rgba(0,0,0,1)",0,0,0),this.timeline.addTween(n.Tween.get(this.FlashAICB_colour__Path__2).wait(21).to({regX:43.3,regY:33.4,scaleX:1.51,scaleY:1.51,skewX:3.2,skewY:.3,x:241.4,y:91},0).wait(1).to({scaleX:1.52,scaleY:1.52,skewX:6.3,skewY:.6,x:241.6,y:97.3},0).wait(1).to({scaleX:1.53,scaleY:1.53,skewX:9.2,skewY:.8,x:241.9,y:103.4},0).wait(1).to({scaleX:1.54,scaleY:1.54,skewX:12,skewY:1.1,x:242,y:109.1},0).wait(1).to({scaleX:1.55,scaleY:1.55,skewX:14.6,skewY:1.3,x:242.2,y:114.6},0).wait(1).to({scaleX:1.55,scaleY:1.55,skewX:17.2,skewY:1.5,x:242.4,y:119.8},0).wait(1).to({scaleX:1.56,scaleY:1.56,skewX:19.6,skewY:1.7,x:242.6,y:124.8},0).wait(1).to({scaleX:1.57,scaleY:1.57,skewX:21.9,skewY:1.9,x:242.8,y:129.6},0).wait(1).to({scaleX:1.58,scaleY:1.58,skewX:24.1,skewY:2.1,x:243,y:134.1},0).wait(1).to({scaleX:1.58,scaleY:1.58,skewX:26.2,skewY:2.3,x:243.1,y:138.5},0).wait(1).to({scaleX:1.59,scaleY:1.59,skewX:28.2,skewY:2.5,x:243.2,y:142.7},0).wait(1).to({scaleX:1.6,scaleY:1.59,skewX:30.2,skewY:2.7,x:243.4,y:146.7},0).wait(1).to({scaleX:1.6,scaleY:1.6,skewX:32,skewY:2.8,x:243.5,y:150.5},0).wait(1).to({scaleX:1.61,scaleY:1.61,skewX:33.8,skewY:3,x:243.7,y:154.2},0).wait(1).to({scaleX:1.61,scaleY:1.61,skewX:35.5,skewY:3.1,x:243.8,y:157.7},0).wait(1).to({scaleX:1.62,scaleY:1.62,skewX:37.2,skewY:3.3,x:244,y:161.1},0).wait(1).to({scaleX:1.62,scaleY:1.62,skewX:38.8,skewY:3.4,x:244.1,y:164.4},0).wait(1).to({scaleX:1.63,scaleY:1.63,skewX:40.3,skewY:3.6,x:244.2,y:167.6},0).wait(1).to({scaleX:1.63,scaleY:1.63,skewX:41.8,skewY:3.7,x:244.3,y:170.6},0).wait(1).to({scaleX:1.64,scaleY:1.64,skewX:43.2,skewY:3.8,x:244.4,y:173.6},0).wait(1).to({scaleX:1.64,scaleY:1.64,skewX:44.6,skewY:4,x:244.5,y:176.4},0).wait(1).to({scaleX:1.64,scaleY:1.64,skewX:45.9,skewY:4.1,x:244.6,y:179.2},0).wait(1).to({scaleX:1.65,scaleY:1.65,skewX:47.2,skewY:4.2,x:244.7,y:181.9},0).wait(1).to({scaleX:1.65,scaleY:1.65,skewX:48.5,skewY:4.3,x:244.8,y:184.5},0).wait(1).to({scaleX:1.66,scaleY:1.66,skewX:49.7,skewY:4.4,x:244.9,y:187.1},0).wait(1).to({scaleX:1.66,scaleY:1.66,skewX:51,skewY:4.5,x:245,y:189.6},0).wait(1).to({scaleX:1.66,scaleY:1.66,skewX:52.2,skewY:4.6,x:245.1,y:192.1},0).wait(1).to({scaleX:1.67,scaleY:1.67,skewX:53.3,skewY:4.7,y:194.5},0).wait(1).to({scaleX:1.67,scaleY:1.67,skewX:54.5,skewY:4.8,x:245.2,y:196.9},0).wait(1).to({scaleX:1.68,scaleY:1.67,skewX:55.6,skewY:4.9,x:245.3,y:199.2},0).wait(1).to({scaleX:1.68,scaleY:1.68,skewX:56.8,skewY:5,x:245.4,y:201.5},0).wait(1).to({scaleX:1.68,scaleY:1.68,skewX:57.9,skewY:5.1,x:245.5,y:203.9},0).wait(1).to({scaleX:1.69,scaleY:1.68,skewX:59,skewY:5.2,x:245.6,y:206.2},0).wait(1).to({scaleX:1.69,scaleY:1.69,skewX:60.1,skewY:5.3,x:245.7,y:208.5},0).wait(1).to({scaleX:1.69,scaleY:1.69,skewX:61.2,skewY:5.4,y:210.9},0).wait(1).to({scaleX:1.7,scaleY:1.69,skewX:62.4,skewY:5.5,x:245.8,y:213.1},0).wait(1).to({scaleX:1.7,scaleY:1.7,skewX:63.5,skewY:5.6,x:245.9,y:215.5},0).wait(1).to({scaleX:1.7,scaleY:1.7,skewX:64.6,skewY:5.7,x:246,y:217.9},0).wait(1).to({scaleX:1.71,scaleY:1.71,skewX:65.8,skewY:5.8,x:246.1,y:220.3},0).wait(1).to({scaleX:1.71,scaleY:1.71,skewX:67,skewY:5.9,y:222.7},0).wait(1).to({scaleX:1.71,scaleY:1.71,skewX:68.2,skewY:6,x:246.2,y:225.2},0).wait(1).to({scaleX:1.72,scaleY:1.72,skewX:69.4,skewY:6.1,x:246.4,y:227.7},0).wait(1).to({scaleX:1.72,scaleY:1.72,skewX:70.7,skewY:6.3,y:230.4},0).wait(1).to({scaleX:1.73,scaleY:1.72,skewX:71.9,skewY:6.4,x:246.6,y:233},0).wait(1).to({scaleX:1.73,scaleY:1.73,skewX:73.3,skewY:6.5,y:235.7},0).wait(1).to({scaleX:1.74,scaleY:1.73,skewX:74.6,skewY:6.6,x:246.7,y:238.6},0).wait(1).to({scaleX:1.74,scaleY:1.74,skewX:76,skewY:6.7,x:246.9,y:241.5},0).wait(1).to({scaleX:1.74,scaleY:1.74,skewX:77.5,skewY:6.9,y:244.5},0).wait(1).to({regX:43.4,scaleX:1.75,scaleY:1.75,skewX:79,skewY:7,x:246.8,y:247.7},0).to({scaleY:1.75,skewX:79.2,skewY:9,y:245.8},3).to({scaleY:1.75,skewX:79,skewY:7,y:247.7},4).wait(10)),this.FlashAICB_colour__Path__3=new e.panelred,this.FlashAICB_colour__Path__3.setTransform(156.8,201.2,1.5,1.5,0,0,0,43.4,33.4),this.FlashAICB_colour__Path__3.alpha=.898,this.FlashAICB_colour__Path__3.shadow=new n.Shadow("rgba(0,0,0,1)",0,0,0),this.timeline.addTween(n.Tween.get(this.FlashAICB_colour__Path__3).wait(18).to({regX:43.3,scaleX:1.49,scaleY:1.49,skewX:-3.9,skewY:-1,x:152.3,y:204.7},0).wait(1).to({scaleX:1.48,scaleY:1.48,skewX:-7.5,skewY:-2,x:148.2,y:208.2},0).wait(1).to({scaleX:1.47,scaleY:1.47,skewX:-10.9,skewY:-3,x:144.3,y:211.4},0).wait(1).to({scaleX:1.46,scaleY:1.46,skewX:-14.2,skewY:-3.8,x:140.6,y:214.4},0).wait(1).to({scaleX:1.45,scaleY:1.45,skewX:-17.2,skewY:-4.7,x:137.3,y:217.3},0).wait(1).to({scaleX:1.44,scaleY:1.44,skewX:-20.1,skewY:-5.4,x:134,y:220},0).wait(1).to({scaleX:1.44,scaleY:1.44,skewX:-22.8,skewY:-6.2,x:130.9,y:222.5},0).wait(1).to({scaleX:1.43,scaleY:1.43,skewX:-25.3,skewY:-6.9,x:128.1,y:224.9},0).wait(1).to({scaleX:1.42,scaleY:1.42,skewX:-27.7,skewY:-7.5,x:125.3,y:227.1},0).wait(1).to({scaleX:1.42,scaleY:1.42,skewX:-30,skewY:-8.1,x:122.8,y:229.3},0).wait(1).to({scaleX:1.41,scaleY:1.41,skewX:-32.1,skewY:-8.7,x:120.4,y:231.2},0).wait(1).to({scaleX:1.4,scaleY:1.4,skewX:-34.1,skewY:-9.3,x:118.1,y:233.1},0).wait(1).to({scaleX:1.4,scaleY:1.4,skewX:-36,skewY:-9.8,x:115.9,y:234.9},0).wait(1).to({scaleX:1.39,scaleY:1.39,skewX:-37.8,skewY:-10.3,x:113.9,y:236.6},0).wait(1).to({scaleX:1.39,scaleY:1.39,skewX:-39.6,skewY:-10.7,x:112,y:238.2},0).wait(1).to({scaleX:1.38,scaleY:1.38,skewX:-41.2,skewY:-11.2,x:110.1,y:239.8},0).wait(1).to({scaleX:1.38,scaleY:1.38,skewX:-42.8,skewY:-11.6,x:108.4,y:241.2},0).wait(1).to({scaleX:1.38,scaleY:1.38,skewX:-44.3,skewY:-12,x:106.6,y:242.6},0).wait(1).to({scaleX:1.37,scaleY:1.37,skewX:-45.7,skewY:-12.4,x:105,y:244},0).wait(1).to({scaleX:1.37,scaleY:1.37,skewX:-47.1,skewY:-12.8,x:103.4,y:245.3},0).wait(1).to({scaleX:1.36,scaleY:1.36,skewX:-48.5,skewY:-13.2,x:101.9,y:246.6},0).wait(1).to({scaleX:1.36,scaleY:1.36,skewX:-49.8,skewY:-13.5,x:100.4,y:247.8},0).wait(1).to({scaleX:1.36,scaleY:1.36,skewX:-51.1,skewY:-13.9,x:99,y:249},0).wait(1).to({scaleX:1.35,scaleY:1.35,skewX:-52.4,skewY:-14.2,x:97.5,y:250.2},0).wait(1).to({scaleX:1.35,scaleY:1.35,skewX:-53.7,skewY:-14.6,x:96,y:251.4},0).wait(1).to({scaleX:1.34,scaleY:1.34,skewX:-55,skewY:-14.9,x:94.6,y:252.7},0).wait(1).to({scaleX:1.34,scaleY:1.34,skewX:-56.3,skewY:-15.3,x:93.1,y:253.9},0).wait(1).to({scaleX:1.34,scaleY:1.34,skewX:-57.6,skewY:-15.6,x:91.6,y:255.1},0).wait(1).to({scaleX:1.33,scaleY:1.33,skewX:-59,skewY:-16,x:90.1,y:256.4},0).wait(1).to({scaleX:1.33,scaleY:1.33,skewX:-60.4,skewY:-16.4,x:88.5,y:257.7},0).wait(1).to({scaleX:1.33,scaleY:1.33,skewX:-61.8,skewY:-16.8,x:86.9,y:259.1},0).wait(1).to({scaleX:1.32,scaleY:1.32,skewX:-63.3,skewY:-17.2,x:85.2,y:260.4},0).wait(1).to({scaleX:1.32,scaleY:1.32,skewX:-64.9,skewY:-17.6,x:83.5,y:261.9},0).wait(1).to({scaleX:1.31,scaleY:1.31,skewX:-66.5,skewY:-18,x:81.6,y:263.5},0).wait(1).to({scaleX:1.31,scaleY:1.31,skewX:-68.2,skewY:-18.5,x:79.7,y:265.1},0).wait(1).to({regX:42.9,regY:33.5,scaleX:1.3,scaleY:1.3,skewX:-70,skewY:-19,x:77.7,y:266.7},0).to({scaleX:1.3,scaleY:1.3,skewY:-14,y:260.5},3).to({scaleX:1.3,scaleY:1.3,skewY:-19,y:266.7},11).wait(19)),this.FlashAICB_colour__Path__4=new e.panelorange,this.FlashAICB_colour__Path__4.setTransform(234.5,123.2,1.5,1.5,0,0,0,33.4,43.3),this.FlashAICB_colour__Path__4.alpha=.898,this.FlashAICB_colour__Path__4.shadow=new n.Shadow("rgba(0,0,0,1)",0,0,0),this.timeline.addTween(n.Tween.get(this.FlashAICB_colour__Path__4).wait(23).to({scaleX:1.52,scaleY:1.52,skewX:5,skewY:.3,x:234.7,y:131.6},0).wait(1).to({scaleX:1.54,scaleY:1.54,skewX:9.6,skewY:.7,x:235,y:139.4},0).wait(1).to({scaleX:1.56,scaleY:1.56,skewX:13.9,skewY:1,x:235.2,y:146.8},0).wait(1).to({scaleX:1.58,scaleY:1.58,skewX:17.9,skewY:1.3,x:235.4,y:153.6},0).wait(1).to({scaleX:1.59,scaleY:1.59,skewX:21.7,skewY:1.5,x:235.6,y:160},0).wait(1).to({scaleX:1.61,scaleY:1.61,skewX:25.2,skewY:1.8,x:235.8,y:165.9},0).wait(1).to({scaleX:1.62,scaleY:1.62,skewX:28.5,skewY:2,x:235.9,y:171.6},0).wait(1).to({scaleX:1.63,scaleY:1.63,skewX:31.6,skewY:2.2,x:236,y:176.7},0).wait(1).to({scaleX:1.65,scaleY:1.65,skewX:34.5,skewY:2.4,x:236.2,y:181.7},0).wait(1).to({scaleX:1.66,scaleY:1.66,skewX:37.2,skewY:2.6,x:236.3,y:186.3},0).wait(1).to({scaleX:1.67,scaleY:1.67,skewX:39.8,skewY:2.8,x:236.5,y:190.7},0).wait(1).to({scaleX:1.68,scaleY:1.68,skewX:42.2,skewY:3,x:236.6,y:194.8},0).wait(1).to({scaleX:1.69,scaleY:1.69,skewX:44.5,skewY:3.1,x:236.7,y:198.7},0).wait(1).to({scaleX:1.7,scaleY:1.7,skewX:46.7,skewY:3.3,x:236.8,y:202.4},0).wait(1).to({scaleX:1.71,scaleY:1.71,skewX:48.7,skewY:3.4,x:236.9,y:205.9},0).wait(1).to({scaleX:1.72,scaleY:1.72,skewX:50.7,skewY:3.6,x:237,y:209.3},0).wait(1).to({scaleX:1.72,
scaleY:1.72,skewX:52.6,skewY:3.7,x:237.1,y:212.6},0).wait(1).to({scaleX:1.73,scaleY:1.73,skewX:54.5,skewY:3.8,x:237.2,y:215.6},0).wait(1).to({scaleX:1.74,scaleY:1.74,skewX:56.2,skewY:4,x:237.3,y:218.7},0).wait(1).to({scaleX:1.75,scaleY:1.75,skewX:58,skewY:4.1,x:237.4,y:221.6},0).wait(1).to({scaleX:1.75,scaleY:1.75,skewX:59.6,skewY:4.2,x:237.5,y:224.4},0).wait(1).to({scaleX:1.76,scaleY:1.76,skewX:61.3,skewY:4.3,y:227.3},0).wait(1).to({scaleX:1.77,scaleY:1.77,skewX:62.9,skewY:4.4,x:237.6,y:230},0).wait(1).to({scaleX:1.77,scaleY:1.77,skewX:64.6,skewY:4.6,x:237.7,y:232.8},0).wait(1).to({scaleX:1.78,scaleY:1.78,skewX:66.2,skewY:4.7,x:237.8,y:235.6},0).wait(1).to({scaleX:1.79,scaleY:1.79,skewX:67.8,skewY:4.8,x:237.9,y:238.4},0).wait(1).to({scaleX:1.79,scaleY:1.79,skewX:69.5,skewY:4.9,y:241.3},0).wait(1).to({scaleX:1.8,scaleY:1.8,skewX:71.2,skewY:5,x:238.1,y:244.1},0).wait(1).to({scaleX:1.81,scaleY:1.81,skewX:73,skewY:5.2,x:238.2,y:247.1},0).wait(1).to({scaleX:1.82,scaleY:1.82,skewX:74.8,skewY:5.3,y:250.2},0).wait(1).to({scaleX:1.83,scaleY:1.83,skewX:76.6,skewY:5.4,x:238.3,y:253.3},0).wait(1).to({scaleX:1.83,scaleY:1.83,skewX:78.6,skewY:5.5,x:238.4,y:256.6},0).wait(1).to({scaleX:1.84,scaleY:1.84,skewX:80.6,skewY:5.7,x:238.5,y:260.1},0).wait(1).to({scaleX:1.85,scaleY:1.85,skewX:82.8,skewY:5.8,x:238.6,y:263.7},0).wait(1).to({regX:32.9,regY:42.6,scaleX:1.86,scaleY:1.86,skewX:85,skewY:6,x:238.8,y:267.5},0).to({scaleX:1.86,skewX:81,skewY:5.8,x:238.9,y:265.7},4).to({scaleX:1.86,skewX:85,skewY:6,x:238.8,y:267.5},6).wait(19))}).prototype=r=new n.MovieClip,r.nominalBounds=new n.Rectangle(289.7,183.3,222.6,223)}function r(e){i(e=e||{},{},createjs,{}),canvas=document.getElementById("canvas"),exportRoot=new e.CollapsedLogoErrorAnimation,stage=new createjs.Stage(canvas),stage.addChild(exportRoot),stage.update(),createjs.Ticker.setFPS(e.properties.fps),createjs.Ticker.addEventListener("tick",stage)}t.exports={start:r}},{}],193:[function(e,t,n){function i(){return function(e){return e.journal.toLowerCase().split(" ").concat(e.doi).join(", ")}}angular.module("reader").filter("articleKeywords",i)},{}],194:[function(e,t,n){function i(){return function(e){return _.map(e,function(e){return e.short_name||e.name})}}angular.module("reader").filter("authorShortName",i)},{}],195:[function(e,t,n){function i(){return function(e){return(e||"").replace(/(?:\r?\n|\r)+/g," ")}}angular.module("reader").filter("breaksToSpaces",i)},{}],196:[function(e,t,n){function i(e){var t={chrome:1024,msedge:512,msie:512}[e.name];return function(e){return e?t?e.substr(0,t-3)+"...":e:""}}i.$inject=["browser"],angular.module("reader").filter("clipTitle",i)},{}],197:[function(e,t,n){function i(e){return e=e.replace(/^([\s\:\.])+/g,""),e=e.replace(/([\s\:])+$/g,"")}function r(e){return function(t){var n=t.indexOf(":");return n==-1?e.trustAsHtml(t):e.trustAsHtml(sprintf("<b>%s | </b>%s",i(t.substr(0,n)),i(t.substr(n+1))))}}function o(e){return function(t){var n=t.indexOf(":");return n==-1?e.trustAsHtml(t):e.trustAsHtml(i(t.substr(0,n)))}}function s(e){return function(t){var n=t.indexOf(":"),r=t.search(/(?:\S)\.(?=\s)/i);return n==-1?"":(r==-1&&(r=t.length),e.trustAsHtml(i(t.substring(n+1,r+2))))}}function a(e){return function(t){var n=t.indexOf(":"),r=t.search(/(?:\S)\.(?=\s)/i);return n==-1||r==-1?"":e.trustAsHtml(i(t.substr(r+2)))}}r.$inject=["$sce"],o.$inject=["$sce"],s.$inject=["$sce"],a.$inject=["$sce"],angular.module("reader").filter("figureCaption",r),angular.module("reader").filter("figureCaptionLabel",o),angular.module("reader").filter("figureCaptionTitle",s),angular.module("reader").filter("figureCaptionText",a)},{}],198:[function(e,t,n){function i(){return function(e,t){return moment(e).format(t)}}function r(){return function(e){return moment(e).calendar()}}angular.module("reader").filter("formatDate",i),angular.module("reader").filter("calendarDate",r)},{}],199:[function(e,t,n){function i(){return function(e,t){return(e||[]).join(t||"")}}angular.module("reader").filter("join",i)},{}],200:[function(e,t,n){function i(){return function(e){if(!isNaN(e=parseInt(e,10)))return e<1e3?e:(e/1e3|0)+"k"}}angular.module("reader").filter("kilo",i)},{}],201:[function(e,t,n){function i(e){return function(t){return t=t.replace(/<(http[^>]+)>/g,function(e,t){return t}),t=t.replace(/(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/g,function(e){return'<a href="'+e+'" target="_blank"> '+e+" </a>"}),e.trustAsHtml(t)}}i.$inject=["$sce"],angular.module("reader").filter("linkify",i)},{}],202:[function(e,t,n){function i(){return function(e){return e.journal&&e.year?e.journal+", "+e.year:e.journal||e.year||""}}angular.module("reader").filter("refPublishInfo",i)},{}],203:[function(e,t,n){function i(e,t){if(e=(0|e).toString(),e.length<t)for(var n=e.length;n<t;n++)e="0"+e;return e}function r(){return function(e){var t=moment.duration(e);return sprintf("%s:%s:%s",i(t.asHours(),2),i(t.minutes(),2),i(t.seconds(),2))}}angular.module("reader").filter("rentalDuration",r)},{}],204:[function(e,t,n){function i(e){return function(t){return e.trustAsResourceUrl(t)}}i.$inject=["$sce"],angular.module("reader").filter("trustUrl",i)},{}],205:[function(e,t,n){function i(){return new Promise(function(e){$(e)})}function r(){return new Promise(function(t){!endpoint.parent||parseUri(location.href).queryKey.autoboot?t():($(e("./core/receiver").all).on("new_session",t),window.parent.postMessage({type:"loaded"},"*"))})}function o(){E&&$("html").addClass("opaque"),j&&$("html").addClass("mobile"),i().then(function(){c()||a()||($("head").attr("metadata",""),angular.bootstrap(document,["reader"],{strictDi:!0}))});var t=e("./core/user");t.fetch().finally(function(){t.signedIn()&&(e("./core/user_storage").setPrefix(t.get().id),trackJs&&trackJs.configure({userId:t.get().id}))}),s()}function s(){var t=e("./core/utils/util"),n=e("./core/update"),i=e("./core/command");$(i).on("reload",t.reload),$(i).on("force_update",function(){n.available().then(t.reload)})}function a(){var t=e("./core/compatible");return!t().result&&(h(d()),!0)}function c(){var t=e("./core/compatible");return!(!I.get()||"mobile_browser"!=t().message)&&(I.getProxiedArticle(f()).then(function(e){return h(e.url)}).catch(function(){return h(u(f()))}),!0)}function l(){var e=parseUri(location.href);return!(e.queryKey.lightbox||e.queryKey.parent_url)}function u(t){return sprintf("%s/%s",e("./core/endpoint").dx_doi,t)}function d(){var t=e("./core/endpoint"),n=I.get()?t.authors_springernature:t.web;return sprintf("%s/unsupported/%s",n,f())}function h(t){e("./core/utils/util").redirectOrPost(t)}function f(){var e=decodeURIComponent(location.href.split("?")[0]),t=e.match(S);if(t)return t[0];var n=parseUri(location.href),i=n.queryKey.doi;return i?i.replace(/~2F/g,"/"):"unknown"}function p(){var t=e("./core/utils/util");return t.readcube("discover")?S.source:"^$"}function m(t,n,i){function r(e){return t(function(t){n.loadScript(e,t)})}return r(i.scripts.easeljs).then(function(){return t.all([r(i.scripts.tweenjs),r(i.scripts.movieclip)])}).then(function(){return e("./error/animation.js")})}function g(){return e("./core/includes/init_mixpanel")(),mixpanel.track("Loaded",{Client:"Web Reader"}),mixpanel}function v(){return e("./core/includes/init_ga")(),ga("require","displayfeatures"),ga("send","pageview"),ga}function _(e,t,n,i,r,o,s){var a=n.defer();return r.fetch().then(function(){a.resolve(r)}).catch(function(n){a.reject(n),401==n.status?h(sprintf("%s/session/new?redirect=%s",o.web,encodeURIComponent(location.href))):(s(n,t),e.go("error.500",null,{location:!1}))}),a.promise}function w(e,t,n){return t.init({doi:e.doi,preview:"1"}).catch(function(t){t.error&&trackError(t,e),"content_missing"==t.error&&h(u(e.doi))}).finally(function(){window.parent.postMessage({type:"initialized"},"*")}),n.init(),t}function b(e,t,n,i,r,o,s,a){return r.init({doi:t.doi},n.pickDefined(t,O)).catch(function(n){return n.error&&a(n,t),i.parent&&"processing"!=n.error?void window.parent.postMessage({type:"html_unavailable"},"*"):"doi_invalid"==n.error?void e.go("error.404",null,{location:!1}):"unsupported_mobile_content"==n.error?void h(d()):/(?:content_not_allowed|content_missing)/.test(n.error)?void h(u(t.doi)):"processing"==n.error?void e.go("processing",null,{location:!1}):void e.go("error.500",null,{location:!1})}).finally(function(){window.parent.postMessage({type:"initialized"},"*")}),o.init(),s.init(),r}function y(){return new Promise(function(e){(window.readcube||{}).viewer_pdf?$.ajax({method:"HEAD",url:window.readcube.viewer_pdf,success:e,error:function(){delete window.readcube.viewer_pdf,e()}}):e()})}function k(e,t,n,i,r,o,s){return y().then(function(){i.init({resource_id:t.resource_id},n.pickDefined(t,["sponsored"])).catch(function(n){return n.error&&s(n,t),/(?:resource_not_found|no_access)/.test(n.error)?void e.go("error.404",null,{location:!1}):"processing"==n.error?void e.go("processing",null,{location:!1}):void e.go("error.500",null,{location:!1})}).finally(function(){window.parent.postMessage({type:"initialized"},"*")}),r.init()}),i}function x(e,t,n,i,r,o){return i.initSupplement(n.pickDefined(t,N)).catch(function(n){return n.error&&o(n,t),"no_access"==n.error?void h(r.app):"resource_not_found"==n.error?void e.go("error.404",null,{location:!1}):"no_preview"==n.error?(e.go("error.404",null,{location:!1}),void h(n.url)):void e.go("error.500",null,{location:!1})}),i}function C(e,t){return function(n,i){t(n),e(n,i)}}function A(e,t){e.endpoint=t,e.$on("$stateChangeError",function(e,t,n,i,r,o){throw o})}function T(t,n,i,r){var o=j?"MobileReaderCtrl":"ReaderCtrl",s=j?"mobile_reader.html":"reader.html",a=j?"mobile_reader.html":"library.html";t.decorator("$exceptionHandler",C),r.html5Mode(!0).hashPrefix("!"),i.otherwise(function(){h(e("./core/endpoint").web)}),n.state("error",{abstract:!0,url:"^/error",controller:"ErrorCtrl",templateUrl:"error/error.html",resolve:{errorAnimation:m}}).state("error.404",{url:"/404",templateUrl:"error/404.html"}).state("error.500",{url:"/500",templateUrl:"error/500.html"}).state("processing",{url:"^/processing",controller:"ProcessingCtrl",templateUrl:"error/processing.html"}).state("supplement",{url:sprintf("^/supplement?%s",N.join("&")),controller:"SupplementCtrl",templateUrl:"supplement.html",resolve:{supplement:x}}).state("resolve",{url:"^/resolve/:resource_id?types",controller:"ResolveCtrl",templateUrl:"resolve.html",resolve:{article:k,user:_},params:{types:"DOI,PMID,ISBN,Journal,Year,Title,Author"}}).state("sponsored",{url:sprintf("^/s/{resource_id:%s}",X.source),controller:o,templateUrl:a,resolve:{article:k,mixpanel:g,ga:v},params:{sponsored:"1"}}).state("discover",{url:sprintf("^/{doi:%s}",p()),controller:"DiscoverCtrl",templateUrl:"discover.html",resolve:{article:w}}).state("reader",{url:sprintf("^/{doi:%s}?%s",S.source,D.join("&")),controller:o,templateUrl:s,resolve:{article:b,ga:v}}).state("library",{url:sprintf("^/{resource_id:%s}?%s",X.source,P.join("&")),controller:o,templateUrl:a,resolve:{user:_,article:k,mixpanel:g,ga:v}})}READER_VERSION={version:"1.0.12",assets:"1.0.6",build:"2018-06-08T10:03:04.748Z"},m.$inject=["$q","util","endpoint"],_.$inject=["$state","$stateParams","$q","util","user","endpoint","trackError"],w.$inject=["$stateParams","article","renderingFixes"],b.$inject=["$state","$stateParams","util","endpoint","article","access","renderingFixes","trackError"],k.$inject=["$state","$stateParams","util","article","access","endpoint","trackError"],x.$inject=["$state","$stateParams","util","article","endpoint","trackError"],C.$inject=["$delegate","trackError"],A.$inject=["$rootScope","endpoint"],T.$inject=["$provide","$stateProvider","$urlRouterProvider","$locationProvider"],e("./core/includes/trackjs"),e("./core/tracking/session"),angular.module("reader",["ui.router","ngMaterial"]),e("../../tmp/scripts/templates"),{controllers:{ArticleCtrl:e("./controllers/ArticleCtrl.js"),ArticleToolsCtrl:e("./controllers/ArticleToolsCtrl.js"),DiscoverCtrl:e("./controllers/DiscoverCtrl.js"),ErrorCtrl:e("./controllers/ErrorCtrl.js"),FigureViewerCtrl:e("./controllers/FigureViewerCtrl.js"),MenuBarCtrl:e("./controllers/MenuBarCtrl.js"),MobileReaderCtrl:e("./controllers/MobileReaderCtrl.js"),MobileToolbarCtrl:e("./controllers/MobileToolbarCtrl.js"),ProcessingCtrl:e("./controllers/ProcessingCtrl.js"),ReaderCtrl:e("./controllers/ReaderCtrl.js"),ResolveCtrl:e("./controllers/ResolveCtrl.js"),SupplementCtrl:e("./controllers/SupplementCtrl.js"),ViewerToolbarCtrl:e("./controllers/ViewerToolbarCtrl.js"),dialogs:{ComplimentaryCtrl:e("./controllers/dialogs/ComplimentaryCtrl.js"),ExportCtrl:e("./controllers/dialogs/ExportCtrl.js"),MyLibrarySuccessCtrl:e("./controllers/dialogs/MyLibrarySuccessCtrl.js"),PrintCtrl:e("./controllers/dialogs/PrintCtrl.js"),ShareCtrl:e("./controllers/dialogs/ShareCtrl.js"),ShareWileyCtrl:e("./controllers/dialogs/ShareWileyCtrl.js"),UnavailableCtrl:e("./controllers/dialogs/UnavailableCtrl.js")},sidenav:{LeaveFeedbackCtrl:e("./controllers/sidenav/LeaveFeedbackCtrl.js"),SupplementsCtrl:e("./controllers/sidenav/SupplementsCtrl.js")},toast:{AccessForbiddenCtrl:e("./controllers/toast/AccessForbiddenCtrl.js"),AnnotsNotSyncedCtrl:e("./controllers/toast/AnnotsNotSyncedCtrl.js"),AuthFailedCtrl:e("./controllers/toast/AuthFailedCtrl.js"),PromptRegisterCtrl:e("./controllers/toast/PromptRegisterCtrl.js"),ReadPersonalCtrl:e("./controllers/toast/ReadPersonalCtrl.js"),RentalExpiryCtrl:e("./controllers/toast/RentalExpiryCtrl.js"),SharedAccessCtrl:e("./controllers/toast/SharedAccessCtrl.js"),SharedAccessWileyCtrl:e("./controllers/toast/SharedAccessWileyCtrl.js"),SyncedAdCtrl:e("./controllers/toast/SyncedAdCtrl.js"),UpdateAvailableCtrl:e("./controllers/toast/UpdateAvailableCtrl.js")}}},{directives:{advertLeaderboard:e("./directives/advertLeaderboard.js"),annotations:e("./directives/annotations.js"),appnav:e("./directives/appnav.js"),article:e("./directives/article.js"),articleAnnotations:e("./directives/articleAnnotations.js"),articleCitations:e("./directives/articleCitations.js"),articleTools:e("./directives/articleTools.js"),bgImage:e("./directives/bgImage.js"),cancelEvent:e("./directives/cancelEvent.js"),checkout:e("./directives/checkout.js"),citedBy:e("./directives/citedBy.js"),clipboard:e("./directives/clipboard.js"),figure:e("./directives/figure.js"),hammerSidenav:e("./directives/hammerSidenav.js"),infiniteScroll:e("./directives/infiniteScroll.js"),login:e("./directives/login.js"),menuBar:e("./directives/menuBar.js"),metadata:e("./directives/metadata.js"),metrics:e("./directives/metrics.js"),mobileAnnotations:e("./directives/mobileAnnotations.js"),mobileArticle:e("./directives/mobileArticle.js"),mobileArticleAnnotations:e("./directives/mobileArticleAnnotations.js"),mobileSlider:e("./directives/mobileSlider.js"),mobileToolbar:e("./directives/mobileToolbar.js"),onLoad:e("./directives/onLoad.js"),pageInfo:e("./directives/pageInfo.js"),postSelection:e("./directives/postSelection.js"),readMode:e("./directives/readMode.js"),references:e("./directives/references.js"),referrenceList:e("./directives/referrenceList.js"),responsive:e("./directives/responsive.js"),supplementInfo:e("./directives/supplementInfo.js"),targetClick:e("./directives/targetClick.js"),viewer:e("./directives/viewer.js"),viewerToolbar:e("./directives/viewerToolbar.js")}},{services:{altmetricInit:e("./services/altmetricInit.js"),articleExport:e("./services/articleExport.js"),articlePrint:e("./services/articlePrint.js"),core:e("./services/core.js"),figureViewer:e("./services/figureViewer.js"),infoBar:e("./services/infoBar.js"),introTip:e("./services/introTip.js"),share:e("./services/share.js"),toast:e("./services/toast.js"),userModal:e("./services/userModal.js"),userSidenav:e("./services/userSidenav.js"),videoPlayer:e("./services/videoPlayer.js")}},{filters:{articleKeywords:e("./filters/articleKeywords.js"),authorShortName:e("./filters/authorShortName.js"),breaksToSpaces:e("./filters/breaksToSpaces.js"),clipTitle:e("./filters/clipTitle.js"),figureCaption:e("./filters/figureCaption.js"),formatDate:e("./filters/formatDate.js"),join:e("./filters/join.js"),kilo:e("./filters/kilo.js"),linkify:e("./filters/linkify.js"),refPublishInfo:e("./filters/refPublishInfo.js"),rentalDuration:e("./filters/rentalDuration.js"),trustUrl:e("./filters/trustUrl.js")}};var E=l(),j=e("./core/utils/mobile_detect").any,S=/10\.\d{3,9}.+/,X=/.+:[0-9a-fA-F]{8}(?:-[0-9a-fA-F]{4}){3}-[0-9a-fA-F]{12}/,I=e("./core/access_token"),Y=(I.SHARING_TOKENS,I.ACCESS_TOKENS),P=["preview","please","use_s3","pdfjs","intro","scibite"],R=["purchase_referrer","purchase_site_license","tracking_referrer","tracking_action"],N=["resource_id","doi","index","lang","sponsored","ssl","st"].concat(P),O=["parent_url","lang","cochrane","publisher","shared_annotations"].concat(Y).concat(P),D=["ssl","lightbox","show_close","standalone_access","banner","no_additional_access"].concat(O).concat(R);angular.module("reader").constant("MOBILE",j).constant("SUPPL_PARAMS",N).constant("CONST",e("./core/includes/const")).constant("API_KEYS",e("./core/includes/api_keys")).config(T).run(A),r().finally(o)},{"../../tmp/scripts/templates":218,"./controllers/ArticleCtrl.js":45,"./controllers/ArticleToolsCtrl.js":46,"./controllers/DiscoverCtrl.js":47,"./controllers/ErrorCtrl.js":48,"./controllers/FigureViewerCtrl.js":49,"./controllers/MenuBarCtrl.js":50,"./controllers/MobileReaderCtrl.js":51,"./controllers/MobileToolbarCtrl.js":52,"./controllers/ProcessingCtrl.js":53,"./controllers/ReaderCtrl.js":54,"./controllers/ResolveCtrl.js":55,"./controllers/SupplementCtrl.js":56,"./controllers/ViewerToolbarCtrl.js":57,"./controllers/dialogs/ComplimentaryCtrl.js":58,"./controllers/dialogs/ExportCtrl.js":59,"./controllers/dialogs/MyLibrarySuccessCtrl.js":60,"./controllers/dialogs/PrintCtrl.js":61,"./controllers/dialogs/ShareCtrl.js":62,"./controllers/dialogs/ShareWileyCtrl.js":63,"./controllers/dialogs/UnavailableCtrl.js":64,"./controllers/sidenav/LeaveFeedbackCtrl.js":65,"./controllers/sidenav/SupplementsCtrl.js":66,"./controllers/toast/AccessForbiddenCtrl.js":67,"./controllers/toast/AnnotsNotSyncedCtrl.js":68,"./controllers/toast/AuthFailedCtrl.js":69,"./controllers/toast/PromptRegisterCtrl.js":70,"./controllers/toast/ReadPersonalCtrl.js":71,"./controllers/toast/RentalExpiryCtrl.js":72,"./controllers/toast/SharedAccessCtrl.js":73,"./controllers/toast/SharedAccessWileyCtrl.js":74,"./controllers/toast/SyncedAdCtrl.js":75,"./controllers/toast/UpdateAvailableCtrl.js":76,"./core/access_token":78,"./core/command":94,"./core/compatible":95,"./core/endpoint":97,"./core/includes/api_keys":103,"./core/includes/const":104,"./core/includes/init_ga":107,"./core/includes/init_mixpanel":108,"./core/includes/trackjs":111,"./core/receiver":116,"./core/tracking/session":127,"./core/update":131,"./core/user":132,"./core/user_storage":133,"./core/utils/mobile_detect":139,"./core/utils/util":147,"./directives/advertLeaderboard.js":157,"./directives/annotations.js":158,"./directives/appnav.js":159,"./directives/article.js":160,"./directives/articleAnnotations.js":161,"./directives/articleCitations.js":162,"./directives/articleTools.js":163,"./directives/bgImage.js":164,"./directives/cancelEvent.js":165,"./directives/checkout.js":166,"./directives/citedBy.js":167,"./directives/clipboard.js":168,"./directives/figure.js":169,"./directives/hammerSidenav.js":170,"./directives/infiniteScroll.js":171,"./directives/login.js":172,"./directives/menuBar.js":173,"./directives/metadata.js":174,"./directives/metrics.js":175,"./directives/mobileAnnotations.js":176,"./directives/mobileArticle.js":177,"./directives/mobileArticleAnnotations.js":178,"./directives/mobileSlider.js":179,"./directives/mobileToolbar.js":180,"./directives/onLoad.js":181,"./directives/pageInfo.js":182,"./directives/postSelection.js":183,"./directives/readMode.js":184,"./directives/references.js":185,"./directives/referrenceList.js":186,"./directives/responsive.js":187,"./directives/supplementInfo.js":188,"./directives/targetClick.js":189,"./directives/viewer.js":190,"./directives/viewerToolbar.js":191,"./error/animation.js":192,"./filters/articleKeywords.js":193,"./filters/authorShortName.js":194,"./filters/breaksToSpaces.js":195,"./filters/clipTitle.js":196,"./filters/figureCaption.js":197,"./filters/formatDate.js":198,"./filters/join.js":199,"./filters/kilo.js":200,"./filters/linkify.js":201,"./filters/refPublishInfo.js":202,"./filters/rentalDuration.js":203,"./filters/trustUrl.js":204,"./services/altmetricInit.js":206,"./services/articleExport.js":207,"./services/articlePrint.js":208,"./services/core.js":209,"./services/figureViewer.js":210,"./services/infoBar.js":211,"./services/introTip.js":212,"./services/share.js":213,"./services/toast.js":214,"./services/userModal.js":215,"./services/userSidenav.js":216,"./services/videoPlayer.js":217}],206:[function(e,t,n){function i(e,t,n,i){function r(e,t){return/nature|wiley|ats/.test(t)?("ats"==t&&(t="atsjournals"),sprintf("%s//%s.altmetric.com/details/%s",location.protocol,t,e.altmetric_id)):e.details_url}var o=null;return new Promise(function(s,a){return o?void s(o):void n.onInit(function(){return n.get().doi?void e.get(sprintf("%s/v1/doi/%s",t.altmetric,n.get().doi),{params:{key:i.altmetric}}).then(function(e){s(o={images:e.data.images,score:Math.ceil(e.data.score),detailsUrl:r(e.data,n.get().publisher)})},a):void a()})})}i.$inject=["$http","endpoint","article","API_KEYS"],angular.module("reader").factory("altmetricInit",i)},{}],207:[function(e,t,n){function i(e,t,n,i,r,o,s,a){function c(t,n){var r={targetEvent:t,clickOutsideToClose:!0,locals:{action:n}};i.isShared()?e.show(e.alert(angular.merge(r,{templateUrl:"dialogs/complimentary_access.html",controller:"ComplimentaryCtrl"}))):e.show(e.alert(angular.merge(r,{templateUrl:"dialogs/action_unavailable.html",controller:"UnavailableCtrl"})))}function l(t){e.show(e.alert({targetEvent:t,clickOutsideToClose:!0,templateUrl:"dialogs/print_options.html",controller:"PrintCtrl"}))}function u(e){return i.isPersonal()||!r.externalCheckAvailable()||i.get()[e+"_url"]}function d(e,t){i.onceAccessChecked(function(){u(e)?t():r.onExternalCheck(t)})}function h(e){return t.post(n.services+"/reader/pdf",e,{headers:{contentType:"application/json; charset=UTF-8"}})}function f(){var e=i.get().location||{},t=i.get().cover,n=i.get().back,r=i.get().pdf_url,o=s.listArr();return t||n||o.length||/^china$/i.test(e.country||"")?h({url:r,annotations:o,cover:t,back:n}).then(function(e){location.href=e.data.redirect},function(){location.href=r}):(location.href=r,Promise.resolve())}function p(e){return new Promise(function(t,n){d("pdf",function(){i.get().pdf_url?(o.download(!0),a("download_pdf"),f().then(t,n)):i.hasAccess()?(o.download(!1),c(e,"download"),n("rental")):(o.download(!1),n("preview"))})})}function m(e){return new Promise(function(t,n){d("print",function(){i.get().print_url?(l(e),t()):i.hasAccess()?(c(e,"print"),n("rental")):n("preview")})})}var g={};return g.download=p,g.print=m,g}i.$inject=["$mdDialog","$http","endpoint","article","access","tracker","annotationsModel","notifyParent"],angular.module("reader").factory("articleExport",i)},{}],208:[function(e,t,n){function i(e,t,n,i,r,o,s,a,c,l,u){function d(){return r.local.get("readcube-print-annotations")}function h(t){return e.post(i.services+"/reader/pdf",t)}function f(){var e={print:!0,url:o.get().pdf_url,cover:o.get().cover,back:o.get().back},t=l.listArr();return t.length&&d()&&(e.annotations=t),e}function p(){return new Promise(function(e){b?e():$.getScript(i.scripts.cpgadget,function(){b=new cloudprint.Gadget,e()})})}function m(){return c.saveCloud(),a.item.add().catch(_.noop)}function g(){c.print("hd");var e=o.get().location||{},t=o.get().cover,n=o.get().print_url;return t||d()||/^china$/i.test(e.country||"")?h(f()).then(function(e){window.open(e.data.redirect,"_blank")},function(){window.open(n,"_blank")}):(window.open(n,"_blank"),Promise.resolve())}function v(){return c.print("cloud"),p().then(function(){b.setPrintDocument("url","",o.get().print_url),b.openPrintDialog()})}function w(){return c.print("mobile"),s.signedIn()?m():new Promise(function(e){u.showRegister({params:{tracking_action:"print_send_to_mobile",tracking_origin:c.trackingOrigin()},onAuth:function(){m().then(e)}})})}var b=null;return{pdf:g,cloud:v,mobile:w}}i.$inject=["$http","util","browser","endpoint","storage","article","user","sync","tracker","annotationsModel","userModal"],angular.module("reader").factory("articlePrint",i)},{}],209:[function(e,t,n){angular.module("reader").factory("access",function(){return e("../core/access")}).factory("accessToken",function(){return e("../core/access_token")}).factory("annotationsController",function(){return e("../core/annotations/annotations_controller")}).factory("annotationsModel",function(){return e("../core/annotations/annotations_model")}).factory("article",function(){return e("../core/article")}).factory("banner",function(){return e("../core/banner")}).factory("browser",function(){return e("../core/utils/browser")}).factory("citationsModel",function(){return e("../core/citations/citations_model")}).factory("citationDrawer",function(){return e("../core/citations/citation_drawer")}).factory("command",function(){return e("../core/command")}).factory("endpoint",function(){return e("../core/endpoint")}).factory("environment",function(){return e("../core/environment")}).factory("exporter",function(){return e("../core/export/exporter")}).factory("initMixpanel",function(){return e("../core/includes/init_mixpanel")}).factory("notifyParent",function(){return e("../core/tracking/notify_parent")}).factory("popover",function(){return e("../core/elements/popover")}).factory("receiver",function(){return e("../core/receiver")}).factory("Selection",function(){return e("../core/annotations/selection")}).factory("SelectionToolbar",function(){return e("../core/annotations/selection_toolbar")}).factory("storage",function(){return e("../core/utils/storage")}).factory("sync",function(){return e("../core/sync/sync")}).factory("supplement",function(){return e("../core/supplement")}).factory("update",function(){return e("../core/update")}).factory("user",function(){return e("../core/user")}).factory("userStorage",function(){return e("../core/user_storage")}).factory("util",function(){return e("../core/utils/util")}).factory("pdfjsBlacklist",function(){return e("../core/pdfjs_blacklist")}).factory("rangeSerializer",function(){return e("../core/utils/range_serializer")}).factory("renderingFixes",function(){return e("../core/rendering_fixes")}).factory("Rect",function(){return e("../core/utils/rect")}).factory("ResolveToolbar",function(){return e("../core/annotations/resolve_toolbar")}).factory("termiteModel",function(){return e("../core/termite/termite_model")}).factory("trackId",function(){return e("../core/tracking/track_id")}).factory("tracker",function(){return e("../core/tracking/tracker")}).factory("trackError",function(){return e("../core/tracking/track_error")}).factory("visibility",function(){return e("../core/utils/visibility")}).factory("viewer",function(){return e("../core/viewer/viewer")}).factory("mobileViewer",function(){return e("../core/viewer/mobile_viewer")})},{"../core/access":77,"../core/access_token":78,"../core/annotations/annotations_controller":82,"../core/annotations/annotations_model":83,"../core/annotations/resolve_toolbar":85,"../core/annotations/selection":86,"../core/annotations/selection_toolbar":87,"../core/article":88,"../core/banner":89,"../core/citations/citation_drawer":91,"../core/citations/citations_model":93,"../core/command":94,"../core/elements/popover":96,"../core/endpoint":97,"../core/environment":98,"../core/export/exporter":100,"../core/includes/init_mixpanel":108,"../core/pdfjs_blacklist":114,"../core/receiver":116,"../core/rendering_fixes":117,"../core/supplement":119,"../core/sync/sync":122,"../core/termite/termite_model":124,"../core/tracking/notify_parent":125,"../core/tracking/track_error":128,"../core/tracking/track_id":129,"../core/tracking/tracker":130,"../core/update":131,"../core/user":132,"../core/user_storage":133,"../core/utils/browser":135,"../core/utils/range_serializer":141,"../core/utils/rect":142,"../core/utils/storage":143,"../core/utils/util":147,"../core/utils/visibility":148,"../core/viewer/mobile_viewer":152,"../core/viewer/viewer":156}],210:[function(e,t,n){function i(e,t,n){function i(i){function r(){o&&o.$destroy(),s&&s.remove(),$(".reader").removeClass("distraction-free")}var o=angular.merge(n.$new(!0),{index:i,close:r}),s=e(t.get("figure_viewer.html"))(o);s.on("mousedown mouseup click",function(e){e.stopPropagation()}),$(".reader").addClass("distraction-free").append(s)}return i}i.$inject=["$compile","$templateCache","$rootScope"],angular.module("reader").factory("figureViewer",i)},{}],211:[function(e,t,n){function i(e){function t(t){return $(".reader").append(e.get(t.templateUrl)).addClass("info-bar-visible"),++r}function n(e){e&&e!=r||$(".reader").removeClass("info-bar-visible").find(".info-bar").remove()}var i={},r=0;return i.hide=n,i.notifySharedAccessWiley=function(){return t({templateUrl:"info_bar/shared_access_wiley.html"})},i.notifySharedPaywallWiley=function(){return t({templateUrl:"info_bar/shared_paywall_wiley.html"})},i}i.$inject=["$templateCache"],angular.module("reader").factory("infoBar",i)},{}],212:[function(e,t,n){function i(e,t,n,i,r,o,s){function a(e){return"intro-tip:"+e}function c(e){return!1}function l(i){function s(i,r){f=t(n.get(i))(angular.merge(e.$new(!0),{close:function(e){o.close(h),"disable_tips"==e?$(u).trigger("disable-tips"):$(d).trigger("action",[e])}},r))}function l(e,t){r.local.set(a(i),"shown"),h=e,h.on("close.popover",function(){$(d).trigger("close")}),o.open({placement:t,content:f,anchor:h})}if(!c(i))return null;var d={},h=null,f=null;return $(u).on("disable-tips",function(){r.local.set(a(i),"shown"),$(d).trigger("close")}),d.compile=s,d.show=l,d}var u={};return{create:l,enabled:c}}i.$inject=["$rootScope","$compile","$templateCache","$stateParams","storage","popover","article"],angular.module("reader").factory("introTip",i)},{}],213:[function(e,t,n){function i(e,t,n,i,r,o){function s(e){o("create_sharing_link",{share:{token:e.token}})}function a(e){return e?r.writeShared().then(function(e){return n.generateSharedAccess({shared_annotations:e,url:u}).then(function(e){return s(e),i.shareToken(e.token),e})}):new Promise(function(e,t){l?e(l):n.generateSharedAccess({url:u}).then(function(t){s(t),i.shareToken(t.token),e(l=t)},t)})}var c={},l=null,u=[location.protocol,"//",location.host,location.pathname].join("");if("wiley"==n.get().publisher){var d=n.get().doi,h=(n.get().options||{}).cochrane;h?u=t.parent.split(/[?#]/)[0]:e.production()?u="https://onlinelibrary.wiley.com/doi/epdf/"+d:t.parent&&(u="https://"+parseUri(t.parent).host+"/doi/epdf/"+d),u=encodeURI(u)}return c.generate=a,c}i.$inject=["environment","endpoint","article","tracker","annotationsModel","notifyParent"],angular.module("reader").factory("share",i)},{}],214:[function(e,t,n){function i(e,t,n,i){function r(e){return i?e.replace("toast/","toast/mobile/"):e}function o(n){if(!e.includes("error"))return t.show(angular.merge({locals:{toastId:++c},position:i?"bottom":"top right",hideDelay:!1},n)),c}function s(e){e&&e!=c||t.hide()}var a={},c=0;return a.hide=s,a.notifyMessage=function(e){return o({templateUrl:r("toast/info_message.html"),controller:["$scope",function(n){n.message=e,n.close=function(){t.hide()}}]})},a.notifyUpdateAvailable=function(){return o({templateUrl:r("toast/update_available.html"),controller:"UpdateAvailableCtrl"})},a.notifyRentalExpiry=function(){return o({templateUrl:r("toast/rental_expiry.html"),controller:"RentalExpiryCtrl"})},a.notifyReadPersonal=function(){return o({templateUrl:r("toast/read_personal.html"),controller:"ReadPersonalCtrl"})},a.notifyAuthFailed=function(){return o({templateUrl:r("toast/auth_failed.html"),controller:"AuthFailCtrl"})},a.notifyAccessForbidden=function(){
return o({templateUrl:r("toast/access_forbidden.html"),controller:"AccessFrobiddenCtrl"})},a.notifySharedAccess=function(){return o({templateUrl:r("toast/shared_access.html"),controller:"SharedAccessCtrl"})},a.notifySharedAccessWiley=function(){return o({locals:{type:"access"},templateUrl:r("toast/shared_access_wiley.html"),controller:"SharedAccessWileyCtrl"})},a.notifySharedPaywallWiley=function(){return o({locals:{type:"paywall"},templateUrl:r("toast/shared_access_wiley.html"),controller:"SharedAccessWileyCtrl"})},a.notifyAnnotsNotSynced=function(){if(!a.notifyAnnotsNotSynced.shown)return a.notifyAnnotsNotSynced.shown=!0,o({templateUrl:r("toast/annots_not_synced.html"),controller:"AnnotsNotSyncedCtrl"})},a.showSyncedAd=function(){if(!n.get("synced-ad-shown"))return n.set("synced-ad-shown",!0),o({templateUrl:r("toast/synced_ad.html"),controller:"SyncedAdCtrl"})},a.promptRegister=function(e){return o({templateUrl:r("toast/prompt_register.html"),controller:"PromptRegisterCtrl",locals:{onAuth:e}})},window.toast=a,a}i.$inject=["$state","$mdToast","userStorage","MOBILE"],angular.module("reader").factory("toast",i)},{}],215:[function(e,t,n){function i(e,t,n,i,r){function o(n,r){var o="register"==n?"/user/new":"/session/new";return i.production()||(o="/authentication"),e.addParams(t.web+o,e.merge(h,r))}function s(e,t){t=t||{},r.show(r.alert({templateUrl:"dialogs/user.html",clickOutsideToClose:!0,targetEvent:t.targetEvent,controller:["$scope","endpoint",function(n,i){n.endpoint=i,n.showLogin=c,n.showRegister=l,n.src=o(e,t.params),t.registerAd&&(n.registerAd=t.registerAd,n.closeRegisterAd=function(){n.registerAd=null}),a(function(e,i){t.onAuth&&t.onAuth(i),t.successAd?n.successAd=t.successAd:u()})}]}))}function a(e){$(n).off("auth.single"),$(n).one("auth.single",e)}function c(e){s("login",e)}function l(e){s("register",e)}function u(){return r.hide()}var d={},h={parent_url:location.toString(),embed:1,html5:1};return d.showLogin=c,d.showRegister=l,d.hide=u,d}i.$inject=["util","endpoint","user","environment","$mdDialog"],angular.module("reader").factory("userModal",i)},{}],216:[function(e,t,n){function i(e,t,n,i,r,o,s,a,c){function l(e,n){var i=a.$new(!0);return i.title=n.title||"Login / Register",i.endpoint=t,i.src=u(e,n.params),i.close=m,n.registerAd&&(i.registerAd=n.registerAd,i.closeRegisterAd=function(){i.registerAd=null}),i}function u(n,r){var o="register"==n?"/user/new":"/session/new";return i.production()||(o="/authentication"),e.addParams(t.web+o,e.merge(_,r))}function d(e,t){$("#user-sidenav").remove();var n=s.get("sidenav/mobile_user.html");o(n)(l(e,t)).appendTo(document.body),c("user").open()}function h(e){$(n).off("auth.single"),$(n).one("auth.single",function(t,n){e&&e(n)})}function f(e){h(e.onAuth),d("login",e)}function p(e){h(e.onAuth),d("register",e)}function m(){$("#user-sidenav").length&&c("user").close().then(function(){$("#user-sidenav").remove()})}function g(){$(n).on("auth",m)}var v={},_={parent_url:location.toString(),mobile:1,embed:1,html5:1};return g(),v.showLogin=f,v.showRegister=p,v.hide=m,v}i.$inject=["util","endpoint","user","environment","$sce","$compile","$templateCache","$rootScope","$mdSidenav"],angular.module("reader").factory("userSidenav",i)},{}],217:[function(e,t,n){function i(e,t,n,i,r,o,s){function a(e){return new Promise(function(e){window.videojs?e():(r.loadCss(o.stylesheets.videojs),$.getScript(o.scripts.videojs,e))})}function c(r){a().then(function(){function o(){a&&a.dispose(),l&&l.$destroy(),u&&u.remove(),$(".reader").removeClass("distraction-free")}var a=null,c="video-"+r.index,l=angular.merge(e.$new(!0),{mobile:s,videoId:c,video:r,close:o}),u=t(n.get("video_player.html"))(l);u.on("mousedown mouseup click",function(e){e.stopPropagation()}),$(".reader").addClass("distraction-free").append(u),i(function(){a=videojs(c,{width:Math.min(640,.9*screen.width),height:Math.min(480,.9*screen.height-100),autoplay:!0})})})}return c}i.$inject=["$rootScope","$compile","$templateCache","$timeout","util","endpoint","MOBILE"],angular.module("reader").factory("videoPlayer",i)},{}],218:[function(e,t,n){t.exports=angular.module("reader").run(["$templateCache",function(e){e.put("article.html",'<viewer class="viewer hw-accel"\n  article-citations\n  article-annotations>\n  <div id="advert-leaderboard" advert-leaderboard></div>\n  <div id="journal-banner"></div>\n</viewer>\n\n<page-info></page-info>\n<viewer-toolbar></viewer-toolbar>\n\n<ng-include src="\'popover/annotations.html\'"></ng-include>\n'),e.put("article_tools.html",'<div class="article-tools" ng-hide="!toolsEnabled()">\n  <md-fab-speed-dial\n    class="md-scale"\n    md-open="isOpen"\n    md-direction="up"\n    ng-mouseenter="setOpen(true)"\n    ng-mouseleave="setOpen(false, 800)">\n    <md-fab-trigger cancel-event="mousedown mouseup click" role="button">\n      <md-button\n        ng-click="defaultAction && defaultAction.handler()"\n        class="md-fab hw-accel" ng-class="{\'default-action\': defaultAction}">\n        <md-tooltip\n          ng-if="defaultAction.tooltip"\n          md-visible="tooltipVisible"\n          md-direction="left"\n          md-delay="50" md-autohide="false">\n          {{defaultAction.tooltip}}\n        </md-tooltip>\n        <i class="material-icons more">more_vert</i>\n        <i class="material-icons action">{{defaultAction.icon}}</i>\n      </md-button>\n    </md-fab-trigger>\n    <md-fab-actions>\n      <md-button\n        ng-if="::article.get().doi && metadata"\n        ng-click="export($event)"\n        class="md-fab md-raised md-mini export">\n        <md-tooltip md-direction="left" md-visible="tooltipVisible" md-delay="50" md-autohide="false">\n          Export Citation\n        </md-tooltip>\n        <i class="material-icons">file_upload</i>\n      </md-button>\n      <md-button\n        ng-if="::altmetric.score"\n        ng-click="openAltmetric()"\n        class="md-fab md-raised md-mini altmetric">\n        <md-tooltip md-direction="left" md-visible="tooltipVisible" md-delay="50" md-autohide="false">\n          Altmetric ({{::altmetric.score}})\n        </md-tooltip>\n        <div class="altmetric-embed">\n          <img ng-src="{{::altmetric.images.medium}}" width="100px" height="100px">\n        </div>\n      </md-button>\n      <md-button\n        ng-if="::article.get().doi && article.get().meta.url"\n        ng-click="gotoPublisher()"\n        class="md-fab md-raised md-mini goto-publisher">\n        <md-tooltip md-direction="left" md-visible="tooltipVisible" md-delay="50" md-autohide="false">\n          {{::publisherPageLabel || \'Go to article page\'}}\n        </md-tooltip>\n        <i class="material-icons">web</i>\n      </md-button>\n      <md-button\n        ng-if="::article.get().doi && defaultAction.handler != openRelated"\n        ng-click="openRelated()"\n        class="md-fab md-raised md-mini related">\n        <md-tooltip md-direction="left" md-visible="tooltipVisible" md-delay="50" md-autohide="false">\n          Related articles\n        </md-tooltip>\n        <i class="material-icons">layers</i>\n      </md-button>\n      <md-button\n        ng-if="::figures.length"\n        ng-click="openFigures()"\n        class="md-fab md-raised md-mini figures">\n        <md-tooltip md-direction="left" md-visible="tooltipVisible" md-delay="50" md-autohide="false">\n          Figures ({{::figures.length}})\n        </md-tooltip>\n        <i class="material-icons">photo_library</i>\n      </md-button>\n      <md-button\n        ng-if="notesEnabled()"\n        ng-click="toggleAnnots()"\n        class="md-fab md-raised md-mini annotations">\n        <md-tooltip md-direction="left" md-visible="tooltipVisible" md-delay="50" md-autohide="false">\n          Notes <span ng-if="notes.length">({{notes.length}})</span>\n        </md-tooltip>\n        <i class="material-icons">chat</i>\n      </md-button>\n      <md-button\n        ng-if="::article.get().access_share_enabled"\n        ng-click="share($event)"\n        class="md-fab md-raised md-mini share">\n        <md-tooltip md-direction="left" md-visible="tooltipVisible" md-delay="50" md-autohide="false">\n          Share\n        </md-tooltip>\n        <i class="material-icons">share</i>\n      </md-button>\n    </md-fab-actions>\n  </md-fab-speed-dial>\n</div>\n'),e.put("discover.html",'<div class="reader discover-reader article-container">\n  <viewer class="viewer hw-accel"></viewer>\n\n  <div class="bottom unselectable">\n    <a class="publisher-site-link" ng-href="{{::articleUrl}}">\n      View the entire article on\n      <div class="logo"></div>\n      <div class="arrow"></div>\n    </a>\n  </div>\n</div>'),e.put("figure_viewer.html",'<div class="modal-backdrop"></div>\n<div\n  ng-controller="FigureViewerCtrl"\n  ng-class="{\'details-open\': detailsOpen}"\n  class="figure-overlay">\n  <div\n    class="md-whiteframe-z2 figure-details">\n    <h3>{{figure().caption | figureCaptionLabel}}</h3>\n    <md-button class="md-icon-button close grey" ng-click="toggleDetails()">\n      <i class="material-icons">close</i>\n    </md-button>\n    <div class="blue-divider"></div>\n    <h4>{{figure().caption | figureCaptionTitle}}</h4>\n    <span>{{figure().caption | figureCaptionText}}</span>\n  </div>\n  <div class="figure-content">\n    <div class="header md-whiteframe-1dp">\n      <div class="left">\n        <i\n          class="material-icons header-btn icon-btn"\n          ng-click="close()"\n          md-ink-ripple="#FFF">\n          arrow_back\n        </i>\n      </div>\n      <div class="center">\n        <a\n          class="header-btn download"\n          ng-href="{{figure().download_url}}"\n          md-ink-ripple="#FFF">\n          <i class="material-icons">file_download</i>\n          <span>Download</span>\n        </a>\n      </div>\n      <div class="right">\n        <i\n          class="material-icons show-details header-btn icon-btn"\n          ng-click="toggleDetails()"\n          md-ink-ripple="#FFF">\n          chrome_reader_mode\n        </i>\n      </div>\n    </div>\n    <div class="wrap">\n      <div class="full" ng-class="{busy: busy}" target-click="close()">\n        <div class="nav-arrow prev" ng-if="showNav" ng-click="prev()" md-ink-ripple="#FFF">\n          <div class="icon-container">\n            <i class="material-icons">navigate_before</i>\n          </div>\n        </div>\n        <img ng-src="{{figure().url}}" on-load="busy = false"/>\n        <spinner></spinner>\n        <div class="nav-arrow next" ng-if="showNav" ng-click="next()" md-ink-ripple="#FFF">\n          <div class="icon-container">\n            <i class="material-icons">navigate_next</i>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>'),e.put("library.html",'<div class="reader personal" read-mode="distraction-free">\n\n  <div class="content article-container">\n    <article></article>\n    <article-tools></article-tools>\n    <div\n      class="prev-article"\n      ng-if="::goPrev"\n      ng-click="goPrev()">\n      <i class="material-icons">arrow_back</i>\n    </div>\n    <div\n      class="next-article"\n      ng-if="::goNext"\n      ng-click="goNext()">\n      <i class="material-icons">arrow_forward</i>\n    </div>\n  </div>\n\n  <ng-include src="\'sidenav/rcr.html\'"></ng-include>\n  <ng-include src="\'sidenav/supplements.html\'"></ng-include>\n  <ng-include src="\'sidenav/references.html\'"></ng-include>\n  <ng-include src="\'sidenav/annotations.html\'"></ng-include>\n  <ng-include src="\'sidenav/cited_by.html\'"></ng-include>\n  <ng-include src="\'sidenav/figures.html\'"></ng-include>\n  <ng-include src="\'sidenav/related.html\'"></ng-include>\n  <ng-include src="\'sidenav/appnav.html\'"></ng-include>\n\n  <menu-bar><menu-bar>\n</div>\n\n<ng-include class="print-notice" src="\'print_notice.html\'"></ng-include>\n'),e.put("menu_bar.html",'<div\n  class="menu-bar article-menu md-whiteframe-1dp"\n  ng-class="{\'signed-in\': user.signedIn(), \'sharing-token\': $root.sharingToken, \'sharing\': $root.sharing, \'contracted\': contracted}"\n  responsive>\n  <div\n    class="close"\n    ng-if="::showClose"\n    md-ink-ripple="#FFF"\n    ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n  <div class="left">\n    <div\n      class="rc-menu"\n      ng-click="onAppMenuClick($event)"\n      md-ink-ripple="#FFF">\n      <i class="material-icons app-menu">menu</i>\n      <div class="rc-logo"></div>\n      <span class="rc-text">My Library</span>\n    </div>\n  </div>\n  <div class="center">\n    <div\n      class="menu-btn download sticky"\n      ng-class="{busy: downloading}"\n      ng-click="downloadPdf($event)">\n      <div class="inner" md-ink-ripple="#FFF">\n        <div class="icon-container">\n          <div class="spinner-container">\n            <spinner></spinner>\n          </div>\n          <i class="material-icons">file_download</i>\n        </div>\n        <span>Download PDF</span>\n      </div>\n      <md-tooltip ng-if="contracted" md-direction="bottom" md-autohide="true">\n        <span>Download PDF</span>\n      </md-tooltip>\n    </div>\n    <div\n      class="menu-btn download get-access sticky"\n      ng-click="getAccess()">\n      <div class="inner" md-ink-ripple="#FFF">\n        <div class="icon-container">\n          <i class="material-icons">lock_open</i>\n        </div>\n        <span>Get Access</span>\n      </div>\n      <md-tooltip ng-if="contracted" md-direction="bottom" md-autohide="true">\n        <span>Get Access</span>\n      </md-tooltip>\n    </div>\n    <div\n      ng-if="::article.get().sync_enabled"\n      class="menu-btn add-to-library sticky"\n      ng-class="{busy: syncing, added: inLibrary}"\n      ng-click="toggleInLibrary($event)"\n      md-ink-ripple="#FFF">\n      <div class="icon-container">\n        <div class="spinner-container">\n          <spinner></spinner>\n        </div>\n        <i class="material-icons upload">cloud_upload</i>\n        <i class="material-icons in-cloud">cloud</i>\n        <i class="material-icons remove">cloud_off</i>\n      </div>\n      <span class="upload">Add To Library</span>\n      <span class="in-cloud">In Library</span>\n      <span class="remove">Remove</span>\n      <md-tooltip ng-if="contracted" md-direction="bottom" md-autohide="true">\n        {{inLibrary ? \'Remove From Library\' : \'Add To Library\'}}\n      </md-tooltip>\n    </div>\n    <div\n      ng-if="::supplements.length"\n      class="menu-btn md-badge"\n      md-ink-ripple="#FFF"\n      data-badge="{{::supplements.length}}"\n      ng-click="openSupplements()">\n      Supplements\n    </div>\n    <div\n      ng-if="::references.length"\n      class="menu-btn md-badge"\n      md-ink-ripple="#FFF"\n      data-badge="{{::references.length}}"\n      ng-click="openReferences()">\n      References\n    </div>\n    <div\n      ng-if="::article.get().doi && metadata.citations_count"\n      class="menu-btn md-badge metrics"\n      md-ink-ripple="#FFF"\n      ng-attr-data-badge="{{::metadata.citations_count | kilo}}"\n      ng-click="openMetrics()">\n      Cited By\n    </div>\n    <div\n      ng-if="::article.get().doi && metadata.rcr"\n      class="menu-btn md-badge rcr"\n      md-ink-ripple="#FFF"\n      ng-click="openRCR()">\n      RCR: <span>{{::(+metadata.rcr).toFixed(2)}}</span>\n    </div>\n    <md-menu\n      class="menu-btn more sticky"\n      ng-if="::supplements.length || references.length || article.get().doi"\n      md-position-mode="target-right target">\n      <i\n        class="material-icons"\n        ng-click="openMoreMenu($mdOpenMenu, $event)"\n        md-ink-ripple="#FFF">\n        more_vert\n      </i>\n      <md-menu-content width="2" class="more-menu">\n        <md-menu-item ng-if="::supplements.length">\n          <md-button ng-click="openSupplements()">\n            <div class="md-badge" data-badge="{{::supplements.length}}">Supplements</div>\n          </md-button>\n        </md-menu-item>\n        <md-menu-item ng-if="::references.length">\n          <md-button ng-click="openReferences()">\n            <div class="md-badge" data-badge="{{::references.length}}">References</div>\n          </md-button>\n        </md-menu-item>\n        <md-menu-item ng-if="::article.get().doi && metadata.citations_count">\n          <md-button ng-click="openMetrics()">\n            <div class="md-badge" ng-attr-data-badge="{{::metadata.citations_count | kilo}}">Cited By</div>\n          </md-button>\n        </md-menu-item>\n        <md-menu-item ng-if="::article.get().doi && metadata.rcr">\n          <md-button ng-click="openRCR()">\n            <div class="rcr">RCR: <span>{{::(+metadata.rcr).toFixed(2)}}</span></div>\n          </md-button>\n        </md-menu-item>\n      </md-menu-content>\n    </md-menu>\n  </div>\n  <div\n    class="right publisher-logo"\n    ng-if="::!showClose"\n    ng-class="{link: !!publisherLinkout}"\n    ng-click="publisherLinkout()">\n    <i class="material-icons">navigate_next</i>\n  </div>\n</div>\n'),e.put("metadata.html",'<title ng-bind="::meta.title"></title>\n\n<link rel="canonical" href="{{::canonical}}" ng-if="::canonical">\n\n<meta name="description" content="{{::meta.abstract}}" ng-if="::meta.abstract">\n<meta name="keywords" content="{{::meta | articleKeywords}}" ng-if="::meta.journal && meta.doi">\n\n<link rel="schema.DC" href="http://purl.org/dc/elements/1.1">\n\n<meta name="DC.title" content="{{::meta.title}}" ng-if="::meta.title">\n<meta name="DC.identifier" content="doi:{{::meta.doi}}" ng-if="::meta.doi">\n\n<meta name="citation_doi" content="{{::meta.doi}}" ng-if="::render_doi">\n<meta name="citation_title" content="{{::meta.title}}" ng-if="::meta.title">\n<meta name="citation_journal_title" content="{{::meta.journal}}" ng-if="::meta.journal">\n<meta name="citation_volume" content="{{::meta.volume}}" ng-if="::meta.volume">\n<meta name="citation_date" content="{{::meta.year}}" ng-if="::meta.year">\n\n<meta name="citation_author" content="{{::author.name}}" ng-repeat="author in meta.authors">\n<meta name="DC.creator" content="{{::author.name}}" ng-repeat="author in meta.authors">\n\n<meta property="og:type" content="article">\n<meta property="og:url" content="{{::canonical}}" ng-if="::canonical">\n<meta property="og:title" content="{{::meta.title}}" ng-if="::meta.title">\n<meta property="og:description" content="{{::meta.abstract}}" ng-if="::meta.abstract">\n<meta property="og:image" content="{{::image}}" ng-if="::image">\n'),e.put("mobile_reader.html",'<div class="reader" read-mode="distraction-free-mobile">\n  <div class="content article-container">\n    <mobile-article class="viewer mobile-viewer" mobile-article-annotations></mobile-article>\n    <ng-include src="\'popover/annotations.html\'"></ng-include>\n  </div>\n  <mobile-toolbar></mobile-toolbar>\n  <mobile-slider ng-if="numPages > 2"></mobile-slider>\n  <ng-include src="\'sidenav/mobile_menu.html\'"></ng-include>\n  <ng-include src="\'sidenav/rcr.html\'"></ng-include>\n  <ng-include src="\'sidenav/supplements.html\'"></ng-include>\n  <ng-include src="\'sidenav/references.html\'"></ng-include>\n  <ng-include src="\'sidenav/mobile_annotations.html\'"></ng-include>\n  <ng-include src="\'sidenav/cited_by.html\'"></ng-include>\n  <ng-include src="\'sidenav/figures.html\'"></ng-include>\n  <ng-include src="\'sidenav/related.html\'"></ng-include>\n  <ng-include src="\'sidenav/mobile_share.html\'"></ng-include>\n  <ng-include src="\'sidenav/mobile_share_wiley.html\'"></ng-include>\n  <ng-include src="\'sidenav/leave_feedback.html\'"></ng-include>\n</div>\n'),e.put("print_notice.html",'<div class="centered-logo"></div>\n<span>To print this article, please use the print button in the bottom toolbar of the web reader.</span>\n'),e.put("reader.html",'<div class="reader" read-mode="distraction-free">\n\n  <div class="content article-container">\n    <article></article>\n    <article-tools></article-tools>\n  </div>\n\n  <ng-include src="\'sidenav/rcr.html\'"></ng-include>\n  <ng-include src="\'sidenav/supplements.html\'"></ng-include>\n  <ng-include src="\'sidenav/references.html\'"></ng-include>\n  <ng-include src="\'sidenav/annotations.html\'"></ng-include>\n  <ng-include src="\'sidenav/cited_by.html\'"></ng-include>\n  <ng-include src="\'sidenav/figures.html\'"></ng-include>\n  <ng-include src="\'sidenav/related.html\'"></ng-include>\n  <ng-include src="\'sidenav/appnav.html\'"></ng-include>\n  <ng-include src="\'sidenav/checkout.html\'"></ng-include>\n\n  <menu-bar></menu-bar>\n</div>\n\n<ng-include class="print-notice" src="\'print_notice.html\'"></ng-include>\n'),e.put("resolve.html",'<div class="reader resolve-reader article-container">\n  <viewer class="viewer hw-accel" post-selection></viewer>\n\n  <page-info></page-info>\n  <viewer-toolbar></viewer-toolbar>\n\n  <ng-include src="\'popover/resolve_selection.html\'"></ng-include>\n</div>'),e.put("supplement.html",'<div\n  class="reader supplement-reader"\n  ng-class="::{\'links-ready\': toolbarLinks}"\n  read-mode="distraction-free">\n\n  <div class="content article-container">\n    <viewer class="viewer hw-accel" article-annotations></viewer>\n    <page-info></page-info>\n    <viewer-toolbar></viewer-toolbar>\n    <ng-include src="\'popover/annotations.html\'"></ng-include>\n  </div>\n\n  <div class="header article-menu md-whiteframe-1dp"\n    ng-class="{contracted: contracted}" responsive>\n    <div class="left">\n      <div class="title">\n        <span class="caption">\n          {{::caption}}\n        </span>\n        <span class="type" ng-if="::article.get().type">\n          ({{::type}})\n        </span>\n      </div>\n    </div>\n    <div class="center">\n      <a\n        class="header-btn download"\n        ng-attr-target="{{::toolbarLinks.save.target}}"\n        ng-href="{{::toolbarLinks.save.href}}"\n        md-ink-ripple="#FFF">\n        <i class="material-icons">file_download</i>\n        <span>Download</span>\n        <md-tooltip ng-if="contracted" md-direction="bottom" md-autohide="true">\n          Download\n        </md-tooltip>\n      </a>\n      <div\n        ng-if="::details"\n        class="header-btn details"\n        md-ink-ripple="#FFF"\n        ng-click="toggleInfo()">\n        <i class="material-icons">chrome_reader_mode</i>\n        <span>Details</span>\n        <md-tooltip ng-if="contracted" md-direction="bottom" md-autohide="true">\n          Details\n        </md-tooltip>\n      </div>\n      <div\n        class="header-btn md-badge notes"\n        md-ink-ripple="#FFF"\n        ng-attr-data-badge="{{notes.length || undefined}}"\n        ng-click="toggleAnnots()">\n        <i class="material-icons">chat</i>\n        <span>Notes</span>\n        <md-tooltip ng-if="contracted" md-direction="bottom" md-autohide="true">\n          Notes <span ng-if="notes.length">({{notes.length}})</span>\n        </md-tooltip>\n      </div>\n    </div>\n    <div class="right publisher-logo"></div>\n  </div>\n\n  <ng-include src="\'sidenav/annotations.html\'"></ng-include>\n  <ng-include src="\'sidenav/supplement_info.html\'"></ng-include>\n</div>\n\n'),e.put("video_player.html",'<div class="modal-backdrop"></div>\n<div class="video-overlay">\n  <div class="video-content" target-click="close()">\n    <video id="{{::videoId}}" class="video-js vjs-default-skin" controls>\n      <source ng-src="{{::video.url | trustUrl}}" type="video/mp4">\n    </video>\n  </div>\n  <div ng-if="::!mobile" class="header md-whiteframe-1dp">\n    <div class="left">\n      <i\n        class="material-icons header-btn icon-btn"\n        ng-click="close()"\n        md-ink-ripple="#FFF">\n        arrow_back\n      </i>\n    </div>\n    <div class="center">\n      <a\n        class="header-btn download"\n        ng-href="{{::video.download_url}}"\n        md-ink-ripple="#FFF">\n        <i class="material-icons">file_download</i>\n        <span>Download</span>\n      </a>\n    </div>\n  </div>\n  <div ng-if="::mobile" class="header md-whiteframe-1dp">\n    <div class="left">\n      <a\n        class="header-btn download"\n        ng-href="{{::video.download_url}}"\n        md-ink-ripple="#FFF">\n        <i class="material-icons">file_download</i>\n      </a>\n    </div>\n    <div class="center">\n      <span class="header-btn">{{::video.caption}}</span>\n    </div>\n    <div class="right">\n      <i\n        class="material-icons header-btn icon-btn"\n        ng-click="close()"\n        md-ink-ripple="#FFF">\n        close\n      </i>\n    </div>\n  </div>\n</div>\n'),e.put("ads/add_to_library.html",'<div class="add-to-library-ad">\n  <h2 class="md-title">\n    Add this Article to your ReadCube Cloud Library\n  </h2>\n  <ul class="features">\n    <li class="flex-row">\n      <i class="material-icons">cloud</i>\n      <div>\n        Access this article instantly from ReadCubes free\n        <a target="_blank" ng-href="{{::endpoint.app}}">Web Library</a>,\n        <a target="_blank" ng-href="{{::endpoint.web + \'/download\'}}">Desktop</a> and\n        <a target="_blank" ng-href="{{::endpoint.web + \'/download\'}}">Mobile</a> apps.\n      </div>\n    </li>\n    <li class="flex-row">\n      <i class="material-icons">important_devices</i>\n      <div>\n        Save annotations and notes. Plus enjoy Enhanced PDF features offline, including clickable inline citations and automatic supplements.\n      </div>\n    </li>\n    <li class="flex-row">\n      <i class="material-icons">insert_chart</i>\n      <div>Unlock article citation metrics.</div>\n    </li>\n  </ul>\n  <div class="actions">\n    <md-button\n      class="md-primary md-raised"\n      ng-click="closeRegisterAd()">\n      Add to Library\n    </md-button>\n  </div>\n</div>'),e.put("ads/my_library_register.html",'<div class="my-library-register-ad">\n  <h2 class="md-title">\n    Managing References and PDFs Has Never Been Easier\n  </h2>\n  <p>\n    Get your free ReadCube Cloud Library account and enjoy time-saving features including:\n  </p>\n  <ul class="features">\n    <li class="flex-row">\n      <i class="material-icons">cloud</i>\n      <div>\n        Sync your articles to the cloud, and access your papers, supplements and annotations from anywhere.\n      </div>\n    </li>\n    <li class="flex-row">\n      <i class="material-icons">important_devices</i>\n      <div>\n        Read smarter, by transforming your articles into Enhanced PDFs with clickable references and authors, advanced metrics and annotation tools.\n      </div>\n    </li>\n    <li class="flex-row">\n      <i class="material-icons">extension</i>\n      <div>\n        Stay on top of the latest literature with personalized paper recommendations, reading lists and our handy <a target="_blank" ng-href="{{::endpoint.chrome_extension}}">Chrome Extension</a>.\n      </div>\n    </li>\n  </ul>\n  <div class="actions">\n    <md-button\n      class="md-primary md-raised"\n      ng-click="closeRegisterAd()">\n      Get Started\n    </md-button>\n  </div>\n  <p class="existing-user">\n    Already registered? Click <a href ng-click="showLogin()">here</a> to sign in.\n  </p>\n</div>\n'),e.put("ads/my_library_success.html",'<div class="my-library-success-ad" ng-controller="MyLibrarySuccessCtrl">\n  <h2 class="md-title">\n    Thanks for registering!\n  </h2>\n  <p>\n    Visit your ReadCube web library to get started.\n  </p>\n  <md-checkbox\n    class="md-primary"\n    ng-model="savePaper"\n    aria-label="Save This Paper">\n    Save This Paper\n  </md-checkbox>\n  <div class="actions">\n    <a\n      class="md-button md-primary md-raised"\n      target="_blank"\n      ng-href="{{::endpoint.app}}"\n      ng-click="openLibrary()">\n      Take Me There\n    </a>\n  </div>\n</div>\n'),e.put("ads/sent_to_mobile.html",'<div class="sent-to-mobile">\n  <div class="cloud-sync-image"></div>\n  <h2>Synced in the cloud!</h2>\n  <div class="instructions">This article is now synced to your ReadCube library. Open the ReadCube Mobile app (iPhone, iPad, Android) to read this article.</div>\n  <div class="buttons">\n    <a target="_blank" class="appstore-button" ng-href="{{::endpoint.mobile_apps.ios}}"></a>\n    <a target="_blank" class="googleplay-button" ng-href="{{::endpoint.mobile_apps.android}}"></a>\n  </div>\n</div>'),e.put("dialogs/action_unavailable.html",'<md-dialog class="action-unavailable" aria-label="Action Unavailable">\n  <md-dialog-content class="md-dialog-content action-unavailable">\n    <h2 class="md-title">{{::titleAction}} Unavailable</h2>\n    <p class="md-body-1">\n      {{::msgAction}} the PDF outside of ReadCube requires the full PDF purchase option. Rental and Cloud articles can be viewed online and offline in the ReadCube Web, Desktop and Mobile apps but cannot be printed or saved outside of ReadCube.\n    </p>\n    <p class="md-caption" ng-if="::purchaseDate">\n      This article was purchased as a <b>{{::purchaseType}}</b> on <b>{{::purchaseDate | formatDate:\'YYYY/MM/DD\'}}</b>.\n    </p>\n  </md-dialog-content>\n  <md-dialog-actions class="md-actions">\n    <md-button ng-click="close()" class="md-primary md-raised">\n      GOT IT!\n    </md-button>\n  </md-dialog-actions>\n</md-dialog>\n'),e.put("dialogs/complimentary_access.html",'<md-dialog class="action-unavailable" aria-label="Action Unavailable">\n  <md-dialog-content class="md-dialog-content">\n    <h2 class="md-title">{{::titleAction}} Unavailable</h2>\n    <p class="md-body-1">\n      You are viewing a complimentary shared article.\n    </p>\n    <p class="md-body-1">\n      Complimentary shares do not allow {{::msgAction}}. If you have another access method, please visit the regular publisher article page in order to {{::titleAction}}.\n    </p>\n  </md-dialog-content>\n  <md-dialog-actions class="md-actions">\n    <md-button ng-if="::gotoPublisher" ng-click="gotoPublisher()" class="md-primary goto-publisher">\n      Go To Publisher Page\n    </md-button>\n    <md-button ng-if="::!gotoPublisher" ng-click="close()" class="md-primary goto-publisher">\n      Got it!\n    </md-button>\n  </md-dialog-actions>\n</md-dialog>\n'),e.put("dialogs/export.html",'<md-dialog class="export-dialog" aria-label="Export Citation">\n  <md-dialog-content class="md-dialog-content">\n    <h2 class="md-title">Export Citation</h2>\n    <p class="md-body-1">\n      To save this citation to your reference manager software, please select one of the formats below.\n    </p>\n    <md-radio-group ng-model="format">\n      <md-radio-button value="ris" class="md-primary">RIS</md-radio-button>\n      <md-radio-button value="endnote" class="md-primary">Endnote</md-radio-button>\n      <md-radio-button value="mendeley" class="md-primary">Mendeley</md-radio-button>\n      <md-radio-button value="papers" class="md-primary">Papers</md-radio-button>\n      <md-radio-button value="bibtex" class="md-primary">BibTeX</md-radio-button>\n    </md-radio-group>\n  </md-dialog-content>\n  <md-dialog-actions class="md-actions">\n    <md-button ng-click="export(format)" class="md-primary">Export</md-button>\n  </md-dialog-actions>\n</md-dialog>\n'),e.put("dialogs/import_annotations.html",'<md-dialog class="import-annotations-dialog" aria-label="Import Annotations">\n  <md-dialog-content class="md-dialog-content">\n    <h3 class="md-title">Shared Annotations</h3>\n    <p>This article was shared with annotations. Would you like to import the shared annotations to your existing annotations?</p>\n  </md-dialog-content>\n  <md-dialog-actions class="md-actions">\n    <md-button ng-click="close()">View my annotations</md-button>\n    <md-button ng-click="close(true)" class="md-primary md-raised">Import</md-button>\n  </md-dialog-actions>\n</md-dialog>\n'),e.put("dialogs/print_options.html",'<md-dialog class="print-options" aria-label="Print Options">\n  <md-dialog-content class="md-dialog-content">\n    <div class="options" ng-show="!synced">\n      <h2 class="md-headline">article print options</h2>\n      <div\n        ng-click="printPdf()"\n        class="row print-pdf"\n        md-ink-ripple=\'#FFF\'>\n        <i class="material-icons option-icon">print</i>\n        <div class="text">Print High Resolution PDF</div>\n      </div>\n      <div\n        ng-click="sendToMobile()"\n        class="row send-to-tablet"\n        md-ink-ripple=\'#FFF\'>\n        <i class="material-icons option-icon">tablet_mac</i>\n        <div class="text">\n          <span>Send to ReadCube Mobile</span>\n          <div class="fineprint">Read the Enhanced PDF on a mobile device (iPhone, iPad, Android)</div>\n        </div>\n      </div>\n      <div\n        ng-click="cloudPrint()"\n        class="row google-cloud-print"\n        md-ink-ripple=\'#FFF\'>\n        <div class="g-logo option-icon"></div>\n        <div class="text">Google Cloud Print</div>\n      </div>\n    </div>\n    <ng-include src="\'ads/sent_to_mobile.html\'" ng-show="synced"></ng-include>\n  </md-dialog-content>\n</md-dialog>\n'),
e.put("dialogs/share.html",'<md-dialog class="share-dialog" aria-label="Share">\n  <md-dialog-content class="md-dialog-content">\n    <i class="material-icons share">share</i>\n    <div class="md-subhead">SHAREABLE URL</div>\n    <h2 class="md-title">Anyone with this URL can read the full text of this article</h2>\n    <div class="link-container" ng-class="{busy: busy}">\n      <div class="link">\n        <i class="material-icons">link</i>\n      </div>\n      <input\n        type="text"\n        readonly="readonly"\n        ng-model="shareLink"\n        ng-mousedown="select($event)">\n    </div>\n    <div>\n      <md-switch class="md-block" ng-model="includeAnnotations">\n        Include Annotations\n      </md-switch>\n    </div>\n  </md-dialog-content>\n</md-dialog>\n'),e.put("dialogs/share_wiley.html",'<md-dialog class="share-dialog" aria-label="Share">\n  <md-dialog-content class="md-dialog-content">\n    <i class="material-icons share">share</i>\n    <h1>Share</h1>\n    <p>Please review our <a target="_blank" href="https://onlinelibrary.wiley.com/termsAndConditions">Terms and Conditions of Use</a> and check box below to share full-text version of article.</p>\n    <md-checkbox\n      class="md-primary"\n      ng-model="acceptTerms"\n      ng-click="generateLink()"\n      aria-label="Terms and Conditions of Use">\n      I have read and accept the Wiley Online Library Terms and Conditions of Use.\n    </md-checkbox>\n    <h4 class="link-title">Shareable Link</h4>\n    <p class="link-description">Use the link below to share a full-text version of this article with your friends and colleagues. <a target="_blank" href="https://www.wiley.com/WileyCDA/Section/id-829333.html">Learn more.</a></p>\n    <div class="link-container" ng-class="{busy: busy}">\n      <div class="link">\n        <i class="material-icons">link</i>\n      </div>\n      <input\n        id="share-link"\n        type="text"\n        readonly="readonly"\n        ng-model="shareLink"\n        ng-disabled="!acceptTerms"\n        ng-mousedown="select($event)">\n    </div>\n    <md-button\n      class="md-raised copy-shared-url"\n      data-clipboard-target="#share-link"\n      ng-disabled="!acceptTerms || !shareLink || busy"\n      clipboard>\n      Copy URL\n    </md-button>\n  </md-dialog-content>\n</md-dialog>\n'),e.put("dialogs/user.html",'<md-dialog\n  class="user-dialog"\n  ng-class="{\'register-ad\': registerAd, \'success-ad\': successAd}"\n  aria-label="Login or Register">\n  <md-dialog-content class="md-dialog-content">\n    <pre-login\n      ng-if="registerAd"\n      ng-include="registerAd">\n    </pre-login>\n    <login ng-class="{loaded: loaded}">\n      <iframe\n        class="modal login"\n        ng-src="{{::src | trustUrl}}"\n        onmousewheel=""\n        allowtransparency="true"\n        seamless="seamless">\n      </iframe>\n      <spinner></spinner>\n    </login>\n    <post-login\n      ng-if="successAd"\n      ng-include="successAd">\n    </post-login>\n  </md-dialog-content>\n</md-dialog>\n'),e.put("citations/author.html",'<div class="author">\n  <h4 class="name">{{::text}}</h4>\n\n  <div class="affiliations" ng-if="::affiliations">\n    <div ng-repeat="af in ::affiliations">{{::af}}</div>\n  </div>\n\n  <div class="contact" ng-if="::email">\n    <i class="material-icons person">person</i>\n    <a\n      ng-attr-target="{{::email.indexOf(\'mailto:\') == 0 ? undefined : \'_blank\'}}"\n      ng-href="{{::email}}">\n      Contact {{::text}}\n    </a>\n  </div>\n\n  <div class="orcid" ng-if="::orcid_url">\n    <i class="logo"></i>\n    <a\n      target="_blank"\n      ng-href="{{::orcid_url}}">\n      View author on ORCID\n    </a>\n  </div>\n\n  <div class="search">\n    Search for author in:\n    <div class="links">\n      <span\n        ng-repeat="lnk in ::search"\n        ng-hide="::lnk.disabled">\n        <a ng-href="{{::lnk.url}}" target="_blank">{{::lnk.provider}}</a>\n        <span ng-if="!$last">  </span>\n      </span>\n    </div>\n  </div>\n</div>'),e.put("citations/figure.html",'<div class="figure">\n  <div class="view-figure">\n    <img class="thumb" ng-src="{{::figure.thumb}}"/>\n    <div class="launch">\n      <i class="material-icons">launch</i>\n      <span>View</span>\n    </div>\n  </div>\n  <span\n    class="caption"\n    ng-bind-html="::figure.caption | figureCaption">\n  </span>\n</div>\n'),e.put("citations/metrics.html",'<div class="articles">\n  <div\n    class="article reference"\n    ng-repeat="ref in metrics">\n    <h4 class="title" ng-if="::ref.title" ng-bind-html="::ref.title | linkify"></h4>\n    <div class="authors">{{::ref.authors.slice(0, 10) | authorShortName | join:\', \'}}</div>\n    <div class="links">\n      <a\n        target="_blank"\n        ng-if="::ref.url"\n        ng-click="trackLinkout(ref)"\n        ng-href="{{::ref.url}}">\n        Article\n      </a>\n    </div>\n    <div class="published">{{::ref | refPublishInfo}}</div>\n  </div>\n</div>\n'),e.put("citations/references.html",'<div class="articles">\n  <div\n    class="article"\n    ng-class="::{\'reference\': ref.badge, \'hide-badges\': hideBadges}"\n    ng-repeat="ref in ::references">\n    <div\n      ng-if="::ref.badge"\n      title="{{::ref.badge}}"\n      class="number">\n      {{::ref.badge}}\n    </div>\n    <h4 class="title" ng-if="::ref.title" ng-bind-html="::ref.title | linkify"></h4>\n    <div class="authors">{{::ref.authors.slice(0, 10) | join:\', \'}}</div>\n    <div class="links">\n      <a\n        target="_blank"\n        ng-if="::ref.find_article_url"\n        ng-click="trackLinkout(ref)"\n        ng-href="{{::ref.find_article_url}}">\n        Find Article\n      </a>\n      <span ng-if="::ref.find_article_url && ref.article_url"> | </span>\n      <a\n        target="_blank"\n        ng-if="::ref.article_url"\n        ng-click="trackLinkout(ref)"\n        ng-href="{{::ref.article_url}}">\n        Article\n      </a>\n    </div>\n    <div class="published">{{::ref | refPublishInfo}}</div>\n  </div>\n</div>\n'),e.put("error/404.html",'<h1>404</h1>\n<h4>Yikes! The page you requested could not be found.</h4>\n<p>\n  If you think this is an error, contact <a ng-href="{{::supportHref}}">support@readcube.com</a> for assistance.\n</p>\n'),e.put("error/500.html",'<h1>500</h1>\n<h4>Yikes! Something went wrong.</h4>\n<p>\n  Please try again later. If the problem persists,<br>\n  contact <a ng-href="{{::supportHref}}">support@readcube.com</a> for assistance.\n</p>\n<p class="edge-msg">\n  You may also find this support <a ng-href="{{::edgeSupportHref}}">article</a> helpful.\n</p>\n'),e.put("error/error.html",'<div class="error">\n  <canvas id="canvas" width="400" height="300"></canvas>\n  <div\n    class="error-content"\n    ng-class="{\'show-code\': showCode, \'show-message\': showMessage}">\n    <ui-view></ui-view>\n  </div>\n</div>\n'),e.put("error/processing.html",'<div class="processing">\n  <div class="processing-content">\n    <div class="logo pulse"></div>\n    <h2>Article processing...</h2>\n    <p>\n      We\'re still processing this PDF for the Enhanced Web Reader - it shouldn\'t take long so please keep this window open.\n    </p>\n    <p>This page will automatically reload in <em>{{refresh}}</em> seconds...</p>\n  </div>\n</div>\n'),e.put("info_bar/shared_access_wiley.html",'<div class="info-bar md-whiteframe-1dp">\n  <span>Limited access to this article is provided by the Wiley Content Sharing initiative.</span>\n  <a class="md-button" target="_blank" href="http://www.wiley.com/WileyCDA/Section/id-829333.html">Learn more</a>\n</div>'),e.put("info_bar/shared_paywall_wiley.html",'<div class="info-bar dark md-whiteframe-1dp">\n  <span>The Wiley Content Sharing link that you used to access this page is no longer valid.</span>\n  <a class="md-button" target="_blank" href="http://www.wiley.com/WileyCDA/Section/id-829333.html">Learn more</a>\n</div>\n'),e.put("intro_tips/annotations.html",'<div class="intro-tip" aria-label="Intro Tooltip">\n  <h3 class="md-title">Annotations and Notes</h3>\n  <p>Select text to bring up the annotations options - you can highlight and write notes. Any annotations you make are organized and accessible in the side toolbar (bottom right button).</p>\n  <div class="md-actions">\n    <md-button ng-click="close(\'disable_tips\')" class="left">Disable Tips</md-button>\n    <md-button ng-click="close()" class="md-primary md-raised right">Got It!</md-button>\n  </div>\n</div>\n'),e.put("intro_tips/article_tools.html",'<div class="intro-tip" aria-label="Intro Tooltip">\n  <h3 class="md-title">Additional Article Tools</h3>\n  <p>Hover over this button to get additional tools, including related articles, your annotations list, citation file export and figures browser.</p>\n  <div class="md-actions">\n    <md-button ng-click="close(\'disable_tips\')" class="left">Disable Tips</md-button>\n    <md-button ng-click="close()" class="md-primary md-raised right">Got It!</md-button>\n  </div>\n</div>\n'),e.put("intro_tips/inline_citations.html",'<div class="intro-tip" aria-label="Intro Tooltip">\n  <h3 class="md-title">Clickable Citations and Authors</h3>\n  <p>Inline references and author names are interactive and can be hovered or clicked - quickly find cited articles and other publications by the authors.</p>\n  <div class="md-actions">\n    <md-button ng-click="close(\'disable_tips\')" class="left">Disable Tips</md-button>\n    <md-button ng-click="close()" class="md-primary md-raised right">Got It!</md-button>\n  </div>\n</div>\n'),e.put("intro_tips/my_library.html",'<div class="intro-tip" aria-label="Intro Tooltip">\n  <h3 class="md-title">Cloud Reference Library</h3>\n  <p ng-if="!signedIn">\n    With a <strong>free ReadCube account</strong>, store articles and manage your reference library from any web browser.\n  </p>\n  <p ng-if="signedIn">\n    With your existing ReadCube account, store articles and manage your reference library from any web browser.\n  </p>\n  <div class="md-actions">\n    <md-button ng-click="close(\'disable_tips\')" class="left">Disable Tips</md-button>\n    <md-button ng-if="!signedIn" ng-click="close(\'sign_up\')" class="md-primary md-raised right">Sign Up</md-button>\n    <md-button ng-if="signedIn" ng-click="close(\'view_library\')" class="md-primary md-raised right">View Library</md-button>\n  </div>\n</div>\n'),e.put("intro_tips/pulse.html",'<div class="loader-inner ball-scale-multiple">\n  <div></div>\n  <div></div>\n  <div></div>\n</div>\n'),e.put("popover/annotations.html",'<div style="display:none;">\n  <div id="annotations-base-toolbar" class="base-toolbar">\n    <div class="row annot-colors unselectable">\n      <div class="sample color-1" data-colorid="1"></div>\n      <div class="sample color-2" data-colorid="2"></div>\n      <div class="sample color-3" data-colorid="3"></div>\n      <div class="sample color-4" data-colorid="4"></div>\n    </div>\n    <div class="row add-note unselectable">\n      <i class="material-icons">comment</i>\n      <span>Add Note</span>\n    </div>\n    <div class="row edit-note">\n    <textarea placeholder="Type note text here."></textarea>\n    </div>\n    <div class="row delete unselectable">\n      <i class="material-icons">delete</i>\n      <span>Delete</span>\n    </div>\n  </div>\n</div>\n'),e.put("popover/resolve_selection.html",'<div style="display:none;">\n  <div id="resolve-toolbar" class="base-toolbar">\n    <div class="row unselectable" ng-repeat="t in ::types" ng-attr-type="{{::t}}">{{::t}}</div>\n  </div>\n</div>\n'),e.put("sidenav/annotations.html",'<annotations class="md-whiteframe-z2">\n  <h3>Notes</h3>\n  <div class="blue-divider"></div>\n\n  <div ng-if="!annots.length">\n    <h4>You have no notes.</h4>\n    <div class="tip">\n      Tip: To annotate, select any text in the article to get the annotation menu. You can add highlights and comments, which will be listed here in this panel.\n    </div>\n  </div>\n\n  <div ng-if="annots.length">\n    <div class="sort-options layout-row">\n      <md-input-container class="sort-order">\n        <label>Order by:</label>\n        <md-select ng-model="sortPredicate">\n          <md-option ng-value="key" ng-repeat="(key, val) in predicates">{{key}}</md-option>\n        </md-select>\n      </md-input-container>\n      <md-input-container class="sort-direction">\n        <label>Direction:</label>\n        <md-select ng-model="sortDirection">\n          <md-option ng-value="key" ng-repeat="(key, val) in directions">{{key}}</md-option>\n        </md-select>\n      </md-input-container>\n    </div>\n    <div\n      class="note-item"\n      ng-click="scrollTo(annot)"\n      ng-repeat="annot in annots | orderBy:predicates[sortPredicate]:directions[sortDirection]">\n      <div ng-if="sortPredicate == \'created\'" class="note-time-date">\n        <span>{{annotationCreated(annot) | calendarDate}}</span>\n      </div>\n      <div ng-if="sortPredicate != \'created\'" class="note-time-date">\n        <span>{{annotationModified(annot) | calendarDate}}</span>\n      </div>\n      <i class="material-icons delete" ng-click="delete($event, annot)">delete</i>\n      <div class="note-highlight" ng-class="\'color-\' + annot.color_id">{{annot.text | breaksToSpaces}}</div>\n      <div class="note-text" ng-if="annot.note">{{annot.note}}</div>\n    </div>\n  </div>\n\n  <md-button ng-if="annots.length" class="md-icon-button download grey" ng-click="downloadAnnots()">\n    <i class="material-icons">file_download</i>\n    <md-tooltip md-direction="bottom" md-autohide="true">\n      Download as CSV\n    </md-tooltip>\n  </md-button>\n  <md-button class="md-icon-button close grey" ng-click="toggleAnnots()">\n    <i class="material-icons">close</i>\n  </md-button>\n</annotations>\n'),e.put("sidenav/appnav.html",'<md-sidenav\n  class="md-sidenav-left"\n  md-component-id="appnav">\n  <appnav ng-class="{loaded: loaded}">\n    <div class="rc-menu">\n      <div class="rc-logo"></div>\n      <span class="rc-text">readcube</span>\n    </div>\n    <iframe\n      class="appnav-frame"\n      allowTransparency="true"\n      seamless="seamless">\n    </iframe>\n    <spinner></spinner>\n    <logout class="md-whiteframe-2dp">\n      <md-menu-item ng-if="user.signedIn()">\n        <md-button class="account-button" ng-click="accountPage()">\n          <md-icon class="material-icons">account_circle</md-icon>\n          <span>{{user.get().name}}</span>\n        </md-button>\n      </md-menu-item>\n      <md-menu-item ng-if="user.signedIn()">\n        <md-button ng-click="onLogOut()">\n          <md-icon class="material-icons">exit_to_app</md-icon>\n          <span>Sign Out</span>\n        </md-button>\n      </md-menu-item>\n    </logout>\n  </appnav>\n</md-sidenav>\n'),e.put("sidenav/checkout.html",'<checkout\n  class="md-whiteframe-z2"\n  ng-class="{loaded: loaded}">\n  <iframe\n    class="checkout-frame"\n    onmousewheel=""\n    allowTransparency="true"\n    seamless="seamless">\n  </iframe>\n  <spinner></spinner>\n</checkout>\n'),e.put("sidenav/cited_by.html",'<md-sidenav\n  hammer-sidenav="right"\n  class="md-sidenav-right md-whiteframe-z2 references metrics"\n  md-component-id="cited-by">\n  <div class="sidenav-title md-whiteframe-2dp">\n    <span>Cited By</span>\n    <md-button class="md-icon-button close white" ng-click="closeSidenav(\'cited-by\')">\n      <i class="material-icons">chevron_right</i>\n    </md-button>\n  </div>\n  <cited-by\n    class="sidenav-content"\n    ng-class="{busy: !metrics.results}"\n    infinite-scroll\n    load-more="scrollMetrics()"\n    treshold-percent="80">\n    <div ng-if="metrics.results.length" metrics="metrics.results", tracking-source="citing_article"></div>\n    <div ng-if="!metrics.finished && metrics.results.length" class="loading-more">\n      <div class="loader-inner ball-pulse">\n        <div></div>\n        <div></div>\n        <div></div>\n      </div>\n    </div>\n    <div ng-if="!metrics.results.length" class="no-results">\n      No citing articles found.\n    </div>\n    <spinner></spinner>\n  </cited-by>\n</md-sidenav>\n'),e.put("sidenav/figures.html",'<md-sidenav\n  hammer-sidenav="right"\n  class="md-sidenav-right md-whiteframe-z2 figures"\n  md-component-id="figures">\n  <div class="sidenav-title md-whiteframe-2dp">\n    <span>Figures</span>\n    <md-button class="md-icon-button close white" ng-click="closeSidenav(\'figures\')">\n      <i class="material-icons">chevron_right</i>\n    </md-button>\n  </div>\n  <div class="sidenav-content">\n    <div\n      ng-repeat="figure in ::figures"\n      figure="figure"\n      index="$index"\n      inlist="true">\n    </div>\n  </div>\n</md-sidenav>\n'),e.put("sidenav/leave_feedback.html",'<md-sidenav\n  hammer-sidenav="right"\n  class="md-sidenav-right md-whiteframe-z2 leave-feedback"\n  md-component-id="leave-feedback">\n  <div class="sidenav-title md-whiteframe-2dp">\n    <span>Leave feedback</span>\n    <md-button class="md-icon-button close white" ng-click="closeSidenav(\'leave-feedback\')">\n      <i class="material-icons">chevron_right</i>\n    </md-button>\n  </div>\n  <div class="sidenav-content" ng-controller="LeaveFeedbackCtrl">\n    <h4>How likely is it that you would recommend the mobile web reader to a friend or colleague?</h4>\n    <md-input-container>\n      <md-select ng-model="score" placeholder="Select a value of 0 to 10">\n        <md-option value="10">10&nbsp&nbsp(most likely)</md-option>\n        <md-option value="9">9</md-option>\n        <md-option value="8">8</md-option>\n        <md-option value="7">7</md-option>\n        <md-option value="6">6</md-option>\n        <md-option value="5">5</md-option>\n        <md-option value="4">4</md-option>\n        <md-option value="3">3</md-option>\n        <md-option value="2">2</md-option>\n        <md-option value="1">1</md-option>\n        <md-option value="0">0&nbsp&nbsp(least likely)</md-option>\n      </md-select>\n    </md-input-container>\n    <div class="actions">\n      <md-button class="md-raised" ng-disabled="disabled()" ng-click="submit()">Submit</md-button>\n    </div>\n  </div>\n</md-sidenav>\n'),e.put("sidenav/mobile_annotations.html",'<md-sidenav\n  hammer-sidenav="right"\n  class="md-sidenav-right md-whiteframe-z2 annotations"\n  md-component-id="annotations">\n  <div class="sidenav-title md-whiteframe-2dp">\n    <span>Notes</span>\n    <md-button class="md-icon-button close white" ng-click="closeSidenav(\'annotations\')">\n      <i class="material-icons">chevron_right</i>\n    </md-button>\n  </div>\n  <div class="sidenav-content">\n    <mobile-annotations>\n      <div class="sort-options layout-row">\n        <md-input-container class="sort-order">\n          <label>Order by:</label>\n          <md-select ng-model="sortPredicate">\n            <md-option ng-value="key" ng-repeat="(key, val) in predicates">{{key}}</md-option>\n          </md-select>\n        </md-input-container>\n        <md-input-container class="sort-direction">\n          <label>Direction:</label>\n          <md-select ng-model="sortDirection">\n            <md-option ng-value="key" ng-repeat="(key, val) in directions">{{key}}</md-option>\n          </md-select>\n        </md-input-container>\n      </div>\n      <div\n        class="note-item"\n        ng-click="scrollTo(annot)"\n        ng-repeat="annot in annots | orderBy:predicates[sortPredicate]:directions[sortDirection]">\n        <div ng-if="sortPredicate == \'created\'" class="note-time-date">\n          {{annotationCreated(annot) | calendarDate}}\n        </div>\n        <div ng-if="sortPredicate != \'created\'" class="note-time-date">\n          {{annotationModified(annot) | calendarDate}}\n        </div>\n        <div class="note-highlight" ng-class="\'color-\' + annot.color_id">{{annot.text | breaksToSpaces}}</div>\n        <div class="note-text" ng-if="annot.note">{{annot.note}}</div>\n      </div>\n    </div>\n  </mobile-annotations>\n</md-sidenav>\n'),e.put("sidenav/mobile_menu.html",'<md-sidenav\n  hammer-sidenav="right"\n  class="md-sidenav-right scroll-and-swipe"\n  md-component-id="mobile_menu">\n  <div class="publisher-logo"></div>\n  <md-menu-content width="4">\n    <md-menu-divider></md-menu-divider>\n    <md-menu-item>\n      <md-button ng-click="toggleInLibrary($event)">\n        <div ng-if="syncing" class="spinner-container"><spinner></spinner></div>\n        <md-icon ng-if="!syncing" class="material-icons">{{inLibrary ? \'cloud_off\' : \'cloud_upload\'}}</md-icon>\n        <span>{{inLibrary ? \'Remove from Library\' : \'Add to Library\'}}</span>\n      </md-button>\n    </md-menu-item>\n    <md-menu-item ng-if="::article.get().doi && article.get().meta.url">\n      <md-button ng-click="gotoPublisher()">\n        <md-icon class="material-icons">web</md-icon>\n        <span>{{publisherPageLabel || \'Go to article page\'}}</span>\n      </md-button>\n    </md-menu-item>\n    <md-menu-item ng-if="::sharingEnabled()">\n      <md-button ng-click="share()">\n        <md-icon class="material-icons">share</md-icon>\n        <span>Share</span>\n      </md-button>\n    </md-menu-item>\n    <md-menu-item ng-if="notesEnabled()">\n      <md-button ng-click="openAnnots()">\n        <md-icon class="material-icons">chat</md-icon>\n        <span class="md-badge" data-badge="{{notes.length}}">Notes</span>\n      </md-button>\n    </md-menu-item>\n    <md-menu-item ng-if="::references.length">\n      <md-button ng-click="openReferences()">\n        <md-icon class="material-icons">list</md-icon>\n        <span class="md-badge" data-badge="{{::references.length}}">References</span>\n      </md-button>\n    </md-menu-item>\n    <md-menu-item ng-if="::figures.length">\n      <md-button ng-click="openFigures()">\n        <md-icon class="material-icons">photo_library</md-icon>\n        <span class="md-badge" data-badge="{{::figures.length}}">Figures</span>\n      </md-button>\n    </md-menu-item>\n    <md-menu-item ng-if="::metadata">\n      <md-button ng-click="openRelated()">\n        <md-icon class="material-icons">layers</md-icon>\n        <span>Related articles</span>\n      </md-button>\n    </md-menu-item>\n    <md-menu-item ng-if="::article.get().doi && metadata.citations_count">\n      <md-button ng-click="openMetrics()">\n        <md-icon class="material-icons">link</md-icon>\n        <span class="md-badge" ng-attr-data-badge="{{::metadata.citations_count | kilo}}">Cited by</span>\n      </md-button>\n    </md-menu-item>\n    <md-menu-item ng-if="::supplements.length">\n      <md-button ng-click="openSupplements()">\n        <md-icon class="material-icons">library_add</md-icon>\n        <span class="md-badge" data-badge="{{::supplements.length}}">Supplements</span>\n      </md-button>\n    </md-menu-item>\n    <md-menu-item ng-if="::article.get().doi && metadata.rcr">\n      <md-button ng-click="openRCR()">\n        <md-icon class="material-icons">assessment</md-icon>\n        <span>RCR: {{::(+metadata.rcr).toFixed(2)}}</span>\n      </md-button>\n    </md-menu-item>\n    <md-menu-item ng-if="::altmetric.score">\n      <md-button ng-click="openAltmetric()">\n        <div class="altmetric-embed">\n          <img ng-src="{{::altmetric.images.medium}}" width="26px" height="26px">\n        </div>\n        <span>Altmetric</span>\n      </md-button>\n    </md-menu-item>\n    <md-menu-item ng-if="user.signedIn()">\n      <md-button class="account-button" ng-click="accountPage($event)">\n        <md-icon class="material-icons">account_circle</md-icon>\n        <span>{{user.get().name}}</span>\n      </md-button>\n    </md-menu-item>\n    <md-menu-item ng-if="user.signedIn()">\n      <md-button ng-click="signOut()">\n        <md-icon class="material-icons">exit_to_app</md-icon>\n        <span>Sign Out</span>\n      </md-button>\n    </md-menu-item>\n    <md-menu-item ng-if="!user.signedIn()">\n      <md-button ng-click="signIn($event)">\n        <div class="rc-logo"></div>\n        <span>Sign In</span>\n      </md-button>\n    </md-menu-item>\n    <md-menu-item ng-if="!$root.mobileFeedback">\n      <md-button ng-click="leaveFeedback()">\n        <md-icon class="material-icons">star_half</md-icon>\n        <span>Leave feedback</span>\n      </md-button>\n    </md-menu-item>\n    <md-menu-item>\n      <md-button ng-click="contactSupport()">\n        <md-icon class="material-icons">help</md-icon>\n        <span>Contact support</span>\n      </md-button>\n    </md-menu-item>\n    <md-menu-divider></md-menu-divider>\n  </md-menu-content>\n</md-sidenav>\n'),e.put("sidenav/mobile_share.html",'<md-sidenav\n  hammer-sidenav="right"\n  class="md-sidenav-right md-whiteframe-z2 share"\n  md-component-id="share">\n  <div class="sidenav-title md-whiteframe-2dp">\n    <span>Share</span>\n    <md-button class="md-icon-button close white" ng-click="closeSidenav(\'share\')">\n      <i class="material-icons">chevron_right</i>\n    </md-button>\n  </div>\n  <div class="sidenav-content share-content" ng-controller="ShareCtrl">\n    <i class="material-icons share">share</i>\n    <div class="md-subhead">SHAREABLE URL</div>\n    <h2 class="md-title">Anyone with this URL can read the full text of this article</h2>\n    <div class="link-container" ng-class="{busy: busy}">\n      <div class="link">\n        <i class="material-icons">link</i>\n      </div>\n      <input\n        id="share-link"\n        type="text"\n        readonly="readonly"\n        ng-model="shareLink"\n        ng-mousedown="select($event)">\n    </div>\n    <md-button\n      class="md-raised copy-shared-url"\n      data-clipboard-target="#share-link"\n      ng-disabled="!shareLink || busy"\n      clipboard>\n      Copy URL\n    </md-button>\n    <div>\n      <md-switch class="md-block" ng-model="includeAnnotations">\n        Include Annotations\n      </md-switch>\n    </div>\n  </div>\n</md-sidenav>\n'),e.put("sidenav/mobile_share_wiley.html",'<md-sidenav\n  hammer-sidenav="right"\n  class="md-sidenav-right md-whiteframe-z2 share share-wiley"\n  md-component-id="share-wiley">\n  <div class="sidenav-title md-whiteframe-2dp">\n    <span>Share</span>\n    <md-button class="md-icon-button close white" ng-click="closeSidenav(\'share-wiley\')">\n      <i class="material-icons">chevron_right</i>\n    </md-button>\n  </div>\n  <div class="sidenav-content share-content" ng-controller="ShareWileyCtrl">\n    <i class="material-icons share">share</i>\n    <h1>Share</h1>\n    <p>Please review our <a target="_blank" href="https://onlinelibrary.wiley.com/termsAndConditions">Terms and Conditions of Use</a> and check box below to share full-text version of article.</p>\n    <md-checkbox\n      class="md-primary"\n      ng-model="acceptTerms"\n      ng-click="generateLink()"\n      aria-label="Terms and Conditions of Use">\n      I have read and accept the Wiley Online Library Terms and Conditions of Use.\n    </md-checkbox>\n    <p>Use the link below to share a full-text version of this article with your friends and colleagues. <a target="_blank" href="http://www.wiley.com/WileyCDA/Section/id-829333.html">Learn more.</a></p>\n    <label class="link-label">Shareable Link</label>\n    <div class="link-container" ng-class="{busy: busy}">\n      <div class="link">\n        <i class="material-icons">link</i>\n      </div>\n      <input\n        id="share-link-wiley"\n        type="text"\n        readonly="readonly"\n        ng-model="shareLink"\n        ng-disabled="!acceptTerms"\n        ng-mousedown="select($event)">\n    </div>\n    <md-button\n      class="md-raised copy-shared-url"\n      data-clipboard-target="#share-link-wiley"\n      ng-disabled="!acceptTerms || !shareLink || busy"\n      clipboard>\n      Copy URL\n    </md-button>\n  </div>\n</md-sidenav>\n'),e.put("sidenav/mobile_user.html",'<md-sidenav\n  id="user-sidenav"\n  md-component-id="user"\n  class="md-sidenav-right user-sidenav"\n  ng-class="{\'register-ad\': registerAd}">\n  <div class="sidenav-title md-whiteframe-2dp">\n    <span>{{::title}}</span>\n    <md-button class="md-icon-button close white" ng-click="close()">\n      <i class="material-icons">chevron_right</i>\n    </md-button>\n  </div>\n  <div class="sidenav-content">\n    <pre-login\n      ng-if="registerAd"\n      ng-include="registerAd">\n    </pre-login>\n    <login ng-class="{loaded: loaded}">\n      <div class="frame-container">\n        <iframe\n          class="modal login"\n          ng-src="{{::src | trustUrl}}"\n          allowtransparency="true"\n          seamless="seamless">\n        </iframe>\n      </div>\n      <spinner></spinner>\n    </login>\n  </div>\n</md-sidenav>\n'),e.put("sidenav/rcr.html",'<md-sidenav\n  hammer-sidenav="right"\n  class="md-sidenav-right md-whiteframe-z2 rcr"\n  md-component-id="rcr">\n  <div class="sidenav-title md-whiteframe-2dp">\n    <span>Relative Citation Ratio</span>\n    <md-button class="md-icon-button close white" ng-click="closeSidenav(\'rcr\')">\n      <i class="material-icons">chevron_right</i>\n    </md-button>\n  </div>\n  <div class="sidenav-content">\n    <h1>RCR: <span>{{(+metadata.rcr).toFixed(2)}}</span></h1>\n    <p>The <a target="_blank" href="http://biorxiv.org/content/early/2015/10/22/029629">Relative Citation Ratio</a> (RCR) is a new citation-based measure of article influence, developed by the <a target="_blank" href="https://dpcpsi.nih.gov/opa/index">Office for Portfolio Analysis</a> (OPA) at the National Institutes of Health in the USA. It was designed to address some of the shortcomings of more standard citation number and Journal Impact Factor (JIF) measures. It does this by normalizing an articles citation number to both time since publication and the field in which it was published, as using citation number alone (see Times cited) does not account for them.</p>\n    <p>Some areas of research experience higher average levels of citation than others, leading to a citation count of 8 being regarded as high in some fields, but low in others. Along the same lines, a new paper may represent a significant scientific breakthrough, but it will have a low citation count if published recently. By taking into account time and field, the RCR attempts to produce an improved indication of impact and reception. For more information on these, and other RCR improvements, you are encouraged to click on the <a target="_blank" href="http://biorxiv.org/content/early/2015/10/22/029629">RCR</a> and <a target="_blank" href="https://dpcpsi.nih.gov/opa/index">OPA</a> links in this description.</p>\n    <p>NOTE: Not all publications have an RCR score, and this may be for several reasons. For example, if a paper is less than two years old, or older than 1980, it is unlikely to have an RCR score due to the lack of robust citation information in short periods and before 1980. Other criteria that the OPA have for inclusion or exclusion of papers are based on relative timing of citations for papers and qualifying journals contributing to the score.</p>\n  </div>\n</md-sidenav>\n'),e.put("sidenav/references.html",'<md-sidenav\n  hammer-sidenav="right"\n  class="md-sidenav-right md-whiteframe-z2 references"\n  md-component-id="references">\n  <div class="sidenav-title md-whiteframe-2dp">\n    <span>References</span>\n    <md-button class="md-icon-button close white" ng-click="closeSidenav(\'references\')">\n      <i class="material-icons">chevron_right</i>\n    </md-button>\n  </div>\n  <div class="sidenav-content">\n    <div ng-if="::references.length" class="articles">\n      <reference-list refs="::references" tracking-source="reference"></reference-list>\n    </div>\n  </div>\n</md-sidenav>\n'),e.put("sidenav/related.html",'<md-sidenav\n  hammer-sidenav="right"\n  class="md-sidenav-right md-whiteframe-z2 related"\n  md-component-id="related">\n  <div class="sidenav-title md-whiteframe-2dp">\n    <span>Related Articles</span>\n    <md-button class="md-icon-button close white" ng-click="closeSidenav(\'related\')">\n      <i class="material-icons">chevron_right</i>\n    </md-button>\n  </div>\n  <div class="sidenav-content" ng-class="{busy: !related}">\n    <div ng-if="related.length" references="related" tracking-source="related_article"></div>\n    <div ng-if="!related.length" class="no-results">\n      No related articles found.\n    </div>\n    <spinner></spinner>\n  </div>\n</md-sidenav>\n'),
e.put("sidenav/supplement_info.html",'<supplement-info class="md-whiteframe-z2">\n  <div class="container" ng-if="::supplement">\n    <h3>Details</h3>\n    <md-button class="md-icon-button close grey" ng-click="toggleInfo()">\n      <i class="material-icons">close</i>\n    </md-button>\n    <div class="blue-divider"></div>\n    <h4>{{::supplement.caption}} ({{::supplement.type.toUpperCase()}})</h4>\n    <div class="description" ng-if="::supplement.description">\n      {{::supplement.description}}\n    </div class="description">\n  </div>\n</supplement-info>\n'),e.put("sidenav/supplements.html",'<md-sidenav\n  hammer-sidenav="right"\n  class="md-sidenav-right md-whiteframe-z2 supplements"\n  md-component-id="supplements">\n  <div ng-controller="SupplementsCtrl">\n    <div class="sidenav-title md-whiteframe-2dp">\n      <span>Supporting Information</span>\n      <md-button class="md-icon-button close white" ng-click="closeSidenav(\'supplements\')">\n        <i class="material-icons">chevron_right</i>\n      </md-button>\n    </div>\n    <div class="sidenav-content">\n      <a\n        ng-repeat="sup in ::supplements"\n        target="_blank"\n        ng-class="[\'supplement\', sup.type]"\n        ng-href="{{::sup.url}}"\n        ng-click="viewSupplement($event, sup)">\n        <div class="thumb" bg-image="{{::sup.thumb[0]}}">\n          <i ng-if="::sup.type == \'video\'" class="material-icons play-icon">play_circle_outline</i>\n        </div>\n        <span class="caption" title="{{::sup.description | clipTitle}}">\n          <b>{{::sup.caption}}<span> ({{::sup.type.toUpperCase()}})</span></b>\n          <span ng-if="::sup.description"><b> | </b>{{::sup.description}}</span>\n        </span>\n      </a>\n    </div>\n  </div>\n</md-sidenav>\n'),e.put("toolbars/mobile_slider.html",'  <div class="slider" aria-label="Slide between pages">\n    <div class="slider-wrap">\n      <div class="slider-track">\n        <div class="slider-fill"></div>\n        <div class="slider-thumb">\n          <div class="focus-ring"></div>\n          <div class="thumb-ring"></div>\n        </div>\n      </div>\n    </div>\n  </div>'),e.put("toolbars/mobile_toolbar.html",'<div\n  class="mobile-toolbar"\n  ng-class="{downloading: downloading, authorizing: authorizing, unauthorized: unauthorized }">\n  <div class="auth-bar">\n    <div class="access-prompt" ng-if="unauthorized" ng-click="getAccess()" md-ink-ripple="#FFF">\n      <i class="material-icons get-access">lock_open</i>\n      <span>Get Access</span>\n    </div>\n    <div class="access-progress" ng-if="!unauthorized">\n      <div class="loader-inner square-spin">\n        <div></div>\n      </div>\n      <span>Checking Access...</span>\n    </div>\n  </div>\n  <div class="checkout-bar"></div>\n  <div class="main-bar">\n    <i\n      class="material-icons menu"\n      ng-click="menu()"\n      md-ink-ripple="#FFF">\n      menu\n    </i>\n    <i\n      class="material-icons next-page"\n      ng-if="::viewer.initialized"\n      ng-class="{invisible: pageIndex <= 1}"\n      ng-click="prevPage()"\n      md-ink-ripple="#FFF">\n      navigate_before\n    </i>\n    <span ng-if="::viewer.initialized">\n      {{pageIndex}} / {{numPages}}\n    </span>\n    <i\n      class="material-icons prev-page"\n      ng-if="::viewer.initialized"\n      ng-class="{invisible: pageIndex >= numPages}"\n      ng-click="nextPage()"\n      md-ink-ripple="#FFF">\n      navigate_next\n    </i>\n    <i\n      class="material-icons download"\n      ng-click="download()"\n      md-ink-ripple="#FFF">\n      file_download\n    </i>\n    <div class="download-spinner">\n      <spinner></spinner>\n    </div>\n  </div>\n</div>'),e.put("toolbars/page_info.html",'<div class="page-info">\n  <div class="pagination">\n    <input class="idx" val=""></input>/\n    <div class="num"></div>\n  </div>\n  <div class="progress-container">\n    <spinner></spinner>\n    <i class="material-icons access-icon">lock</i>\n  </div>\n</div>\n'),e.put("toolbars/viewer_toolbar.html",'<div\n  class="viewer-toolbar"\n  ng-class="{downloading: downloading, printing: printing}">\n  <a\n    ng-repeat="(action, handler) in ::toolbar"\n    ng-hide="disabled[action]"\n    ng-attr-target="{{::toolbarLinks[action].target}}"\n    ng-href="{{::toolbarLinks[action].href}}"\n    ng-class="action"\n    ng-click="handler($event)"\n    md-ink-ripple=\'#FFF\'\n    class="toolbar-btn">\n    <i class="material-icons">{{::action}}</i>\n    <spinner></spinner>\n  </a>\n  <a\n    ng-if="article.get().publisher != \'ieee\'"\n    class="toolbar-btn" target="_blank" href="http://support.readcube.com/">\n    <i class="material-icons">help</i>\n  </a>\n</div>\n'),e.put("toast/access_forbidden.html",'<md-toast>\n  <div class="flex-row">\n    <i class="material-icons">update</i>\n    <span class="message">\n      Your session has expired, please reload the page to regain access to the article.\n    </span>\n    <md-button class="open" ng-click="reload()">\n      Reload\n    </md-button>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>'),e.put("toast/annots_not_synced.html",'<md-toast class="annots-not-synced">\n  <div class="flex-row">\n    <i class="material-icons">cloud_off</i>\n    <span class="message">\n      Annotations not saved. To save annotations, please add this article to your Library.\n    </span>\n    <md-button class="add-to-library" ng-click="addToLibrary($event)">\n      Add to Library\n    </md-button>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>'),e.put("toast/auth_failed.html",'<md-toast class="auth-failed">\n  <div class="flex-row">\n    <i class="material-icons">lock</i>\n    <span class="message">\n      We are unable to authorize full PDF access to this article at this time. Click <a target="_blank" ng-href="{{::articleUrl}}">here</a> to access it on the publishers site.\n    </span>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>\n'),e.put("toast/info_message.html",'<md-toast>\n  <div class="flex-row">\n    <i class="material-icons">info</i>\n    <span class="message">\n      {{message}}\n    </span>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>'),e.put("toast/prompt_register.html",'<md-toast class="register-prompt">\n  <div class="flex-row">\n    <i class="material-icons">person</i>\n    <span class="message">\n      Please <a class="login" ng-click="login()">sign in</a> or create a free ReadCube account to view citation data.\n    </span>\n    <md-button class="register" ng-click="register()">\n      Register\n    </md-button>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>\n'),e.put("toast/read_personal.html",'<md-toast class="read-personal">\n  <div class="flex-row">\n    <i class="material-icons">cloud</i>\n    <span class="message">\n      You have this article in your ReadCube library. Open that version to get full-text access.\n    </span>\n    <md-button class="open" ng-click="openPersonal()">\n      Open\n    </md-button>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>'),e.put("toast/rental_expiry.html",'<md-toast class="rental-expiry">\n  <div class="flex-row">\n    <i class="material-icons">timelapse</i>\n    <span class="message expires-in" ng-if="expiresIn">\n      Rental expires in<br>\n      <span class="duration">{{expiresIn | rentalDuration}}</span>\n    </span>\n    <span class="message expired-on" ng-if="::expiredOn">\n      Rental expired on <span class="time">{{::expiredOn | formatDate:\'dddd, MMMM Do YYYY, h:mm a\'}}</span>\n    </span>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>\n'),e.put("toast/shared_access.html",'<md-toast class="shared-access">\n  <div class="flex-row">\n    <i class="material-icons share">share</i>\n    <span class="message">\n      {{::message}}<br>\n      <a class="back-to-publisher" ng-if="::gotoPublisher" ng-click="gotoPublisher()">\n        Back to {{::publisherName}}\n      </a>\n      <a class="whats-this" target="_blank" ng-if="::whatsThisLink" ng-href="{{::whatsThisLink}}">\n        What\'s this?\n      </a>\n    </span>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>'),e.put("toast/shared_access_wiley.html",'<md-toast class="shared-access shared-access-wiley">\n  <div class="flex-row">\n    <i class="material-icons share">share</i>\n    <span class="message">\n      {{::message}}<br>\n      <a target="_blank" class="learn-more" ng-href="{{::learnMoreLink}}">\n        Learn More\n      </a>\n      <a class="get-access" ng-if="::type == \'access\'" ng-click="getAccess()">\n        Get Access\n      </a>\n    </span>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>'),e.put("toast/synced_ad.html",'<md-toast class="synced-ad">\n  <div class="title">This article has been added to your library.</div>\n  <p>Try ReadCube\'s free apps to access the Enhanced PDF anytime:</p>\n  <a target="_blank" class="md-button desktop-app" ng-href="{{::endpoint.web + \'/download\'}}">\n    <i class="material-icons">desktop_mac</i>\n    <span class="message">\n      ReadCube Desktop (Win/Mac)\n    </span>\n  </a>\n  <a target="_blank" class="md-button ios-app" ng-href="{{::endpoint.mobile_apps.ios}}">\n    <i class="material-icons">tablet_mac</i>\n    <span class="message">\n      ReadCube iOS (iPhone/iPad)\n    </span>\n  </a>\n  <a target="_blank" class="md-button android-app" ng-href="{{::endpoint.mobile_apps.android}}">\n    <i class="material-icons">android</i>\n    <span class="message">\n      ReadCube Android\n    </span>\n  </a>\n  <a target="_blank" class="md-button web-app" ng-href="{{::endpoint.app}}">\n    <i class="material-icons">web</i>\n    <span class="message">\n      ReadCube Web Library\n    </span>\n  </a>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>'),e.put("toast/update_available.html",'<md-toast>\n  <div class="flex-row">\n    <i class="material-icons">update</i>\n    <span class="message">\n      A new version of this application is available.\n    </span>\n    <md-button class="open" ng-click="reload()">\n      Update\n    </md-button>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>'),e.put("toast/mobile/annots_not_synced.html",'<md-toast class="annots-not-synced">\n  <span class="message">\n    Annotations not saved. To save annotations, please add this article to your Library.\n  </span>\n  <div class="actions">\n    <a class="add-to-library" ng-click="addToLibrary($event)">Add to Library</a>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>'),e.put("toast/mobile/auth_failed.html",'<md-toast class="auth-failed">\n  <span class="message">\n    We are unable to authorize full PDF access to this article at this time.\n  </span>\n  <div class="actions">\n    <a target="_blank" ng-href="{{::articleUrl}}">Access on publisher site</a>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>\n'),e.put("toast/mobile/info_message.html",'<md-toast>\n  <div class="flex-row">\n    <i class="material-icons message-icon">info</i>\n    <span class="message">{{message}}</span>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>'),e.put("toast/mobile/prompt_register.html",'<md-toast class="register-prompt">\n  <span class="message">\n    Please sign in or create a free ReadCube account to view citation data.\n  </span>\n  <div class="actions">\n    <a class="login" ng-click="login()">Sign In</a>\n    <a class="register right" ng-click="register()">Register</a>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>\n'),e.put("toast/mobile/read_personal.html",'<md-toast class="read-personal">\n  <span class="message">\n    You have this article in your ReadCube library. Open that version to get full-text access.\n  </span>\n  <div class="actions">\n    <a class="open" ng-click="openPersonal()">Open in library</a>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>'),e.put("toast/mobile/rental_expiry.html",'<md-toast class="rental-expiry">\n  <div class="flex-row">\n    <i class="material-icons message-icon">timelapse</i>\n    <span class="message" ng-if="expiresIn">\n      Rental expires in<br>\n      <span class="duration">{{expiresIn | rentalDuration}}</span>\n    </span>\n    <span class="message expired-on" ng-if="::expiredOn">\n      Rental expired on <span class="time">{{::expiredOn | formatDate:\'dddd, MMMM Do YYYY, h:mm a\'}}</span>\n    </span>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>\n'),e.put("toast/mobile/shared_access.html",'<md-toast class="shared-access">\n  <span class="message">{{::message}}</span>\n  <div class="actions clear-float">\n    <a class="back-to-publisher" ng-if="::gotoPublisher" ng-click="gotoPublisher()">\n      Back to {{::publisherName}}\n    </a>\n    <a class="whats-this" target="_blank" ng-if="::whatsThisLink" ng-href="{{::whatsThisLink}}">\n      What\'s this?\n    </a>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>'),e.put("toast/mobile/shared_access_wiley.html",'<md-toast class="shared-access shared-access-wiley">\n  <span class="message">{{::message}}</span>\n  <div class="actions">\n    <a target="_blank" class="learn-more" ng-href="{{::learnMoreLink}}">\n      Learn More\n    </a>\n    <a class="get-access right" ng-if="::type == \'access\'" ng-click="getAccess()">\n      Get Access\n    </a>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>'),e.put("toast/mobile/synced_ad.html",'<md-toast class="synced-ad">\n  <span class="message">\n    This article has been added to your library.\n    Try ReadCube\'s free apps to access the Enhanced PDF anytime:\n  </span>\n  <div class="actions clear-float">\n    <a target="_blank" class="md-button ios-app" ng-href="{{::endpoint.mobile_apps.ios}}">\n      <i class="material-icons">tablet_mac</i>\n      <span>ReadCube iOS (iPhone/iPad)</span>\n    </a>\n    <a target="_blank" class="md-button android-app" ng-href="{{::endpoint.mobile_apps.android}}">\n      <i class="material-icons">android</i>\n      <span>ReadCube Android</span>\n    </a>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>'),e.put("toast/mobile/update_available.html",'<md-toast>\n  <span class="message">\n    A new version of this application is available.\n  </span>\n  <div class="actions">\n    <a class="open" ng-click="reload()">Update now</a>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>')}])},{}]},{},[205]);
//# sourceMappingURL=../maps/main.js.a9bc9b08.map
